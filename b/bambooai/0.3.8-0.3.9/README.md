# Comparing `tmp/bambooai-0.3.8.tar.gz` & `tmp/bambooai-0.3.9.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "bambooai-0.3.8.tar", last modified: Sat Jul  1 05:15:43 2023, max compression
+gzip compressed data, was "bambooai-0.3.9.tar", last modified: Tue Jul 11 10:25:49 2023, max compression
```

## Comparing `bambooai-0.3.8.tar` & `bambooai-0.3.9.tar`

### file list

```diff
@@ -1,17 +1,19 @@
-drwxrwxrwx   0        0        0        0 2023-07-01 05:15:43.776786 bambooai-0.3.8/
--rw-rw-rw-   0        0        0     7870 2023-07-01 05:15:43.776511 bambooai-0.3.8/PKG-INFO
--rw-rw-rw-   0        0        0     7317 2023-06-27 07:25:47.000000 bambooai-0.3.8/README.md
-drwxrwxrwx   0        0        0        0 2023-07-01 05:15:43.741875 bambooai-0.3.8/bambooai/
--rw-rw-rw-   0        0        0      107 2023-06-27 07:23:09.000000 bambooai-0.3.8/bambooai/__init__.py
--rw-rw-rw-   0        0        0    31937 2023-07-01 04:57:43.000000 bambooai-0.3.8/bambooai/bambooai.py
--rw-rw-rw-   0        0        0     1309 2023-06-22 23:44:14.000000 bambooai-0.3.8/bambooai/func_calls.py
--rw-rw-rw-   0        0        0     6154 2023-07-01 04:51:12.000000 bambooai-0.3.8/bambooai/prompts.py
--rw-rw-rw-   0        0        0     4189 2023-06-27 02:19:42.000000 bambooai-0.3.8/bambooai/qa_retrieval.py
-drwxrwxrwx   0        0        0        0 2023-07-01 05:15:43.774692 bambooai-0.3.8/bambooai.egg-info/
--rw-rw-rw-   0        0        0     7870 2023-07-01 05:15:43.000000 bambooai-0.3.8/bambooai.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0      287 2023-07-01 05:15:43.000000 bambooai-0.3.8/bambooai.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-07-01 05:15:43.000000 bambooai-0.3.8/bambooai.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       24 2023-07-01 05:15:43.000000 bambooai-0.3.8/bambooai.egg-info/requires.txt
--rw-rw-rw-   0        0        0        9 2023-07-01 05:15:43.000000 bambooai-0.3.8/bambooai.egg-info/top_level.txt
--rw-rw-rw-   0        0        0       42 2023-07-01 05:15:43.777486 bambooai-0.3.8/setup.cfg
--rw-rw-rw-   0        0        0      702 2023-07-01 05:11:02.000000 bambooai-0.3.8/setup.py
+drwxrwxrwx   0        0        0        0 2023-07-11 10:25:49.876465 bambooai-0.3.9/
+-rw-rw-rw-   0        0        0     7870 2023-07-11 10:25:49.875645 bambooai-0.3.9/PKG-INFO
+-rw-rw-rw-   0        0        0     7317 2023-06-27 07:25:47.000000 bambooai-0.3.9/README.md
+drwxrwxrwx   0        0        0        0 2023-07-11 10:25:49.837200 bambooai-0.3.9/bambooai/
+-rw-rw-rw-   0        0        0      129 2023-07-11 09:57:21.000000 bambooai-0.3.9/bambooai/__init__.py
+-rw-rw-rw-   0        0        0    29539 2023-07-11 09:55:36.000000 bambooai-0.3.9/bambooai/bambooai.py
+-rw-rw-rw-   0        0        0     1247 2023-07-07 13:06:55.000000 bambooai-0.3.9/bambooai/func_calls.py
+-rw-rw-rw-   0        0        0     5699 2023-07-07 09:09:32.000000 bambooai-0.3.9/bambooai/google_search.py
+-rw-rw-rw-   0        0        0     5338 2023-07-10 03:58:50.000000 bambooai-0.3.9/bambooai/models.py
+-rw-rw-rw-   0        0        0     6085 2023-07-11 08:04:02.000000 bambooai-0.3.9/bambooai/prompts.py
+-rw-rw-rw-   0        0        0     4189 2023-06-27 02:19:42.000000 bambooai-0.3.9/bambooai/qa_retrieval.py
+drwxrwxrwx   0        0        0        0 2023-07-11 10:25:49.874376 bambooai-0.3.9/bambooai.egg-info/
+-rw-rw-rw-   0        0        0     7870 2023-07-11 10:25:49.000000 bambooai-0.3.9/bambooai.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      332 2023-07-11 10:25:49.000000 bambooai-0.3.9/bambooai.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-07-11 10:25:49.000000 bambooai-0.3.9/bambooai.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       45 2023-07-11 10:25:49.000000 bambooai-0.3.9/bambooai.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        9 2023-07-11 10:25:49.000000 bambooai-0.3.9/bambooai.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0       42 2023-07-11 10:25:49.876793 bambooai-0.3.9/setup.cfg
+-rw-rw-rw-   0        0        0      747 2023-07-11 10:21:19.000000 bambooai-0.3.9/setup.py
```

### Comparing `bambooai-0.3.8/PKG-INFO` & `bambooai-0.3.9/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: bambooai
-Version: 0.3.8
+Version: 0.3.9
 Summary: A lightweight library for working with pandas dataframes using natural language queries
 Home-page: UNKNOWN
 Author: Palo Galko
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
 Classifier: License :: OSI Approved :: MIT License
```

### Comparing `bambooai-0.3.8/README.md` & `bambooai-0.3.9/README.md`

 * *Files identical despite different names*

### Comparing `bambooai-0.3.8/bambooai/bambooai.py` & `bambooai-0.3.9/bambooai/bambooai.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,1997 +1,1847 @@
 00000000: 0d0a 696d 706f 7274 206f 730d 0a69 6d70  ..import os..imp
 00000010: 6f72 7420 7265 0d0a 696d 706f 7274 2073  ort re..import s
-00000020: 7973 0d0a 696d 706f 7274 2062 6173 6536  ys..import base6
-00000030: 340d 0a69 6d70 6f72 7420 6a73 6f6e 0d0a  4..import json..
-00000040: 6672 6f6d 2063 6f6e 7465 7874 6c69 6220  from contextlib 
-00000050: 696d 706f 7274 2072 6564 6972 6563 745f  import redirect_
-00000060: 7374 646f 7574 0d0a 696d 706f 7274 2069  stdout..import i
-00000070: 6f0d 0a69 6d70 6f72 7420 7469 6d65 0d0a  o..import time..
-00000080: 696d 706f 7274 206f 7065 6e61 690d 0a69  import openai..i
-00000090: 6d70 6f72 7420 7061 6e64 6173 2061 7320  mport pandas as 
-000000a0: 7064 0d0a 6672 6f6d 2074 6572 6d63 6f6c  pd..from termcol
-000000b0: 6f72 2069 6d70 6f72 7420 636f 6c6f 7265  or import colore
-000000c0: 642c 2063 7072 696e 740d 0a66 726f 6d20  d, cprint..from 
-000000d0: 4950 7974 686f 6e2e 6469 7370 6c61 7920  IPython.display 
-000000e0: 696d 706f 7274 2064 6973 706c 6179 2c20  import display, 
-000000f0: 496d 6167 652c 2048 544d 4c0d 0a69 6d70  Image, HTML..imp
-00000100: 6f72 7420 7761 726e 696e 6773 0d0a 7761  ort warnings..wa
-00000110: 726e 696e 6773 2e66 696c 7465 7277 6172  rnings.filterwar
-00000120: 6e69 6e67 7328 2769 676e 6f72 6527 290d  nings('ignore').
-00000130: 0a0d 0a23 5275 6e6e 696e 6720 6173 2061  ...#Running as a
-00000140: 2073 6372 6970 740d 0a23 696d 706f 7274   script..#import
-00000150: 2070 726f 6d70 7473 0d0a 2369 6d70 6f72   prompts..#impor
-00000160: 7420 6675 6e63 5f63 616c 6c73 0d0a 2369  t func_calls..#i
-00000170: 6d70 6f72 7420 7161 5f72 6574 7269 6576  mport qa_retriev
-00000180: 616c 0d0a 0d0a 2352 756e 6e69 6e67 2061  al....#Running a
-00000190: 7320 6120 7061 636b 6167 650d 0a66 726f  s a package..fro
-000001a0: 6d20 2e20 696d 706f 7274 2070 726f 6d70  m . import promp
-000001b0: 7473 0d0a 6672 6f6d 202e 2069 6d70 6f72  ts..from . impor
-000001c0: 7420 6675 6e63 5f63 616c 6c73 0d0a 6672  t func_calls..fr
-000001d0: 6f6d 202e 2069 6d70 6f72 7420 7161 5f72  om . import qa_r
-000001e0: 6574 7269 6576 616c 0d0a 0d0a 636c 6173  etrieval....clas
-000001f0: 7320 4261 6d62 6f6f 4149 3a0d 0a20 2020  s BambooAI:..   
-00000200: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00000210: 6c66 2c20 6466 3a20 7064 2e44 6174 6146  lf, df: pd.DataF
-00000220: 7261 6d65 2c0d 0a20 2020 2020 2020 2020  rame,..         
-00000230: 2020 2020 2020 2020 6d61 785f 636f 6e76          max_conv
-00000240: 6572 7361 7469 6f6e 733a 2069 6e74 203d  ersations: int =
-00000250: 2034 2c0d 0a20 2020 2020 2020 2020 2020   4,..           
-00000260: 2020 2020 2020 6c6c 6d3a 2073 7472 203d        llm: str =
-00000270: 2027 6770 742d 332e 352d 7475 7262 6f2d   'gpt-3.5-turbo-
-00000280: 3036 3133 272c 0d0a 2020 2020 2020 2020  0613',..        
-00000290: 2020 2020 2020 2020 206c 6c6d 5f66 756e           llm_fun
-000002a0: 633a 2073 7472 203d 2027 6770 742d 332e  c: str = 'gpt-3.
-000002b0: 352d 7475 7262 6f2d 3036 3133 272c 0d0a  5-turbo-0613',..
-000002c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000002d0: 206c 6c6d 5f31 366b 3a20 7374 7220 3d20   llm_16k: str = 
-000002e0: 2767 7074 2d33 2e35 2d74 7572 626f 2d31  'gpt-3.5-turbo-1
-000002f0: 366b 272c 0d0a 2020 2020 2020 2020 2020  6k',..          
-00000300: 2020 2020 2020 206c 6c6d 5f67 7074 343a         llm_gpt4:
-00000310: 2073 7472 203d 2027 6770 742d 342d 3036   str = 'gpt-4-06
-00000320: 3133 272c 0d0a 2020 2020 2020 2020 2020  13',..          
-00000330: 2020 2020 2020 2064 6562 7567 3a20 626f         debug: bo
-00000340: 6f6c 203d 2046 616c 7365 2c20 0d0a 2020  ol = False, ..  
-00000350: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00000360: 6563 746f 725f 6462 3a20 626f 6f6c 203d  ector_db: bool =
-00000370: 2046 616c 7365 2c20 0d0a 2020 2020 2020   False, ..      
-00000380: 2020 2020 2020 2020 2020 206c 6c6d 5f73             llm_s
-00000390: 7769 7463 683a 2062 6f6f 6c20 3d20 4661  witch: bool = Fa
-000003a0: 6c73 652c 200d 0a20 2020 2020 2020 2020  lse, ..         
-000003b0: 2020 2020 2020 2020 6578 706c 6f72 6174          explorat
-000003c0: 6f72 793a 2062 6f6f 6c20 3d20 5472 7565  ory: bool = True
-000003d0: 2c20 0d0a 2020 2020 2020 2020 2020 2020  , ..            
-000003e0: 2020 2020 2029 3a0d 0a0d 0a20 2020 2020       ):....     
-000003f0: 2020 2073 656c 662e 4150 495f 4b45 5920     self.API_KEY 
-00000400: 3d20 6f73 2e65 6e76 6972 6f6e 2e67 6574  = os.environ.get
-00000410: 2827 4f50 454e 4149 5f41 5049 5f4b 4559  ('OPENAI_API_KEY
-00000420: 2729 0d0a 0d0a 2020 2020 2020 2020 2320  ')....        # 
-00000430: 4368 6563 6b20 6966 2074 6865 204f 5045  Check if the OPE
-00000440: 4e41 495f 4150 495f 4b45 5920 656e 7669  NAI_API_KEY envi
-00000450: 726f 6e6d 656e 7420 7661 7269 6162 6c65  ronment variable
-00000460: 2069 7320 7365 740d 0a20 2020 2020 2020   is set..       
-00000470: 2069 6620 6e6f 7420 7365 6c66 2e41 5049   if not self.API
-00000480: 5f4b 4559 3a0d 0a20 2020 2020 2020 2020  _KEY:..         
-00000490: 2020 2072 6169 7365 2045 6e76 6972 6f6e     raise Environ
-000004a0: 6d65 6e74 4572 726f 7228 224f 5045 4e41  mentError("OPENA
-000004b0: 495f 4150 495f 4b45 5920 656e 7669 726f  I_API_KEY enviro
-000004c0: 6e6d 656e 7420 7661 7269 6162 6c65 206e  nment variable n
-000004d0: 6f74 2066 6f75 6e64 2e22 290d 0a20 2020  ot found.")..   
-000004e0: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
-000004f0: 2043 6865 636b 2069 6620 7468 6520 5049   Check if the PI
-00000500: 4e45 434f 4e45 5f41 5049 5f4b 4559 2061  NECONE_API_KEY a
-00000510: 6e64 2050 494e 4543 4f4e 455f 454e 5620  nd PINECONE_ENV 
-00000520: 656e 7669 726f 6e6d 656e 7420 7661 7269  environment vari
-00000530: 6162 6c65 7320 6172 6520 7365 7420 6966  ables are set if
-00000540: 2076 6563 746f 725f 6462 2069 7320 5472   vector_db is Tr
-00000550: 7565 0d0a 2020 2020 2020 2020 6966 2076  ue..        if v
-00000560: 6563 746f 725f 6462 3a0d 0a20 2020 2020  ector_db:..     
-00000570: 2020 2020 2020 2050 494e 4543 4f4e 455f         PINECONE_
-00000580: 4150 495f 4b45 5920 3d20 6f73 2e67 6574  API_KEY = os.get
-00000590: 656e 7628 2750 494e 4543 4f4e 455f 4150  env('PINECONE_AP
-000005a0: 495f 4b45 5927 290d 0a20 2020 2020 2020  I_KEY')..       
-000005b0: 2020 2020 2050 494e 4543 4f4e 455f 454e       PINECONE_EN
-000005c0: 5620 3d20 6f73 2e67 6574 656e 7628 2750  V = os.getenv('P
-000005d0: 494e 4543 4f4e 455f 454e 5627 290d 0a20  INECONE_ENV').. 
-000005e0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-000005f0: 2020 2020 2020 2020 2069 6620 5049 4e45           if PINE
-00000600: 434f 4e45 5f41 5049 5f4b 4559 2069 7320  CONE_API_KEY is 
-00000610: 4e6f 6e65 206f 7220 5049 4e45 434f 4e45  None or PINECONE
-00000620: 5f45 4e56 2069 7320 4e6f 6e65 3a0d 0a20  _ENV is None:.. 
-00000630: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00000640: 7269 6e74 2822 5761 726e 696e 673a 2050  rint("Warning: P
-00000650: 494e 4543 4f4e 455f 4150 495f 4b45 5920  INECONE_API_KEY 
-00000660: 6f72 2050 494e 4543 4f4e 455f 454e 5620  or PINECONE_ENV 
-00000670: 656e 7669 726f 6e6d 656e 7420 7661 7269  environment vari
-00000680: 6162 6c65 206e 6f74 2066 6f75 6e64 2e20  able not found. 
-00000690: 4469 7361 626c 696e 6720 7665 6374 6f72  Disabling vector
-000006a0: 5f64 622e 2229 0d0a 2020 2020 2020 2020  _db.")..        
-000006b0: 2020 2020 2020 2020 7665 6374 6f72 5f64          vector_d
-000006c0: 6220 3d20 4661 6c73 650d 0a0d 0a20 2020  b = False....   
-000006d0: 2020 2020 2073 656c 662e 4d41 585f 4552       self.MAX_ER
-000006e0: 524f 525f 434f 5252 4543 5449 4f4e 5320  ROR_CORRECTIONS 
-000006f0: 3d20 350d 0a20 2020 2020 2020 2023 2053  = 5..        # S
-00000700: 6574 2074 6865 206d 6178 696d 756d 206e  et the maximum n
-00000710: 756d 6265 7220 6f66 2071 7565 7374 696f  umber of questio
-00000720: 6e2f 616e 7377 6572 2070 6169 7273 2074  n/answer pairs t
-00000730: 6f20 6265 206b 6570 7420 696e 2074 6865  o be kept in the
-00000740: 2063 6f6e 7665 7273 6174 696f 6e20 6d65   conversation me
-00000750: 6d6d 6f72 790d 0a20 2020 2020 2020 2073  mmory..        s
-00000760: 656c 662e 4d41 585f 434f 4e56 4552 5341  elf.MAX_CONVERSA
-00000770: 5449 4f4e 5320 3d20 286d 6178 5f63 6f6e  TIONS = (max_con
-00000780: 7665 7273 6174 696f 6e73 2a32 2920 2d20  versations*2) - 
-00000790: 310d 0a20 2020 2020 2020 200d 0a20 2020  1..        ..   
-000007a0: 2020 2020 2023 2053 746f 7265 2074 6865       # Store the
-000007b0: 206f 7269 6769 6e61 6c20 6461 7461 6672   original datafr
-000007c0: 616d 652e 2054 6869 7320 7769 6c6c 2062  ame. This will b
-000007d0: 6520 7573 6564 2074 6f20 7265 7365 7420  e used to reset 
-000007e0: 7468 6520 6461 7461 6672 616d 6520 6265  the dataframe be
-000007f0: 666f 7265 2065 7865 6375 7469 6e67 2074  fore executing t
-00000800: 6865 2063 6f64 650d 0a20 2020 2020 2020  he code..       
-00000810: 2073 656c 662e 6f72 6967 696e 616c 5f64   self.original_d
-00000820: 6620 3d20 6466 0d0a 2020 2020 2020 2020  f = df..        
-00000830: 7365 6c66 2e64 6620 3d20 6466 2e63 6f70  self.df = df.cop
-00000840: 7928 2920 2023 206d 616b 6520 6120 636f  y()  # make a co
-00000850: 7079 206f 6620 7468 6520 6461 7461 6672  py of the datafr
-00000860: 616d 650d 0a20 2020 2020 2020 2073 656c  ame..        sel
-00000870: 662e 6466 5f68 6561 6420 3d20 7365 6c66  f.df_head = self
-00000880: 2e6f 7269 6769 6e61 6c5f 6466 2e68 6561  .original_df.hea
-00000890: 6428 3129 0d0a 2020 2020 2020 2020 7365  d(1)..        se
-000008a0: 6c66 2e64 665f 636f 6c75 6d6e 7320 3d20  lf.df_columns = 
-000008b0: 7365 6c66 2e64 662e 636f 6c75 6d6e 732e  self.df.columns.
-000008c0: 746f 6c69 7374 2829 0d0a 0d0a 2020 2020  tolist()....    
-000008d0: 2020 2020 2320 4c4c 4d73 0d0a 2020 2020      # LLMs..    
-000008e0: 2020 2020 7365 6c66 2e6c 6c6d 203d 206c      self.llm = l
-000008f0: 6c6d 0d0a 2020 2020 2020 2020 7365 6c66  lm..        self
-00000900: 2e6c 6c6d 5f66 756e 6320 3d20 6c6c 6d5f  .llm_func = llm_
-00000910: 6675 6e63 0d0a 2020 2020 2020 2020 7365  func..        se
-00000920: 6c66 2e6c 6c6d 5f31 366b 203d 206c 6c6d  lf.llm_16k = llm
-00000930: 5f31 366b 0d0a 2020 2020 2020 2020 7365  _16k..        se
-00000940: 6c66 2e6c 6c6d 5f67 7074 3420 3d20 6c6c  lf.llm_gpt4 = ll
-00000950: 6d5f 6770 7434 0d0a 0d0a 2020 2020 2020  m_gpt4....      
-00000960: 2020 2320 5365 7420 7468 6520 6465 6275    # Set the debu
-00000970: 6720 6d6f 6465 2e20 5468 6973 206d 6f64  g mode. This mod
-00000980: 6520 6973 2054 7275 6520 7768 656e 2079  e is True when y
-00000990: 6f75 2077 616e 7420 7468 6520 6d6f 6465  ou want the mode
-000009a0: 6c20 746f 2064 6562 7567 2074 6865 2063  l to debug the c
-000009b0: 6f64 6520 616e 6420 636f 7272 6563 7420  ode and correct 
-000009c0: 6974 2e0d 0a20 2020 2020 2020 2073 656c  it...        sel
-000009d0: 662e 6465 6275 6720 3d20 6465 6275 670d  f.debug = debug.
-000009e0: 0a20 2020 2020 2020 2023 2053 6574 2074  .        # Set t
-000009f0: 6865 206c 6c6d 5f73 7769 7463 6820 6d6f  he llm_switch mo
-00000a00: 6465 2e20 5468 6973 206d 6f64 6520 6973  de. This mode is
-00000a10: 2054 7275 6520 7768 656e 2079 6f75 2077   True when you w
-00000a20: 616e 7420 7468 6520 6d6f 6465 6c20 746f  ant the model to
-00000a30: 2073 7769 7463 6820 746f 2067 7074 2d34   switch to gpt-4
-00000a40: 2066 6f72 2064 6562 7567 6769 6e67 2c20   for debugging, 
-00000a50: 6572 726f 7220 636f 7272 6563 7469 6f6e  error correction
-00000a60: 2061 6e64 2072 616e 6b69 6e67 2e0d 0a20   and ranking... 
-00000a70: 2020 2020 2020 2073 656c 662e 6c6c 6d5f         self.llm_
-00000a80: 7377 6974 6368 203d 206c 6c6d 5f73 7769  switch = llm_swi
-00000a90: 7463 680d 0a20 2020 2020 2020 2023 2053  tch..        # S
-00000aa0: 6574 2074 6865 2072 616e 6b20 6d6f 6465  et the rank mode
-00000ab0: 2e20 5468 6973 206d 6f64 6520 6973 2054  . This mode is T
-00000ac0: 7275 6520 7768 656e 2079 6f75 2077 616e  rue when you wan
-00000ad0: 7420 7468 6520 6d6f 6465 6c20 746f 2072  t the model to r
-00000ae0: 616e 6b20 7468 6520 6765 6e65 7261 7465  ank the generate
-00000af0: 6420 636f 6465 2e0d 0a20 2020 2020 2020  d code...       
-00000b00: 2073 656c 662e 7665 6374 6f72 5f64 6220   self.vector_db 
-00000b10: 3d20 7665 6374 6f72 5f64 620d 0a0d 0a20  = vector_db.... 
-00000b20: 2020 2020 2020 2023 2053 6574 2074 6865         # Set the
-00000b30: 2065 7870 6c6f 7261 746f 7279 206d 6f64   exploratory mod
-00000b40: 652e 2054 6869 7320 6d6f 6465 2069 7320  e. This mode is 
-00000b50: 5472 7565 2077 6865 6e20 796f 7520 7761  True when you wa
-00000b60: 6e74 2074 6865 206d 6f64 656c 2074 6f20  nt the model to 
-00000b70: 6576 616c 7561 7465 2074 6865 206f 7269  evaluate the ori
-00000b80: 6769 6e61 6c20 7072 6f6d 7074 2061 6e64  ginal prompt and
-00000b90: 2062 7265 616b 2069 7420 646f 776e 2069   break it down i
-00000ba0: 6e20 616c 676f 7269 7468 6d2e 0d0a 2020  n algorithm...  
-00000bb0: 2020 2020 2020 7365 6c66 2e65 7870 6c6f        self.explo
-00000bc0: 7261 746f 7279 203d 2065 7870 6c6f 7261  ratory = explora
-00000bd0: 746f 7279 0d0a 2020 2020 2020 2020 0d0a  tory..        ..
-00000be0: 2020 2020 2020 2020 2320 5072 6f6d 7074          # Prompt
-00000bf0: 730d 0a20 2020 2020 2020 2073 656c 662e  s..        self.
-00000c00: 6465 6661 756c 745f 6578 616d 706c 655f  default_example_
-00000c10: 6f75 7470 7574 203d 2070 726f 6d70 7473  output = prompts
-00000c20: 2e65 7861 6d70 6c65 5f6f 7574 7075 740d  .example_output.
-00000c30: 0a20 2020 2020 2020 2073 656c 662e 7461  .        self.ta
-00000c40: 736b 5f65 7661 6c75 6174 696f 6e20 3d20  sk_evaluation = 
-00000c50: 7072 6f6d 7074 732e 7461 736b 5f65 7661  prompts.task_eva
-00000c60: 6c75 6174 696f 6e0d 0a20 2020 2020 2020  luation..       
-00000c70: 2073 656c 662e 7379 7374 656d 5f74 6173   self.system_tas
-00000c80: 6b20 3d20 7072 6f6d 7074 732e 7379 7374  k = prompts.syst
-00000c90: 656d 5f74 6173 6b0d 0a20 2020 2020 2020  em_task..       
-00000ca0: 2073 656c 662e 7573 6572 5f74 6173 6b20   self.user_task 
-00000cb0: 3d20 7072 6f6d 7074 732e 7573 6572 5f74  = prompts.user_t
-00000cc0: 6173 6b0d 0a20 2020 2020 2020 2073 656c  ask..        sel
-00000cd0: 662e 6572 726f 725f 636f 7272 6563 745f  f.error_correct_
-00000ce0: 7461 736b 203d 2070 726f 6d70 7473 2e65  task = prompts.e
-00000cf0: 7272 6f72 5f63 6f72 7265 6374 5f74 6173  rror_correct_tas
-00000d00: 6b0d 0a20 2020 2020 2020 2073 656c 662e  k..        self.
-00000d10: 6465 6275 675f 636f 6465 5f74 6173 6b20  debug_code_task 
-00000d20: 3d20 7072 6f6d 7074 732e 6465 6275 675f  = prompts.debug_
-00000d30: 636f 6465 5f74 6173 6b20 200d 0a20 2020  code_task  ..   
-00000d40: 2020 2020 2073 656c 662e 7261 6e6b 5f61       self.rank_a
-00000d50: 6e73 7765 7220 3d20 7072 6f6d 7074 732e  nswer = prompts.
-00000d60: 7261 6e6b 5f61 6e73 7765 720d 0a20 2020  rank_answer..   
-00000d70: 2020 2020 2073 656c 662e 736f 6c75 7469       self.soluti
-00000d80: 6f6e 5f69 6e73 6967 6874 7320 3d20 7072  on_insights = pr
-00000d90: 6f6d 7074 732e 736f 6c75 7469 6f6e 5f69  ompts.solution_i
-00000da0: 6e73 6967 6874 730d 0a0d 0a20 2020 2020  nsights....     
-00000db0: 2020 2023 2046 756e 6374 696f 6e73 0d0a     # Functions..
-00000dc0: 2020 2020 2020 2020 7365 6c66 2e74 6173          self.tas
-00000dd0: 6b5f 6576 616c 5f66 756e 6374 696f 6e20  k_eval_function 
-00000de0: 3d20 6675 6e63 5f63 616c 6c73 2e74 6173  = func_calls.tas
-00000df0: 6b5f 6576 616c 5f66 756e 6374 696f 6e0d  k_eval_function.
-00000e00: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-00000e10: 7369 6768 7473 5f66 756e 6374 696f 6e20  sights_function 
-00000e20: 3d20 6675 6e63 5f63 616c 6c73 2e73 6f6c  = func_calls.sol
-00000e30: 7574 696f 6e5f 696e 7369 6768 7473 5f66  ution_insights_f
-00000e40: 756e 6374 696f 6e0d 0a0d 0a20 2020 2020  unction....     
-00000e50: 2020 2023 2051 4120 5265 7472 6965 7661     # QA Retrieva
-00000e60: 6c0d 0a20 2020 2020 2020 2073 656c 662e  l..        self.
-00000e70: 6164 645f 7175 6573 7469 6f6e 5f61 6e73  add_question_ans
-00000e80: 7765 725f 7061 6972 203d 2071 615f 7265  wer_pair = qa_re
-00000e90: 7472 6965 7661 6c2e 6164 645f 7175 6573  trieval.add_ques
-00000ea0: 7469 6f6e 5f61 6e73 7765 725f 7061 6972  tion_answer_pair
-00000eb0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-00000ec0: 6574 7269 6576 655f 616e 7377 6572 203d  etrieve_answer =
-00000ed0: 2071 615f 7265 7472 6965 7661 6c2e 7265   qa_retrieval.re
-00000ee0: 7472 6965 7665 5f61 6e73 7765 720d 0a20  trieve_answer.. 
-00000ef0: 2020 2020 2020 2073 656c 662e 7369 6d69         self.simi
-00000f00: 6c61 7269 7479 5f74 6872 6573 686f 6c64  larity_threshold
-00000f10: 203d 2030 2e38 0d0a 2020 2020 2020 2020   = 0.8..        
-00000f20: 0d0a 2020 2020 2020 2020 6f70 656e 6169  ..        openai
-00000f30: 2e61 7069 5f6b 6579 203d 2073 656c 662e  .api_key = self.
-00000f40: 4150 495f 4b45 590d 0a0d 0a20 2020 2020  API_KEY....     
-00000f50: 2020 2023 2049 6e69 7469 616c 697a 6520     # Initialize 
-00000f60: 7468 6520 746f 7461 6c20 746f 6b65 6e73  the total tokens
-00000f70: 2075 7365 6420 6c69 7374 2e20 5468 6973   used list. This
-00000f80: 206c 6973 7420 7769 6c6c 2062 6520 7573   list will be us
-00000f90: 6564 2074 6f20 6b65 6570 2074 7261 636b  ed to keep track
-00000fa0: 206f 6620 7468 6520 746f 7461 6c20 746f   of the total to
-00000fb0: 6b65 6e73 2075 7365 6420 6279 2074 6865  kens used by the
-00000fc0: 206d 6f64 656c 0d0a 2020 2020 2020 2020   model..        
-00000fd0: 7365 6c66 2e74 6f74 616c 5f74 6f6b 656e  self.total_token
-00000fe0: 735f 7573 6564 203d 205b 5d0d 0a0d 0a20  s_used = [].... 
-00000ff0: 2020 2064 6566 206c 6c6d 5f63 616c 6c28     def llm_call(
-00001000: 7365 6c66 2c20 6d65 7373 6167 6573 3a20  self, messages: 
-00001010: 7374 722c 2074 656d 7065 7261 7475 7265  str, temperature
-00001020: 3a20 666c 6f61 7420 3d20 302c 206d 6178  : float = 0, max
-00001030: 5f74 6f6b 656e 733a 2069 6e74 203d 2031  _tokens: int = 1
-00001040: 3030 302c 206c 6c6d 5f63 6173 6361 6465  000, llm_cascade
-00001050: 3a20 626f 6f6c 203d 2046 616c 7365 293a  : bool = False):
-00001060: 0d0a 2020 2020 2020 2020 6d6f 6465 6c20  ..        model 
-00001070: 3d20 7365 6c66 2e6c 6c6d 0d0a 2020 2020  = self.llm..    
-00001080: 2020 2020 6966 206c 6c6d 5f63 6173 6361      if llm_casca
-00001090: 6465 3a0d 0a20 2020 2020 2020 2020 2020  de:..           
-000010a0: 206d 6f64 656c 203d 2073 656c 662e 6c6c   model = self.ll
-000010b0: 6d5f 6770 7434 0d0a 2020 2020 2020 2020  m_gpt4..        
-000010c0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-000010d0: 2020 7265 7370 6f6e 7365 203d 206f 7065    response = ope
-000010e0: 6e61 692e 4368 6174 436f 6d70 6c65 7469  nai.ChatCompleti
-000010f0: 6f6e 2e63 7265 6174 6528 0d0a 2020 2020  on.create(..    
-00001100: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-00001110: 6c3d 6d6f 6465 6c2c 0d0a 2020 2020 2020  l=model,..      
-00001120: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
-00001130: 6573 3d6d 6573 7361 6765 732c 0d0a 2020  es=messages,..  
-00001140: 2020 2020 2020 2020 2020 2020 2020 7465                te
-00001150: 6d70 6572 6174 7572 653d 7465 6d70 6572  mperature=temper
-00001160: 6174 7572 652c 0d0a 2020 2020 2020 2020  ature,..        
-00001170: 2020 2020 2020 2020 6d61 785f 746f 6b65          max_toke
-00001180: 6e73 3d6d 6178 5f74 6f6b 656e 732c 0d0a  ns=max_tokens,..
-00001190: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-000011a0: 2020 2020 2020 2065 7863 6570 7420 6f70         except op
-000011b0: 656e 6169 2e65 7272 6f72 2e52 6174 654c  enai.error.RateL
-000011c0: 696d 6974 4572 726f 723a 0d0a 2020 2020  imitError:..    
-000011d0: 2020 2020 2020 2020 7072 696e 7428 0d0a          print(..
-000011e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000011f0: 2254 6865 204f 7065 6e41 4920 4150 4920  "The OpenAI API 
-00001200: 7261 7465 206c 696d 6974 2068 6173 2062  rate limit has b
-00001210: 6565 6e20 6578 6365 6564 6564 2e20 5761  een exceeded. Wa
-00001220: 6974 696e 6720 3130 2073 6563 6f6e 6473  iting 10 seconds
-00001230: 2061 6e64 2074 7279 696e 6720 6167 6169   and trying agai
-00001240: 6e2e 220d 0a20 2020 2020 2020 2020 2020  n."..           
-00001250: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-00001260: 7469 6d65 2e73 6c65 6570 2831 3029 0d0a  time.sleep(10)..
-00001270: 2020 2020 2020 2020 2020 2020 7265 7370              resp
-00001280: 6f6e 7365 203d 206f 7065 6e61 692e 4368  onse = openai.Ch
-00001290: 6174 436f 6d70 6c65 7469 6f6e 2e63 7265  atCompletion.cre
-000012a0: 6174 6528 0d0a 2020 2020 2020 2020 2020  ate(..          
-000012b0: 2020 2020 2020 6d6f 6465 6c3d 6d6f 6465        model=mode
-000012c0: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
-000012d0: 2020 2020 6d65 7373 6167 6573 3d6d 6573      messages=mes
-000012e0: 7361 6765 732c 0d0a 2020 2020 2020 2020  sages,..        
-000012f0: 2020 2020 2020 2020 7465 6d70 6572 6174          temperat
-00001300: 7572 653d 7465 6d70 6572 6174 7572 652c  ure=temperature,
-00001310: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001320: 2020 6d61 785f 746f 6b65 6e73 3d6d 6178    max_tokens=max
-00001330: 5f74 6f6b 656e 732c 0d0a 2020 2020 2020  _tokens,..      
-00001340: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00001350: 2023 2045 7863 6565 6465 6420 7468 6520   # Exceeded the 
-00001360: 6d61 7869 6d75 6d20 6e75 6d62 6572 206f  maximum number o
-00001370: 6620 746f 6b65 6e73 2061 6c6c 6f77 6564  f tokens allowed
-00001380: 2062 7920 7468 6520 4150 490d 0a20 2020   by the API..   
-00001390: 2020 2020 2065 7863 6570 7420 6f70 656e       except open
-000013a0: 6169 2e65 7272 6f72 2e49 6e76 616c 6964  ai.error.Invalid
-000013b0: 5265 7175 6573 7445 7272 6f72 3a0d 0a20  RequestError:.. 
-000013c0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000013d0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-000013e0: 2020 2022 5468 6520 4f70 656e 4149 2041     "The OpenAI A
-000013f0: 5049 206d 6178 696d 756d 2074 6f6b 656e  PI maximum token
-00001400: 7320 6c69 6d69 7420 6861 7320 6265 656e  s limit has been
-00001410: 2065 7863 6565 6465 642e 2053 7769 7463   exceeded. Switc
-00001420: 6869 6e67 2074 6f20 6120 3136 4b20 6d6f  hing to a 16K mo
-00001430: 6465 6c2e 220d 0a20 2020 2020 2020 2020  del."..         
-00001440: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-00001450: 2020 7265 7370 6f6e 7365 203d 206f 7065    response = ope
-00001460: 6e61 692e 4368 6174 436f 6d70 6c65 7469  nai.ChatCompleti
-00001470: 6f6e 2e63 7265 6174 6528 0d0a 2020 2020  on.create(..    
-00001480: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-00001490: 6c3d 7365 6c66 2e6c 6c6d 5f31 366b 2c0d  l=self.llm_16k,.
-000014a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000014b0: 206d 6573 7361 6765 733d 6d65 7373 6167   messages=messag
-000014c0: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
-000014d0: 2020 2020 2074 656d 7065 7261 7475 7265       temperature
-000014e0: 3d74 656d 7065 7261 7475 7265 2c0d 0a20  =temperature,.. 
-000014f0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00001500: 6178 5f74 6f6b 656e 733d 6d61 785f 746f  ax_tokens=max_to
-00001510: 6b65 6e73 2c0d 0a20 2020 2020 2020 2020  kens,..         
-00001520: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
-00001530: 636f 6e74 656e 7420 3d20 7265 7370 6f6e  content = respon
-00001540: 7365 2e63 686f 6963 6573 5b30 5d2e 6d65  se.choices[0].me
-00001550: 7373 6167 652e 636f 6e74 656e 742e 7374  ssage.content.st
-00001560: 7269 7028 290d 0a20 2020 2020 2020 2074  rip()..        t
-00001570: 6f6b 656e 735f 7573 6564 203d 2072 6573  okens_used = res
-00001580: 706f 6e73 652e 7573 6167 652e 746f 7461  ponse.usage.tota
-00001590: 6c5f 746f 6b65 6e73 0d0a 0d0a 2020 2020  l_tokens....    
-000015a0: 2020 2020 7265 7475 726e 2063 6f6e 7465      return conte
-000015b0: 6e74 2c20 746f 6b65 6e73 5f75 7365 640d  nt, tokens_used.
-000015c0: 0a20 2020 200d 0a20 2020 2064 6566 206c  .    ..    def l
-000015d0: 6c6d 5f66 756e 635f 6361 6c6c 2873 656c  lm_func_call(sel
-000015e0: 662c 206d 6573 7361 6765 732c 2066 756e  f, messages, fun
-000015f0: 6374 696f 6e73 2c20 6675 6e63 7469 6f6e  ctions, function
-00001600: 5f6e 616d 6529 3a0d 0a20 2020 2020 2020  _name):..       
-00001610: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00001620: 2020 2072 6573 706f 6e73 6520 3d20 6f70     response = op
-00001630: 656e 6169 2e43 6861 7443 6f6d 706c 6574  enai.ChatComplet
-00001640: 696f 6e2e 6372 6561 7465 280d 0a20 2020  ion.create(..   
-00001650: 2020 2020 2020 2020 206d 6f64 656c 203d           model =
-00001660: 2073 656c 662e 6c6c 6d5f 6675 6e63 2c0d   self.llm_func,.
-00001670: 0a20 2020 2020 2020 2020 2020 206d 6573  .            mes
-00001680: 7361 6765 733d 6d65 7373 6167 6573 2c0d  sages=messages,.
-00001690: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
-000016a0: 6374 696f 6e73 3d66 756e 6374 696f 6e73  ctions=functions
-000016b0: 2c0d 0a20 2020 2020 2020 2020 2020 2066  ,..            f
-000016c0: 756e 6374 696f 6e5f 6361 6c6c 203d 2066  unction_call = f
-000016d0: 756e 6374 696f 6e5f 6e61 6d65 2c0d 0a20  unction_name,.. 
-000016e0: 2020 2020 2020 2020 2020 2074 656d 7065             tempe
-000016f0: 7261 7475 7265 3d30 2c0d 0a20 2020 2020  rature=0,..     
-00001700: 2020 2020 2020 206d 6178 5f74 6f6b 656e         max_token
-00001710: 7320 3d20 3730 302c 200d 0a20 2020 2020  s = 700, ..     
-00001720: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00001730: 2020 6578 6365 7074 206f 7065 6e61 692e    except openai.
-00001740: 6572 726f 722e 5261 7465 4c69 6d69 7445  error.RateLimitE
-00001750: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00001760: 2020 2070 7269 6e74 280d 0a20 2020 2020     print(..     
-00001770: 2020 2020 2020 2020 2020 2022 5468 6520             "The 
-00001780: 4f70 656e 4149 2041 5049 2072 6174 6520  OpenAI API rate 
-00001790: 6c69 6d69 7420 6861 7320 6265 656e 2065  limit has been e
-000017a0: 7863 6565 6465 642e 2057 6169 7469 6e67  xceeded. Waiting
-000017b0: 2031 3020 7365 636f 6e64 7320 616e 6420   10 seconds and 
-000017c0: 7472 7969 6e67 2061 6761 696e 2e22 0d0a  trying again."..
-000017d0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-000017e0: 2020 2020 2020 2020 2020 2074 696d 652e             time.
-000017f0: 736c 6565 7028 3130 290d 0a20 2020 2020  sleep(10)..     
-00001800: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
-00001810: 3d20 6f70 656e 6169 2e43 6861 7443 6f6d  = openai.ChatCom
-00001820: 706c 6574 696f 6e2e 6372 6561 7465 280d  pletion.create(.
-00001830: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-00001840: 656c 203d 2073 656c 662e 6c6c 6d5f 6675  el = self.llm_fu
-00001850: 6e63 2c0d 0a20 2020 2020 2020 2020 2020  nc,..           
-00001860: 206d 6573 7361 6765 733d 6d65 7373 6167   messages=messag
-00001870: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
-00001880: 2066 756e 6374 696f 6e73 3d66 756e 6374   functions=funct
-00001890: 696f 6e73 2c0d 0a20 2020 2020 2020 2020  ions,..         
-000018a0: 2020 2066 756e 6374 696f 6e5f 6361 6c6c     function_call
-000018b0: 203d 2066 756e 6374 696f 6e5f 6e61 6d65   = function_name
-000018c0: 2c0d 0a20 2020 2020 2020 2020 2020 2074  ,..            t
-000018d0: 656d 7065 7261 7475 7265 3d30 2c0d 0a20  emperature=0,.. 
-000018e0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-000018f0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00001900: 666e 5f6e 616d 6520 3d20 7265 7370 6f6e  fn_name = respon
-00001910: 7365 2e63 686f 6963 6573 5b30 5d2e 6d65  se.choices[0].me
-00001920: 7373 6167 655b 2266 756e 6374 696f 6e5f  ssage["function_
-00001930: 6361 6c6c 225d 2e6e 616d 650d 0a20 2020  call"].name..   
-00001940: 2020 2020 2061 7267 756d 656e 7473 203d       arguments =
-00001950: 2072 6573 706f 6e73 652e 6368 6f69 6365   response.choice
-00001960: 735b 305d 2e6d 6573 7361 6765 5b22 6675  s[0].message["fu
-00001970: 6e63 7469 6f6e 5f63 616c 6c22 5d2e 6172  nction_call"].ar
-00001980: 6775 6d65 6e74 730d 0a20 2020 2020 2020  guments..       
-00001990: 2074 6f6b 656e 735f 7573 6564 203d 2072   tokens_used = r
-000019a0: 6573 706f 6e73 652e 7573 6167 652e 746f  esponse.usage.to
-000019b0: 7461 6c5f 746f 6b65 6e73 0d0a 0d0a 2020  tal_tokens....  
-000019c0: 2020 2020 2020 7265 7475 726e 2066 6e5f        return fn_
-000019d0: 6e61 6d65 2c61 7267 756d 656e 7473 2c74  name,arguments,t
-000019e0: 6f6b 656e 735f 7573 6564 0d0a 0d0a 2020  okens_used....  
-000019f0: 2020 0d0a 2020 2020 2320 4675 6e63 7469    ..    # Functi
-00001a00: 6f6e 7320 746f 2073 616e 6974 697a 6520  ons to sanitize 
-00001a10: 7468 6520 6f75 7470 7574 2066 726f 6d20  the output from 
-00001a20: 7468 6520 4c4c 4d0d 0a20 2020 2064 6566  the LLM..    def
-00001a30: 205f 6578 7472 6163 745f 636f 6465 2873   _extract_code(s
-00001a40: 656c 662c 7265 7370 6f6e 7365 3a20 7374  elf,response: st
-00001a50: 722c 2073 6570 6172 6174 6f72 3a20 7374  r, separator: st
-00001a60: 7220 3d20 2260 6060 2229 202d 3e20 7374  r = "```") -> st
-00001a70: 723a 0d0a 0d0a 2020 2020 2020 2020 2320  r:....        # 
-00001a80: 4465 6669 6e65 2061 2062 6c61 636b 6c69  Define a blackli
-00001a90: 7374 206f 6620 5079 7468 6f6e 206b 6579  st of Python key
-00001aa0: 776f 7264 7320 616e 6420 6675 6e63 7469  words and functi
-00001ab0: 6f6e 7320 7468 6174 2061 7265 206e 6f74  ons that are not
-00001ac0: 2061 6c6c 6f77 6564 0d0a 2020 2020 2020   allowed..      
-00001ad0: 2020 626c 6163 6b6c 6973 7420 3d20 5b27    blacklist = ['
-00001ae0: 6f73 272c 2773 7562 7072 6f63 6573 7327  os','subprocess'
-00001af0: 2c27 7379 7327 2c27 6576 616c 272c 2765  ,'sys','eval','e
-00001b00: 7865 6327 2c27 6669 6c65 272c 2773 6f63  xec','file','soc
-00001b10: 6b65 7427 2c27 7572 6c6c 6962 272c 0d0a  ket','urllib',..
-00001b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001b30: 2020 2020 2773 6875 7469 6c27 2c27 7069      'shutil','pi
-00001b40: 636b 6c65 272c 2763 7479 7065 7327 2c27  ckle','ctypes','
-00001b50: 6d75 6c74 6970 726f 6365 7373 696e 6727  multiprocessing'
-00001b60: 2c27 7465 6d70 6669 6c65 272c 2767 6c6f  ,'tempfile','glo
-00001b70: 6227 2c27 636f 6465 272c 2770 7479 272c  b','code','pty',
-00001b80: 2763 6f6d 6d61 6e64 7327 2c0d 0a20 2020  'commands',..   
-00001b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ba0: 2027 7265 7175 6573 7473 272c 2763 6769   'requests','cgi
-00001bb0: 272c 2763 6769 7462 272c 2778 6d6c 2e65  ','cgitb','xml.e
-00001bc0: 7472 6565 2e45 6c65 6d65 6e74 5472 6565  tree.ElementTree
-00001bd0: 272c 2762 7569 6c74 696e 7327 0d0a 2020  ','builtins'..  
-00001be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001bf0: 2020 5d0d 0a0d 0a20 2020 2020 2020 2023    ]....        #
-00001c00: 2053 6561 7263 6820 666f 7220 6120 7061   Search for a pa
-00001c10: 7474 6572 6e20 6265 7477 6565 6e20 3c63  ttern between <c
-00001c20: 6f64 653e 2061 6e64 203c 2f63 6f64 653e  ode> and </code>
-00001c30: 2069 6e20 7468 6520 6578 7472 6163 7465   in the extracte
-00001c40: 6420 636f 6465 0d0a 2020 2020 2020 2020  d code..        
-00001c50: 6d61 7463 6820 3d20 7265 2e73 6561 7263  match = re.searc
-00001c60: 6828 7222 3c63 6f64 653e 282e 2a29 3c2f  h(r"<code>(.*)</
-00001c70: 636f 6465 3e22 2c20 7265 7370 6f6e 7365  code>", response
-00001c80: 2c20 7265 2e44 4f54 414c 4c29 0d0a 2020  , re.DOTALL)..  
-00001c90: 2020 2020 2020 6966 206d 6174 6368 3a0d        if match:.
-00001ca0: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-00001cb0: 6620 6120 6d61 7463 6820 6973 2066 6f75  f a match is fou
-00001cc0: 6e64 2c20 6578 7472 6163 7420 7468 6520  nd, extract the 
-00001cd0: 636f 6465 2062 6574 7765 656e 203c 636f  code between <co
-00001ce0: 6465 3e20 616e 6420 3c2f 636f 6465 3e0d  de> and </code>.
-00001cf0: 0a20 2020 2020 2020 2020 2020 2063 6f64  .            cod
-00001d00: 6520 3d20 6d61 7463 682e 6772 6f75 7028  e = match.group(
-00001d10: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-00001d20: 2320 4966 2074 6865 2072 6573 706f 6e73  # If the respons
-00001d30: 6520 636f 6e74 6169 6e73 2074 6865 2073  e contains the s
-00001d40: 6570 6172 6174 6f72 2c20 6578 7472 6163  eparator, extrac
-00001d50: 7420 7468 6520 636f 6465 2062 6c6f 636b  t the code block
-00001d60: 2062 6574 7765 656e 2074 6865 2073 6570   between the sep
-00001d70: 6172 6174 6f72 730d 0a20 2020 2020 2020  arators..       
-00001d80: 2020 2020 2069 6620 6c65 6e28 636f 6465       if len(code
-00001d90: 2e73 706c 6974 2873 6570 6172 6174 6f72  .split(separator
-00001da0: 2929 203e 2031 3a0d 0a20 2020 2020 2020  )) > 1:..       
-00001db0: 2020 2020 2020 2020 2063 6f64 6520 3d20           code = 
-00001dc0: 636f 6465 2e73 706c 6974 2873 6570 6172  code.split(separ
-00001dd0: 6174 6f72 295b 315d 0d0a 0d0a 2020 2020  ator)[1]....    
-00001de0: 2020 2020 2320 4966 2074 6865 2072 6573      # If the res
-00001df0: 706f 6e73 6520 636f 6e74 6169 6e73 2074  ponse contains t
-00001e00: 6865 2073 6570 6172 6174 6f72 2c20 6578  he separator, ex
-00001e10: 7472 6163 7420 7468 6520 636f 6465 2062  tract the code b
-00001e20: 6c6f 636b 2062 6574 7765 656e 2074 6865  lock between the
-00001e30: 2073 6570 6172 6174 6f72 730d 0a20 2020   separators..   
-00001e40: 2020 2020 2069 6620 6c65 6e28 7265 7370       if len(resp
-00001e50: 6f6e 7365 2e73 706c 6974 2873 6570 6172  onse.split(separ
-00001e60: 6174 6f72 2929 203e 2031 3a0d 0a20 2020  ator)) > 1:..   
-00001e70: 2020 2020 2020 2020 2063 6f64 6520 3d20           code = 
-00001e80: 7265 7370 6f6e 7365 2e73 706c 6974 2873  response.split(s
-00001e90: 6570 6172 6174 6f72 295b 315d 0d0a 2020  eparator)[1]..  
-00001ea0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00001eb0: 2020 2020 2320 5265 6d6f 7665 2074 6865      # Remove the
-00001ec0: 2022 7079 7468 6f6e 2220 6f72 2022 7079   "python" or "py
-00001ed0: 2220 7072 6566 6978 2069 6620 7072 6573  " prefix if pres
-00001ee0: 656e 740d 0a20 2020 2020 2020 2069 6620  ent..        if 
-00001ef0: 7265 2e6d 6174 6368 2872 225e 2870 7974  re.match(r"^(pyt
-00001f00: 686f 6e7c 7079 2922 2c20 636f 6465 293a  hon|py)", code):
-00001f10: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00001f20: 6465 203d 2072 652e 7375 6228 7222 5e28  de = re.sub(r"^(
-00001f30: 7079 7468 6f6e 7c70 7929 222c 2022 222c  python|py)", "",
-00001f40: 2063 6f64 6529 0d0a 2020 2020 2020 2020   code)..        
-00001f50: 2320 4966 2074 6865 2063 6f64 6520 6973  # If the code is
-00001f60: 2062 6574 7765 656e 2073 696e 676c 6520   between single 
-00001f70: 6261 636b 7469 636b 732c 2065 7874 7261  backticks, extra
-00001f80: 6374 2074 6865 2063 6f64 6520 6265 7477  ct the code betw
-00001f90: 6565 6e20 7468 656d 0d0a 2020 2020 2020  een them..      
-00001fa0: 2020 6966 2072 652e 6d61 7463 6828 7222    if re.match(r"
-00001fb0: 5e60 2e2a 6024 222c 2063 6f64 6529 3a0d  ^`.*`$", code):.
-00001fc0: 0a20 2020 2020 2020 2020 2020 2063 6f64  .            cod
-00001fd0: 6520 3d20 7265 2e73 7562 2872 225e 6028  e = re.sub(r"^`(
-00001fe0: 2e2a 2960 2422 2c20 7222 5c31 222c 2063  .*)`$", r"\1", c
-00001ff0: 6f64 6529 0d0a 0d0a 2020 2020 2020 2020  ode)....        
-00002000: 2320 5265 6d6f 7665 2061 6e79 2069 6e73  # Remove any ins
-00002010: 7461 6e63 6573 206f 6620 2264 6620 3d20  tances of "df = 
-00002020: 7064 2e72 6561 645f 6373 7628 2766 696c  pd.read_csv('fil
-00002030: 656e 616d 652e 6373 7627 2922 2066 726f  ename.csv')" fro
-00002040: 6d20 7468 6520 636f 6465 0d0a 2020 2020  m the code..    
-00002050: 2020 2020 636f 6465 203d 2072 652e 7375      code = re.su
-00002060: 6228 7222 6466 5c73 2a3d 5c73 2a70 645c  b(r"df\s*=\s*pd\
-00002070: 2e72 6561 645f 6373 765c 2827 2e2a 3f27  .read_csv\('.*?'
-00002080: 282c 2e2a 293f 5c29 222c 2022 222c 2063  (,.*)?\)", "", c
-00002090: 6f64 6529 0d0a 0d0a 2020 2020 2020 2020  ode)....        
-000020a0: 2320 4465 6669 6e65 2074 6865 2072 6567  # Define the reg
-000020b0: 756c 6172 2065 7870 7265 7373 696f 6e20  ular expression 
-000020c0: 7061 7474 6572 6e20 746f 206d 6174 6368  pattern to match
-000020d0: 2074 6865 2062 6c61 636b 6c69 7374 2069   the blacklist i
-000020e0: 7465 6d73 0d0a 2020 2020 2020 2020 7061  tems..        pa
-000020f0: 7474 6572 6e20 3d20 7222 5e28 2e2a 5c62  ttern = r"^(.*\b
-00002100: 2822 202b 2022 7c22 2e6a 6f69 6e28 626c  (" + "|".join(bl
-00002110: 6163 6b6c 6973 7429 202b 2072 2229 5c62  acklist) + r")\b
-00002120: 2e2a 2924 220d 0a0d 0a20 2020 2020 2020  .*)$"....       
-00002130: 2023 2052 6570 6c61 6365 2074 6865 2062   # Replace the b
-00002140: 6c61 636b 6c69 7374 2069 7465 6d73 2077  lacklist items w
-00002150: 6974 6820 636f 6d6d 656e 7473 0d0a 2020  ith comments..  
-00002160: 2020 2020 2020 636f 6465 203d 2072 652e        code = re.
-00002170: 7375 6228 7061 7474 6572 6e2c 2072 2223  sub(pattern, r"#
-00002180: 206e 6f74 2061 6c6c 6f77 6564 205c 3122   not allowed \1"
-00002190: 2c20 636f 6465 2c20 666c 6167 733d 7265  , code, flags=re
-000021a0: 2e4d 554c 5449 4c49 4e45 290d 0a0d 0a20  .MULTILINE).... 
-000021b0: 2020 2020 2020 2023 2052 6574 7572 6e20         # Return 
-000021c0: 7468 6520 636c 6561 6e65 6420 616e 6420  the cleaned and 
-000021d0: 6578 7472 6163 7465 6420 636f 6465 0d0a  extracted code..
-000021e0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-000021f0: 6f64 652e 7374 7269 7028 290d 0a20 2020  ode.strip()..   
-00002200: 200d 0a20 2020 2064 6566 205f 6578 7472   ..    def _extr
-00002210: 6163 745f 7261 6e6b 2873 656c 662c 7265  act_rank(self,re
-00002220: 7370 6f6e 7365 3a20 7374 7229 202d 3e20  sponse: str) -> 
-00002230: 7374 723a 0d0a 0d0a 2020 2020 2020 2020  str:....        
-00002240: 2320 5365 6172 6368 2066 6f72 2061 2070  # Search for a p
-00002250: 6174 7465 726e 2062 6574 7765 656e 203c  attern between <
-00002260: 7261 6e6b 3e20 616e 6420 3c2f 7261 6e6b  rank> and </rank
-00002270: 3e20 696e 2074 6865 2072 6573 706f 6e73  > in the respons
-00002280: 650d 0a20 2020 2020 2020 206d 6174 6368  e..        match
-00002290: 203d 2072 652e 7365 6172 6368 2872 223c   = re.search(r"<
-000022a0: 7261 6e6b 3e28 2e2a 293c 2f72 616e 6b3e  rank>(.*)</rank>
-000022b0: 222c 2072 6573 706f 6e73 6529 0d0a 2020  ", response)..  
-000022c0: 2020 2020 2020 6966 206d 6174 6368 3a0d        if match:.
-000022d0: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-000022e0: 6620 6120 6d61 7463 6820 6973 2066 6f75  f a match is fou
-000022f0: 6e64 2c20 6578 7472 6163 7420 7468 6520  nd, extract the 
-00002300: 7261 6e6b 2062 6574 7765 656e 203c 7261  rank between <ra
-00002310: 6e6b 3e20 616e 6420 3c2f 7261 6e6b 3e0d  nk> and </rank>.
-00002320: 0a20 2020 2020 2020 2020 2020 2072 616e  .            ran
-00002330: 6b20 3d20 6d61 7463 682e 6772 6f75 7028  k = match.group(
-00002340: 3129 0d0a 2020 2020 2020 2020 656c 7365  1)..        else
-00002350: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00002360: 616e 6b20 3d20 2222 0d0a 0d0a 2020 2020  ank = ""....    
-00002370: 2020 2020 2320 5265 7475 726e 2074 6865      # Return the
-00002380: 2063 6c65 616e 6564 2061 6e64 2065 7874   cleaned and ext
-00002390: 7261 6374 6564 2063 6f64 650d 0a20 2020  racted code..   
-000023a0: 2020 2020 2072 6574 7572 6e20 7261 6e6b       return rank
-000023b0: 2e73 7472 6970 2829 0d0a 2020 2020 0d0a  .strip()..    ..
-000023c0: 2020 2020 2320 4675 6e63 7469 6f6e 2074      # Function t
-000023d0: 6f20 7265 6d6f 7665 2065 7861 6d70 6c65  o remove example
-000023e0: 7320 6672 6f6d 206d 6573 7361 6765 7320  s from messages 
-000023f0: 7768 656e 206e 6f20 6c6f 6e67 6572 206e  when no longer n
-00002400: 6565 6465 640d 0a20 2020 2064 6566 205f  eeded..    def _
-00002410: 7265 6d6f 7665 5f65 7861 6d70 6c65 7328  remove_examples(
-00002420: 7365 6c66 2c6d 6573 7361 6765 733a 2073  self,messages: s
-00002430: 7472 2920 2d3e 2073 7472 3a0d 0a20 2020  tr) -> str:..   
-00002440: 2020 2020 2023 2044 6566 696e 6520 7468       # Define th
-00002450: 6520 7265 6775 6c61 7220 6578 7072 6573  e regular expres
-00002460: 7369 6f6e 2070 6174 7465 726e 0d0a 2020  sion pattern..  
-00002470: 2020 2020 2020 7061 7474 6572 6e20 3d20        pattern = 
-00002480: 2745 7861 6d70 6c65 204f 7574 7075 743a  'Example Output:
-00002490: 5c73 2a3c 636f 6465 3e2e 2a3f 3c2f 636f  \s*<code>.*?</co
-000024a0: 6465 3e5c 732a 270d 0a0d 0a20 2020 2020  de>\s*'....     
-000024b0: 2020 2023 2049 7465 7261 7465 206f 7665     # Iterate ove
-000024c0: 7220 7468 6520 6c69 7374 206f 6620 6469  r the list of di
-000024d0: 6374 696f 6e61 7269 6573 0d0a 2020 2020  ctionaries..    
-000024e0: 2020 2020 666f 7220 6469 6374 2069 6e20      for dict in 
-000024f0: 6d65 7373 6167 6573 3a0d 0a20 2020 2020  messages:..     
-00002500: 2020 2020 2020 2023 2041 6363 6573 7320         # Access 
-00002510: 616e 6420 636c 6561 6e20 7570 2027 636f  and clean up 'co
-00002520: 6e74 656e 7427 2066 6965 6c64 0d0a 2020  ntent' field..  
-00002530: 2020 2020 2020 2020 2020 6966 2064 6963            if dic
-00002540: 742e 6765 7428 2772 6f6c 6527 2920 3d3d  t.get('role') ==
-00002550: 2027 7573 6572 2720 616e 6420 2763 6f6e   'user' and 'con
-00002560: 7465 6e74 2720 696e 2064 6963 743a 0d0a  tent' in dict:..
-00002570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002580: 6469 6374 5b27 636f 6e74 656e 7427 5d20  dict['content'] 
-00002590: 3d20 7265 2e73 7562 2870 6174 7465 726e  = re.sub(pattern
-000025a0: 2c20 2727 2c20 6469 6374 5b27 636f 6e74  , '', dict['cont
-000025b0: 656e 7427 5d2c 2066 6c61 6773 3d72 652e  ent'], flags=re.
-000025c0: 444f 5441 4c4c 290d 0a0d 0a20 2020 2020  DOTALL)....     
-000025d0: 2020 2072 6574 7572 6e20 6d65 7373 6167     return messag
-000025e0: 6573 0d0a 2020 2020 0d0a 2020 2020 6465  es..    ..    de
-000025f0: 6620 7461 736b 5f65 7661 6c28 7365 6c66  f task_eval(self
-00002600: 2c20 6576 616c 5f6d 6573 7361 6765 7329  , eval_messages)
-00002610: 3a0d 0a0d 0a20 2020 2020 2020 2069 6620  :....        if 
-00002620: 2769 7079 6b65 726e 656c 2720 696e 2073  'ipykernel' in s
-00002630: 7973 2e6d 6f64 756c 6573 3a0d 0a20 2020  ys.modules:..   
-00002640: 2020 2020 2020 2020 2023 204a 7570 7974           # Jupyt
-00002650: 6572 206e 6f74 6562 6f6f 6b20 6f72 2069  er notebook or i
-00002660: 7079 7468 6f6e 0d0a 2020 2020 2020 2020  python..        
-00002670: 2020 2020 6469 7370 6c61 7928 4854 4d4c      display(HTML
-00002680: 2866 273c 7020 7374 796c 653d 2263 6f6c  (f'<p style="col
-00002690: 6f72 3a6d 6167 656e 7461 3b22 3e5c 6e43  or:magenta;">\nC
-000026a0: 616c 6c69 6e67 204d 6f64 656c 3a20 7b73  alling Model: {s
-000026b0: 656c 662e 6c6c 6d5f 6675 6e63 7d3c 2f70  elf.llm_func}</p
-000026c0: 3e27 2929 0d0a 2020 2020 2020 2020 2020  >'))..          
-000026d0: 2020 6469 7370 6c61 7928 4854 4d4c 2866    display(HTML(f
-000026e0: 273c 703e 3c62 2073 7479 6c65 3d22 636f  '<p><b style="co
-000026f0: 6c6f 723a 6d61 6765 6e74 613b 223e 5472  lor:magenta;">Tr
-00002700: 7969 6e67 2074 6f20 6465 7465 726d 696e  ying to determin
-00002710: 6520 7468 6520 6265 7374 206d 6574 686f  e the best metho
-00002720: 6420 746f 2061 6e73 7765 7220 796f 7572  d to answer your
-00002730: 2071 7565 7374 696f 6e2c 2070 6c65 6173   question, pleas
-00002740: 6520 7761 6974 2e2e 2e3c 2f62 3e3c 2f70  e wait...</b></p
-00002750: 3e3c 6272 3e27 2929 0d0a 2020 2020 2020  ><br>'))..      
-00002760: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00002770: 2020 2020 2023 204f 7468 6572 2065 6e76       # Other env
-00002780: 6972 6f6e 6d65 6e74 2028 6c69 6b65 2074  ironment (like t
-00002790: 6572 6d69 6e61 6c29 0d0a 2020 2020 2020  erminal)..      
-000027a0: 2020 2020 2020 7072 696e 7428 636f 6c6f        print(colo
-000027b0: 7265 6428 6622 5c6e 3e3e 2043 616c 6c69  red(f"\n>> Calli
-000027c0: 6e67 204d 6f64 656c 3a20 7b73 656c 662e  ng Model: {self.
-000027d0: 6c6c 6d5f 6675 6e63 7d22 2c20 226d 6167  llm_func}", "mag
-000027e0: 656e 7461 2229 290d 0a20 2020 2020 2020  enta"))..       
-000027f0: 2020 2020 2063 7072 696e 7428 6622 5c6e       cprint(f"\n
-00002800: 3e3e 2054 7279 696e 6720 746f 2064 6574  >> Trying to det
-00002810: 6572 6d69 6e65 2074 6865 2062 6573 7420  ermine the best 
-00002820: 6d65 7468 6f64 2074 6f20 616e 7377 6572  method to answer
-00002830: 2079 6f75 7220 7175 6573 7469 6f6e 2c20   your question, 
-00002840: 706c 6561 7365 2077 6169 742e 2e2e 5c6e  please wait...\n
-00002850: 222c 2027 6d61 6765 6e74 6127 2c20 6174  ", 'magenta', at
-00002860: 7472 733d 5b27 626f 6c64 275d 290d 0a0d  trs=['bold'])...
-00002870: 0a20 2020 2020 2020 2023 2043 616c 6c20  .        # Call 
-00002880: 4f70 656e 4149 2041 5049 0d0a 2020 2020  OpenAI API..    
-00002890: 2020 2020 6675 6e63 7469 6f6e 5f6e 616d      function_nam
-000028a0: 6520 3d20 7b22 6e61 6d65 223a 2022 5141  e = {"name": "QA
-000028b0: 5f52 6573 706f 6e73 6522 7d0d 0a20 2020  _Response"}..   
-000028c0: 2020 2020 2066 6e5f 6e61 6d65 2c20 6172       fn_name, ar
-000028d0: 6775 6d65 6e74 732c 2074 6f6b 656e 735f  guments, tokens_
-000028e0: 7573 6564 203d 2073 656c 662e 6c6c 6d5f  used = self.llm_
-000028f0: 6675 6e63 5f63 616c 6c28 6576 616c 5f6d  func_call(eval_m
-00002900: 6573 7361 6765 732c 7365 6c66 2e74 6173  essages,self.tas
-00002910: 6b5f 6576 616c 5f66 756e 6374 696f 6e2c  k_eval_function,
-00002920: 2066 756e 6374 696f 6e5f 6e61 6d65 290d   function_name).
-00002930: 0a0d 0a20 2020 2020 2020 2023 2050 6172  ...        # Par
-00002940: 7365 2074 6865 204a 534f 4e20 7374 7269  se the JSON stri
-00002950: 6e67 2074 6f20 6120 5079 7468 6f6e 2064  ng to a Python d
-00002960: 6963 740d 0a20 2020 2020 2020 2061 7267  ict..        arg
-00002970: 756d 656e 7473 5f64 6963 7420 3d20 6a73  uments_dict = js
-00002980: 6f6e 2e6c 6f61 6473 2861 7267 756d 656e  on.loads(argumen
-00002990: 7473 2c20 7374 7269 6374 3d46 616c 7365  ts, strict=False
-000029a0: 290d 0a0d 0a20 2020 2020 2020 2023 2052  )....        # R
-000029b0: 6574 7269 6576 6520 7661 6c75 6573 0d0a  etrieve values..
-000029c0: 2020 2020 2020 2020 6576 616c 5f61 6e73          eval_ans
-000029d0: 7765 7220 3d20 6172 6775 6d65 6e74 735f  wer = arguments_
-000029e0: 6469 6374 5b22 616e 7377 6572 225d 0d0a  dict["answer"]..
-000029f0: 2020 2020 2020 2020 6576 616c 5f61 6e73          eval_ans
-00002a00: 7765 725f 7479 7065 203d 2061 7267 756d  wer_type = argum
-00002a10: 656e 7473 5f64 6963 745b 2261 6e73 7765  ents_dict["answe
-00002a20: 725f 7479 7065 225d 0d0a 0d0a 2020 2020  r_type"]....    
-00002a30: 2020 2020 7365 6c66 2e74 6f74 616c 5f74      self.total_t
-00002a40: 6f6b 656e 735f 7573 6564 2e61 7070 656e  okens_used.appen
-00002a50: 6428 746f 6b65 6e73 5f75 7365 6429 0d0a  d(tokens_used)..
-00002a60: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00002a70: 2061 7267 756d 656e 7473 2c20 666e 5f6e   arguments, fn_n
-00002a80: 616d 652c 2065 7661 6c5f 616e 7377 6572  ame, eval_answer
-00002a90: 2c20 6576 616c 5f61 6e73 7765 725f 7479  , eval_answer_ty
-00002aa0: 7065 0d0a 0d0a 2020 2020 6465 6620 6465  pe....    def de
-00002ab0: 6275 675f 636f 6465 2873 656c 662c 636f  bug_code(self,co
-00002ac0: 6465 2c71 7565 7374 696f 6e2c 206c 6c6d  de,question, llm
-00002ad0: 5f63 6173 6361 6465 3d46 616c 7365 293a  _cascade=False):
-00002ae0: 0d0a 2020 2020 2020 2020 2320 496e 6974  ..        # Init
-00002af0: 6961 6c69 7a65 2074 6865 206d 6573 7361  ialize the messa
-00002b00: 6765 7320 6c69 7374 2077 6974 6820 6120  ges list with a 
-00002b10: 7379 7374 656d 206d 6573 7361 6765 2063  system message c
-00002b20: 6f6e 7461 696e 696e 6720 7468 6520 7461  ontaining the ta
-00002b30: 736b 2070 726f 6d70 740d 0a20 2020 2020  sk prompt..     
-00002b40: 2020 2064 6562 7567 5f6d 6573 7361 6765     debug_message
-00002b50: 7320 3d20 5b7b 2272 6f6c 6522 3a20 2273  s = [{"role": "s
-00002b60: 7973 7465 6d22 2c20 2263 6f6e 7465 6e74  ystem", "content
-00002b70: 223a 2073 656c 662e 6465 6275 675f 636f  ": self.debug_co
-00002b80: 6465 5f74 6173 6b2e 666f 726d 6174 2863  de_task.format(c
-00002b90: 6f64 652c 7175 6573 7469 6f6e 297d 5d0d  ode,question)}].
-00002ba0: 0a0d 0a20 2020 2020 2020 2075 7369 6e67  ...        using
-00002bb0: 5f6d 6f64 656c 203d 2073 656c 662e 6c6c  _model = self.ll
-00002bc0: 6d0d 0a20 2020 2020 2020 2069 6620 6c6c  m..        if ll
-00002bd0: 6d5f 6361 7363 6164 653a 0d0a 2020 2020  m_cascade:..    
-00002be0: 2020 2020 2020 2020 7573 696e 675f 6d6f          using_mo
-00002bf0: 6465 6c20 3d20 7365 6c66 2e6c 6c6d 5f67  del = self.llm_g
-00002c00: 7074 340d 0a0d 0a20 2020 2020 2020 2069  pt4....        i
-00002c10: 6620 2769 7079 6b65 726e 656c 2720 696e  f 'ipykernel' in
-00002c20: 2073 7973 2e6d 6f64 756c 6573 3a0d 0a20   sys.modules:.. 
-00002c30: 2020 2020 2020 2020 2020 2023 204a 7570             # Jup
-00002c40: 7974 6572 206e 6f74 6562 6f6f 6b20 6f72  yter notebook or
-00002c50: 2069 7079 7468 6f6e 0d0a 2020 2020 2020   ipython..      
-00002c60: 2020 2020 2020 6469 7370 6c61 7928 4854        display(HT
-00002c70: 4d4c 2866 273c 7020 7374 796c 653d 2263  ML(f'<p style="c
-00002c80: 6f6c 6f72 3a6d 6167 656e 7461 3b22 3e5c  olor:magenta;">\
-00002c90: 6e43 616c 6c69 6e67 204d 6f64 656c 3a20  nCalling Model: 
-00002ca0: 7b75 7369 6e67 5f6d 6f64 656c 7d3c 2f70  {using_model}</p
-00002cb0: 3e27 2929 0d0a 2020 2020 2020 2020 2020  >'))..          
-00002cc0: 2020 6469 7370 6c61 7928 4854 4d4c 2866    display(HTML(f
-00002cd0: 273c 703e 3c62 2073 7479 6c65 3d22 636f  '<p><b style="co
-00002ce0: 6c6f 723a 6d61 6765 6e74 613b 223e 4920  lor:magenta;">I 
-00002cf0: 6861 7665 2072 6563 6569 7665 6420 7468  have received th
-00002d00: 6520 6669 7273 7420 7665 7273 696f 6e20  e first version 
-00002d10: 6f66 2074 6865 2063 6f64 652e 2049 2061  of the code. I a
-00002d20: 6d20 7365 6e64 696e 6720 6974 2062 6163  m sending it bac
-00002d30: 6b20 746f 204c 4c4d 2074 6f20 6765 7420  k to LLM to get 
-00002d40: 6974 2063 6865 636b 6564 2066 6f72 2061  it checked for a
-00002d50: 6e79 2065 7272 6f72 732c 2062 7567 7320  ny errors, bugs 
-00002d60: 6f72 2069 6e63 6f6e 7369 7374 656e 6369  or inconsistenci
-00002d70: 6573 2c20 616e 6420 636f 7272 6563 7469  es, and correcti
-00002d80: 6f6e 2069 6620 6e65 6365 7373 6172 792e  on if necessary.
-00002d90: 2050 6c65 6173 6520 7761 6974 2e2e 2e3c   Please wait...<
-00002da0: 2f62 3e3c 2f70 3e3c 6272 3e27 2929 0d0a  /b></p><br>'))..
-00002db0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00002dc0: 2020 2020 2020 2020 2020 2023 204f 7468             # Oth
-00002dd0: 6572 2065 6e76 6972 6f6e 6d65 6e74 2028  er environment (
-00002de0: 6c69 6b65 2074 6572 6d69 6e61 6c29 0d0a  like terminal)..
-00002df0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00002e00: 7428 636f 6c6f 7265 6428 6622 5c6e 3e3e  t(colored(f"\n>>
-00002e10: 2043 616c 6c69 6e67 204d 6f64 656c 3a20   Calling Model: 
-00002e20: 7b75 7369 6e67 5f6d 6f64 656c 7d22 2c20  {using_model}", 
-00002e30: 226d 6167 656e 7461 2229 290d 0a20 2020  "magenta"))..   
-00002e40: 2020 2020 2020 2020 2063 7072 696e 7428           cprint(
-00002e50: 6622 5c6e 3e3e 2049 2068 6176 6520 7265  f"\n>> I have re
-00002e60: 6365 6976 6564 2074 6865 2066 6972 7374  ceived the first
-00002e70: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
-00002e80: 636f 6465 2e20 4920 616d 2073 656e 6469  code. I am sendi
-00002e90: 6e67 2069 7420 6261 636b 2074 6f20 4c4c  ng it back to LL
-00002ea0: 4d20 746f 2067 6574 2069 7420 6368 6563  M to get it chec
-00002eb0: 6b65 6420 666f 7220 616e 7920 6572 726f  ked for any erro
-00002ec0: 7273 2c20 6275 6773 206f 7220 696e 636f  rs, bugs or inco
-00002ed0: 6e73 6973 7465 6e63 6965 732c 2061 6e64  nsistencies, and
-00002ee0: 2063 6f72 7265 6374 696f 6e20 6966 206e   correction if n
-00002ef0: 6563 6573 7361 7279 2e20 506c 6561 7365  ecessary. Please
-00002f00: 2077 6169 742e 2e2e 5c6e 222c 2027 6d61   wait...\n", 'ma
-00002f10: 6765 6e74 6127 2c20 6174 7472 733d 5b27  genta', attrs=['
-00002f20: 626f 6c64 275d 290d 0a0d 0a20 2020 2020  bold'])....     
-00002f30: 2020 2023 2046 756e 6374 696f 6e20 746f     # Function to
-00002f40: 2064 6973 706c 6179 2072 6573 756c 7473   display results
-00002f50: 206e 6963 656c 790d 0a20 2020 2020 2020   nicely..       
-00002f60: 2064 6566 2064 6973 706c 6179 5f74 6173   def display_tas
-00002f70: 6b28 293a 0d0a 2020 2020 2020 2020 2020  k():..          
-00002f80: 2020 6966 2027 6970 796b 6572 6e65 6c27    if 'ipykernel'
-00002f90: 2069 6e20 7379 732e 6d6f 6475 6c65 733a   in sys.modules:
-00002fa0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002fb0: 2020 2320 4a75 7079 7465 7220 6e6f 7465    # Jupyter note
-00002fc0: 626f 6f6b 206f 7220 6970 7974 686f 6e0d  book or ipython.
-00002fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002fe0: 2064 6973 706c 6179 2848 544d 4c28 6627   display(HTML(f'
-00002ff0: 3c70 3e3c 6220 7374 796c 653d 2263 6f6c  <p><b style="col
-00003000: 6f72 3a6d 6167 656e 7461 3b22 3e49 2068  or:magenta;">I h
-00003010: 6176 6520 6669 6e69 7368 6564 2064 6562  ave finished deb
-00003020: 7567 6769 6e67 2074 6865 2063 6f64 652c  ugging the code,
-00003030: 2061 6e64 2077 696c 6c20 6e6f 7720 7072   and will now pr
-00003040: 6f63 6565 6420 746f 2074 6865 2065 7865  oceed to the exe
-00003050: 6375 7469 6f6e 2e2e 2e3c 2f62 3e3c 2f70  cution...</b></p
-00003060: 3e3c 6272 3e27 2929 0d0a 2020 2020 2020  ><br>'))..      
-00003070: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00003080: 2020 2020 2020 2020 2020 2020 2023 204f               # O
-00003090: 7468 6572 2065 6e76 6972 6f6e 6d65 6e74  ther environment
-000030a0: 2028 6c69 6b65 2074 6572 6d69 6e61 6c29   (like terminal)
-000030b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000030c0: 2020 6370 7269 6e74 2866 225c 6e3e 3e20    cprint(f"\n>> 
-000030d0: 4920 6861 7665 2066 696e 6973 6865 6420  I have finished 
-000030e0: 6465 6275 6767 696e 6720 7468 6520 636f  debugging the co
-000030f0: 6465 2c20 616e 6420 7769 6c6c 206e 6f77  de, and will now
-00003100: 2070 726f 6365 6564 2074 6f20 7468 6520   proceed to the 
-00003110: 6578 6563 7574 696f 6e2e 2e2e 5c6e 222c  execution...\n",
-00003120: 2027 6d61 6765 6e74 6127 2c20 6174 7472   'magenta', attr
-00003130: 733d 5b27 626f 6c64 275d 290d 0a0d 0a20  s=['bold']).... 
-00003140: 2020 2020 2020 2023 2043 616c 6c20 7468         # Call th
-00003150: 6520 4f70 656e 4149 2041 5049 0d0a 2020  e OpenAI API..  
-00003160: 2020 2020 2020 6c6c 6d5f 7265 7370 6f6e        llm_respon
-00003170: 7365 2c20 746f 6b65 6e73 5f75 7365 6420  se, tokens_used 
-00003180: 3d20 7365 6c66 2e6c 6c6d 5f63 616c 6c28  = self.llm_call(
-00003190: 6465 6275 675f 6d65 7373 6167 6573 2c74  debug_messages,t
-000031a0: 656d 7065 7261 7475 7265 3d30 2c6c 6c6d  emperature=0,llm
-000031b0: 5f63 6173 6361 6465 3d6c 6c6d 5f63 6173  _cascade=llm_cas
-000031c0: 6361 6465 2920 2320 6869 6768 6572 2074  cade) # higher t
-000031d0: 656d 7065 7261 7475 7265 2072 6573 756c  emperature resul
-000031e0: 7473 2069 6e20 6d6f 7265 2022 6372 6561  ts in more "crea
-000031f0: 7469 7665 2220 616e 7377 6572 7320 2873  tive" answers (s
-00003200: 6f6d 6574 696d 6573 2074 6f6f 2063 7265  ometimes too cre
-00003210: 6174 6976 6520 3a2d 2929 0d0a 2020 2020  ative :-))..    
-00003220: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
-00003230: 4578 7472 6163 7420 7468 6520 636f 6465  Extract the code
-00003240: 2066 726f 6d20 7468 6520 4150 4920 7265   from the API re
-00003250: 7370 6f6e 7365 0d0a 2020 2020 2020 2020  sponse..        
-00003260: 6465 6275 6767 6564 5f63 6f64 6520 3d20  debugged_code = 
-00003270: 7365 6c66 2e5f 6578 7472 6163 745f 636f  self._extract_co
-00003280: 6465 286c 6c6d 5f72 6573 706f 6e73 6529  de(llm_response)
-00003290: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000032a0: 2064 6973 706c 6179 5f74 6173 6b28 290d   display_task().
-000032b0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-000032c0: 746f 7461 6c5f 746f 6b65 6e73 5f75 7365  total_tokens_use
-000032d0: 642e 6170 7065 6e64 2874 6f6b 656e 735f  d.append(tokens_
-000032e0: 7573 6564 290d 0a0d 0a20 2020 2020 2020  used)....       
-000032f0: 2072 6574 7572 6e20 6465 6275 6767 6564   return debugged
-00003300: 5f63 6f64 650d 0a0d 0a20 2020 2064 6566  _code....    def
-00003310: 2072 616e 6b5f 636f 6465 2873 656c 662c   rank_code(self,
-00003320: 636f 6465 2c71 7565 7374 696f 6e2c 6c6c  code,question,ll
-00003330: 6d5f 6361 7363 6164 653d 4661 6c73 6529  m_cascade=False)
-00003340: 3a0d 0a20 2020 2020 2020 2023 2049 6e69  :..        # Ini
-00003350: 7469 616c 697a 6520 7468 6520 6d65 7373  tialize the mess
-00003360: 6167 6573 206c 6973 7420 7769 7468 2061  ages list with a
-00003370: 2073 7973 7465 6d20 6d65 7373 6167 6520   system message 
-00003380: 636f 6e74 6169 6e69 6e67 2074 6865 2074  containing the t
-00003390: 6173 6b20 7072 6f6d 7074 0d0a 2020 2020  ask prompt..    
-000033a0: 2020 2020 7261 6e6b 5f6d 6573 7361 6765      rank_message
-000033b0: 7320 3d20 5b7b 2272 6f6c 6522 3a20 2273  s = [{"role": "s
-000033c0: 7973 7465 6d22 2c20 2263 6f6e 7465 6e74  ystem", "content
-000033d0: 223a 2073 656c 662e 7261 6e6b 5f61 6e73  ": self.rank_ans
-000033e0: 7765 722e 666f 726d 6174 2863 6f64 652c  wer.format(code,
-000033f0: 7175 6573 7469 6f6e 297d 5d0d 0a0d 0a20  question)}].... 
-00003400: 2020 2020 2020 2075 7369 6e67 5f6d 6f64         using_mod
-00003410: 656c 203d 2073 656c 662e 6c6c 6d0d 0a20  el = self.llm.. 
-00003420: 2020 2020 2020 2069 6620 6c6c 6d5f 6361         if llm_ca
-00003430: 7363 6164 653a 0d0a 2020 2020 2020 2020  scade:..        
-00003440: 2020 2020 7573 696e 675f 6d6f 6465 6c20      using_model 
-00003450: 3d20 7365 6c66 2e6c 6c6d 5f67 7074 340d  = self.llm_gpt4.
-00003460: 0a0d 0a20 2020 2020 2020 2069 6620 2769  ...        if 'i
-00003470: 7079 6b65 726e 656c 2720 696e 2073 7973  pykernel' in sys
-00003480: 2e6d 6f64 756c 6573 3a0d 0a20 2020 2020  .modules:..     
-00003490: 2020 2020 2020 2023 204a 7570 7974 6572         # Jupyter
-000034a0: 206e 6f74 6562 6f6f 6b20 6f72 2069 7079   notebook or ipy
-000034b0: 7468 6f6e 0d0a 2020 2020 2020 2020 2020  thon..          
-000034c0: 2020 6469 7370 6c61 7928 4854 4d4c 2866    display(HTML(f
-000034d0: 273c 7020 7374 796c 653d 2263 6f6c 6f72  '<p style="color
-000034e0: 3a6d 6167 656e 7461 3b22 3e5c 6e43 616c  :magenta;">\nCal
-000034f0: 6c69 6e67 204d 6f64 656c 3a20 7b75 7369  ling Model: {usi
-00003500: 6e67 5f6d 6f64 656c 7d3c 2f70 3e27 2929  ng_model}</p>'))
-00003510: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
-00003520: 7370 6c61 7928 4854 4d4c 2866 273c 703e  splay(HTML(f'<p>
-00003530: 3c62 2073 7479 6c65 3d22 636f 6c6f 723a  <b style="color:
-00003540: 6d61 6765 6e74 613b 223e 4920 616d 2067  magenta;">I am g
-00003550: 6f69 6e67 2074 6f20 6576 616c 7561 7465  oing to evaluate
-00003560: 2061 6e64 2072 616e 6b20 7468 6520 616e   and rank the an
-00003570: 7377 6572 2e20 506c 6561 7365 2077 6169  swer. Please wai
-00003580: 742e 2e2e 3c2f 623e 3c2f 703e 3c62 723e  t...</b></p><br>
-00003590: 2729 290d 0a20 2020 2020 2020 2065 6c73  '))..        els
-000035a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000035b0: 2320 4f74 6865 7220 656e 7669 726f 6e6d  # Other environm
-000035c0: 656e 7420 286c 696b 6520 7465 726d 696e  ent (like termin
-000035d0: 616c 290d 0a20 2020 2020 2020 2020 2020  al)..           
-000035e0: 2070 7269 6e74 2863 6f6c 6f72 6564 2866   print(colored(f
-000035f0: 225c 6e3e 3e20 4361 6c6c 696e 6720 4d6f  "\n>> Calling Mo
-00003600: 6465 6c3a 207b 7573 696e 675f 6d6f 6465  del: {using_mode
-00003610: 6c7d 222c 2022 6d61 6765 6e74 6122 2929  l}", "magenta"))
-00003620: 0d0a 2020 2020 2020 2020 2020 2020 6370  ..            cp
-00003630: 7269 6e74 2866 225c 6e3e 3e20 4920 616d  rint(f"\n>> I am
-00003640: 2067 6f69 6e67 2074 6f20 6576 616c 7561   going to evalua
-00003650: 7465 2061 6e64 2072 616e 6b20 7468 6520  te and rank the 
-00003660: 616e 7377 6572 2e20 506c 6561 7365 2077  answer. Please w
-00003670: 6169 742e 2e5c 6e22 2c20 276d 6167 656e  ait..\n", 'magen
-00003680: 7461 272c 2061 7474 7273 3d5b 2762 6f6c  ta', attrs=['bol
-00003690: 6427 5d29 0d0a 0d0a 2020 2020 2020 2020  d'])....        
-000036a0: 2320 4361 6c6c 2074 6865 204f 7065 6e41  # Call the OpenA
-000036b0: 4920 4150 4920 0d0a 2020 2020 2020 2020  I API ..        
-000036c0: 6c6c 6d5f 7265 7370 6f6e 7365 2c20 746f  llm_response, to
-000036d0: 6b65 6e73 5f75 7365 6420 3d20 7365 6c66  kens_used = self
-000036e0: 2e6c 6c6d 5f63 616c 6c28 7261 6e6b 5f6d  .llm_call(rank_m
-000036f0: 6573 7361 6765 732c 6c6c 6d5f 6361 7363  essages,llm_casc
-00003700: 6164 653d 6c6c 6d5f 6361 7363 6164 6529  ade=llm_cascade)
-00003710: 0d0a 0d0a 2020 2020 2020 2020 2320 4578  ....        # Ex
-00003720: 7472 6163 7420 7468 6520 7261 6e6b 2066  tract the rank f
-00003730: 726f 6d20 7468 6520 4150 4920 7265 7370  rom the API resp
-00003740: 6f6e 7365 0d0a 2020 2020 2020 2020 7261  onse..        ra
-00003750: 6e6b 203d 2073 656c 662e 5f65 7874 7261  nk = self._extra
-00003760: 6374 5f72 616e 6b28 6c6c 6d5f 7265 7370  ct_rank(llm_resp
-00003770: 6f6e 7365 2920 2020 2020 2020 0d0a 0d0a  onse)       ....
-00003780: 2020 2020 2020 2020 7365 6c66 2e74 6f74          self.tot
-00003790: 616c 5f74 6f6b 656e 735f 7573 6564 2e61  al_tokens_used.a
-000037a0: 7070 656e 6428 746f 6b65 6e73 5f75 7365  ppend(tokens_use
-000037b0: 6429 0d0a 0d0a 2020 2020 2020 2020 7265  d)....        re
-000037c0: 7475 726e 2072 616e 6b0d 0a0d 0a20 2020  turn rank....   
-000037d0: 2064 6566 2070 645f 6167 656e 745f 636f   def pd_agent_co
-000037e0: 6e76 6572 7365 2873 656c 662c 2071 7565  nverse(self, que
-000037f0: 7374 696f 6e3d 4e6f 6e65 293a 0d0a 2020  stion=None):..  
-00003800: 2020 2020 2020 2320 4675 6e63 7469 6f6e        # Function
-00003810: 7320 746f 2064 6973 706c 6179 2072 6573  s to display res
-00003820: 756c 7473 206e 6963 656c 790d 0a20 2020  ults nicely..   
-00003830: 2020 2020 2064 6566 2064 6973 706c 6179       def display
-00003840: 5f72 6573 756c 7473 2861 6e73 7765 722c  _results(answer,
-00003850: 2063 6f64 652c 2072 616e 6b2c 2074 6f74   code, rank, tot
-00003860: 616c 5f74 6f6b 656e 735f 7573 6564 5f73  al_tokens_used_s
-00003870: 756d 293a 0d0a 2020 2020 2020 2020 2020  um):..          
-00003880: 2020 6966 2027 6970 796b 6572 6e65 6c27    if 'ipykernel'
-00003890: 2069 6e20 7379 732e 6d6f 6475 6c65 733a   in sys.modules:
-000038a0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-000038b0: 2020 2020 2020 2069 6620 616e 7377 6572         if answer
-000038c0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-000038d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000038e0: 2020 2064 6973 706c 6179 2848 544d 4c28     display(HTML(
-000038f0: 6627 3c70 3e3c 6220 7374 796c 653d 2263  f'<p><b style="c
-00003900: 6f6c 6f72 3a62 6c75 653b 223e 4920 6e6f  olor:blue;">I no
-00003910: 7720 6861 7665 2074 6865 2066 696e 616c  w have the final
-00003920: 2061 6e73 7765 723a 3c2f 623e 3c62 723e   answer:</b><br>
-00003930: 3c70 7265 2073 7479 6c65 3d22 636f 6c6f  <pre style="colo
-00003940: 723a 626c 6163 6b3b 2077 6869 7465 2d73  r:black; white-s
-00003950: 7061 6365 3a20 7072 652d 7772 6170 3b20  pace: pre-wrap; 
-00003960: 666f 6e74 2d77 6569 6768 743a 2062 6f6c  font-weight: bol
-00003970: 643b 223e 7b61 6e73 7765 727d 3c2f 7072  d;">{answer}</pr
-00003980: 653e 3c2f 703e 3c62 723e 2729 290d 0a20  e></p><br>')).. 
-00003990: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000039a0: 6620 636f 6465 2069 7320 6e6f 7420 4e6f  f code is not No
-000039b0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-000039c0: 2020 2020 2020 2020 2064 6973 706c 6179           display
-000039d0: 2848 544d 4c28 6627 3c70 3e3c 6220 7374  (HTML(f'<p><b st
-000039e0: 796c 653d 2263 6f6c 6f72 3a62 6c75 653b  yle="color:blue;
-000039f0: 223e 4865 7265 2069 7320 7468 6520 6669  ">Here is the fi
-00003a00: 6e61 6c20 636f 6465 2074 6861 7420 6163  nal code that ac
-00003a10: 636f 6d70 6c69 7368 6573 2074 6865 2074  complishes the t
-00003a20: 6173 6b3a 3c2f 623e 3c62 723e 3c70 7265  ask:</b><br><pre
-00003a30: 2073 7479 6c65 3d22 636f 6c6f 723a 2335   style="color:#5
-00003a40: 3535 3535 353b 223e 7b63 6f64 657d 3c2f  55555;">{code}</
-00003a50: 7072 653e 3c2f 703e 3c62 723e 2729 290d  pre></p><br>')).
-00003a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003a70: 2069 6620 7365 6c66 2e76 6563 746f 725f   if self.vector_
-00003a80: 6462 2061 6e64 2072 616e 6b20 6973 206e  db and rank is n
-00003a90: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00003aa0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00003ab0: 7370 6c61 7928 4854 4d4c 2866 273c 703e  splay(HTML(f'<p>
-00003ac0: 3c62 2073 7479 6c65 3d22 636f 6c6f 723a  <b style="color:
-00003ad0: 626c 7565 3b22 3e52 616e 6b3a 3c2f 623e  blue;">Rank:</b>
-00003ae0: 3c62 723e 3c73 7061 6e20 7374 796c 653d  <br><span style=
-00003af0: 2263 6f6c 6f72 3a62 6c61 636b 3b22 3e7b  "color:black;">{
-00003b00: 7261 6e6b 7d3c 2f73 7061 6e3e 3c2f 703e  rank}</span></p>
-00003b10: 3c62 723e 2729 290d 0a20 2020 2020 2020  <br>'))..       
-00003b20: 2020 2020 2020 2020 2064 6973 706c 6179           display
-00003b30: 2848 544d 4c28 6627 3c70 3e3c 6220 7374  (HTML(f'<p><b st
-00003b40: 796c 653d 2263 6f6c 6f72 3a62 6c75 653b  yle="color:blue;
-00003b50: 223e 546f 7461 6c20 546f 6b65 6e73 2055  ">Total Tokens U
-00003b60: 7365 643a 3c2f 623e 3c62 723e 3c73 7061  sed:</b><br><spa
-00003b70: 6e20 7374 796c 653d 2263 6f6c 6f72 3a62  n style="color:b
-00003b80: 6c61 636b 3b22 3e7b 746f 7461 6c5f 746f  lack;">{total_to
-00003b90: 6b65 6e73 5f75 7365 645f 7375 6d7d 3c2f  kens_used_sum}</
-00003ba0: 7370 616e 3e3c 2f70 3e3c 6272 3e27 2929  span></p><br>'))
-00003bb0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00003bc0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00003bd0: 2020 2020 2069 6620 616e 7377 6572 2069       if answer i
-00003be0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00003bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003c00: 2063 7072 696e 7428 6622 5c6e 3e3e 2049   cprint(f"\n>> I
-00003c10: 206e 6f77 2068 6176 6520 7468 6520 6669   now have the fi
-00003c20: 6e61 6c20 616e 7377 6572 3a5c 6e7b 616e  nal answer:\n{an
-00003c30: 7377 6572 7d5c 6e22 2c20 2767 7265 656e  swer}\n", 'green
-00003c40: 272c 2061 7474 7273 3d5b 2762 6f6c 6427  ', attrs=['bold'
-00003c50: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00003c60: 2020 2020 6966 2063 6f64 6520 6973 206e      if code is n
-00003c70: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00003c80: 2020 2020 2020 2020 2020 2020 2020 6370                cp
-00003c90: 7269 6e74 2866 223e 3e20 4865 7265 2069  rint(f">> Here i
-00003ca0: 7320 7468 6520 6669 6e61 6c20 636f 6465  s the final code
-00003cb0: 2074 6861 7420 6163 636f 6d70 6c69 7368   that accomplish
-00003cc0: 6573 2074 6865 2074 6173 6b3a 5c6e 7b63  es the task:\n{c
-00003cd0: 6f64 657d 5c6e 222c 2027 6772 6565 6e27  ode}\n", 'green'
-00003ce0: 2c20 6174 7472 733d 5b27 626f 6c64 275d  , attrs=['bold']
-00003cf0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00003d00: 2020 2069 6620 7365 6c66 2e76 6563 746f     if self.vecto
-00003d10: 725f 6462 2061 6e64 2072 616e 6b20 6973  r_db and rank is
-00003d20: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00000020: 7973 0d0a 696d 706f 7274 206a 736f 6e0d  ys..import json.
+00000030: 0a66 726f 6d20 636f 6e74 6578 746c 6962  .from contextlib
+00000040: 2069 6d70 6f72 7420 7265 6469 7265 6374   import redirect
+00000050: 5f73 7464 6f75 740d 0a69 6d70 6f72 7420  _stdout..import 
+00000060: 696f 0d0a 696d 706f 7274 2074 696d 650d  io..import time.
+00000070: 0a69 6d70 6f72 7420 7061 6e64 6173 2061  .import pandas a
+00000080: 7320 7064 0d0a 6672 6f6d 2074 6572 6d63  s pd..from termc
+00000090: 6f6c 6f72 2069 6d70 6f72 7420 636f 6c6f  olor import colo
+000000a0: 7265 642c 2063 7072 696e 740d 0a66 726f  red, cprint..fro
+000000b0: 6d20 4950 7974 686f 6e2e 6469 7370 6c61  m IPython.displa
+000000c0: 7920 696d 706f 7274 2064 6973 706c 6179  y import display
+000000d0: 2c48 544d 4c0d 0a69 6d70 6f72 7420 7761  ,HTML..import wa
+000000e0: 726e 696e 6773 0d0a 7761 726e 696e 6773  rnings..warnings
+000000f0: 2e66 696c 7465 7277 6172 6e69 6e67 7328  .filterwarnings(
+00000100: 2769 676e 6f72 6527 290d 0a0d 0a23 5275  'ignore')....#Ru
+00000110: 6e6e 696e 6720 6173 2061 2073 6372 6970  nning as a scrip
+00000120: 740d 0a23 696d 706f 7274 206d 6f64 656c  t..#import model
+00000130: 730d 0a23 696d 706f 7274 2070 726f 6d70  s..#import promp
+00000140: 7473 0d0a 2369 6d70 6f72 7420 6675 6e63  ts..#import func
+00000150: 5f63 616c 6c73 0d0a 2369 6d70 6f72 7420  _calls..#import 
+00000160: 7161 5f72 6574 7269 6576 616c 0d0a 2369  qa_retrieval..#i
+00000170: 6d70 6f72 745f 676f 6f67 6c65 5f73 6561  mport_google_sea
+00000180: 7263 6820 2320 496e 636c 7564 6564 2069  rch # Included i
+00000190: 6e20 7468 6520 7061 636b 6167 652c 2062  n the package, b
+000001a0: 7574 206e 6f74 2072 6561 6479 2079 6574  ut not ready yet
+000001b0: 2e20 5769 6c6c 206e 6565 6420 736f 6d65  . Will need some
+000001c0: 206d 6f72 6520 776f 726b 2e0d 0a0d 0a23   more work.....#
+000001d0: 5275 6e6e 696e 6720 6173 2061 2070 6163  Running as a pac
+000001e0: 6b61 6765 0d0a 6672 6f6d 202e 2069 6d70  kage..from . imp
+000001f0: 6f72 7420 6d6f 6465 6c73 0d0a 6672 6f6d  ort models..from
+00000200: 202e 2069 6d70 6f72 7420 7072 6f6d 7074   . import prompt
+00000210: 730d 0a66 726f 6d20 2e20 696d 706f 7274  s..from . import
+00000220: 2066 756e 635f 6361 6c6c 730d 0a66 726f   func_calls..fro
+00000230: 6d20 2e20 696d 706f 7274 2071 615f 7265  m . import qa_re
+00000240: 7472 6965 7661 6c0d 0a23 6672 6f6d 202e  trieval..#from .
+00000250: 2069 6d70 6f72 7420 676f 6f67 6c65 5f73   import google_s
+00000260: 6561 7263 6820 2320 496e 636c 7564 6564  earch # Included
+00000270: 2069 6e20 7468 6520 7061 636b 6167 652c   in the package,
+00000280: 2062 7574 206e 6f74 2072 6561 6479 2079   but not ready y
+00000290: 6574 2e20 5769 6c6c 206e 6565 6420 736f  et. Will need so
+000002a0: 6d65 206d 6f72 6520 776f 726b 2e0d 0a0d  me more work....
+000002b0: 0a63 6c61 7373 2042 616d 626f 6f41 493a  .class BambooAI:
+000002c0: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+000002d0: 5f5f 2873 656c 662c 2064 663a 2070 642e  __(self, df: pd.
+000002e0: 4461 7461 4672 616d 652c 0d0a 2020 2020  DataFrame,..    
+000002f0: 2020 2020 2020 2020 2020 2020 206d 6178               max
+00000300: 5f63 6f6e 7665 7273 6174 696f 6e73 3a20  _conversations: 
+00000310: 696e 7420 3d20 342c 0d0a 2020 2020 2020  int = 4,..      
+00000320: 2020 2020 2020 2020 2020 206c 6c6d 3a20             llm: 
+00000330: 7374 7220 3d20 2767 7074 2d33 2e35 2d74  str = 'gpt-3.5-t
+00000340: 7572 626f 2d30 3631 3327 2c20 2320 4261  urbo-0613', # Ba
+00000350: 7365 204d 6f64 656c 0d0a 2020 2020 2020  se Model..      
+00000360: 2020 2020 2020 2020 2020 2064 6562 7567             debug
+00000370: 3a20 626f 6f6c 203d 2046 616c 7365 2c20  : bool = False, 
+00000380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00000390: 2020 2076 6563 746f 725f 6462 3a20 626f     vector_db: bo
+000003a0: 6f6c 203d 2046 616c 7365 2c20 0d0a 2020  ol = False, ..  
+000003b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000003c0: 6c6d 5f73 7769 7463 683a 2062 6f6f 6c20  lm_switch: bool 
+000003d0: 3d20 4661 6c73 652c 200d 0a20 2020 2020  = False, ..     
+000003e0: 2020 2020 2020 2020 2020 2020 6578 706c              expl
+000003f0: 6f72 6174 6f72 793a 2062 6f6f 6c20 3d20  oratory: bool = 
+00000400: 5472 7565 2c20 0d0a 2020 2020 2020 2020  True, ..        
+00000410: 2020 2020 2020 2020 2029 3a0d 0a0d 0a20           ):.... 
+00000420: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
+00000430: 6620 7468 6520 4f50 454e 4149 5f41 5049  f the OPENAI_API
+00000440: 5f4b 4559 2065 6e76 6972 6f6e 6d65 6e74  _KEY environment
+00000450: 2076 6172 6961 626c 6520 6973 2073 6574   variable is set
+00000460: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00000470: 206f 732e 6765 7465 6e76 2827 4f50 454e   os.getenv('OPEN
+00000480: 4149 5f41 5049 5f4b 4559 2729 3a0d 0a20  AI_API_KEY'):.. 
+00000490: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000004a0: 2045 6e76 6972 6f6e 6d65 6e74 4572 726f   EnvironmentErro
+000004b0: 7228 224f 5045 4e41 495f 4150 495f 4b45  r("OPENAI_API_KE
+000004c0: 5920 656e 7669 726f 6e6d 656e 7420 7661  Y environment va
+000004d0: 7269 6162 6c65 206e 6f74 2066 6f75 6e64  riable not found
+000004e0: 2e22 290d 0a20 2020 2020 2020 200d 0a20  .")..        .. 
+000004f0: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
+00000500: 6620 7468 6520 5049 4e45 434f 4e45 5f41  f the PINECONE_A
+00000510: 5049 5f4b 4559 2061 6e64 2050 494e 4543  PI_KEY and PINEC
+00000520: 4f4e 455f 454e 5620 656e 7669 726f 6e6d  ONE_ENV environm
+00000530: 656e 7420 7661 7269 6162 6c65 7320 6172  ent variables ar
+00000540: 6520 7365 7420 6966 2076 6563 746f 725f  e set if vector_
+00000550: 6462 2069 7320 5472 7565 0d0a 2020 2020  db is True..    
+00000560: 2020 2020 6966 2076 6563 746f 725f 6462      if vector_db
+00000570: 3a0d 0a20 2020 2020 2020 2020 2020 2050  :..            P
+00000580: 494e 4543 4f4e 455f 4150 495f 4b45 5920  INECONE_API_KEY 
+00000590: 3d20 6f73 2e67 6574 656e 7628 2750 494e  = os.getenv('PIN
+000005a0: 4543 4f4e 455f 4150 495f 4b45 5927 290d  ECONE_API_KEY').
+000005b0: 0a20 2020 2020 2020 2020 2020 2050 494e  .            PIN
+000005c0: 4543 4f4e 455f 454e 5620 3d20 6f73 2e67  ECONE_ENV = os.g
+000005d0: 6574 656e 7628 2750 494e 4543 4f4e 455f  etenv('PINECONE_
+000005e0: 454e 5627 290d 0a20 2020 2020 2020 2020  ENV')..         
+000005f0: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00000600: 2069 6620 5049 4e45 434f 4e45 5f41 5049   if PINECONE_API
+00000610: 5f4b 4559 2069 7320 4e6f 6e65 206f 7220  _KEY is None or 
+00000620: 5049 4e45 434f 4e45 5f45 4e56 2069 7320  PINECONE_ENV is 
+00000630: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00000640: 2020 2020 2020 2070 7269 6e74 2822 5761         print("Wa
+00000650: 726e 696e 673a 2050 494e 4543 4f4e 455f  rning: PINECONE_
+00000660: 4150 495f 4b45 5920 6f72 2050 494e 4543  API_KEY or PINEC
+00000670: 4f4e 455f 454e 5620 656e 7669 726f 6e6d  ONE_ENV environm
+00000680: 656e 7420 7661 7269 6162 6c65 206e 6f74  ent variable not
+00000690: 2066 6f75 6e64 2e20 4469 7361 626c 696e   found. Disablin
+000006a0: 6720 7665 6374 6f72 5f64 622e 2229 0d0a  g vector_db.")..
+000006b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000006c0: 7665 6374 6f72 5f64 6220 3d20 4661 6c73  vector_db = Fals
+000006d0: 650d 0a0d 0a20 2020 2020 2020 2073 656c  e....        sel
+000006e0: 662e 4d41 585f 4552 524f 525f 434f 5252  f.MAX_ERROR_CORR
+000006f0: 4543 5449 4f4e 5320 3d20 350d 0a20 2020  ECTIONS = 5..   
+00000700: 2020 2020 2023 2053 6574 2074 6865 206d       # Set the m
+00000710: 6178 696d 756d 206e 756d 6265 7220 6f66  aximum number of
+00000720: 2071 7565 7374 696f 6e2f 616e 7377 6572   question/answer
+00000730: 2070 6169 7273 2074 6f20 6265 206b 6570   pairs to be kep
+00000740: 7420 696e 2074 6865 2063 6f6e 7665 7273  t in the convers
+00000750: 6174 696f 6e20 6d65 6d6d 6f72 790d 0a20  ation memmory.. 
+00000760: 2020 2020 2020 2073 656c 662e 4d41 585f         self.MAX_
+00000770: 434f 4e56 4552 5341 5449 4f4e 5320 3d20  CONVERSATIONS = 
+00000780: 286d 6178 5f63 6f6e 7665 7273 6174 696f  (max_conversatio
+00000790: 6e73 2a32 2920 2d20 310d 0a20 2020 2020  ns*2) - 1..     
+000007a0: 2020 200d 0a20 2020 2020 2020 2023 2053     ..        # S
+000007b0: 746f 7265 2074 6865 206f 7269 6769 6e61  tore the origina
+000007c0: 6c20 6461 7461 6672 616d 652e 2054 6869  l dataframe. Thi
+000007d0: 7320 7769 6c6c 2062 6520 7573 6564 2074  s will be used t
+000007e0: 6f20 7265 7365 7420 7468 6520 6461 7461  o reset the data
+000007f0: 6672 616d 6520 6265 666f 7265 2065 7865  frame before exe
+00000800: 6375 7469 6e67 2074 6865 2063 6f64 650d  cuting the code.
+00000810: 0a20 2020 2020 2020 2073 656c 662e 6f72  .        self.or
+00000820: 6967 696e 616c 5f64 6620 3d20 6466 0d0a  iginal_df = df..
+00000830: 2020 2020 2020 2020 7365 6c66 2e64 6620          self.df 
+00000840: 3d20 6466 2e63 6f70 7928 2920 2023 206d  = df.copy()  # m
+00000850: 616b 6520 6120 636f 7079 206f 6620 7468  ake a copy of th
+00000860: 6520 6461 7461 6672 616d 650d 0a20 2020  e dataframe..   
+00000870: 2020 2020 2073 656c 662e 6466 5f68 6561       self.df_hea
+00000880: 6420 3d20 7365 6c66 2e6f 7269 6769 6e61  d = self.origina
+00000890: 6c5f 6466 2e68 6561 6428 3129 0d0a 2020  l_df.head(1)..  
+000008a0: 2020 2020 2020 7365 6c66 2e64 665f 636f        self.df_co
+000008b0: 6c75 6d6e 7320 3d20 7365 6c66 2e64 662e  lumns = self.df.
+000008c0: 636f 6c75 6d6e 732e 746f 6c69 7374 2829  columns.tolist()
+000008d0: 0d0a 0d0a 2020 2020 2020 2020 2320 4c4c  ....        # LL
+000008e0: 4d73 0d0a 2020 2020 2020 2020 2320 6d6f  Ms..        # mo
+000008f0: 6465 6c20 6469 6374 0d0a 2020 2020 2020  del dict..      
+00000900: 2020 7365 6c66 2e6d 6f64 656c 5f64 6963    self.model_dic
+00000910: 7420 3d20 7b22 6c6c 6d22 3a20 6c6c 6d2c  t = {"llm": llm,
+00000920: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00000930: 2020 2020 2020 2020 2020 2020 2022 6c6c               "ll
+00000940: 6d5f 6770 7434 223a 2022 6770 742d 342d  m_gpt4": "gpt-4-
+00000950: 3036 3133 222c 0d0a 2020 2020 2020 2020  0613",..        
+00000960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000970: 2020 2022 6c6c 6d5f 3136 6b22 3a20 2267     "llm_16k": "g
+00000980: 7074 2d33 2e35 2d74 7572 626f 2d31 366b  pt-3.5-turbo-16k
+00000990: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+000009a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000009b0: 6c6c 6d5f 6675 6e63 223a 2022 6770 742d  llm_func": "gpt-
+000009c0: 332e 352d 7475 7262 6f2d 3036 3133 222c  3.5-turbo-0613",
+000009d0: 7d0d 0a0d 0a20 2020 2020 2020 2023 2053  }....        # S
+000009e0: 6574 2074 6865 2064 6562 7567 206d 6f64  et the debug mod
+000009f0: 652e 2054 6869 7320 6d6f 6465 2069 7320  e. This mode is 
+00000a00: 5472 7565 2077 6865 6e20 796f 7520 7761  True when you wa
+00000a10: 6e74 2074 6865 206d 6f64 656c 2074 6f20  nt the model to 
+00000a20: 6465 6275 6720 7468 6520 636f 6465 2061  debug the code a
+00000a30: 6e64 2063 6f72 7265 6374 2069 742e 0d0a  nd correct it...
+00000a40: 2020 2020 2020 2020 7365 6c66 2e64 6562          self.deb
+00000a50: 7567 203d 2064 6562 7567 0d0a 2020 2020  ug = debug..    
+00000a60: 2020 2020 2320 5365 7420 7468 6520 6c6c      # Set the ll
+00000a70: 6d5f 7377 6974 6368 206d 6f64 652e 2054  m_switch mode. T
+00000a80: 6869 7320 6d6f 6465 2069 7320 5472 7565  his mode is True
+00000a90: 2077 6865 6e20 796f 7520 7761 6e74 2074   when you want t
+00000aa0: 6865 206d 6f64 656c 2074 6f20 7377 6974  he model to swit
+00000ab0: 6368 2074 6f20 6770 742d 3420 666f 7220  ch to gpt-4 for 
+00000ac0: 6465 6275 6767 696e 672c 2065 7272 6f72  debugging, error
+00000ad0: 2063 6f72 7265 6374 696f 6e20 616e 6420   correction and 
+00000ae0: 7261 6e6b 696e 672e 0d0a 2020 2020 2020  ranking...      
+00000af0: 2020 7365 6c66 2e6c 6c6d 5f73 7769 7463    self.llm_switc
+00000b00: 6820 3d20 6c6c 6d5f 7377 6974 6368 0d0a  h = llm_switch..
+00000b10: 2020 2020 2020 2020 2320 5365 7420 7468          # Set th
+00000b20: 6520 7261 6e6b 206d 6f64 652e 2054 6869  e rank mode. Thi
+00000b30: 7320 6d6f 6465 2069 7320 5472 7565 2077  s mode is True w
+00000b40: 6865 6e20 796f 7520 7761 6e74 2074 6865  hen you want the
+00000b50: 206d 6f64 656c 2074 6f20 7261 6e6b 2074   model to rank t
+00000b60: 6865 2067 656e 6572 6174 6564 2063 6f64  he generated cod
+00000b70: 652e 0d0a 2020 2020 2020 2020 7365 6c66  e...        self
+00000b80: 2e76 6563 746f 725f 6462 203d 2076 6563  .vector_db = vec
+00000b90: 746f 725f 6462 0d0a 0d0a 2020 2020 2020  tor_db....      
+00000ba0: 2020 2320 5365 7420 7468 6520 6578 706c    # Set the expl
+00000bb0: 6f72 6174 6f72 7920 6d6f 6465 2e20 5468  oratory mode. Th
+00000bc0: 6973 206d 6f64 6520 6973 2054 7275 6520  is mode is True 
+00000bd0: 7768 656e 2079 6f75 2077 616e 7420 7468  when you want th
+00000be0: 6520 6d6f 6465 6c20 746f 2065 7661 6c75  e model to evalu
+00000bf0: 6174 6520 7468 6520 6f72 6967 696e 616c  ate the original
+00000c00: 2070 726f 6d70 7420 616e 6420 6272 6561   prompt and brea
+00000c10: 6b20 6974 2064 6f77 6e20 696e 2061 6c67  k it down in alg
+00000c20: 6f72 6974 686d 2e0d 0a20 2020 2020 2020  orithm...       
+00000c30: 2073 656c 662e 6578 706c 6f72 6174 6f72   self.explorator
+00000c40: 7920 3d20 6578 706c 6f72 6174 6f72 790d  y = exploratory.
+00000c50: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00000c60: 2020 2023 2050 726f 6d70 7473 0d0a 2020     # Prompts..  
+00000c70: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
+00000c80: 6c74 5f65 7861 6d70 6c65 5f6f 7574 7075  lt_example_outpu
+00000c90: 7420 3d20 7072 6f6d 7074 732e 6578 616d  t = prompts.exam
+00000ca0: 706c 655f 6f75 7470 7574 0d0a 2020 2020  ple_output..    
+00000cb0: 2020 2020 7365 6c66 2e74 6173 6b5f 6576      self.task_ev
+00000cc0: 616c 7561 7469 6f6e 203d 2070 726f 6d70  aluation = promp
+00000cd0: 7473 2e74 6173 6b5f 6576 616c 7561 7469  ts.task_evaluati
+00000ce0: 6f6e 0d0a 2020 2020 2020 2020 7365 6c66  on..        self
+00000cf0: 2e73 7973 7465 6d5f 7461 736b 203d 2070  .system_task = p
+00000d00: 726f 6d70 7473 2e73 7973 7465 6d5f 7461  rompts.system_ta
+00000d10: 736b 0d0a 2020 2020 2020 2020 7365 6c66  sk..        self
+00000d20: 2e75 7365 725f 7461 736b 203d 2070 726f  .user_task = pro
+00000d30: 6d70 7473 2e75 7365 725f 7461 736b 0d0a  mpts.user_task..
+00000d40: 2020 2020 2020 2020 7365 6c66 2e65 7272          self.err
+00000d50: 6f72 5f63 6f72 7265 6374 5f74 6173 6b20  or_correct_task 
+00000d60: 3d20 7072 6f6d 7074 732e 6572 726f 725f  = prompts.error_
+00000d70: 636f 7272 6563 745f 7461 736b 0d0a 2020  correct_task..  
+00000d80: 2020 2020 2020 7365 6c66 2e64 6562 7567        self.debug
+00000d90: 5f63 6f64 655f 7461 736b 203d 2070 726f  _code_task = pro
+00000da0: 6d70 7473 2e64 6562 7567 5f63 6f64 655f  mpts.debug_code_
+00000db0: 7461 736b 2020 0d0a 2020 2020 2020 2020  task  ..        
+00000dc0: 7365 6c66 2e72 616e 6b5f 616e 7377 6572  self.rank_answer
+00000dd0: 203d 2070 726f 6d70 7473 2e72 616e 6b5f   = prompts.rank_
+00000de0: 616e 7377 6572 0d0a 2020 2020 2020 2020  answer..        
+00000df0: 7365 6c66 2e73 6f6c 7574 696f 6e5f 696e  self.solution_in
+00000e00: 7369 6768 7473 203d 2070 726f 6d70 7473  sights = prompts
+00000e10: 2e73 6f6c 7574 696f 6e5f 696e 7369 6768  .solution_insigh
+00000e20: 7473 0d0a 0d0a 2020 2020 2020 2020 2320  ts....        # 
+00000e30: 4675 6e63 7469 6f6e 730d 0a20 2020 2020  Functions..     
+00000e40: 2020 2073 656c 662e 7461 736b 5f65 7661     self.task_eva
+00000e50: 6c5f 6675 6e63 7469 6f6e 203d 2066 756e  l_function = fun
+00000e60: 635f 6361 6c6c 732e 7461 736b 5f65 7661  c_calls.task_eva
+00000e70: 6c5f 6675 6e63 7469 6f6e 0d0a 2020 2020  l_function..    
+00000e80: 2020 2020 7365 6c66 2e69 6e73 6967 6874      self.insight
+00000e90: 735f 6675 6e63 7469 6f6e 203d 2066 756e  s_function = fun
+00000ea0: 635f 6361 6c6c 732e 736f 6c75 7469 6f6e  c_calls.solution
+00000eb0: 5f69 6e73 6967 6874 735f 6675 6e63 7469  _insights_functi
+00000ec0: 6f6e 0d0a 0d0a 2020 2020 2020 2020 2320  on....        # 
+00000ed0: 4c4c 4d20 6361 6c6c 730d 0a20 2020 2020  LLM calls..     
+00000ee0: 2020 2073 656c 662e 6c6c 6d5f 6361 6c6c     self.llm_call
+00000ef0: 203d 206d 6f64 656c 732e 6c6c 6d5f 6361   = models.llm_ca
+00000f00: 6c6c 0d0a 2020 2020 2020 2020 7365 6c66  ll..        self
+00000f10: 2e6c 6c6d 5f66 756e 635f 6361 6c6c 203d  .llm_func_call =
+00000f20: 206d 6f64 656c 732e 6c6c 6d5f 6675 6e63   models.llm_func
+00000f30: 5f63 616c 6c0d 0a20 2020 2020 2020 2073  _call..        s
+00000f40: 656c 662e 6c6c 6d5f 7374 7265 616d 203d  elf.llm_stream =
+00000f50: 206d 6f64 656c 732e 6c6c 6d5f 7374 7265   models.llm_stre
+00000f60: 616d 0d0a 0d0a 2020 2020 2020 2020 2320  am....        # 
+00000f70: 5141 2052 6574 7269 6576 616c 0d0a 2020  QA Retrieval..  
+00000f80: 2020 2020 2020 7365 6c66 2e61 6464 5f71        self.add_q
+00000f90: 7565 7374 696f 6e5f 616e 7377 6572 5f70  uestion_answer_p
+00000fa0: 6169 7220 3d20 7161 5f72 6574 7269 6576  air = qa_retriev
+00000fb0: 616c 2e61 6464 5f71 7565 7374 696f 6e5f  al.add_question_
+00000fc0: 616e 7377 6572 5f70 6169 720d 0a20 2020  answer_pair..   
+00000fd0: 2020 2020 2073 656c 662e 7265 7472 6965       self.retrie
+00000fe0: 7665 5f61 6e73 7765 7220 3d20 7161 5f72  ve_answer = qa_r
+00000ff0: 6574 7269 6576 616c 2e72 6574 7269 6576  etrieval.retriev
+00001000: 655f 616e 7377 6572 0d0a 2020 2020 2020  e_answer..      
+00001010: 2020 7365 6c66 2e73 696d 696c 6172 6974    self.similarit
+00001020: 795f 7468 7265 7368 6f6c 6420 3d20 302e  y_threshold = 0.
+00001030: 380d 0a0d 0a20 2020 2020 2020 2023 2049  8....        # I
+00001040: 6e69 7469 616c 697a 6520 7468 6520 746f  nitialize the to
+00001050: 7461 6c20 746f 6b65 6e73 2075 7365 6420  tal tokens used 
+00001060: 6c69 7374 2e20 5468 6973 206c 6973 7420  list. This list 
+00001070: 7769 6c6c 2062 6520 7573 6564 2074 6f20  will be used to 
+00001080: 6b65 6570 2074 7261 636b 206f 6620 7468  keep track of th
+00001090: 6520 746f 7461 6c20 746f 6b65 6e73 2075  e total tokens u
+000010a0: 7365 6420 6279 2074 6865 206d 6f64 656c  sed by the model
+000010b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+000010c0: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+000010d0: 203d 205b 5d0d 0a0d 0a0d 0a20 2020 2023   = []......    #
+000010e0: 2046 756e 6374 696f 6e73 2074 6f20 7361   Functions to sa
+000010f0: 6e69 7469 7a65 2074 6865 206f 7574 7075  nitize the outpu
+00001100: 7420 6672 6f6d 2074 6865 204c 4c4d 0d0a  t from the LLM..
+00001110: 2020 2020 6465 6620 5f65 7874 7261 6374      def _extract
+00001120: 5f63 6f64 6528 7365 6c66 2c72 6573 706f  _code(self,respo
+00001130: 6e73 653a 2073 7472 2c20 7365 7061 7261  nse: str, separa
+00001140: 746f 723a 2073 7472 203d 2022 6060 6022  tor: str = "```"
+00001150: 2920 2d3e 2073 7472 3a0d 0a0d 0a20 2020  ) -> str:....   
+00001160: 2020 2020 2023 2044 6566 696e 6520 6120       # Define a 
+00001170: 626c 6163 6b6c 6973 7420 6f66 2050 7974  blacklist of Pyt
+00001180: 686f 6e20 6b65 7977 6f72 6473 2061 6e64  hon keywords and
+00001190: 2066 756e 6374 696f 6e73 2074 6861 7420   functions that 
+000011a0: 6172 6520 6e6f 7420 616c 6c6f 7765 640d  are not allowed.
+000011b0: 0a20 2020 2020 2020 2062 6c61 636b 6c69  .        blackli
+000011c0: 7374 203d 205b 276f 7327 2c27 7375 6270  st = ['os','subp
+000011d0: 726f 6365 7373 272c 2773 7973 272c 2765  rocess','sys','e
+000011e0: 7661 6c27 2c27 6578 6563 272c 2766 696c  val','exec','fil
+000011f0: 6527 2c27 736f 636b 6574 272c 2775 726c  e','socket','url
+00001200: 6c69 6227 2c0d 0a20 2020 2020 2020 2020  lib',..         
+00001210: 2020 2020 2020 2020 2020 2027 7368 7574             'shut
+00001220: 696c 272c 2770 6963 6b6c 6527 2c27 6374  il','pickle','ct
+00001230: 7970 6573 272c 276d 756c 7469 7072 6f63  ypes','multiproc
+00001240: 6573 7369 6e67 272c 2774 656d 7066 696c  essing','tempfil
+00001250: 6527 2c27 676c 6f62 272c 2763 6f64 6527  e','glob','code'
+00001260: 2c27 7074 7927 2c27 636f 6d6d 616e 6473  ,'pty','commands
+00001270: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00001280: 2020 2020 2020 2020 2772 6571 7565 7374          'request
+00001290: 7327 2c27 6367 6927 2c27 6367 6974 6227  s','cgi','cgitb'
+000012a0: 2c27 786d 6c2e 6574 7265 652e 456c 656d  ,'xml.etree.Elem
+000012b0: 656e 7454 7265 6527 2c27 6275 696c 7469  entTree','builti
+000012c0: 6e73 270d 0a20 2020 2020 2020 2020 2020  ns'..           
+000012d0: 2020 2020 2020 2020 205d 0d0a 0d0a 2020           ]....  
+000012e0: 2020 2020 2020 2320 5365 6172 6368 2066        # Search f
+000012f0: 6f72 2061 2070 6174 7465 726e 2062 6574  or a pattern bet
+00001300: 7765 656e 203c 636f 6465 3e20 616e 6420  ween <code> and 
+00001310: 3c2f 636f 6465 3e20 696e 2074 6865 2065  </code> in the e
+00001320: 7874 7261 6374 6564 2063 6f64 650d 0a20  xtracted code.. 
+00001330: 2020 2020 2020 206d 6174 6368 203d 2072         match = r
+00001340: 652e 7365 6172 6368 2872 223c 636f 6465  e.search(r"<code
+00001350: 3e28 2e2a 293c 2f63 6f64 653e 222c 2072  >(.*)</code>", r
+00001360: 6573 706f 6e73 652c 2072 652e 444f 5441  esponse, re.DOTA
+00001370: 4c4c 290d 0a20 2020 2020 2020 2069 6620  LL)..        if 
+00001380: 6d61 7463 683a 0d0a 2020 2020 2020 2020  match:..        
+00001390: 2020 2020 2320 4966 2061 206d 6174 6368      # If a match
+000013a0: 2069 7320 666f 756e 642c 2065 7874 7261   is found, extra
+000013b0: 6374 2074 6865 2063 6f64 6520 6265 7477  ct the code betw
+000013c0: 6565 6e20 3c63 6f64 653e 2061 6e64 203c  een <code> and <
+000013d0: 2f63 6f64 653e 0d0a 2020 2020 2020 2020  /code>..        
+000013e0: 2020 2020 636f 6465 203d 206d 6174 6368      code = match
+000013f0: 2e67 726f 7570 2831 290d 0a20 2020 2020  .group(1)..     
+00001400: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+00001410: 7265 7370 6f6e 7365 2063 6f6e 7461 696e  response contain
+00001420: 7320 7468 6520 7365 7061 7261 746f 722c  s the separator,
+00001430: 2065 7874 7261 6374 2074 6865 2063 6f64   extract the cod
+00001440: 6520 626c 6f63 6b20 6265 7477 6565 6e20  e block between 
+00001450: 7468 6520 7365 7061 7261 746f 7273 0d0a  the separators..
+00001460: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00001470: 656e 2863 6f64 652e 7370 6c69 7428 7365  en(code.split(se
+00001480: 7061 7261 746f 7229 2920 3e20 313a 0d0a  parator)) > 1:..
+00001490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000014a0: 636f 6465 203d 2063 6f64 652e 7370 6c69  code = code.spli
+000014b0: 7428 7365 7061 7261 746f 7229 5b31 5d0d  t(separator)[1].
+000014c0: 0a0d 0a20 2020 2020 2020 2023 2049 6620  ...        # If 
+000014d0: 7468 6520 7265 7370 6f6e 7365 2063 6f6e  the response con
+000014e0: 7461 696e 7320 7468 6520 7365 7061 7261  tains the separa
+000014f0: 746f 722c 2065 7874 7261 6374 2074 6865  tor, extract the
+00001500: 2063 6f64 6520 626c 6f63 6b20 6265 7477   code block betw
+00001510: 6565 6e20 7468 6520 7365 7061 7261 746f  een the separato
+00001520: 7273 0d0a 2020 2020 2020 2020 6966 206c  rs..        if l
+00001530: 656e 2872 6573 706f 6e73 652e 7370 6c69  en(response.spli
+00001540: 7428 7365 7061 7261 746f 7229 2920 3e20  t(separator)) > 
+00001550: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+00001560: 636f 6465 203d 2072 6573 706f 6e73 652e  code = response.
+00001570: 7370 6c69 7428 7365 7061 7261 746f 7229  split(separator)
+00001580: 5b31 5d0d 0a20 2020 2020 2020 2020 2020  [1]..           
+00001590: 200d 0a20 2020 2020 2020 2023 2052 656d   ..        # Rem
+000015a0: 6f76 6520 7468 6520 2270 7974 686f 6e22  ove the "python"
+000015b0: 206f 7220 2270 7922 2070 7265 6669 7820   or "py" prefix 
+000015c0: 6966 2070 7265 7365 6e74 0d0a 2020 2020  if present..    
+000015d0: 2020 2020 6966 2072 652e 6d61 7463 6828      if re.match(
+000015e0: 7222 5e28 7079 7468 6f6e 7c70 7929 222c  r"^(python|py)",
+000015f0: 2063 6f64 6529 3a0d 0a20 2020 2020 2020   code):..       
+00001600: 2020 2020 2063 6f64 6520 3d20 7265 2e73       code = re.s
+00001610: 7562 2872 225e 2870 7974 686f 6e7c 7079  ub(r"^(python|py
+00001620: 2922 2c20 2222 2c20 636f 6465 290d 0a20  )", "", code).. 
+00001630: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+00001640: 636f 6465 2069 7320 6265 7477 6565 6e20  code is between 
+00001650: 7369 6e67 6c65 2062 6163 6b74 6963 6b73  single backticks
+00001660: 2c20 6578 7472 6163 7420 7468 6520 636f  , extract the co
+00001670: 6465 2062 6574 7765 656e 2074 6865 6d0d  de between them.
+00001680: 0a20 2020 2020 2020 2069 6620 7265 2e6d  .        if re.m
+00001690: 6174 6368 2872 225e 602e 2a60 2422 2c20  atch(r"^`.*`$", 
+000016a0: 636f 6465 293a 0d0a 2020 2020 2020 2020  code):..        
+000016b0: 2020 2020 636f 6465 203d 2072 652e 7375      code = re.su
+000016c0: 6228 7222 5e60 282e 2a29 6024 222c 2072  b(r"^`(.*)`$", r
+000016d0: 225c 3122 2c20 636f 6465 290d 0a0d 0a20  "\1", code).... 
+000016e0: 2020 2020 2020 2023 2052 656d 6f76 6520         # Remove 
+000016f0: 616e 7920 696e 7374 616e 6365 7320 6f66  any instances of
+00001700: 2022 6466 203d 2070 642e 7265 6164 5f63   "df = pd.read_c
+00001710: 7376 2827 6669 6c65 6e61 6d65 2e63 7376  sv('filename.csv
+00001720: 2729 2220 6672 6f6d 2074 6865 2063 6f64  ')" from the cod
+00001730: 650d 0a20 2020 2020 2020 2063 6f64 6520  e..        code 
+00001740: 3d20 7265 2e73 7562 2872 2264 665c 732a  = re.sub(r"df\s*
+00001750: 3d5c 732a 7064 5c2e 7265 6164 5f63 7376  =\s*pd\.read_csv
+00001760: 5c28 272e 2a3f 2728 2c2e 2a29 3f5c 2922  \('.*?'(,.*)?\)"
+00001770: 2c20 2222 2c20 636f 6465 290d 0a0d 0a20  , "", code).... 
+00001780: 2020 2020 2020 2023 2044 6566 696e 6520         # Define 
+00001790: 7468 6520 7265 6775 6c61 7220 6578 7072  the regular expr
+000017a0: 6573 7369 6f6e 2070 6174 7465 726e 2074  ession pattern t
+000017b0: 6f20 6d61 7463 6820 7468 6520 626c 6163  o match the blac
+000017c0: 6b6c 6973 7420 6974 656d 730d 0a20 2020  klist items..   
+000017d0: 2020 2020 2070 6174 7465 726e 203d 2072       pattern = r
+000017e0: 225e 282e 2a5c 6228 2220 2b20 227c 222e  "^(.*\b(" + "|".
+000017f0: 6a6f 696e 2862 6c61 636b 6c69 7374 2920  join(blacklist) 
+00001800: 2b20 7222 295c 622e 2a29 2422 0d0a 0d0a  + r")\b.*)$"....
+00001810: 2020 2020 2020 2020 2320 5265 706c 6163          # Replac
+00001820: 6520 7468 6520 626c 6163 6b6c 6973 7420  e the blacklist 
+00001830: 6974 656d 7320 7769 7468 2063 6f6d 6d65  items with comme
+00001840: 6e74 730d 0a20 2020 2020 2020 2063 6f64  nts..        cod
+00001850: 6520 3d20 7265 2e73 7562 2870 6174 7465  e = re.sub(patte
+00001860: 726e 2c20 7222 2320 6e6f 7420 616c 6c6f  rn, r"# not allo
+00001870: 7765 6420 5c31 222c 2063 6f64 652c 2066  wed \1", code, f
+00001880: 6c61 6773 3d72 652e 4d55 4c54 494c 494e  lags=re.MULTILIN
+00001890: 4529 0d0a 0d0a 2020 2020 2020 2020 2320  E)....        # 
+000018a0: 5265 7475 726e 2074 6865 2063 6c65 616e  Return the clean
+000018b0: 6564 2061 6e64 2065 7874 7261 6374 6564  ed and extracted
+000018c0: 2063 6f64 650d 0a20 2020 2020 2020 2072   code..        r
+000018d0: 6574 7572 6e20 636f 6465 2e73 7472 6970  eturn code.strip
+000018e0: 2829 0d0a 2020 2020 0d0a 2020 2020 6465  ()..    ..    de
+000018f0: 6620 5f65 7874 7261 6374 5f72 616e 6b28  f _extract_rank(
+00001900: 7365 6c66 2c72 6573 706f 6e73 653a 2073  self,response: s
+00001910: 7472 2920 2d3e 2073 7472 3a0d 0a0d 0a20  tr) -> str:.... 
+00001920: 2020 2020 2020 2023 2053 6561 7263 6820         # Search 
+00001930: 666f 7220 6120 7061 7474 6572 6e20 6265  for a pattern be
+00001940: 7477 6565 6e20 3c72 616e 6b3e 2061 6e64  tween <rank> and
+00001950: 203c 2f72 616e 6b3e 2069 6e20 7468 6520   </rank> in the 
+00001960: 7265 7370 6f6e 7365 0d0a 2020 2020 2020  response..      
+00001970: 2020 6d61 7463 6820 3d20 7265 2e73 6561    match = re.sea
+00001980: 7263 6828 7222 3c72 616e 6b3e 282e 2a29  rch(r"<rank>(.*)
+00001990: 3c2f 7261 6e6b 3e22 2c20 7265 7370 6f6e  </rank>", respon
+000019a0: 7365 290d 0a20 2020 2020 2020 2069 6620  se)..        if 
+000019b0: 6d61 7463 683a 0d0a 2020 2020 2020 2020  match:..        
+000019c0: 2020 2020 2320 4966 2061 206d 6174 6368      # If a match
+000019d0: 2069 7320 666f 756e 642c 2065 7874 7261   is found, extra
+000019e0: 6374 2074 6865 2072 616e 6b20 6265 7477  ct the rank betw
+000019f0: 6565 6e20 3c72 616e 6b3e 2061 6e64 203c  een <rank> and <
+00001a00: 2f72 616e 6b3e 0d0a 2020 2020 2020 2020  /rank>..        
+00001a10: 2020 2020 7261 6e6b 203d 206d 6174 6368      rank = match
+00001a20: 2e67 726f 7570 2831 290d 0a20 2020 2020  .group(1)..     
+00001a30: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00001a40: 2020 2020 2020 7261 6e6b 203d 2022 220d        rank = "".
+00001a50: 0a0d 0a20 2020 2020 2020 2023 2052 6574  ...        # Ret
+00001a60: 7572 6e20 7468 6520 636c 6561 6e65 6420  urn the cleaned 
+00001a70: 616e 6420 6578 7472 6163 7465 6420 636f  and extracted co
+00001a80: 6465 0d0a 2020 2020 2020 2020 7265 7475  de..        retu
+00001a90: 726e 2072 616e 6b2e 7374 7269 7028 290d  rn rank.strip().
+00001aa0: 0a20 2020 200d 0a20 2020 2023 2046 756e  .    ..    # Fun
+00001ab0: 6374 696f 6e20 746f 2072 656d 6f76 6520  ction to remove 
+00001ac0: 6578 616d 706c 6573 2066 726f 6d20 6d65  examples from me
+00001ad0: 7373 6167 6573 2077 6865 6e20 6e6f 206c  ssages when no l
+00001ae0: 6f6e 6765 7220 6e65 6564 6564 0d0a 2020  onger needed..  
+00001af0: 2020 6465 6620 5f72 656d 6f76 655f 6578    def _remove_ex
+00001b00: 616d 706c 6573 2873 656c 662c 6d65 7373  amples(self,mess
+00001b10: 6167 6573 3a20 7374 7229 202d 3e20 7374  ages: str) -> st
+00001b20: 723a 0d0a 2020 2020 2020 2020 2320 4465  r:..        # De
+00001b30: 6669 6e65 2074 6865 2072 6567 756c 6172  fine the regular
+00001b40: 2065 7870 7265 7373 696f 6e20 7061 7474   expression patt
+00001b50: 6572 6e0d 0a20 2020 2020 2020 2070 6174  ern..        pat
+00001b60: 7465 726e 203d 2027 4578 616d 706c 6520  tern = 'Example 
+00001b70: 4f75 7470 7574 3a5c 732a 3c63 6f64 653e  Output:\s*<code>
+00001b80: 2e2a 3f3c 2f63 6f64 653e 5c73 2a27 0d0a  .*?</code>\s*'..
+00001b90: 0d0a 2020 2020 2020 2020 2320 4974 6572  ..        # Iter
+00001ba0: 6174 6520 6f76 6572 2074 6865 206c 6973  ate over the lis
+00001bb0: 7420 6f66 2064 6963 7469 6f6e 6172 6965  t of dictionarie
+00001bc0: 730d 0a20 2020 2020 2020 2066 6f72 2064  s..        for d
+00001bd0: 6963 7420 696e 206d 6573 7361 6765 733a  ict in messages:
+00001be0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00001bf0: 4163 6365 7373 2061 6e64 2063 6c65 616e  Access and clean
+00001c00: 2075 7020 2763 6f6e 7465 6e74 2720 6669   up 'content' fi
+00001c10: 656c 640d 0a20 2020 2020 2020 2020 2020  eld..           
+00001c20: 2069 6620 6469 6374 2e67 6574 2827 726f   if dict.get('ro
+00001c30: 6c65 2729 203d 3d20 2775 7365 7227 2061  le') == 'user' a
+00001c40: 6e64 2027 636f 6e74 656e 7427 2069 6e20  nd 'content' in 
+00001c50: 6469 6374 3a0d 0a20 2020 2020 2020 2020  dict:..         
+00001c60: 2020 2020 2020 2064 6963 745b 2763 6f6e         dict['con
+00001c70: 7465 6e74 275d 203d 2072 652e 7375 6228  tent'] = re.sub(
+00001c80: 7061 7474 6572 6e2c 2027 272c 2064 6963  pattern, '', dic
+00001c90: 745b 2763 6f6e 7465 6e74 275d 2c20 666c  t['content'], fl
+00001ca0: 6167 733d 7265 2e44 4f54 414c 4c29 0d0a  ags=re.DOTALL)..
+00001cb0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00001cc0: 206d 6573 7361 6765 730d 0a20 2020 200d   messages..    .
+00001cd0: 0a20 2020 2064 6566 2074 6173 6b5f 6576  .    def task_ev
+00001ce0: 616c 2873 656c 662c 2065 7661 6c5f 6d65  al(self, eval_me
+00001cf0: 7373 6167 6573 293a 0d0a 2020 2020 2020  ssages):..      
+00001d00: 2020 0d0a 2020 2020 2020 2020 6c6c 6d5f    ..        llm_
+00001d10: 6675 6e63 203d 2073 656c 662e 6d6f 6465  func = self.mode
+00001d20: 6c5f 6469 6374 5b27 6c6c 6d5f 6675 6e63  l_dict['llm_func
+00001d30: 275d 0d0a 0d0a 2020 2020 2020 2020 6966  ']....        if
+00001d40: 2027 6970 796b 6572 6e65 6c27 2069 6e20   'ipykernel' in 
+00001d50: 7379 732e 6d6f 6475 6c65 733a 0d0a 2020  sys.modules:..  
+00001d60: 2020 2020 2020 2020 2020 2320 4a75 7079            # Jupy
+00001d70: 7465 7220 6e6f 7465 626f 6f6b 206f 7220  ter notebook or 
+00001d80: 6970 7974 686f 6e0d 0a20 2020 2020 2020  ipython..       
+00001d90: 2020 2020 2064 6973 706c 6179 2848 544d       display(HTM
+00001da0: 4c28 6627 3c70 2073 7479 6c65 3d22 636f  L(f'<p style="co
+00001db0: 6c6f 723a 6d61 6765 6e74 613b 223e 5c6e  lor:magenta;">\n
+00001dc0: 4361 6c6c 696e 6720 4d6f 6465 6c3a 207b  Calling Model: {
+00001dd0: 6c6c 6d5f 6675 6e63 7d3c 2f70 3e27 2929  llm_func}</p>'))
+00001de0: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+00001df0: 7370 6c61 7928 4854 4d4c 2866 273c 703e  splay(HTML(f'<p>
+00001e00: 3c62 2073 7479 6c65 3d22 636f 6c6f 723a  <b style="color:
+00001e10: 6d61 6765 6e74 613b 223e 5472 7969 6e67  magenta;">Trying
+00001e20: 2074 6f20 6465 7465 726d 696e 6520 7468   to determine th
+00001e30: 6520 6265 7374 206d 6574 686f 6420 746f  e best method to
+00001e40: 2061 6e73 7765 7220 796f 7572 2071 7565   answer your que
+00001e50: 7374 696f 6e2c 2070 6c65 6173 6520 7761  stion, please wa
+00001e60: 6974 2e2e 2e3c 2f62 3e3c 2f70 3e3c 6272  it...</b></p><br
+00001e70: 3e27 2929 0d0a 2020 2020 2020 2020 656c  >'))..        el
+00001e80: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00001e90: 2023 204f 7468 6572 2065 6e76 6972 6f6e   # Other environ
+00001ea0: 6d65 6e74 2028 6c69 6b65 2074 6572 6d69  ment (like termi
+00001eb0: 6e61 6c29 0d0a 2020 2020 2020 2020 2020  nal)..          
+00001ec0: 2020 7072 696e 7428 636f 6c6f 7265 6428    print(colored(
+00001ed0: 6622 5c6e 3e3e 2043 616c 6c69 6e67 204d  f"\n>> Calling M
+00001ee0: 6f64 656c 3a20 7b6c 6c6d 5f66 756e 637d  odel: {llm_func}
+00001ef0: 222c 2022 6d61 6765 6e74 6122 2929 0d0a  ", "magenta"))..
+00001f00: 2020 2020 2020 2020 2020 2020 6370 7269              cpri
+00001f10: 6e74 2866 225c 6e3e 3e20 5472 7969 6e67  nt(f"\n>> Trying
+00001f20: 2074 6f20 6465 7465 726d 696e 6520 7468   to determine th
+00001f30: 6520 6265 7374 206d 6574 686f 6420 746f  e best method to
+00001f40: 2061 6e73 7765 7220 796f 7572 2071 7565   answer your que
+00001f50: 7374 696f 6e2c 2070 6c65 6173 6520 7761  stion, please wa
+00001f60: 6974 2e2e 2e5c 6e22 2c20 276d 6167 656e  it...\n", 'magen
+00001f70: 7461 272c 2061 7474 7273 3d5b 2762 6f6c  ta', attrs=['bol
+00001f80: 6427 5d29 0d0a 0d0a 2020 2020 2020 2020  d'])....        
+00001f90: 2320 4361 6c6c 204f 7065 6e41 4920 4150  # Call OpenAI AP
+00001fa0: 490d 0a20 2020 2020 2020 2066 756e 6374  I..        funct
+00001fb0: 696f 6e5f 6e61 6d65 203d 207b 226e 616d  ion_name = {"nam
+00001fc0: 6522 3a20 2251 415f 5265 7370 6f6e 7365  e": "QA_Response
+00001fd0: 227d 0d0a 2020 2020 2020 2020 666e 5f6e  "}..        fn_n
+00001fe0: 616d 652c 2061 7267 756d 656e 7473 2c20  ame, arguments, 
+00001ff0: 746f 6b65 6e73 5f75 7365 6420 3d20 7365  tokens_used = se
+00002000: 6c66 2e6c 6c6d 5f66 756e 635f 6361 6c6c  lf.llm_func_call
+00002010: 2873 656c 662e 6d6f 6465 6c5f 6469 6374  (self.model_dict
+00002020: 2c20 6576 616c 5f6d 6573 7361 6765 732c  , eval_messages,
+00002030: 7365 6c66 2e74 6173 6b5f 6576 616c 5f66  self.task_eval_f
+00002040: 756e 6374 696f 6e2c 2066 756e 6374 696f  unction, functio
+00002050: 6e5f 6e61 6d65 290d 0a0d 0a20 2020 2020  n_name)....     
+00002060: 2020 2023 2050 6172 7365 2074 6865 204a     # Parse the J
+00002070: 534f 4e20 7374 7269 6e67 2074 6f20 6120  SON string to a 
+00002080: 5079 7468 6f6e 2064 6963 740d 0a20 2020  Python dict..   
+00002090: 2020 2020 2061 7267 756d 656e 7473 5f64       arguments_d
+000020a0: 6963 7420 3d20 6a73 6f6e 2e6c 6f61 6473  ict = json.loads
+000020b0: 2861 7267 756d 656e 7473 2c20 7374 7269  (arguments, stri
+000020c0: 6374 3d46 616c 7365 290d 0a0d 0a20 2020  ct=False)....   
+000020d0: 2020 2020 2023 2052 6574 7269 6576 6520       # Retrieve 
+000020e0: 7661 6c75 6573 0d0a 2020 2020 2020 2020  values..        
+000020f0: 6576 616c 5f61 6e73 7765 7220 3d20 6172  eval_answer = ar
+00002100: 6775 6d65 6e74 735f 6469 6374 5b22 616e  guments_dict["an
+00002110: 7377 6572 225d 0d0a 2020 2020 2020 2020  swer"]..        
+00002120: 6576 616c 5f61 6e73 7765 725f 7479 7065  eval_answer_type
+00002130: 203d 2061 7267 756d 656e 7473 5f64 6963   = arguments_dic
+00002140: 745b 2261 6e73 7765 725f 7479 7065 225d  t["answer_type"]
+00002150: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00002160: 2e74 6f74 616c 5f74 6f6b 656e 735f 7573  .total_tokens_us
+00002170: 6564 2e61 7070 656e 6428 746f 6b65 6e73  ed.append(tokens
+00002180: 5f75 7365 6429 0d0a 0d0a 2020 2020 2020  _used)....      
+00002190: 2020 7265 7475 726e 2061 7267 756d 656e    return argumen
+000021a0: 7473 2c20 666e 5f6e 616d 652c 2065 7661  ts, fn_name, eva
+000021b0: 6c5f 616e 7377 6572 2c20 6576 616c 5f61  l_answer, eval_a
+000021c0: 6e73 7765 725f 7479 7065 0d0a 0d0a 2020  nswer_type....  
+000021d0: 2020 6465 6620 6465 6275 675f 636f 6465    def debug_code
+000021e0: 2873 656c 662c 636f 6465 2c71 7565 7374  (self,code,quest
+000021f0: 696f 6e2c 206c 6c6d 5f63 6173 6361 6465  ion, llm_cascade
+00002200: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
+00002210: 2020 2320 496e 6974 6961 6c69 7a65 2074    # Initialize t
+00002220: 6865 206d 6573 7361 6765 7320 6c69 7374  he messages list
+00002230: 2077 6974 6820 6120 7379 7374 656d 206d   with a system m
+00002240: 6573 7361 6765 2063 6f6e 7461 696e 696e  essage containin
+00002250: 6720 7468 6520 7461 736b 2070 726f 6d70  g the task promp
+00002260: 740d 0a20 2020 2020 2020 2064 6562 7567  t..        debug
+00002270: 5f6d 6573 7361 6765 7320 3d20 5b7b 2272  _messages = [{"r
+00002280: 6f6c 6522 3a20 2273 7973 7465 6d22 2c20  ole": "system", 
+00002290: 2263 6f6e 7465 6e74 223a 2073 656c 662e  "content": self.
+000022a0: 6465 6275 675f 636f 6465 5f74 6173 6b2e  debug_code_task.
+000022b0: 666f 726d 6174 2863 6f64 652c 7175 6573  format(code,ques
+000022c0: 7469 6f6e 297d 5d0d 0a0d 0a20 2020 2020  tion)}]....     
+000022d0: 2020 2075 7369 6e67 5f6d 6f64 656c 203d     using_model =
+000022e0: 2073 656c 662e 6d6f 6465 6c5f 6469 6374   self.model_dict
+000022f0: 5b27 6c6c 6d27 5d0d 0a20 2020 2020 2020  ['llm']..       
+00002300: 2069 6620 6c6c 6d5f 6361 7363 6164 653a   if llm_cascade:
+00002310: 0d0a 2020 2020 2020 2020 2020 2020 7573  ..            us
+00002320: 696e 675f 6d6f 6465 6c20 3d20 7365 6c66  ing_model = self
+00002330: 2e6d 6f64 656c 5f64 6963 745b 276c 6c6d  .model_dict['llm
+00002340: 5f67 7074 3427 5d0d 0a0d 0a20 2020 2020  _gpt4']....     
+00002350: 2020 2069 6620 2769 7079 6b65 726e 656c     if 'ipykernel
+00002360: 2720 696e 2073 7973 2e6d 6f64 756c 6573  ' in sys.modules
+00002370: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00002380: 204a 7570 7974 6572 206e 6f74 6562 6f6f   Jupyter noteboo
+00002390: 6b20 6f72 2069 7079 7468 6f6e 0d0a 2020  k or ipython..  
+000023a0: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
+000023b0: 7928 4854 4d4c 2866 273c 7020 7374 796c  y(HTML(f'<p styl
+000023c0: 653d 2263 6f6c 6f72 3a6d 6167 656e 7461  e="color:magenta
+000023d0: 3b22 3e5c 6e43 616c 6c69 6e67 204d 6f64  ;">\nCalling Mod
+000023e0: 656c 3a20 7b75 7369 6e67 5f6d 6f64 656c  el: {using_model
+000023f0: 7d3c 2f70 3e27 2929 0d0a 2020 2020 2020  }</p>'))..      
+00002400: 2020 2020 2020 6469 7370 6c61 7928 4854        display(HT
+00002410: 4d4c 2866 273c 703e 3c62 2073 7479 6c65  ML(f'<p><b style
+00002420: 3d22 636f 6c6f 723a 6d61 6765 6e74 613b  ="color:magenta;
+00002430: 223e 2049 2061 6d20 7265 7669 6577 696e  "> I am reviewin
+00002440: 6720 616e 6420 6465 6275 6767 696e 6720  g and debugging 
+00002450: 7468 6520 6669 7273 7420 7665 7273 696f  the first versio
+00002460: 6e20 6f66 2074 6865 2063 6f64 6520 746f  n of the code to
+00002470: 2063 6865 636b 2066 6f72 2061 6e79 2065   check for any e
+00002480: 7272 6f72 732c 2062 7567 732c 206f 7220  rrors, bugs, or 
+00002490: 696e 636f 6e73 6973 7465 6e63 6965 7320  inconsistencies 
+000024a0: 616e 6420 7769 6c6c 206d 616b 6520 636f  and will make co
+000024b0: 7272 6563 7469 6f6e 7320 6966 206e 6563  rrections if nec
+000024c0: 6573 7361 7279 2e20 506c 6561 7365 2077  essary. Please w
+000024d0: 6169 742e 2e3c 2f62 3e3c 2f70 3e3c 6272  ait..</b></p><br
+000024e0: 3e27 2929 0d0a 2020 2020 2020 2020 656c  >'))..        el
+000024f0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00002500: 2023 204f 7468 6572 2065 6e76 6972 6f6e   # Other environ
+00002510: 6d65 6e74 2028 6c69 6b65 2074 6572 6d69  ment (like termi
+00002520: 6e61 6c29 0d0a 2020 2020 2020 2020 2020  nal)..          
+00002530: 2020 7072 696e 7428 636f 6c6f 7265 6428    print(colored(
+00002540: 6622 5c6e 3e3e 2043 616c 6c69 6e67 204d  f"\n>> Calling M
+00002550: 6f64 656c 3a20 7b75 7369 6e67 5f6d 6f64  odel: {using_mod
+00002560: 656c 7d22 2c20 226d 6167 656e 7461 2229  el}", "magenta")
+00002570: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
+00002580: 7072 696e 7428 6622 5c6e 3e3e 2049 2061  print(f"\n>> I a
+00002590: 6d20 7265 7669 6577 696e 6720 616e 6420  m reviewing and 
+000025a0: 6465 6275 6767 696e 6720 7468 6520 6669  debugging the fi
+000025b0: 7273 7420 7665 7273 696f 6e20 6f66 2074  rst version of t
+000025c0: 6865 2063 6f64 6520 746f 2063 6865 636b  he code to check
+000025d0: 2066 6f72 2061 6e79 2065 7272 6f72 732c   for any errors,
+000025e0: 2062 7567 732c 206f 7220 696e 636f 6e73   bugs, or incons
+000025f0: 6973 7465 6e63 6965 7320 616e 6420 7769  istencies and wi
+00002600: 6c6c 206d 616b 6520 636f 7272 6563 7469  ll make correcti
+00002610: 6f6e 7320 6966 206e 6563 6573 7361 7279  ons if necessary
+00002620: 2e20 506c 6561 7365 2077 6169 742e 2e2e  . Please wait...
+00002630: 5c6e 222c 2027 6d61 6765 6e74 6127 2c20  \n", 'magenta', 
+00002640: 6174 7472 733d 5b27 626f 6c64 275d 290d  attrs=['bold']).
+00002650: 0a0d 0a20 2020 2020 2020 2023 2046 756e  ...        # Fun
+00002660: 6374 696f 6e20 746f 2064 6973 706c 6179  ction to display
+00002670: 2072 6573 756c 7473 206e 6963 656c 790d   results nicely.
+00002680: 0a20 2020 2020 2020 2064 6566 2064 6973  .        def dis
+00002690: 706c 6179 5f74 6173 6b28 293a 0d0a 2020  play_task():..  
+000026a0: 2020 2020 2020 2020 2020 6966 2027 6970            if 'ip
+000026b0: 796b 6572 6e65 6c27 2069 6e20 7379 732e  ykernel' in sys.
+000026c0: 6d6f 6475 6c65 733a 0d0a 2020 2020 2020  modules:..      
+000026d0: 2020 2020 2020 2020 2020 2320 4a75 7079            # Jupy
+000026e0: 7465 7220 6e6f 7465 626f 6f6b 206f 7220  ter notebook or 
+000026f0: 6970 7974 686f 6e0d 0a20 2020 2020 2020  ipython..       
+00002700: 2020 2020 2020 2020 2064 6973 706c 6179           display
+00002710: 2848 544d 4c28 6627 3c70 3e3c 6220 7374  (HTML(f'<p><b st
+00002720: 796c 653d 2263 6f6c 6f72 3a6d 6167 656e  yle="color:magen
+00002730: 7461 3b22 3e49 2068 6176 6520 6669 6e69  ta;">I have fini
+00002740: 7368 6564 2064 6562 7567 6769 6e67 2074  shed debugging t
+00002750: 6865 2063 6f64 652c 2061 6e64 2077 696c  he code, and wil
+00002760: 6c20 6e6f 7720 7072 6f63 6565 6420 746f  l now proceed to
+00002770: 2074 6865 2065 7865 6375 7469 6f6e 2e2e   the execution..
+00002780: 2e3c 2f62 3e3c 2f70 3e3c 6272 3e27 2929  .</b></p><br>'))
+00002790: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+000027a0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000027b0: 2020 2020 2023 204f 7468 6572 2065 6e76       # Other env
+000027c0: 6972 6f6e 6d65 6e74 2028 6c69 6b65 2074  ironment (like t
+000027d0: 6572 6d69 6e61 6c29 0d0a 2020 2020 2020  erminal)..      
+000027e0: 2020 2020 2020 2020 2020 6370 7269 6e74            cprint
+000027f0: 2866 225c 6e3e 3e20 4920 6861 7665 2066  (f"\n>> I have f
+00002800: 696e 6973 6865 6420 6465 6275 6767 696e  inished debuggin
+00002810: 6720 7468 6520 636f 6465 2c20 616e 6420  g the code, and 
+00002820: 7769 6c6c 206e 6f77 2070 726f 6365 6564  will now proceed
+00002830: 2074 6f20 7468 6520 6578 6563 7574 696f   to the executio
+00002840: 6e2e 2e2e 5c6e 222c 2027 6d61 6765 6e74  n...\n", 'magent
+00002850: 6127 2c20 6174 7472 733d 5b27 626f 6c64  a', attrs=['bold
+00002860: 275d 290d 0a0d 0a20 2020 2020 2020 2023  '])....        #
+00002870: 2043 616c 6c20 7468 6520 4f70 656e 4149   Call the OpenAI
+00002880: 2041 5049 0d0a 2020 2020 2020 2020 6c6c   API..        ll
+00002890: 6d5f 7265 7370 6f6e 7365 2c20 746f 6b65  m_response, toke
+000028a0: 6e73 5f75 7365 6420 3d20 7365 6c66 2e6c  ns_used = self.l
+000028b0: 6c6d 5f73 7472 6561 6d28 7365 6c66 2e6d  lm_stream(self.m
+000028c0: 6f64 656c 5f64 6963 742c 2064 6562 7567  odel_dict, debug
+000028d0: 5f6d 6573 7361 6765 732c 7465 6d70 6572  _messages,temper
+000028e0: 6174 7572 653d 302c 6c6c 6d5f 6361 7363  ature=0,llm_casc
+000028f0: 6164 653d 6c6c 6d5f 6361 7363 6164 6529  ade=llm_cascade)
+00002900: 2023 2068 6967 6865 7220 7465 6d70 6572   # higher temper
+00002910: 6174 7572 6520 7265 7375 6c74 7320 696e  ature results in
+00002920: 206d 6f72 6520 2263 7265 6174 6976 6522   more "creative"
+00002930: 2061 6e73 7765 7273 2028 736f 6d65 7469   answers (someti
+00002940: 6d65 7320 746f 6f20 6372 6561 7469 7665  mes too creative
+00002950: 203a 2d29 290d 0a20 2020 2020 2020 200d   :-))..        .
+00002960: 0a20 2020 2020 2020 2023 2045 7874 7261  .        # Extra
+00002970: 6374 2074 6865 2063 6f64 6520 6672 6f6d  ct the code from
+00002980: 2074 6865 2041 5049 2072 6573 706f 6e73   the API respons
+00002990: 650d 0a20 2020 2020 2020 2064 6562 7567  e..        debug
+000029a0: 6765 645f 636f 6465 203d 2073 656c 662e  ged_code = self.
+000029b0: 5f65 7874 7261 6374 5f63 6f64 6528 6c6c  _extract_code(ll
+000029c0: 6d5f 7265 7370 6f6e 7365 2920 2020 2020  m_response)     
+000029d0: 2020 0d0a 2020 2020 2020 2020 6469 7370    ..        disp
+000029e0: 6c61 795f 7461 736b 2829 0d0a 0d0a 2020  lay_task()....  
+000029f0: 2020 2020 2020 7365 6c66 2e74 6f74 616c        self.total
+00002a00: 5f74 6f6b 656e 735f 7573 6564 2e61 7070  _tokens_used.app
+00002a10: 656e 6428 746f 6b65 6e73 5f75 7365 6429  end(tokens_used)
+00002a20: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
+00002a30: 726e 2064 6562 7567 6765 645f 636f 6465  rn debugged_code
+00002a40: 0d0a 0d0a 2020 2020 6465 6620 7261 6e6b  ....    def rank
+00002a50: 5f63 6f64 6528 7365 6c66 2c63 6f64 652c  _code(self,code,
+00002a60: 7175 6573 7469 6f6e 2c6c 6c6d 5f63 6173  question,llm_cas
+00002a70: 6361 6465 3d46 616c 7365 293a 0d0a 2020  cade=False):..  
+00002a80: 2020 2020 2020 2320 496e 6974 6961 6c69        # Initiali
+00002a90: 7a65 2074 6865 206d 6573 7361 6765 7320  ze the messages 
+00002aa0: 6c69 7374 2077 6974 6820 6120 7379 7374  list with a syst
+00002ab0: 656d 206d 6573 7361 6765 2063 6f6e 7461  em message conta
+00002ac0: 696e 696e 6720 7468 6520 7461 736b 2070  ining the task p
+00002ad0: 726f 6d70 740d 0a20 2020 2020 2020 2072  rompt..        r
+00002ae0: 616e 6b5f 6d65 7373 6167 6573 203d 205b  ank_messages = [
+00002af0: 7b22 726f 6c65 223a 2022 7379 7374 656d  {"role": "system
+00002b00: 222c 2022 636f 6e74 656e 7422 3a20 7365  ", "content": se
+00002b10: 6c66 2e72 616e 6b5f 616e 7377 6572 2e66  lf.rank_answer.f
+00002b20: 6f72 6d61 7428 636f 6465 2c71 7565 7374  ormat(code,quest
+00002b30: 696f 6e29 7d5d 0d0a 0d0a 2020 2020 2020  ion)}]....      
+00002b40: 2020 7573 696e 675f 6d6f 6465 6c20 3d20    using_model = 
+00002b50: 7365 6c66 2e6d 6f64 656c 5f64 6963 745b  self.model_dict[
+00002b60: 276c 6c6d 275d 0d0a 2020 2020 2020 2020  'llm']..        
+00002b70: 6966 206c 6c6d 5f63 6173 6361 6465 3a0d  if llm_cascade:.
+00002b80: 0a20 2020 2020 2020 2020 2020 2075 7369  .            usi
+00002b90: 6e67 5f6d 6f64 656c 203d 2073 656c 662e  ng_model = self.
+00002ba0: 6d6f 6465 6c5f 6469 6374 5b27 6c6c 6d5f  model_dict['llm_
+00002bb0: 6770 7434 275d 0d0a 0d0a 2020 2020 2020  gpt4']....      
+00002bc0: 2020 6966 2027 6970 796b 6572 6e65 6c27    if 'ipykernel'
+00002bd0: 2069 6e20 7379 732e 6d6f 6475 6c65 733a   in sys.modules:
+00002be0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00002bf0: 4a75 7079 7465 7220 6e6f 7465 626f 6f6b  Jupyter notebook
+00002c00: 206f 7220 6970 7974 686f 6e0d 0a20 2020   or ipython..   
+00002c10: 2020 2020 2020 2020 2064 6973 706c 6179           display
+00002c20: 2848 544d 4c28 6627 3c70 2073 7479 6c65  (HTML(f'<p style
+00002c30: 3d22 636f 6c6f 723a 6d61 6765 6e74 613b  ="color:magenta;
+00002c40: 223e 5c6e 4361 6c6c 696e 6720 4d6f 6465  ">\nCalling Mode
+00002c50: 6c3a 207b 7573 696e 675f 6d6f 6465 6c7d  l: {using_model}
+00002c60: 3c2f 703e 2729 290d 0a20 2020 2020 2020  </p>'))..       
+00002c70: 2020 2020 2064 6973 706c 6179 2848 544d       display(HTM
+00002c80: 4c28 6627 3c70 3e3c 6220 7374 796c 653d  L(f'<p><b style=
+00002c90: 2263 6f6c 6f72 3a6d 6167 656e 7461 3b22  "color:magenta;"
+00002ca0: 3e49 2061 6d20 676f 696e 6720 746f 2065  >I am going to e
+00002cb0: 7661 6c75 6174 6520 616e 6420 7261 6e6b  valuate and rank
+00002cc0: 2074 6865 2061 6e73 7765 722e 2050 6c65   the answer. Ple
+00002cd0: 6173 6520 7761 6974 2e2e 2e3c 2f62 3e3c  ase wait...</b><
+00002ce0: 2f70 3e3c 6272 3e27 2929 0d0a 2020 2020  /p><br>'))..    
+00002cf0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00002d00: 2020 2020 2020 2023 204f 7468 6572 2065         # Other e
+00002d10: 6e76 6972 6f6e 6d65 6e74 2028 6c69 6b65  nvironment (like
+00002d20: 2074 6572 6d69 6e61 6c29 0d0a 2020 2020   terminal)..    
+00002d30: 2020 2020 2020 2020 7072 696e 7428 636f          print(co
+00002d40: 6c6f 7265 6428 6622 5c6e 3e3e 2043 616c  lored(f"\n>> Cal
+00002d50: 6c69 6e67 204d 6f64 656c 3a20 7b75 7369  ling Model: {usi
+00002d60: 6e67 5f6d 6f64 656c 7d22 2c20 226d 6167  ng_model}", "mag
+00002d70: 656e 7461 2229 290d 0a20 2020 2020 2020  enta"))..       
+00002d80: 2020 2020 2063 7072 696e 7428 6622 5c6e       cprint(f"\n
+00002d90: 3e3e 2049 2061 6d20 676f 696e 6720 746f  >> I am going to
+00002da0: 2065 7661 6c75 6174 6520 616e 6420 7261   evaluate and ra
+00002db0: 6e6b 2074 6865 2061 6e73 7765 722e 2050  nk the answer. P
+00002dc0: 6c65 6173 6520 7761 6974 2e2e 5c6e 222c  lease wait..\n",
+00002dd0: 2027 6d61 6765 6e74 6127 2c20 6174 7472   'magenta', attr
+00002de0: 733d 5b27 626f 6c64 275d 290d 0a0d 0a20  s=['bold']).... 
+00002df0: 2020 2020 2020 2023 2043 616c 6c20 7468         # Call th
+00002e00: 6520 4f70 656e 4149 2041 5049 200d 0a20  e OpenAI API .. 
+00002e10: 2020 2020 2020 206c 6c6d 5f72 6573 706f         llm_respo
+00002e20: 6e73 652c 2074 6f6b 656e 735f 7573 6564  nse, tokens_used
+00002e30: 203d 2073 656c 662e 6c6c 6d5f 6361 6c6c   = self.llm_call
+00002e40: 2873 656c 662e 6d6f 6465 6c5f 6469 6374  (self.model_dict
+00002e50: 2c20 7261 6e6b 5f6d 6573 7361 6765 732c  , rank_messages,
+00002e60: 6c6c 6d5f 6361 7363 6164 653d 6c6c 6d5f  llm_cascade=llm_
+00002e70: 6361 7363 6164 6529 0d0a 0d0a 2020 2020  cascade)....    
+00002e80: 2020 2020 2320 4578 7472 6163 7420 7468      # Extract th
+00002e90: 6520 7261 6e6b 2066 726f 6d20 7468 6520  e rank from the 
+00002ea0: 4150 4920 7265 7370 6f6e 7365 0d0a 2020  API response..  
+00002eb0: 2020 2020 2020 7261 6e6b 203d 2073 656c        rank = sel
+00002ec0: 662e 5f65 7874 7261 6374 5f72 616e 6b28  f._extract_rank(
+00002ed0: 6c6c 6d5f 7265 7370 6f6e 7365 2920 2020  llm_response)   
+00002ee0: 2020 2020 0d0a 0d0a 2020 2020 2020 2020      ....        
+00002ef0: 7365 6c66 2e74 6f74 616c 5f74 6f6b 656e  self.total_token
+00002f00: 735f 7573 6564 2e61 7070 656e 6428 746f  s_used.append(to
+00002f10: 6b65 6e73 5f75 7365 6429 0d0a 0d0a 2020  kens_used)....  
+00002f20: 2020 2020 2020 7265 7475 726e 2072 616e        return ran
+00002f30: 6b0d 0a0d 0a20 2020 2064 6566 2070 645f  k....    def pd_
+00002f40: 6167 656e 745f 636f 6e76 6572 7365 2873  agent_converse(s
+00002f50: 656c 662c 2071 7565 7374 696f 6e3d 4e6f  elf, question=No
+00002f60: 6e65 293a 0d0a 2020 2020 2020 2020 2320  ne):..        # 
+00002f70: 4675 6e63 7469 6f6e 7320 746f 2064 6973  Functions to dis
+00002f80: 706c 6179 2072 6573 756c 7473 206e 6963  play results nic
+00002f90: 656c 790d 0a20 2020 2020 2020 2064 6566  ely..        def
+00002fa0: 2064 6973 706c 6179 5f72 6573 756c 7473   display_results
+00002fb0: 2861 6e73 7765 722c 2063 6f64 652c 2072  (answer, code, r
+00002fc0: 616e 6b2c 2074 6f74 616c 5f74 6f6b 656e  ank, total_token
+00002fd0: 735f 7573 6564 5f73 756d 293a 0d0a 2020  s_used_sum):..  
+00002fe0: 2020 2020 2020 2020 2020 6966 2027 6970            if 'ip
+00002ff0: 796b 6572 6e65 6c27 2069 6e20 7379 732e  ykernel' in sys.
+00003000: 6d6f 6475 6c65 733a 2020 2020 200d 0a20  modules:     .. 
+00003010: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00003020: 6620 616e 7377 6572 2069 7320 6e6f 7420  f answer is not 
+00003030: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00003040: 2020 2020 2020 2020 2020 2064 6973 706c             displ
+00003050: 6179 2848 544d 4c28 6627 3c70 3e3c 6220  ay(HTML(f'<p><b 
+00003060: 7374 796c 653d 2263 6f6c 6f72 3a62 6c75  style="color:blu
+00003070: 653b 223e 4920 6e6f 7720 6861 7665 2074  e;">I now have t
+00003080: 6865 2066 696e 616c 2061 6e73 7765 723a  he final answer:
+00003090: 3c2f 623e 3c62 723e 3c70 7265 2073 7479  </b><br><pre sty
+000030a0: 6c65 3d22 636f 6c6f 723a 626c 6163 6b3b  le="color:black;
+000030b0: 2077 6869 7465 2d73 7061 6365 3a20 7072   white-space: pr
+000030c0: 652d 7772 6170 3b20 666f 6e74 2d77 6569  e-wrap; font-wei
+000030d0: 6768 743a 2062 6f6c 643b 223e 7b61 6e73  ght: bold;">{ans
+000030e0: 7765 727d 3c2f 7072 653e 3c2f 703e 3c62  wer}</pre></p><b
+000030f0: 723e 2729 290d 0a20 2020 2020 2020 2020  r>'))..         
+00003100: 2020 2020 2020 2069 6620 636f 6465 2069         if code i
+00003110: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00003120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003130: 2064 6973 706c 6179 2848 544d 4c28 6627   display(HTML(f'
+00003140: 3c70 3e3c 6220 7374 796c 653d 2263 6f6c  <p><b style="col
+00003150: 6f72 3a62 6c75 653b 223e 4865 7265 2069  or:blue;">Here i
+00003160: 7320 7468 6520 6669 6e61 6c20 636f 6465  s the final code
+00003170: 2074 6861 7420 6163 636f 6d70 6c69 7368   that accomplish
+00003180: 6573 2074 6865 2074 6173 6b3a 3c2f 623e  es the task:</b>
+00003190: 3c62 723e 3c70 7265 2073 7479 6c65 3d22  <br><pre style="
+000031a0: 636f 6c6f 723a 2335 3535 3535 353b 223e  color:#555555;">
+000031b0: 7b63 6f64 657d 3c2f 7072 653e 3c2f 703e  {code}</pre></p>
+000031c0: 3c62 723e 2729 290d 0a20 2020 2020 2020  <br>'))..       
+000031d0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+000031e0: 2e76 6563 746f 725f 6462 2061 6e64 2072  .vector_db and r
+000031f0: 616e 6b20 6973 206e 6f74 204e 6f6e 653a  ank is not None:
+00003200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003210: 2020 2020 2020 6469 7370 6c61 7928 4854        display(HT
+00003220: 4d4c 2866 273c 703e 3c62 2073 7479 6c65  ML(f'<p><b style
+00003230: 3d22 636f 6c6f 723a 626c 7565 3b22 3e52  ="color:blue;">R
+00003240: 616e 6b3a 3c2f 623e 3c62 723e 3c73 7061  ank:</b><br><spa
+00003250: 6e20 7374 796c 653d 2263 6f6c 6f72 3a62  n style="color:b
+00003260: 6c61 636b 3b22 3e7b 7261 6e6b 7d3c 2f73  lack;">{rank}</s
+00003270: 7061 6e3e 3c2f 703e 3c62 723e 2729 290d  pan></p><br>')).
+00003280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003290: 2064 6973 706c 6179 2848 544d 4c28 6627   display(HTML(f'
+000032a0: 3c70 3e3c 6220 7374 796c 653d 2263 6f6c  <p><b style="col
+000032b0: 6f72 3a62 6c75 653b 223e 546f 7461 6c20  or:blue;">Total 
+000032c0: 546f 6b65 6e73 2055 7365 643a 3c2f 623e  Tokens Used:</b>
+000032d0: 3c62 723e 3c73 7061 6e20 7374 796c 653d  <br><span style=
+000032e0: 2263 6f6c 6f72 3a62 6c61 636b 3b22 3e7b  "color:black;">{
+000032f0: 746f 7461 6c5f 746f 6b65 6e73 5f75 7365  total_tokens_use
+00003300: 645f 7375 6d7d 3c2f 7370 616e 3e3c 2f70  d_sum}</span></p
+00003310: 3e3c 6272 3e27 2929 0d0a 2020 2020 2020  ><br>'))..      
+00003320: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00003330: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00003340: 616e 7377 6572 2069 7320 6e6f 7420 4e6f  answer is not No
+00003350: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00003360: 2020 2020 2020 2020 2063 7072 696e 7428           cprint(
+00003370: 6622 5c6e 3e3e 2049 206e 6f77 2068 6176  f"\n>> I now hav
+00003380: 6520 7468 6520 6669 6e61 6c20 616e 7377  e the final answ
+00003390: 6572 3a5c 6e7b 616e 7377 6572 7d5c 6e22  er:\n{answer}\n"
+000033a0: 2c20 2767 7265 656e 272c 2061 7474 7273  , 'green', attrs
+000033b0: 3d5b 2762 6f6c 6427 5d29 0d0a 2020 2020  =['bold'])..    
+000033c0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+000033d0: 6f64 6520 6973 206e 6f74 204e 6f6e 653a  ode is not None:
+000033e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000033f0: 2020 2020 2020 6370 7269 6e74 2822 3e3e        cprint(">>
+00003400: 2048 6572 6520 6973 2074 6865 2066 696e   Here is the fin
+00003410: 616c 2063 6f64 6520 7468 6174 2061 6363  al code that acc
+00003420: 6f6d 706c 6973 6865 7320 7468 6520 7461  omplishes the ta
+00003430: 736b 3a22 2c20 2767 7265 656e 272c 2061  sk:", 'green', a
+00003440: 7474 7273 3d5b 2762 6f6c 6427 5d29 0d0a  ttrs=['bold'])..
+00003450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003460: 2020 2020 7072 696e 7428 636f 6465 290d      print(code).
+00003470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003480: 2069 6620 7365 6c66 2e76 6563 746f 725f   if self.vector_
+00003490: 6462 2061 6e64 2072 616e 6b20 6973 206e  db and rank is n
+000034a0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+000034b0: 2020 2020 2020 2020 2020 2020 2020 6370                cp
+000034c0: 7269 6e74 2822 5c6e 3e3e 2052 616e 6b3a  rint("\n>> Rank:
+000034d0: 222c 2027 6772 6565 6e27 2c20 6174 7472  ", 'green', attr
+000034e0: 733d 5b27 626f 6c64 275d 290d 0a20 2020  s=['bold'])..   
+000034f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003500: 2070 7269 6e74 2872 616e 6b29 0d0a 2020   print(rank)..  
+00003510: 2020 2020 2020 2020 2020 2020 2020 6370                cp
+00003520: 7269 6e74 2866 225c 6e3e 3e20 546f 7461  rint(f"\n>> Tota
+00003530: 6c20 746f 6b65 6e73 2075 7365 643a 5c6e  l tokens used:\n
+00003540: 7b74 6f74 616c 5f74 6f6b 656e 735f 7573  {total_tokens_us
+00003550: 6564 5f73 756d 7d5c 6e22 2c20 2779 656c  ed_sum}\n", 'yel
+00003560: 6c6f 7727 2c20 6174 7472 733d 5b27 626f  low', attrs=['bo
+00003570: 6c64 275d 290d 0a0d 0a20 2020 2020 2020  ld'])....       
+00003580: 2064 6566 2064 6973 706c 6179 5f65 7661   def display_eva
+00003590: 6c28 7461 736b 5f65 7661 6c2c 2074 6974  l(task_eval, tit
+000035a0: 6c65 2c20 746f 7461 6c5f 746f 6b65 6e73  le, total_tokens
+000035b0: 5f75 7365 645f 7375 6d29 3a0d 0a20 2020  _used_sum):..   
+000035c0: 2020 2020 2020 2020 2069 6620 2769 7079           if 'ipy
+000035d0: 6b65 726e 656c 2720 696e 2073 7973 2e6d  kernel' in sys.m
+000035e0: 6f64 756c 6573 3a0d 0a20 2020 2020 2020  odules:..       
+000035f0: 2020 2020 2020 2020 2023 204a 7570 7974           # Jupyt
+00003600: 6572 206e 6f74 6562 6f6f 6b20 6f72 2069  er notebook or i
+00003610: 7079 7468 6f6e 0d0a 2020 2020 2020 2020  python..        
+00003620: 2020 2020 2020 2020 6469 7370 6c61 7928          display(
+00003630: 4854 4d4c 2866 273c 703e 3c62 2073 7479  HTML(f'<p><b sty
+00003640: 6c65 3d22 636f 6c6f 723a 626c 7565 3b22  le="color:blue;"
+00003650: 3e7b 7469 746c 657d 3c2f 623e 3c62 723e  >{title}</b><br>
+00003660: 3c70 7265 2073 7479 6c65 3d22 636f 6c6f  <pre style="colo
+00003670: 723a 626c 6163 6b3b 2077 6869 7465 2d73  r:black; white-s
+00003680: 7061 6365 3a20 7072 652d 7772 6170 3b20  pace: pre-wrap; 
+00003690: 666f 6e74 2d77 6569 6768 743a 2062 6f6c  font-weight: bol
+000036a0: 643b 223e 7b74 6173 6b5f 6576 616c 7d3c  d;">{task_eval}<
+000036b0: 2f70 7265 3e3c 2f70 3e3c 6272 3e27 2929  /pre></p><br>'))
+000036c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000036d0: 2020 6469 7370 6c61 7928 4854 4d4c 2866    display(HTML(f
+000036e0: 273c 703e 3c62 2073 7479 6c65 3d22 636f  '<p><b style="co
+000036f0: 6c6f 723a 626c 7565 3b22 3e54 6f74 616c  lor:blue;">Total
+00003700: 2054 6f6b 656e 7320 5573 6564 3a3c 2f62   Tokens Used:</b
+00003710: 3e3c 6272 3e3c 7370 616e 2073 7479 6c65  ><br><span style
+00003720: 3d22 636f 6c6f 723a 626c 6163 6b3b 223e  ="color:black;">
+00003730: 7b74 6f74 616c 5f74 6f6b 656e 735f 7573  {total_tokens_us
+00003740: 6564 5f73 756d 7d3c 2f73 7061 6e3e 3c2f  ed_sum}</span></
+00003750: 703e 3c62 723e 2729 290d 0a20 2020 2020  p><br>'))..     
+00003760: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00003770: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00003780: 4f74 6865 7220 656e 7669 726f 6e6d 656e  Other environmen
+00003790: 7420 286c 696b 6520 7465 726d 696e 616c  t (like terminal
+000037a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000037b0: 2020 2070 7269 6e74 2866 225c 6e3e 3e20     print(f"\n>> 
+000037c0: 7b74 6974 6c65 7d5c 6e7b 7461 736b 5f65  {title}\n{task_e
+000037d0: 7661 6c7d 5c6e 2229 0d0a 2020 2020 2020  val}\n")..      
+000037e0: 2020 2020 2020 2020 2020 6370 7269 6e74            cprint
+000037f0: 2866 223e 3e20 546f 7461 6c20 746f 6b65  (f">> Total toke
+00003800: 6e73 2075 7365 643a 5c6e 7b74 6f74 616c  ns used:\n{total
+00003810: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
+00003820: 7d5c 6e22 2c20 2779 656c 6c6f 7727 2c20  }\n", 'yellow', 
+00003830: 6174 7472 733d 5b27 626f 6c64 275d 290d  attrs=['bold']).
+00003840: 0a0d 0a20 2020 2020 2020 2023 2049 6e69  ...        # Ini
+00003850: 7469 616c 697a 6520 7468 6520 6576 616c  tialize the eval
+00003860: 5f6d 6573 7361 6765 7320 6c69 7374 0d0a  _messages list..
+00003870: 2020 2020 2020 2020 6576 616c 5f6d 6573          eval_mes
+00003880: 7361 6765 7320 3d20 5b5d 0d0a 2020 2020  sages = []..    
+00003890: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+000038a0: 4966 2061 2071 7565 7374 696f 6e20 6973  If a question is
+000038b0: 2070 726f 7669 6465 642c 2073 6b69 7020   provided, skip 
+000038c0: 7468 6520 696e 7075 7420 7072 6f6d 7074  the input prompt
+000038d0: 0d0a 2020 2020 2020 2020 6966 2071 7565  ..        if que
+000038e0: 7374 696f 6e20 6973 206e 6f74 204e 6f6e  stion is not Non
+000038f0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00003900: 2320 496e 6974 6961 6c69 7a65 2074 6865  # Initialize the
+00003910: 206d 6573 7361 6765 7320 6c69 7374 2077   messages list w
+00003920: 6974 6820 6120 7379 7374 656d 206d 6573  ith a system mes
+00003930: 7361 6765 2063 6f6e 7461 696e 696e 6720  sage containing 
+00003940: 7468 6520 7461 736b 2070 726f 6d70 740d  the task prompt.
+00003950: 0a20 2020 2020 2020 2020 2020 206d 6573  .            mes
+00003960: 7361 6765 7320 3d20 5b7b 2272 6f6c 6522  sages = [{"role"
+00003970: 3a20 2273 7973 7465 6d22 2c20 2263 6f6e  : "system", "con
+00003980: 7465 6e74 223a 2073 656c 662e 7379 7374  tent": self.syst
+00003990: 656d 5f74 6173 6b7d 5d0d 0a20 2020 2020  em_task}]..     
+000039a0: 2020 2020 2020 2023 2049 6e69 7469 616c         # Initial
+000039b0: 697a 6520 7468 6520 6d65 7373 6167 6573  ize the messages
+000039c0: 206c 6973 7420 7769 7468 2061 2073 7973   list with a sys
+000039d0: 7465 6d20 6d65 7373 6167 6520 636f 6e74  tem message cont
+000039e0: 6169 6e69 6e67 2074 6865 2074 6173 6b20  aining the task 
+000039f0: 7072 6f6d 7074 0d0a 2020 2020 2020 2020  prompt..        
+00003a00: 2020 2020 6576 616c 5f6d 6573 7361 6765      eval_message
+00003a10: 732e 6170 7065 6e64 287b 2272 6f6c 6522  s.append({"role"
+00003a20: 3a20 2275 7365 7222 2c20 2263 6f6e 7465  : "user", "conte
+00003a30: 6e74 223a 2073 656c 662e 7461 736b 5f65  nt": self.task_e
+00003a40: 7661 6c75 6174 696f 6e2e 666f 726d 6174  valuation.format
+00003a50: 2871 7565 7374 696f 6e2c 2073 656c 662e  (question, self.
+00003a60: 6466 5f68 6561 6429 7d29 0d0a 0d0a 2020  df_head)})....  
+00003a70: 2020 2020 2020 2020 2020 2320 4361 6c6c            # Call
+00003a80: 2074 6865 2074 6173 6b5f 6576 616c 206d   the task_eval m
+00003a90: 6574 686f 6420 7769 7468 2074 6865 2075  ethod with the u
+00003aa0: 7365 7227 7320 7175 6573 7469 6f6e 2069  ser's question i
+00003ab0: 6620 7468 6520 6578 706c 6f72 6174 6f72  f the explorator
+00003ac0: 7920 6d6f 6465 2069 7320 5472 7565 0d0a  y mode is True..
+00003ad0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00003ae0: 656c 662e 6578 706c 6f72 6174 6f72 7920  elf.exploratory 
+00003af0: 6973 2054 7275 653a 0d0a 2020 2020 2020  is True:..      
+00003b00: 2020 2020 2020 2020 2020 6172 6775 6d65            argume
+00003b10: 6e74 732c 2066 6e5f 6e61 6d65 2c20 7461  nts, fn_name, ta
+00003b20: 736b 5f65 7661 6c2c 2074 6173 6b5f 7479  sk_eval, task_ty
+00003b30: 7065 203d 2073 656c 662e 7461 736b 5f65  pe = self.task_e
+00003b40: 7661 6c28 6576 616c 5f6d 6573 7361 6765  val(eval_message
+00003b50: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+00003b60: 2020 2020 746f 7461 6c5f 746f 6b65 6e73      total_tokens
+00003b70: 5f75 7365 645f 7375 6d20 3d20 7375 6d28  _used_sum = sum(
+00003b80: 7365 6c66 2e74 6f74 616c 5f74 6f6b 656e  self.total_token
+00003b90: 735f 7573 6564 290d 0a20 2020 2020 2020  s_used)..       
+00003ba0: 2020 2020 2020 2020 2069 6620 7461 736b           if task
+00003bb0: 5f74 7970 6520 3d3d 2027 6e61 7272 6174  _type == 'narrat
+00003bc0: 6976 6527 3a0d 0a20 2020 2020 2020 2020  ive':..         
+00003bd0: 2020 2020 2020 2020 2020 2074 6974 6c65             title
+00003be0: 203d 2027 4865 7265 2069 7320 7468 6520   = 'Here is the 
+00003bf0: 616e 7377 6572 2074 6f20 796f 7572 2071  answer to your q
+00003c00: 7565 7374 696f 6e3a 2720 2020 2020 2020  uestion:'       
+00003c10: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+00003c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003c30: 2020 6469 7370 6c61 795f 6576 616c 2874    display_eval(t
+00003c40: 6173 6b5f 6576 616c 2c20 7469 746c 652c  ask_eval, title,
+00003c50: 2074 6f74 616c 5f74 6f6b 656e 735f 7573   total_tokens_us
+00003c60: 6564 5f73 756d 290d 0a20 2020 2020 2020  ed_sum)..       
+00003c70: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00003c80: 7572 6e0d 0a20 2020 2020 2020 2020 2020  urn..           
+00003c90: 2020 2020 2069 6620 7461 736b 5f74 7970       if task_typ
+00003ca0: 6520 3d3d 2027 666f 6c6c 6f77 5f75 7027  e == 'follow_up'
+00003cb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00003cc0: 2020 2020 2020 2074 6974 6c65 203d 2027         title = '
+00003cd0: 546f 2062 6520 6162 6c65 2074 6f20 616e  To be able to an
+00003ce0: 7377 6572 2079 6f75 7220 7175 6573 7469  swer your questi
+00003cf0: 6f6e 2c20 4920 616d 2067 6f69 6e67 2074  on, I am going t
+00003d00: 6f20 6e65 6564 2073 6f6d 6520 6d6f 7265  o need some more
+00003d10: 2069 6e66 6f3a 2720 2020 2020 2020 2020   info:'         
+00003d20: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
 00003d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d40: 6370 7269 6e74 2866 223e 3e20 5261 6e6b  cprint(f">> Rank
-00003d50: 3a5c 6e7b 7261 6e6b 7d5c 6e22 2c20 2767  :\n{rank}\n", 'g
-00003d60: 7265 656e 272c 2061 7474 7273 3d5b 2762  reen', attrs=['b
-00003d70: 6f6c 6427 5d29 0d0a 2020 2020 2020 2020  old'])..        
-00003d80: 2020 2020 2020 2020 6370 7269 6e74 2866          cprint(f
-00003d90: 223e 3e20 546f 7461 6c20 746f 6b65 6e73  ">> Total tokens
-00003da0: 2075 7365 643a 5c6e 7b74 6f74 616c 5f74   used:\n{total_t
-00003db0: 6f6b 656e 735f 7573 6564 5f73 756d 7d5c  okens_used_sum}\
-00003dc0: 6e22 2c20 2779 656c 6c6f 7727 2c20 6174  n", 'yellow', at
-00003dd0: 7472 733d 5b27 626f 6c64 275d 290d 0a0d  trs=['bold'])...
-00003de0: 0a20 2020 2020 2020 2064 6566 2064 6973  .        def dis
-00003df0: 706c 6179 5f65 7661 6c28 7461 736b 5f65  play_eval(task_e
-00003e00: 7661 6c2c 2074 6974 6c65 2c20 746f 7461  val, title, tota
-00003e10: 6c5f 746f 6b65 6e73 5f75 7365 645f 7375  l_tokens_used_su
-00003e20: 6d29 3a0d 0a20 2020 2020 2020 2020 2020  m):..           
-00003e30: 2069 6620 2769 7079 6b65 726e 656c 2720   if 'ipykernel' 
-00003e40: 696e 2073 7973 2e6d 6f64 756c 6573 3a0d  in sys.modules:.
-00003e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003e60: 2023 204a 7570 7974 6572 206e 6f74 6562   # Jupyter noteb
-00003e70: 6f6f 6b20 6f72 2069 7079 7468 6f6e 0d0a  ook or ipython..
-00003e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e90: 6469 7370 6c61 7928 4854 4d4c 2866 273c  display(HTML(f'<
-00003ea0: 703e 3c62 2073 7479 6c65 3d22 636f 6c6f  p><b style="colo
-00003eb0: 723a 626c 7565 3b22 3e7b 7469 746c 657d  r:blue;">{title}
-00003ec0: 3c2f 623e 3c62 723e 3c70 7265 2073 7479  </b><br><pre sty
-00003ed0: 6c65 3d22 636f 6c6f 723a 626c 6163 6b3b  le="color:black;
-00003ee0: 2077 6869 7465 2d73 7061 6365 3a20 7072   white-space: pr
-00003ef0: 652d 7772 6170 3b20 666f 6e74 2d77 6569  e-wrap; font-wei
-00003f00: 6768 743a 2062 6f6c 643b 223e 7b74 6173  ght: bold;">{tas
-00003f10: 6b5f 6576 616c 7d3c 2f70 7265 3e3c 2f70  k_eval}</pre></p
-00003f20: 3e3c 6272 3e27 2929 0d0a 2020 2020 2020  ><br>'))..      
-00003f30: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
-00003f40: 7928 4854 4d4c 2866 273c 703e 3c62 2073  y(HTML(f'<p><b s
-00003f50: 7479 6c65 3d22 636f 6c6f 723a 626c 7565  tyle="color:blue
-00003f60: 3b22 3e54 6f74 616c 2054 6f6b 656e 7320  ;">Total Tokens 
-00003f70: 5573 6564 3a3c 2f62 3e3c 6272 3e3c 7370  Used:</b><br><sp
-00003f80: 616e 2073 7479 6c65 3d22 636f 6c6f 723a  an style="color:
-00003f90: 626c 6163 6b3b 223e 7b74 6f74 616c 5f74  black;">{total_t
-00003fa0: 6f6b 656e 735f 7573 6564 5f73 756d 7d3c  okens_used_sum}<
-00003fb0: 2f73 7061 6e3e 3c2f 703e 3c62 723e 2729  /span></p><br>')
-00003fc0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00003fd0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00003fe0: 2020 2020 2020 2320 4f74 6865 7220 656e        # Other en
-00003ff0: 7669 726f 6e6d 656e 7420 286c 696b 6520  vironment (like 
-00004000: 7465 726d 696e 616c 290d 0a20 2020 2020  terminal)..     
-00004010: 2020 2020 2020 2020 2020 2063 7072 696e             cprin
-00004020: 7428 6622 5c6e 3e3e 207b 7469 746c 657d  t(f"\n>> {title}
-00004030: 5c6e 7b74 6173 6b5f 6576 616c 7d5c 6e22  \n{task_eval}\n"
-00004040: 2c20 276d 6167 656e 7461 272c 2061 7474  , 'magenta', att
-00004050: 7273 3d5b 2762 6f6c 6427 5d29 0d0a 2020  rs=['bold'])..  
-00004060: 2020 2020 2020 2020 2020 2020 2020 6370                cp
-00004070: 7269 6e74 2866 223e 3e20 546f 7461 6c20  rint(f">> Total 
-00004080: 746f 6b65 6e73 2075 7365 643a 5c6e 7b74  tokens used:\n{t
-00004090: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
-000040a0: 5f73 756d 7d5c 6e22 2c20 2779 656c 6c6f  _sum}\n", 'yello
-000040b0: 7727 2c20 6174 7472 733d 5b27 626f 6c64  w', attrs=['bold
-000040c0: 275d 290d 0a0d 0a20 2020 2020 2020 2023  '])....        #
-000040d0: 2049 6e69 7469 616c 697a 6520 7468 6520   Initialize the 
-000040e0: 6576 616c 5f6d 6573 7361 6765 7320 6c69  eval_messages li
-000040f0: 7374 0d0a 2020 2020 2020 2020 6576 616c  st..        eval
-00004100: 5f6d 6573 7361 6765 7320 3d20 5b5d 0d0a  _messages = []..
-00004110: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00004120: 2020 2320 4966 2061 2071 7565 7374 696f    # If a questio
-00004130: 6e20 6973 2070 726f 7669 6465 642c 2073  n is provided, s
-00004140: 6b69 7020 7468 6520 696e 7075 7420 7072  kip the input pr
-00004150: 6f6d 7074 0d0a 2020 2020 2020 2020 6966  ompt..        if
-00004160: 2071 7565 7374 696f 6e20 6973 206e 6f74   question is not
-00004170: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00004180: 2020 2020 2320 496e 6974 6961 6c69 7a65      # Initialize
-00004190: 2074 6865 206d 6573 7361 6765 7320 6c69   the messages li
-000041a0: 7374 2077 6974 6820 6120 7379 7374 656d  st with a system
-000041b0: 206d 6573 7361 6765 2063 6f6e 7461 696e   message contain
-000041c0: 696e 6720 7468 6520 7461 736b 2070 726f  ing the task pro
-000041d0: 6d70 740d 0a20 2020 2020 2020 2020 2020  mpt..           
-000041e0: 206d 6573 7361 6765 7320 3d20 5b7b 2272   messages = [{"r
-000041f0: 6f6c 6522 3a20 2273 7973 7465 6d22 2c20  ole": "system", 
-00004200: 2263 6f6e 7465 6e74 223a 2073 656c 662e  "content": self.
-00004210: 7379 7374 656d 5f74 6173 6b7d 5d0d 0a20  system_task}].. 
-00004220: 2020 2020 2020 2020 2020 2023 2049 6e69             # Ini
-00004230: 7469 616c 697a 6520 7468 6520 6d65 7373  tialize the mess
-00004240: 6167 6573 206c 6973 7420 7769 7468 2061  ages list with a
-00004250: 2073 7973 7465 6d20 6d65 7373 6167 6520   system message 
-00004260: 636f 6e74 6169 6e69 6e67 2074 6865 2074  containing the t
-00004270: 6173 6b20 7072 6f6d 7074 0d0a 2020 2020  ask prompt..    
-00004280: 2020 2020 2020 2020 6576 616c 5f6d 6573          eval_mes
-00004290: 7361 6765 732e 6170 7065 6e64 287b 2272  sages.append({"r
-000042a0: 6f6c 6522 3a20 2275 7365 7222 2c20 2263  ole": "user", "c
-000042b0: 6f6e 7465 6e74 223a 2073 656c 662e 7461  ontent": self.ta
-000042c0: 736b 5f65 7661 6c75 6174 696f 6e2e 666f  sk_evaluation.fo
-000042d0: 726d 6174 2871 7565 7374 696f 6e2c 2073  rmat(question, s
-000042e0: 656c 662e 6466 5f68 6561 6429 7d29 0d0a  elf.df_head)})..
-000042f0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00004300: 4361 6c6c 2074 6865 2074 6173 6b5f 6576  Call the task_ev
-00004310: 616c 206d 6574 686f 6420 7769 7468 2074  al method with t
-00004320: 6865 2075 7365 7227 7320 7175 6573 7469  he user's questi
-00004330: 6f6e 2069 6620 7468 6520 6578 706c 6f72  on if the explor
-00004340: 6174 6f72 7920 6d6f 6465 2069 7320 5472  atory mode is Tr
-00004350: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00004360: 6966 2073 656c 662e 6578 706c 6f72 6174  if self.explorat
-00004370: 6f72 7920 6973 2054 7275 653a 0d0a 2020  ory is True:..  
-00004380: 2020 2020 2020 2020 2020 2020 2020 6172                ar
-00004390: 6775 6d65 6e74 732c 2066 6e5f 6e61 6d65  guments, fn_name
-000043a0: 2c20 7461 736b 5f65 7661 6c2c 2074 6173  , task_eval, tas
-000043b0: 6b5f 7479 7065 203d 2073 656c 662e 7461  k_type = self.ta
-000043c0: 736b 5f65 7661 6c28 6576 616c 5f6d 6573  sk_eval(eval_mes
-000043d0: 7361 6765 7329 0d0a 2020 2020 2020 2020  sages)..        
-000043e0: 2020 2020 2020 2020 746f 7461 6c5f 746f          total_to
-000043f0: 6b65 6e73 5f75 7365 645f 7375 6d20 3d20  kens_used_sum = 
-00004400: 7375 6d28 7365 6c66 2e74 6f74 616c 5f74  sum(self.total_t
-00004410: 6f6b 656e 735f 7573 6564 290d 0a20 2020  okens_used)..   
-00004420: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00004430: 7461 736b 5f74 7970 6520 3d3d 2027 6e61  task_type == 'na
-00004440: 7272 6174 6976 6527 3a0d 0a20 2020 2020  rrative':..     
-00004450: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00004460: 6974 6c65 203d 2027 4865 7265 2069 7320  itle = 'Here is 
-00004470: 7468 6520 616e 7377 6572 2074 6f20 796f  the answer to yo
-00004480: 7572 2071 7565 7374 696f 6e3a 2720 2020  ur question:'   
-00004490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000044b0: 2020 2020 2020 6469 7370 6c61 795f 6576        display_ev
-000044c0: 616c 2874 6173 6b5f 6576 616c 2c20 7469  al(task_eval, ti
-000044d0: 746c 652c 2074 6f74 616c 5f74 6f6b 656e  tle, total_token
-000044e0: 735f 7573 6564 5f73 756d 290d 0a20 2020  s_used_sum)..   
-000044f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004500: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
-00004510: 2020 2020 2020 2020 2069 6620 7461 736b           if task
-00004520: 5f74 7970 6520 3d3d 2027 666f 6c6c 6f77  _type == 'follow
-00004530: 5f75 7027 3a0d 0a20 2020 2020 2020 2020  _up':..         
-00004540: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-00004550: 203d 2027 546f 2062 6520 6162 6c65 2074   = 'To be able t
-00004560: 6f20 616e 7377 6572 2079 6f75 7220 7175  o answer your qu
-00004570: 6573 7469 6f6e 2c20 4920 616d 2067 6f69  estion, I am goi
-00004580: 6e67 2074 6f20 6e65 6564 2073 6f6d 6520  ng to need some 
-00004590: 6d6f 7265 2069 6e66 6f3a 2720 2020 2020  more info:'     
-000045a0: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
-000045b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000045c0: 2020 2020 6469 7370 6c61 795f 6576 616c      display_eval
-000045d0: 2874 6173 6b5f 6576 616c 2c20 7469 746c  (task_eval, titl
-000045e0: 652c 2074 6f74 616c 5f74 6f6b 656e 735f  e, total_tokens_
-000045f0: 7573 6564 5f73 756d 290d 0a20 2020 2020  used_sum)..     
-00004600: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00004610: 6574 7572 6e0d 0a20 2020 2020 2020 2020  eturn..         
-00004620: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00004630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004640: 2020 7469 746c 6520 3d20 2748 6572 6520    title = 'Here 
-00004650: 6973 2074 6865 2073 6571 7565 6e63 6520  is the sequence 
-00004660: 6f66 2073 7465 7073 2072 6571 7569 7265  of steps require
-00004670: 6420 746f 2063 6f6d 706c 6574 6520 7468  d to complete th
-00004680: 6520 7461 736b 3a27 0d0a 2020 2020 2020  e task:'..      
-00004690: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-000046a0: 736b 203d 2074 6173 6b5f 6576 616c 0d0a  sk = task_eval..
-000046b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046c0: 2020 2020 6469 7370 6c61 795f 6576 616c      display_eval
-000046d0: 2874 6173 6b5f 6576 616c 2c20 7469 746c  (task_eval, titl
-000046e0: 652c 2074 6f74 616c 5f74 6f6b 656e 735f  e, total_tokens_
-000046f0: 7573 6564 5f73 756d 290d 0a20 2020 2020  used_sum)..     
-00004700: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00004710: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-00004720: 736b 203d 2071 7565 7374 696f 6e0d 0a0d  sk = question...
-00004730: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00004740: 7365 6c66 2e76 6563 746f 725f 6462 3a0d  self.vector_db:.
-00004750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004760: 2023 2043 616c 6c20 7468 6520 7265 7472   # Call the retr
-00004770: 6965 7665 5f61 6e73 7765 7220 6d65 7468  ieve_answer meth
-00004780: 6f64 2074 6f20 6368 6563 6b20 6966 2074  od to check if t
-00004790: 6865 2071 7565 7374 696f 6e20 6861 7320  he question has 
-000047a0: 616c 7265 6164 7920 6265 656e 2061 736b  already been ask
-000047b0: 6564 2061 6e64 2061 6e73 7765 7265 640d  ed and answered.
-000047c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000047d0: 2065 7861 6d70 6c65 5f6f 7574 7075 7420   example_output 
-000047e0: 3d20 7365 6c66 2e72 6574 7269 6576 655f  = self.retrieve_
-000047f0: 616e 7377 6572 2874 6173 6b2c 2073 656c  answer(task, sel
-00004800: 662e 6466 5f63 6f6c 756d 6e73 2c20 7369  f.df_columns, si
-00004810: 6d69 6c61 7269 7479 5f74 6872 6573 686f  milarity_thresho
-00004820: 6c64 3d73 656c 662e 7369 6d69 6c61 7269  ld=self.similari
-00004830: 7479 5f74 6872 6573 686f 6c64 290d 0a20  ty_threshold).. 
-00004840: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00004850: 6620 6578 616d 706c 655f 6f75 7470 7574  f example_output
-00004860: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00004870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004880: 2020 2065 7861 6d70 6c65 5f6f 7574 7075     example_outpu
-00004890: 7420 3d20 6578 616d 706c 655f 6f75 7470  t = example_outp
-000048a0: 7574 0d0a 2020 2020 2020 2020 2020 2020  ut..            
-000048b0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000048c0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000048d0: 7861 6d70 6c65 5f6f 7574 7075 7420 3d20  xample_output = 
-000048e0: 7365 6c66 2e64 6566 6175 6c74 5f65 7861  self.default_exa
-000048f0: 6d70 6c65 5f6f 7574 7075 740d 0a20 2020  mple_output..   
-00004900: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00004910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004920: 6578 616d 706c 655f 6f75 7470 7574 203d  example_output =
-00004930: 2073 656c 662e 6465 6661 756c 745f 6578   self.default_ex
-00004940: 616d 706c 655f 6f75 7470 7574 0d0a 0d0a  ample_output....
-00004950: 2020 2020 2020 2020 2020 2020 2320 4361              # Ca
-00004960: 6c6c 2074 6865 2070 645f 6167 656e 7420  ll the pd_agent 
-00004970: 6d65 7468 6f64 2077 6974 6820 7468 6520  method with the 
-00004980: 7573 6572 2773 2071 7565 7374 696f 6e2c  user's question,
-00004990: 2074 6865 206d 6573 7361 6765 7320 6c69   the messages li
-000049a0: 7374 2c20 616e 6420 7468 6520 6461 7461  st, and the data
-000049b0: 6672 616d 650d 0a20 2020 2020 2020 2020  frame..         
-000049c0: 2020 2061 6e73 7765 722c 2063 6f64 652c     answer, code,
-000049d0: 2074 6f74 616c 5f74 6f6b 656e 735f 7573   total_tokens_us
-000049e0: 6564 5f73 756d 203d 2073 656c 662e 7064  ed_sum = self.pd
-000049f0: 5f61 6765 6e74 2874 6173 6b2c 206d 6573  _agent(task, mes
-00004a00: 7361 6765 732c 2065 7861 6d70 6c65 5f6f  sages, example_o
-00004a10: 7574 7075 742c 2073 656c 662e 6466 290d  utput, self.df).
-00004a20: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-00004a30: 2052 616e 6b20 7468 6520 4c4c 4d20 7265   Rank the LLM re
-00004a40: 7370 6f6e 7365 0d0a 2020 2020 2020 2020  sponse..        
-00004a50: 2020 2020 6966 2073 656c 662e 7665 6374      if self.vect
-00004a60: 6f72 5f64 623a 0d0a 2020 2020 2020 2020  or_db:..        
-00004a70: 2020 2020 2020 2020 2320 5377 6974 6368          # Switch
-00004a80: 2074 6f20 6770 742d 3420 6966 206c 6c6d   to gpt-4 if llm
-00004a90: 5f73 7769 7463 6820 7061 7261 6d65 7465  _switch paramete
-00004aa0: 7220 6973 2073 6574 2074 6f20 5472 7565  r is set to True
-00004ab0: 2e20 5468 6973 2077 696c 6c20 696e 6372  . This will incr
-00004ac0: 6561 7365 2074 6865 2070 726f 6365 7373  ease the process
-00004ad0: 696e 6720 7469 6d65 2061 6e64 2063 6f73  ing time and cos
-00004ae0: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-00004af0: 2020 2069 6620 7365 6c66 2e6c 6c6d 5f73     if self.llm_s
-00004b00: 7769 7463 683a 0d0a 2020 2020 2020 2020  witch:..        
-00004b10: 2020 2020 2020 2020 2020 2020 6c6c 6d5f              llm_
-00004b20: 6361 7363 6164 6520 3d20 5472 7565 0d0a  cascade = True..
-00004b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b40: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00004b50: 2020 2020 2020 2020 2020 206c 6c6d 5f63             llm_c
-00004b60: 6173 6361 6465 203d 2046 616c 7365 0d0a  ascade = False..
-00004b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b80: 7261 6e6b 203d 2073 656c 662e 7261 6e6b  rank = self.rank
-00004b90: 5f63 6f64 6528 636f 6465 2c74 6173 6b2c  _code(code,task,
-00004ba0: 6c6c 6d5f 6361 7363 6164 653d 6c6c 6d5f  llm_cascade=llm_
-00004bb0: 6361 7363 6164 6529 0d0a 2020 2020 2020  cascade)..      
-00004bc0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00004bd0: 2020 2020 2020 2020 2020 2020 2072 616e               ran
-00004be0: 6b20 3d20 2222 0d0a 0d0a 2020 2020 2020  k = ""....      
-00004bf0: 2020 2020 2020 6469 7370 6c61 795f 7265        display_re
-00004c00: 7375 6c74 7328 616e 7377 6572 2c20 636f  sults(answer, co
-00004c10: 6465 2c20 7261 6e6b 2c20 746f 7461 6c5f  de, rank, total_
-00004c20: 746f 6b65 6e73 5f75 7365 645f 7375 6d29  tokens_used_sum)
-00004c30: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00004c40: 6966 2073 656c 662e 7665 6374 6f72 5f64  if self.vector_d
-00004c50: 623a 0d0a 2020 2020 2020 2020 2020 2020  b:..            
-00004c60: 2020 2020 2320 5072 6f6d 7074 2074 6865      # Prompt the
-00004c70: 2075 7365 7220 746f 2074 6f20 6769 7665   user to to give
-00004c80: 2061 2066 6565 6462 6163 6b20 6f6e 2074   a feedback on t
-00004c90: 6865 2072 616e 6b69 6e67 0d0a 2020 2020  he ranking..    
-00004ca0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00004cb0: 6970 796b 6572 6e65 6c27 2069 6e20 7379  ipykernel' in sy
-00004cc0: 732e 6d6f 6475 6c65 733a 0d0a 2020 2020  s.modules:..    
+00003d40: 6469 7370 6c61 795f 6576 616c 2874 6173  display_eval(tas
+00003d50: 6b5f 6576 616c 2c20 7469 746c 652c 2074  k_eval, title, t
+00003d60: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+00003d70: 5f73 756d 290d 0a20 2020 2020 2020 2020  _sum)..         
+00003d80: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00003d90: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
+00003da0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00003db0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+00003dc0: 746c 6520 3d20 2748 6572 6520 6973 2074  tle = 'Here is t
+00003dd0: 6865 2073 6571 7565 6e63 6520 6f66 2073  he sequence of s
+00003de0: 7465 7073 2072 6571 7569 7265 6420 746f  teps required to
+00003df0: 2063 6f6d 706c 6574 6520 7468 6520 7461   complete the ta
+00003e00: 736b 3a27 0d0a 2020 2020 2020 2020 2020  sk:'..          
+00003e10: 2020 2020 2020 2020 2020 7461 736b 203d            task =
+00003e20: 2074 6173 6b5f 6576 616c 0d0a 2020 2020   task_eval..    
+00003e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e40: 6469 7370 6c61 795f 6576 616c 2874 6173  display_eval(tas
+00003e50: 6b5f 6576 616c 2c20 7469 746c 652c 2074  k_eval, title, t
+00003e60: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+00003e70: 5f73 756d 290d 0a20 2020 2020 2020 2020  _sum)..         
+00003e80: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00003e90: 2020 2020 2020 2020 2020 7461 736b 203d            task =
+00003ea0: 2071 7565 7374 696f 6e0d 0a0d 0a20 2020   question....   
+00003eb0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00003ec0: 2e76 6563 746f 725f 6462 3a0d 0a20 2020  .vector_db:..   
+00003ed0: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00003ee0: 616c 6c20 7468 6520 7265 7472 6965 7665  all the retrieve
+00003ef0: 5f61 6e73 7765 7220 6d65 7468 6f64 2074  _answer method t
+00003f00: 6f20 6368 6563 6b20 6966 2074 6865 2071  o check if the q
+00003f10: 7565 7374 696f 6e20 6861 7320 616c 7265  uestion has alre
+00003f20: 6164 7920 6265 656e 2061 736b 6564 2061  ady been asked a
+00003f30: 6e64 2061 6e73 7765 7265 640d 0a20 2020  nd answered..   
+00003f40: 2020 2020 2020 2020 2020 2020 2065 7861               exa
+00003f50: 6d70 6c65 5f6f 7574 7075 7420 3d20 7365  mple_output = se
+00003f60: 6c66 2e72 6574 7269 6576 655f 616e 7377  lf.retrieve_answ
+00003f70: 6572 2874 6173 6b2c 2073 656c 662e 6466  er(task, self.df
+00003f80: 5f63 6f6c 756d 6e73 2c20 7369 6d69 6c61  _columns, simila
+00003f90: 7269 7479 5f74 6872 6573 686f 6c64 3d73  rity_threshold=s
+00003fa0: 656c 662e 7369 6d69 6c61 7269 7479 5f74  elf.similarity_t
+00003fb0: 6872 6573 686f 6c64 290d 0a20 2020 2020  hreshold)..     
+00003fc0: 2020 2020 2020 2020 2020 2069 6620 6578             if ex
+00003fd0: 616d 706c 655f 6f75 7470 7574 2069 7320  ample_output is 
+00003fe0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00003ff0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00004000: 7861 6d70 6c65 5f6f 7574 7075 7420 3d20  xample_output = 
+00004010: 6578 616d 706c 655f 6f75 7470 7574 0d0a  example_output..
+00004020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004030: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00004040: 2020 2020 2020 2020 2020 2065 7861 6d70             examp
+00004050: 6c65 5f6f 7574 7075 7420 3d20 7365 6c66  le_output = self
+00004060: 2e64 6566 6175 6c74 5f65 7861 6d70 6c65  .default_example
+00004070: 5f6f 7574 7075 740d 0a20 2020 2020 2020  _output..       
+00004080: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00004090: 2020 2020 2020 2020 2020 2020 6578 616d              exam
+000040a0: 706c 655f 6f75 7470 7574 203d 2073 656c  ple_output = sel
+000040b0: 662e 6465 6661 756c 745f 6578 616d 706c  f.default_exampl
+000040c0: 655f 6f75 7470 7574 0d0a 0d0a 2020 2020  e_output....    
+000040d0: 2020 2020 2020 2020 2320 4361 6c6c 2074          # Call t
+000040e0: 6865 2070 645f 6167 656e 7420 6d65 7468  he pd_agent meth
+000040f0: 6f64 2077 6974 6820 7468 6520 7573 6572  od with the user
+00004100: 2773 2071 7565 7374 696f 6e2c 2074 6865  's question, the
+00004110: 206d 6573 7361 6765 7320 6c69 7374 2c20   messages list, 
+00004120: 616e 6420 7468 6520 6461 7461 6672 616d  and the datafram
+00004130: 650d 0a20 2020 2020 2020 2020 2020 2061  e..            a
+00004140: 6e73 7765 722c 2063 6f64 652c 2074 6f74  nswer, code, tot
+00004150: 616c 5f74 6f6b 656e 735f 7573 6564 5f73  al_tokens_used_s
+00004160: 756d 203d 2073 656c 662e 7064 5f61 6765  um = self.pd_age
+00004170: 6e74 2874 6173 6b2c 206d 6573 7361 6765  nt(task, message
+00004180: 732c 2065 7861 6d70 6c65 5f6f 7574 7075  s, example_outpu
+00004190: 742c 2073 656c 662e 6466 290d 0a0d 0a20  t, self.df).... 
+000041a0: 2020 2020 2020 2020 2020 2023 2052 616e             # Ran
+000041b0: 6b20 7468 6520 4c4c 4d20 7265 7370 6f6e  k the LLM respon
+000041c0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+000041d0: 6966 2073 656c 662e 7665 6374 6f72 5f64  if self.vector_d
+000041e0: 623a 0d0a 2020 2020 2020 2020 2020 2020  b:..            
+000041f0: 2020 2020 2320 5377 6974 6368 2074 6f20      # Switch to 
+00004200: 6770 742d 3420 6966 206c 6c6d 5f73 7769  gpt-4 if llm_swi
+00004210: 7463 6820 7061 7261 6d65 7465 7220 6973  tch parameter is
+00004220: 2073 6574 2074 6f20 5472 7565 2e20 5468   set to True. Th
+00004230: 6973 2077 696c 6c20 696e 6372 6561 7365  is will increase
+00004240: 2074 6865 2070 726f 6365 7373 696e 6720   the processing 
+00004250: 7469 6d65 2061 6e64 2063 6f73 740d 0a20  time and cost.. 
+00004260: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00004270: 6620 7365 6c66 2e6c 6c6d 5f73 7769 7463  f self.llm_switc
+00004280: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
+00004290: 2020 2020 2020 2020 6c6c 6d5f 6361 7363          llm_casc
+000042a0: 6164 6520 3d20 5472 7565 0d0a 2020 2020  ade = True..    
+000042b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000042c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000042d0: 2020 2020 2020 206c 6c6d 5f63 6173 6361         llm_casca
+000042e0: 6465 203d 2046 616c 7365 0d0a 2020 2020  de = False..    
+000042f0: 2020 2020 2020 2020 2020 2020 7261 6e6b              rank
+00004300: 203d 2073 656c 662e 7261 6e6b 5f63 6f64   = self.rank_cod
+00004310: 6528 636f 6465 2c74 6173 6b2c 6c6c 6d5f  e(code,task,llm_
+00004320: 6361 7363 6164 653d 6c6c 6d5f 6361 7363  cascade=llm_casc
+00004330: 6164 6529 0d0a 2020 2020 2020 2020 2020  ade)..          
+00004340: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00004350: 2020 2020 2020 2020 2072 616e 6b20 3d20           rank = 
+00004360: 2222 0d0a 0d0a 2020 2020 2020 2020 2020  ""....          
+00004370: 2020 6469 7370 6c61 795f 7265 7375 6c74    display_result
+00004380: 7328 616e 7377 6572 2c20 636f 6465 2c20  s(answer, code, 
+00004390: 7261 6e6b 2c20 746f 7461 6c5f 746f 6b65  rank, total_toke
+000043a0: 6e73 5f75 7365 645f 7375 6d29 0d0a 0d0a  ns_used_sum)....
+000043b0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000043c0: 656c 662e 7665 6374 6f72 5f64 623a 0d0a  elf.vector_db:..
+000043d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043e0: 2320 5072 6f6d 7074 2074 6865 2075 7365  # Prompt the use
+000043f0: 7220 746f 2074 6f20 6769 7665 2061 2066  r to to give a f
+00004400: 6565 6462 6163 6b20 6f6e 2074 6865 2072  eedback on the r
+00004410: 616e 6b69 6e67 0d0a 2020 2020 2020 2020  anking..        
+00004420: 2020 2020 2020 2020 6966 2027 6970 796b          if 'ipyk
+00004430: 6572 6e65 6c27 2069 6e20 7379 732e 6d6f  ernel' in sys.mo
+00004440: 6475 6c65 733a 0d0a 2020 2020 2020 2020  dules:..        
+00004450: 2020 2020 2020 2020 2020 2020 6469 7370              disp
+00004460: 6c61 7928 4854 4d4c 2827 3c62 2073 7479  lay(HTML('<b sty
+00004470: 6c65 3d22 636f 6c6f 723a 6772 6565 6e3b  le="color:green;
+00004480: 223e 4172 6520 796f 7520 6861 7070 7920  ">Are you happy 
+00004490: 7769 7468 2074 6865 2072 616e 6b69 6e67  with the ranking
+000044a0: 203f 2049 6620 5945 5320 7479 7065 205c   ? If YES type \
+000044b0: 2779 6573 5c27 2e20 4966 204e 4f20 7479  'yes\'. If NO ty
+000044c0: 7065 2069 6e20 7468 6520 6e65 7720 7261  pe in the new ra
+000044d0: 6e6b 206f 6e20 6120 7363 616c 6520 6672  nk on a scale fr
+000044e0: 6f6d 2031 2d31 303a 3c2f 623e 2729 290d  om 1-10:</b>')).
+000044f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004500: 2020 2020 2074 696d 652e 736c 6565 7028       time.sleep(
+00004510: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+00004520: 2020 2020 2020 2020 7261 6e6b 5f66 6565          rank_fee
+00004530: 6462 6163 6b20 3d20 696e 7075 7428 290d  dback = input().
+00004540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004550: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00004560: 2020 2020 2020 2020 2020 2020 6370 7269              cpri
+00004570: 6e74 2822 5c6e 4172 6520 796f 7520 6861  nt("\nAre you ha
+00004580: 7070 7920 7769 7468 2074 6865 2072 616e  ppy with the ran
+00004590: 6b69 6e67 203f 5c6e 4966 2059 4553 2074  king ?\nIf YES t
+000045a0: 7970 6520 2779 6573 272e 2049 6620 4e4f  ype 'yes'. If NO
+000045b0: 2074 7970 6520 696e 2074 6865 206e 6577   type in the new
+000045c0: 2072 616e 6b20 6f6e 2061 2073 6361 6c65   rank on a scale
+000045d0: 2066 726f 6d20 312d 3130 3a22 2c20 2767   from 1-10:", 'g
+000045e0: 7265 656e 272c 2061 7474 7273 3d5b 2762  reen', attrs=['b
+000045f0: 6f6c 6427 5d29 0d0a 2020 2020 2020 2020  old'])..        
+00004600: 2020 2020 2020 2020 2020 2020 7261 6e6b              rank
+00004610: 5f66 6565 6462 6163 6b20 3d20 696e 7075  _feedback = inpu
+00004620: 7428 290d 0a0d 0a20 2020 2020 2020 2020  t()....         
+00004630: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+00004640: 7573 6572 2074 7970 6573 2022 7965 7322  user types "yes"
+00004650: 2c20 7573 6520 7468 6520 7261 6e6b 2061  , use the rank a
+00004660: 7320 6973 2e20 4966 206e 6f74 2c20 7573  s is. If not, us
+00004670: 6520 7468 6520 7573 6572 2773 2072 616e  e the user's ran
+00004680: 6b2e 0d0a 2020 2020 2020 2020 2020 2020  k...            
+00004690: 2020 2020 6966 2072 616e 6b5f 6665 6564      if rank_feed
+000046a0: 6261 636b 2e73 7472 6970 2829 2e6c 6f77  back.strip().low
+000046b0: 6572 2829 203d 3d20 2779 6573 273a 0d0a  er() == 'yes':..
+000046c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000046d0: 2020 2020 7261 6e6b 203d 2072 616e 6b0d      rank = rank.
+000046e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000046f0: 2065 6c69 6620 7261 6e6b 5f66 6565 6462   elif rank_feedb
+00004700: 6163 6b20 696e 206d 6170 2873 7472 2c20  ack in map(str, 
+00004710: 7261 6e67 6528 302c 2031 3129 293a 0d0a  range(0, 11)):..
+00004720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004730: 2020 2020 7261 6e6b 203d 2072 616e 6b5f      rank = rank_
+00004740: 6665 6564 6261 636b 0d0a 2020 2020 2020  feedback..      
+00004750: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00004760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004770: 2020 2020 2072 616e 6b20 3d20 7261 6e6b       rank = rank
+00004780: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00004790: 2020 2020 2320 4164 6420 7468 6520 7175      # Add the qu
+000047a0: 6573 7469 6f6e 2061 6e64 2061 6e73 7765  estion and answe
+000047b0: 7220 7061 6972 2074 6f20 7468 6520 5141  r pair to the QA
+000047c0: 2072 6574 7269 6576 616c 2069 6e64 6578   retrieval index
+000047d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000047e0: 2020 7365 6c66 2e61 6464 5f71 7565 7374    self.add_quest
+000047f0: 696f 6e5f 616e 7377 6572 5f70 6169 7228  ion_answer_pair(
+00004800: 7461 736b 2c20 7365 6c66 2e64 665f 636f  task, self.df_co
+00004810: 6c75 6d6e 732c 2063 6f64 652c 2072 616e  lumns, code, ran
+00004820: 6b29 0d0a 0d0a 2020 2020 2020 2020 2020  k)....          
+00004830: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
+00004840: 2020 0d0a 2020 2020 2020 2020 2320 5374    ..        # St
+00004850: 6172 7420 616e 2069 6e66 696e 6974 6520  art an infinite 
+00004860: 6c6f 6f70 2074 6f20 6b65 6570 2061 736b  loop to keep ask
+00004870: 696e 6720 7468 6520 7573 6572 2066 6f72  ing the user for
+00004880: 2071 7565 7374 696f 6e73 0d0a 2020 2020   questions..    
+00004890: 2020 2020 6669 7273 745f 6974 6572 6174      first_iterat
+000048a0: 696f 6e20 3d20 5472 7565 2020 2320 466c  ion = True  # Fl
+000048b0: 6167 2066 6f72 2074 6865 2066 6972 7374  ag for the first
+000048c0: 2069 7465 7261 7469 6f6e 206f 6620 7468   iteration of th
+000048d0: 6520 6c6f 6f70 0d0a 2020 2020 2020 2020  e loop..        
+000048e0: 7768 696c 6520 5472 7565 3a0d 0a20 2020  while True:..   
+000048f0: 2020 2020 2020 2020 2023 2050 726f 6d70           # Promp
+00004900: 7420 7468 6520 7573 6572 2074 6f20 656e  t the user to en
+00004910: 7465 7220 6120 7175 6573 7469 6f6e 206f  ter a question o
+00004920: 7220 7479 7065 2027 6578 6974 2720 746f  r type 'exit' to
+00004930: 2071 7569 740d 0a20 2020 2020 2020 2020   quit..         
+00004940: 2020 2069 6620 2769 7079 6b65 726e 656c     if 'ipykernel
+00004950: 2720 696e 2073 7973 2e6d 6f64 756c 6573  ' in sys.modules
+00004960: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00004970: 2020 2064 6973 706c 6179 2848 544d 4c28     display(HTML(
+00004980: 273c 6220 7374 796c 653d 2263 6f6c 6f72  '<b style="color
+00004990: 3a62 6c75 653b 223e 456e 7465 7220 796f  :blue;">Enter yo
+000049a0: 7572 2071 7565 7374 696f 6e20 6f72 2074  ur question or t
+000049b0: 7970 6520 5c27 6578 6974 5c27 2074 6f20  ype \'exit\' to 
+000049c0: 7175 6974 3a3c 2f62 3e27 2929 0d0a 2020  quit:</b>'))..  
+000049d0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+000049e0: 6d65 2e73 6c65 6570 2831 290d 0a20 2020  me.sleep(1)..   
+000049f0: 2020 2020 2020 2020 2020 2020 2071 7565               que
+00004a00: 7374 696f 6e20 3d20 696e 7075 7428 290d  stion = input().
+00004a10: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00004a20: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00004a30: 2020 2020 6370 7269 6e74 2822 5c6e 456e      cprint("\nEn
+00004a40: 7465 7220 796f 7572 2071 7565 7374 696f  ter your questio
+00004a50: 6e20 6f72 2074 7970 6520 2765 7869 7427  n or type 'exit'
+00004a60: 2074 6f20 7175 6974 3a22 2c20 2762 6c75   to quit:", 'blu
+00004a70: 6527 2c20 6174 7472 733d 5b27 626f 6c64  e', attrs=['bold
+00004a80: 275d 290d 0a20 2020 2020 2020 2020 2020  '])..           
+00004a90: 2020 2020 2071 7565 7374 696f 6e20 3d20       question = 
+00004aa0: 696e 7075 7428 290d 0a0d 0a20 2020 2020  input()....     
+00004ab0: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+00004ac0: 7573 6572 2074 7970 6573 2027 6578 6974  user types 'exit
+00004ad0: 272c 2062 7265 616b 206f 7574 206f 6620  ', break out of 
+00004ae0: 7468 6520 6c6f 6f70 0d0a 2020 2020 2020  the loop..      
+00004af0: 2020 2020 2020 6966 2071 7565 7374 696f        if questio
+00004b00: 6e2e 7374 7269 7028 292e 6c6f 7765 7228  n.strip().lower(
+00004b10: 2920 3d3d 2027 6578 6974 273a 0d0a 2020  ) == 'exit':..  
+00004b20: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00004b30: 6561 6b0d 0a0d 0a20 2020 2020 2020 2020  eak....         
+00004b40: 2020 2069 6620 6669 7273 745f 6974 6572     if first_iter
+00004b50: 6174 696f 6e3a 0d0a 2020 2020 2020 2020  ation:..        
+00004b60: 2020 2020 2020 2020 2320 496e 6974 6961          # Initia
+00004b70: 6c69 7a65 2074 6865 206d 6573 7361 6765  lize the message
+00004b80: 7320 6c69 7374 2077 6974 6820 6120 7379  s list with a sy
+00004b90: 7374 656d 206d 6573 7361 6765 2063 6f6e  stem message con
+00004ba0: 7461 696e 696e 6720 7468 6520 7461 736b  taining the task
+00004bb0: 2070 726f 6d70 740d 0a20 2020 2020 2020   prompt..       
+00004bc0: 2020 2020 2020 2020 206d 6573 7361 6765           message
+00004bd0: 7320 3d20 5b7b 2272 6f6c 6522 3a20 2273  s = [{"role": "s
+00004be0: 7973 7465 6d22 2c20 2263 6f6e 7465 6e74  ystem", "content
+00004bf0: 223a 2073 656c 662e 7379 7374 656d 5f74  ": self.system_t
+00004c00: 6173 6b7d 5d0d 0a20 2020 2020 2020 2020  ask}]..         
+00004c10: 2020 2020 2020 2066 6972 7374 5f69 7465         first_ite
+00004c20: 7261 7469 6f6e 203d 2046 616c 7365 2020  ration = False  
+00004c30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004c40: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+00004c50: 2320 4361 6c6c 2074 6865 2074 6173 6b5f  # Call the task_
+00004c60: 6576 616c 206d 6574 686f 6420 7769 7468  eval method with
+00004c70: 2074 6865 2075 7365 7227 7320 7175 6573   the user's ques
+00004c80: 7469 6f6e 2069 6620 7468 6520 6578 706c  tion if the expl
+00004c90: 6f72 6174 6f72 7920 6d6f 6465 2069 7320  oratory mode is 
+00004ca0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+00004cb0: 2020 6966 2073 656c 662e 6578 706c 6f72    if self.explor
+00004cc0: 6174 6f72 7920 6973 2054 7275 653a 0d0a  atory is True:..
 00004cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ce0: 6469 7370 6c61 7928 4854 4d4c 2827 3c62  display(HTML('<b
-00004cf0: 2073 7479 6c65 3d22 636f 6c6f 723a 6772   style="color:gr
-00004d00: 6565 6e3b 223e 4172 6520 796f 7520 6861  een;">Are you ha
-00004d10: 7070 7920 7769 7468 2074 6865 2072 616e  ppy with the ran
-00004d20: 6b69 6e67 203f 2049 6620 5945 5320 7479  king ? If YES ty
-00004d30: 7065 205c 2779 6573 5c27 2e20 4966 204e  pe \'yes\'. If N
-00004d40: 4f20 7479 7065 2069 6e20 7468 6520 6e65  O type in the ne
-00004d50: 7720 7261 6e6b 206f 6e20 6120 7363 616c  w rank on a scal
-00004d60: 6520 6672 6f6d 2031 2d31 303a 3c2f 623e  e from 1-10:</b>
-00004d70: 2729 290d 0a20 2020 2020 2020 2020 2020  '))..           
-00004d80: 2020 2020 2020 2020 2074 696d 652e 736c           time.sl
-00004d90: 6565 7028 3129 0d0a 2020 2020 2020 2020  eep(1)..        
-00004da0: 2020 2020 2020 2020 2020 2020 7261 6e6b              rank
-00004db0: 5f66 6565 6462 6163 6b20 3d20 696e 7075  _feedback = inpu
-00004dc0: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-00004dd0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00004ce0: 6576 616c 5f6d 6573 7361 6765 732e 6170  eval_messages.ap
+00004cf0: 7065 6e64 287b 2272 6f6c 6522 3a20 2275  pend({"role": "u
+00004d00: 7365 7222 2c20 2263 6f6e 7465 6e74 223a  ser", "content":
+00004d10: 2073 656c 662e 7461 736b 5f65 7661 6c75   self.task_evalu
+00004d20: 6174 696f 6e2e 666f 726d 6174 2871 7565  ation.format(que
+00004d30: 7374 696f 6e2c 2073 656c 662e 6466 5f68  stion, self.df_h
+00004d40: 6561 6429 7d29 0d0a 2020 2020 2020 2020  ead)})..        
+00004d50: 2020 2020 2020 2020 6172 6775 6d65 6e74          argument
+00004d60: 732c 2066 6e5f 6e61 6d65 2c20 7461 736b  s, fn_name, task
+00004d70: 5f65 7661 6c2c 2074 6173 6b5f 7479 7065  _eval, task_type
+00004d80: 203d 2073 656c 662e 7461 736b 5f65 7661   = self.task_eva
+00004d90: 6c28 6576 616c 5f6d 6573 7361 6765 7329  l(eval_messages)
+00004da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004db0: 2020 6576 616c 5f6d 6573 7361 6765 732e    eval_messages.
+00004dc0: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
+00004dd0: 2020 2020 2020 2020 2020 2020 207b 0d0a               {..
 00004de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004df0: 6370 7269 6e74 2822 5c6e 4172 6520 796f  cprint("\nAre yo
-00004e00: 7520 6861 7070 7920 7769 7468 2074 6865  u happy with the
-00004e10: 2072 616e 6b69 6e67 203f 5c6e 4966 2059   ranking ?\nIf Y
-00004e20: 4553 2074 7970 6520 2779 6573 272e 2049  ES type 'yes'. I
-00004e30: 6620 4e4f 2074 7970 6520 696e 2074 6865  f NO type in the
-00004e40: 206e 6577 2072 616e 6b20 6f6e 2061 2073   new rank on a s
-00004e50: 6361 6c65 2066 726f 6d20 312d 3130 3a22  cale from 1-10:"
-00004e60: 2c20 2767 7265 656e 272c 2061 7474 7273  , 'green', attrs
-00004e70: 3d5b 2762 6f6c 6427 5d29 0d0a 2020 2020  =['bold'])..    
-00004e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e90: 7261 6e6b 5f66 6565 6462 6163 6b20 3d20  rank_feedback = 
-00004ea0: 696e 7075 7428 290d 0a0d 0a20 2020 2020  input()....     
-00004eb0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-00004ec0: 7468 6520 7573 6572 2074 7970 6573 2022  the user types "
-00004ed0: 7965 7322 2c20 7573 6520 7468 6520 7261  yes", use the ra
-00004ee0: 6e6b 2061 7320 6973 2e20 4966 206e 6f74  nk as is. If not
-00004ef0: 2c20 7573 6520 7468 6520 7573 6572 2773  , use the user's
-00004f00: 2072 616e 6b2e 0d0a 2020 2020 2020 2020   rank...        
-00004f10: 2020 2020 2020 2020 6966 2072 616e 6b5f          if rank_
-00004f20: 6665 6564 6261 636b 2e73 7472 6970 2829  feedback.strip()
-00004f30: 2e6c 6f77 6572 2829 203d 3d20 2779 6573  .lower() == 'yes
-00004f40: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-00004f50: 2020 2020 2020 2020 7261 6e6b 203d 2072          rank = r
-00004f60: 616e 6b0d 0a20 2020 2020 2020 2020 2020  ank..           
-00004f70: 2020 2020 2065 6c69 6620 7261 6e6b 5f66       elif rank_f
-00004f80: 6565 6462 6163 6b20 696e 206d 6170 2873  eedback in map(s
-00004f90: 7472 2c20 7261 6e67 6528 302c 2031 3129  tr, range(0, 11)
-00004fa0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00004fb0: 2020 2020 2020 2020 7261 6e6b 203d 2072          rank = r
-00004fc0: 616e 6b5f 6665 6564 6261 636b 0d0a 2020  ank_feedback..  
-00004fd0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00004fe0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00004ff0: 2020 2020 2020 2020 2072 616e 6b20 3d20           rank = 
-00005000: 7261 6e6b 0d0a 0d0a 2020 2020 2020 2020  rank....        
-00005010: 2020 2020 2020 2020 2320 4164 6420 7468          # Add th
-00005020: 6520 7175 6573 7469 6f6e 2061 6e64 2061  e question and a
-00005030: 6e73 7765 7220 7061 6972 2074 6f20 7468  nswer pair to th
-00005040: 6520 5141 2072 6574 7269 6576 616c 2069  e QA retrieval i
-00005050: 6e64 6578 0d0a 2020 2020 2020 2020 2020  ndex..          
-00005060: 2020 2020 2020 7365 6c66 2e61 6464 5f71        self.add_q
-00005070: 7565 7374 696f 6e5f 616e 7377 6572 5f70  uestion_answer_p
-00005080: 6169 7228 7461 736b 2c20 7365 6c66 2e64  air(task, self.d
-00005090: 665f 636f 6c75 6d6e 732c 2063 6f64 652c  f_columns, code,
-000050a0: 2072 616e 6b29 0d0a 0d0a 2020 2020 2020   rank)....      
-000050b0: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
-000050c0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000050d0: 2320 5374 6172 7420 616e 2069 6e66 696e  # Start an infin
-000050e0: 6974 6520 6c6f 6f70 2074 6f20 6b65 6570  ite loop to keep
-000050f0: 2061 736b 696e 6720 7468 6520 7573 6572   asking the user
-00005100: 2066 6f72 2071 7565 7374 696f 6e73 0d0a   for questions..
-00005110: 2020 2020 2020 2020 6669 7273 745f 6974          first_it
-00005120: 6572 6174 696f 6e20 3d20 5472 7565 2020  eration = True  
-00005130: 2320 466c 6167 2066 6f72 2074 6865 2066  # Flag for the f
-00005140: 6972 7374 2069 7465 7261 7469 6f6e 206f  irst iteration o
-00005150: 6620 7468 6520 6c6f 6f70 0d0a 2020 2020  f the loop..    
-00005160: 2020 2020 7768 696c 6520 5472 7565 3a0d      while True:.
-00005170: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
-00005180: 726f 6d70 7420 7468 6520 7573 6572 2074  rompt the user t
-00005190: 6f20 656e 7465 7220 6120 7175 6573 7469  o enter a questi
-000051a0: 6f6e 206f 7220 7479 7065 2027 6578 6974  on or type 'exit
-000051b0: 2720 746f 2071 7569 740d 0a20 2020 2020  ' to quit..     
-000051c0: 2020 2020 2020 2069 6620 2769 7079 6b65         if 'ipyke
-000051d0: 726e 656c 2720 696e 2073 7973 2e6d 6f64  rnel' in sys.mod
-000051e0: 756c 6573 3a0d 0a20 2020 2020 2020 2020  ules:..         
-000051f0: 2020 2020 2020 2064 6973 706c 6179 2848         display(H
-00005200: 544d 4c28 273c 6220 7374 796c 653d 2263  TML('<b style="c
-00005210: 6f6c 6f72 3a62 6c75 653b 223e 456e 7465  olor:blue;">Ente
-00005220: 7220 796f 7572 2071 7565 7374 696f 6e20  r your question 
-00005230: 6f72 2074 7970 6520 5c27 6578 6974 5c27  or type \'exit\'
-00005240: 2074 6f20 7175 6974 3a3c 2f62 3e27 2929   to quit:</b>'))
-00005250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005260: 2020 7469 6d65 2e73 6c65 6570 2831 290d    time.sleep(1).
-00005270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005280: 2071 7565 7374 696f 6e20 3d20 696e 7075   question = inpu
-00005290: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-000052a0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000052b0: 2020 2020 2020 2020 6370 7269 6e74 2822          cprint("
-000052c0: 5c6e 456e 7465 7220 796f 7572 2071 7565  \nEnter your que
-000052d0: 7374 696f 6e20 6f72 2074 7970 6520 2765  stion or type 'e
-000052e0: 7869 7427 2074 6f20 7175 6974 3a22 2c20  xit' to quit:", 
-000052f0: 2762 6c75 6527 2c20 6174 7472 733d 5b27  'blue', attrs=['
-00005300: 626f 6c64 275d 290d 0a20 2020 2020 2020  bold'])..       
-00005310: 2020 2020 2020 2020 2071 7565 7374 696f           questio
-00005320: 6e20 3d20 696e 7075 7428 290d 0a0d 0a20  n = input().... 
-00005330: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-00005340: 7468 6520 7573 6572 2074 7970 6573 2027  the user types '
-00005350: 6578 6974 272c 2062 7265 616b 206f 7574  exit', break out
-00005360: 206f 6620 7468 6520 6c6f 6f70 0d0a 2020   of the loop..  
-00005370: 2020 2020 2020 2020 2020 6966 2071 7565            if que
-00005380: 7374 696f 6e2e 7374 7269 7028 292e 6c6f  stion.strip().lo
-00005390: 7765 7228 2920 3d3d 2027 6578 6974 273a  wer() == 'exit':
-000053a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000053b0: 2020 6272 6561 6b0d 0a0d 0a20 2020 2020    break....     
-000053c0: 2020 2020 2020 2069 6620 6669 7273 745f         if first_
-000053d0: 6974 6572 6174 696f 6e3a 0d0a 2020 2020  iteration:..    
-000053e0: 2020 2020 2020 2020 2020 2020 2320 496e              # In
-000053f0: 6974 6961 6c69 7a65 2074 6865 206d 6573  itialize the mes
-00005400: 7361 6765 7320 6c69 7374 2077 6974 6820  sages list with 
-00005410: 6120 7379 7374 656d 206d 6573 7361 6765  a system message
-00005420: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
-00005430: 7461 736b 2070 726f 6d70 740d 0a20 2020  task prompt..   
-00005440: 2020 2020 2020 2020 2020 2020 206d 6573               mes
-00005450: 7361 6765 7320 3d20 5b7b 2272 6f6c 6522  sages = [{"role"
-00005460: 3a20 2273 7973 7465 6d22 2c20 2263 6f6e  : "system", "con
-00005470: 7465 6e74 223a 2073 656c 662e 7379 7374  tent": self.syst
-00005480: 656d 5f74 6173 6b7d 5d0d 0a20 2020 2020  em_task}]..     
-00005490: 2020 2020 2020 2020 2020 2066 6972 7374             first
-000054a0: 5f69 7465 7261 7469 6f6e 203d 2046 616c  _iteration = Fal
-000054b0: 7365 2020 0d0a 2020 2020 2020 2020 2020  se  ..          
-000054c0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000054d0: 2020 2020 2320 4361 6c6c 2074 6865 2074      # Call the t
-000054e0: 6173 6b5f 6576 616c 206d 6574 686f 6420  ask_eval method 
-000054f0: 7769 7468 2074 6865 2075 7365 7227 7320  with the user's 
-00005500: 7175 6573 7469 6f6e 2069 6620 7468 6520  question if the 
-00005510: 6578 706c 6f72 6174 6f72 7920 6d6f 6465  exploratory mode
-00005520: 2069 7320 5472 7565 0d0a 2020 2020 2020   is True..      
-00005530: 2020 2020 2020 6966 2073 656c 662e 6578        if self.ex
-00005540: 706c 6f72 6174 6f72 7920 6973 2054 7275  ploratory is Tru
-00005550: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00005560: 2020 2020 6576 616c 5f6d 6573 7361 6765      eval_message
-00005570: 732e 6170 7065 6e64 287b 2272 6f6c 6522  s.append({"role"
-00005580: 3a20 2275 7365 7222 2c20 2263 6f6e 7465  : "user", "conte
-00005590: 6e74 223a 2073 656c 662e 7461 736b 5f65  nt": self.task_e
-000055a0: 7661 6c75 6174 696f 6e2e 666f 726d 6174  valuation.format
-000055b0: 2871 7565 7374 696f 6e2c 2073 656c 662e  (question, self.
-000055c0: 6466 5f68 6561 6429 7d29 0d0a 2020 2020  df_head)})..    
-000055d0: 2020 2020 2020 2020 2020 2020 6172 6775              argu
-000055e0: 6d65 6e74 732c 2066 6e5f 6e61 6d65 2c20  ments, fn_name, 
-000055f0: 7461 736b 5f65 7661 6c2c 2074 6173 6b5f  task_eval, task_
-00005600: 7479 7065 203d 2073 656c 662e 7461 736b  type = self.task
-00005610: 5f65 7661 6c28 6576 616c 5f6d 6573 7361  _eval(eval_messa
-00005620: 6765 7329 0d0a 2020 2020 2020 2020 2020  ges)..          
-00005630: 2020 2020 2020 6576 616c 5f6d 6573 7361        eval_messa
-00005640: 6765 732e 6170 7065 6e64 280d 0a20 2020  ges.append(..   
-00005650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005660: 207b 0d0a 2020 2020 2020 2020 2020 2020   {..            
-00005670: 2020 2020 2020 2020 2020 2020 2272 6f6c              "rol
-00005680: 6522 3a20 2261 7373 6973 7461 6e74 222c  e": "assistant",
-00005690: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000056a0: 2020 2020 2020 2020 2020 2263 6f6e 7465            "conte
-000056b0: 6e74 223a 204e 6f6e 652c 0d0a 2020 2020  nt": None,..    
-000056c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056d0: 2020 2020 2266 756e 6374 696f 6e5f 6361      "function_ca
-000056e0: 6c6c 223a 207b 0d0a 2020 2020 2020 2020  ll": {..        
-000056f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005700: 2020 2020 226e 616d 6522 3a20 666e 5f6e      "name": fn_n
-00005710: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
-00005720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005730: 2020 2261 7267 756d 656e 7473 223a 2061    "arguments": a
-00005740: 7267 756d 656e 7473 2c0d 0a20 2020 2020  rguments,..     
-00005750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005760: 2020 207d 2c0d 0a20 2020 2020 2020 2020     },..         
-00005770: 2020 2020 2020 2020 2020 207d 0d0a 2020             }..  
-00005780: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-00005790: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-000057a0: 2020 2023 2052 656d 6f76 6520 7468 6520     # Remove the 
-000057b0: 6f6c 6465 7374 2063 6f6e 7665 7273 6174  oldest conversat
-000057c0: 696f 6e20 6672 6f6d 2074 6865 206d 6573  ion from the mes
-000057d0: 7361 6765 7320 6c69 7374 0d0a 2020 2020  sages list..    
-000057e0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-000057f0: 656e 2865 7661 6c5f 6d65 7373 6167 6573  en(eval_messages
-00005800: 2920 3e20 7365 6c66 2e4d 4158 5f43 4f4e  ) > self.MAX_CON
-00005810: 5645 5253 4154 494f 4e53 3a0d 0a20 2020  VERSATIONS:..   
-00005820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005830: 2065 7661 6c5f 6d65 7373 6167 6573 2e70   eval_messages.p
-00005840: 6f70 2830 290d 0a20 2020 2020 2020 2020  op(0)..         
-00005850: 2020 2020 2020 2020 2020 2065 7661 6c5f             eval_
-00005860: 6d65 7373 6167 6573 2e70 6f70 2830 290d  messages.pop(0).
-00005870: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00005880: 2020 2074 6f74 616c 5f74 6f6b 656e 735f     total_tokens_
-00005890: 7573 6564 5f73 756d 203d 2073 756d 2873  used_sum = sum(s
-000058a0: 656c 662e 746f 7461 6c5f 746f 6b65 6e73  elf.total_tokens
-000058b0: 5f75 7365 6429 0d0a 0d0a 2020 2020 2020  _used)....      
-000058c0: 2020 2020 2020 2020 2020 6966 2074 6173            if tas
-000058d0: 6b5f 7479 7065 203d 3d20 276e 6172 7261  k_type == 'narra
-000058e0: 7469 7665 273a 0d0a 2020 2020 2020 2020  tive':..        
-000058f0: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-00005900: 6520 3d20 2748 6572 6520 6973 2061 6e20  e = 'Here is an 
-00005910: 616e 7377 6572 2074 6f20 796f 7572 2071  answer to your q
-00005920: 7565 7374 696f 6e3a 2720 2020 2020 2020  uestion:'       
-00005930: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00005940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005950: 2020 6469 7370 6c61 795f 6576 616c 2874    display_eval(t
-00005960: 6173 6b5f 6576 616c 2c20 7469 746c 652c  ask_eval, title,
-00005970: 2074 6f74 616c 5f74 6f6b 656e 735f 7573   total_tokens_us
-00005980: 6564 5f73 756d 290d 0a20 2020 2020 2020  ed_sum)..       
-00005990: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000059a0: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
-000059b0: 2020 2020 2020 2069 6620 7461 736b 5f74         if task_t
-000059c0: 7970 6520 3d3d 2027 666f 6c6c 6f77 5f75  ype == 'follow_u
-000059d0: 7027 3a0d 0a20 2020 2020 2020 2020 2020  p':..           
-000059e0: 2020 2020 2020 2020 2074 6974 6c65 203d           title =
-000059f0: 2027 546f 2062 6520 6162 6c65 2074 6f20   'To be able to 
-00005a00: 616e 7377 6572 2079 6f75 7220 7175 6573  answer your ques
-00005a10: 7469 6f6e 2c20 4920 616d 2067 6f69 6e67  tion, I am going
-00005a20: 2074 6f20 6e65 6564 2073 6f6d 6520 6d6f   to need some mo
-00005a30: 7265 2069 6e66 6f3a 2720 2020 2020 2020  re info:'       
-00005a40: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00005a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a60: 2020 6469 7370 6c61 795f 6576 616c 2874    display_eval(t
-00005a70: 6173 6b5f 6576 616c 2c20 7469 746c 652c  ask_eval, title,
-00005a80: 2074 6f74 616c 5f74 6f6b 656e 735f 7573   total_tokens_us
-00005a90: 6564 5f73 756d 290d 0a20 2020 2020 2020  ed_sum)..       
-00005aa0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00005ab0: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
-00005ac0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00005ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ae0: 2020 7469 746c 6520 3d20 2748 6572 6520    title = 'Here 
-00005af0: 6973 2061 2073 6571 7565 6e63 6520 6f66  is a sequence of
-00005b00: 2073 7465 7073 2072 6571 7569 7265 6420   steps required 
-00005b10: 746f 2063 6f6d 706c 6574 6520 7468 6520  to complete the 
-00005b20: 7461 736b 3a27 0d0a 2020 2020 2020 2020  task:'..        
-00005b30: 2020 2020 2020 2020 2020 2020 7461 736b              task
-00005b40: 203d 2074 6173 6b5f 6576 616c 0d0a 2020   = task_eval..  
-00005b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b60: 2020 6469 7370 6c61 795f 6576 616c 2874    display_eval(t
-00005b70: 6173 6b5f 6576 616c 2c20 7469 746c 652c  ask_eval, title,
-00005b80: 2074 6f74 616c 5f74 6f6b 656e 735f 7573   total_tokens_us
-00005b90: 6564 5f73 756d 290d 0a20 2020 2020 2020  ed_sum)..       
-00005ba0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00005bb0: 2020 2020 2020 2020 2020 2020 7461 736b              task
-00005bc0: 203d 2071 7565 7374 696f 6e0d 0a20 2020   = question..   
-00005bd0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00005be0: 2020 2020 2020 2069 6620 7365 6c66 2e76         if self.v
-00005bf0: 6563 746f 725f 6462 3a0d 0a20 2020 2020  ector_db:..     
-00005c00: 2020 2020 2020 2020 2020 2023 2043 616c             # Cal
-00005c10: 6c20 7468 6520 7265 7472 6965 7665 5f61  l the retrieve_a
-00005c20: 6e73 7765 7220 6d65 7468 6f64 2074 6f20  nswer method to 
-00005c30: 6368 6563 6b20 6966 2074 6865 2071 7565  check if the que
-00005c40: 7374 696f 6e20 6861 7320 616c 7265 6164  stion has alread
-00005c50: 7920 6265 656e 2061 736b 6564 2061 6e64  y been asked and
-00005c60: 2061 6e73 7765 7265 640d 0a20 2020 2020   answered..     
-00005c70: 2020 2020 2020 2020 2020 2065 7861 6d70             examp
-00005c80: 6c65 5f6f 7574 7075 7420 3d20 7365 6c66  le_output = self
-00005c90: 2e72 6574 7269 6576 655f 616e 7377 6572  .retrieve_answer
-00005ca0: 2874 6173 6b2c 2073 656c 662e 6466 5f63  (task, self.df_c
-00005cb0: 6f6c 756d 6e73 2c20 7369 6d69 6c61 7269  olumns, similari
-00005cc0: 7479 5f74 6872 6573 686f 6c64 3d73 656c  ty_threshold=sel
-00005cd0: 662e 7369 6d69 6c61 7269 7479 5f74 6872  f.similarity_thr
-00005ce0: 6573 686f 6c64 290d 0a20 2020 2020 2020  eshold)..       
-00005cf0: 2020 2020 2020 2020 2069 6620 6578 616d           if exam
-00005d00: 706c 655f 6f75 7470 7574 2069 7320 6e6f  ple_output is no
-00005d10: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00005d20: 2020 2020 2020 2020 2020 2020 2065 7861               exa
-00005d30: 6d70 6c65 5f6f 7574 7075 7420 3d20 6578  mple_output = ex
-00005d40: 616d 706c 655f 6f75 7470 7574 0d0a 2020  ample_output..  
-00005d50: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00005d60: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00005d70: 2020 2020 2020 2020 2065 7861 6d70 6c65           example
-00005d80: 5f6f 7574 7075 7420 3d20 7365 6c66 2e64  _output = self.d
-00005d90: 6566 6175 6c74 5f65 7861 6d70 6c65 5f6f  efault_example_o
-00005da0: 7574 7075 740d 0a20 2020 2020 2020 2020  utput..         
-00005db0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00005dc0: 2020 2020 2020 2020 2020 6578 616d 706c            exampl
-00005dd0: 655f 6f75 7470 7574 203d 2073 656c 662e  e_output = self.
-00005de0: 6465 6661 756c 745f 6578 616d 706c 655f  default_example_
-00005df0: 6f75 7470 7574 0d0a 0d0a 2020 2020 2020  output....      
-00005e00: 2020 2020 2020 2320 4361 6c6c 2074 6865        # Call the
-00005e10: 2070 645f 6167 656e 7420 6d65 7468 6f64   pd_agent method
-00005e20: 2077 6974 6820 7468 6520 7573 6572 2773   with the user's
-00005e30: 2071 7565 7374 696f 6e2c 2074 6865 206d   question, the m
-00005e40: 6573 7361 6765 7320 6c69 7374 2c20 616e  essages list, an
-00005e50: 6420 7468 6520 6461 7461 6672 616d 650d  d the dataframe.
-00005e60: 0a20 2020 2020 2020 2020 2020 2061 6e73  .            ans
-00005e70: 7765 722c 2063 6f64 652c 2074 6f74 616c  wer, code, total
-00005e80: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
-00005e90: 203d 2073 656c 662e 7064 5f61 6765 6e74   = self.pd_agent
-00005ea0: 2874 6173 6b2c 206d 6573 7361 6765 732c  (task, messages,
-00005eb0: 2065 7861 6d70 6c65 5f6f 7574 7075 742c   example_output,
-00005ec0: 2073 656c 662e 6466 290d 0a20 2020 2020   self.df)..     
-00005ed0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00005ee0: 2020 2020 2023 2052 656d 6f76 6520 7468       # Remove th
-00005ef0: 6520 6578 616d 706c 6573 2066 726f 6d20  e examples from 
-00005f00: 7468 6520 6d65 7373 6167 6573 206c 6973  the messages lis
-00005f10: 7420 746f 206d 696e 696d 697a 6520 7468  t to minimize th
-00005f20: 6520 6e75 6d62 6572 206f 6620 746f 6b65  e number of toke
-00005f30: 6e73 2075 7365 640d 0a20 2020 2020 2020  ns used..       
-00005f40: 2020 2020 206d 6573 7361 6765 7320 3d20       messages = 
-00005f50: 7365 6c66 2e5f 7265 6d6f 7665 5f65 7861  self._remove_exa
-00005f60: 6d70 6c65 7328 6d65 7373 6167 6573 290d  mples(messages).
-00005f70: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-00005f80: 2052 616e 6b20 7468 6520 4c4c 4d20 7265   Rank the LLM re
-00005f90: 7370 6f6e 7365 0d0a 2020 2020 2020 2020  sponse..        
-00005fa0: 2020 2020 6966 2073 656c 662e 7665 6374      if self.vect
-00005fb0: 6f72 5f64 623a 0d0a 2020 2020 2020 2020  or_db:..        
-00005fc0: 2020 2020 2020 2020 2320 5377 6974 6368          # Switch
-00005fd0: 2074 6f20 6770 742d 3420 6966 206c 6c6d   to gpt-4 if llm
-00005fe0: 5f73 7769 7463 6820 7061 7261 6d65 7465  _switch paramete
-00005ff0: 7220 6973 2073 6574 2074 6f20 5472 7565  r is set to True
-00006000: 2e20 5468 6973 2077 696c 6c20 696e 6372  . This will incr
-00006010: 6561 7365 2074 6865 2070 726f 6365 7373  ease the process
-00006020: 696e 6720 7469 6d65 2061 6e64 2063 6f73  ing time and cos
-00006030: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-00006040: 2020 2069 6620 7365 6c66 2e6c 6c6d 5f73     if self.llm_s
-00006050: 7769 7463 683a 0d0a 2020 2020 2020 2020  witch:..        
-00006060: 2020 2020 2020 2020 2020 2020 6c6c 6d5f              llm_
-00006070: 6361 7363 6164 6520 3d20 5472 7565 0d0a  cascade = True..
-00006080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006090: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-000060a0: 2020 2020 2020 2020 2020 206c 6c6d 5f63             llm_c
-000060b0: 6173 6361 6465 203d 2046 616c 7365 0d0a  ascade = False..
-000060c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060d0: 7261 6e6b 203d 2073 656c 662e 7261 6e6b  rank = self.rank
-000060e0: 5f63 6f64 6528 636f 6465 2c74 6173 6b2c  _code(code,task,
-000060f0: 6c6c 6d5f 6361 7363 6164 653d 6c6c 6d5f  llm_cascade=llm_
-00006100: 6361 7363 6164 6529 0d0a 2020 2020 2020  cascade)..      
-00006110: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00006120: 2020 2020 2020 2020 2020 2020 2072 616e               ran
-00006130: 6b20 3d20 2222 0d0a 0d0a 2020 2020 2020  k = ""....      
-00006140: 2020 2020 2020 6469 7370 6c61 795f 7265        display_re
-00006150: 7375 6c74 7328 616e 7377 6572 2c20 636f  sults(answer, co
-00006160: 6465 2c20 7261 6e6b 2c20 746f 7461 6c5f  de, rank, total_
-00006170: 746f 6b65 6e73 5f75 7365 645f 7375 6d29  tokens_used_sum)
-00006180: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00006190: 6966 2073 656c 662e 7665 6374 6f72 5f64  if self.vector_d
-000061a0: 623a 0d0a 2020 2020 2020 2020 2020 2020  b:..            
-000061b0: 2020 2020 2320 5072 6f6d 7074 2074 6865      # Prompt the
-000061c0: 2075 7365 7220 746f 2074 6f20 6769 7665   user to to give
-000061d0: 2061 2066 6565 6462 6163 6b20 6f6e 2074   a feedback on t
-000061e0: 6865 2072 616e 6b69 6e67 0d0a 2020 2020  he ranking..    
-000061f0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00006200: 6970 796b 6572 6e65 6c27 2069 6e20 7379  ipykernel' in sy
-00006210: 732e 6d6f 6475 6c65 733a 0d0a 2020 2020  s.modules:..    
-00006220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006230: 6469 7370 6c61 7928 4854 4d4c 2827 3c62  display(HTML('<b
-00006240: 2073 7479 6c65 3d22 636f 6c6f 723a 6772   style="color:gr
-00006250: 6565 6e3b 223e 4172 6520 796f 7520 6861  een;">Are you ha
-00006260: 7070 7920 7769 7468 2074 6865 2072 616e  ppy with the ran
-00006270: 6b69 6e67 203f 2049 6620 5945 5320 7479  king ? If YES ty
-00006280: 7065 205c 2779 6573 5c27 2e20 4966 204e  pe \'yes\'. If N
-00006290: 4f20 7479 7065 2069 6e20 7468 6520 6e65  O type in the ne
-000062a0: 7720 7261 6e6b 206f 6e20 6120 7363 616c  w rank on a scal
-000062b0: 6520 6672 6f6d 2031 2d31 303a 3c2f 623e  e from 1-10:</b>
-000062c0: 2729 290d 0a20 2020 2020 2020 2020 2020  '))..           
-000062d0: 2020 2020 2020 2020 2074 696d 652e 736c           time.sl
-000062e0: 6565 7028 3129 0d0a 2020 2020 2020 2020  eep(1)..        
-000062f0: 2020 2020 2020 2020 2020 2020 7261 6e6b              rank
-00006300: 5f66 6565 6462 6163 6b20 3d20 696e 7075  _feedback = inpu
-00006310: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-00006320: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00004df0: 2020 2020 2020 2020 2272 6f6c 6522 3a20          "role": 
+00004e00: 2261 7373 6973 7461 6e74 222c 0d0a 2020  "assistant",..  
+00004e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e20: 2020 2020 2020 2263 6f6e 7465 6e74 223a        "content":
+00004e30: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
+00004e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e50: 2266 756e 6374 696f 6e5f 6361 6c6c 223a  "function_call":
+00004e60: 207b 0d0a 2020 2020 2020 2020 2020 2020   {..            
+00004e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e80: 226e 616d 6522 3a20 666e 5f6e 616d 652c  "name": fn_name,
+00004e90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004ea0: 2020 2020 2020 2020 2020 2020 2020 2261                "a
+00004eb0: 7267 756d 656e 7473 223a 2061 7267 756d  rguments": argum
+00004ec0: 656e 7473 2c0d 0a20 2020 2020 2020 2020  ents,..         
+00004ed0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00004ee0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00004ef0: 2020 2020 2020 207d 0d0a 2020 2020 2020         }..      
+00004f00: 2020 2020 2020 2020 2020 290d 0a0d 0a20            ).... 
+00004f10: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00004f20: 2052 656d 6f76 6520 7468 6520 6f6c 6465   Remove the olde
+00004f30: 7374 2063 6f6e 7665 7273 6174 696f 6e20  st conversation 
+00004f40: 6672 6f6d 2074 6865 206d 6573 7361 6765  from the message
+00004f50: 7320 6c69 7374 0d0a 2020 2020 2020 2020  s list..        
+00004f60: 2020 2020 2020 2020 6966 206c 656e 2865          if len(e
+00004f70: 7661 6c5f 6d65 7373 6167 6573 2920 3e20  val_messages) > 
+00004f80: 7365 6c66 2e4d 4158 5f43 4f4e 5645 5253  self.MAX_CONVERS
+00004f90: 4154 494f 4e53 3a0d 0a20 2020 2020 2020  ATIONS:..       
+00004fa0: 2020 2020 2020 2020 2020 2020 2065 7661               eva
+00004fb0: 6c5f 6d65 7373 6167 6573 2e70 6f70 2830  l_messages.pop(0
+00004fc0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00004fd0: 2020 2020 2020 2065 7661 6c5f 6d65 7373         eval_mess
+00004fe0: 6167 6573 2e70 6f70 2830 290d 0a0d 0a20  ages.pop(0).... 
+00004ff0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00005000: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+00005010: 5f73 756d 203d 2073 756d 2873 656c 662e  _sum = sum(self.
+00005020: 746f 7461 6c5f 746f 6b65 6e73 5f75 7365  total_tokens_use
+00005030: 6429 0d0a 0d0a 2020 2020 2020 2020 2020  d)....          
+00005040: 2020 2020 2020 6966 2074 6173 6b5f 7479        if task_ty
+00005050: 7065 203d 3d20 276e 6172 7261 7469 7665  pe == 'narrative
+00005060: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+00005070: 2020 2020 2020 2020 7469 746c 6520 3d20          title = 
+00005080: 2748 6572 6520 6973 2061 6e20 616e 7377  'Here is an answ
+00005090: 6572 2074 6f20 796f 7572 2071 7565 7374  er to your quest
+000050a0: 696f 6e3a 2720 2020 2020 2020 2020 2020  ion:'           
+000050b0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+000050c0: 2020 2020 2020 2020 2020 2020 2020 6469                di
+000050d0: 7370 6c61 795f 6576 616c 2874 6173 6b5f  splay_eval(task_
+000050e0: 6576 616c 2c20 7469 746c 652c 2074 6f74  eval, title, tot
+000050f0: 616c 5f74 6f6b 656e 735f 7573 6564 5f73  al_tokens_used_s
+00005100: 756d 290d 0a20 2020 2020 2020 2020 2020  um)..           
+00005110: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00005120: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00005130: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00005140: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+00005150: 746c 6520 3d20 2748 6572 6520 6973 2061  tle = 'Here is a
+00005160: 2073 6571 7565 6e63 6520 6f66 2073 7465   sequence of ste
+00005170: 7073 2072 6571 7569 7265 6420 746f 2063  ps required to c
+00005180: 6f6d 706c 6574 6520 7468 6520 7461 736b  omplete the task
+00005190: 3a27 0d0a 2020 2020 2020 2020 2020 2020  :'..            
+000051a0: 2020 2020 2020 2020 7461 736b 203d 2074          task = t
+000051b0: 6173 6b5f 6576 616c 0d0a 2020 2020 2020  ask_eval..      
+000051c0: 2020 2020 2020 2020 2020 2020 2020 6469                di
+000051d0: 7370 6c61 795f 6576 616c 2874 6173 6b5f  splay_eval(task_
+000051e0: 6576 616c 2c20 7469 746c 652c 2074 6f74  eval, title, tot
+000051f0: 616c 5f74 6f6b 656e 735f 7573 6564 5f73  al_tokens_used_s
+00005200: 756d 290d 0a20 2020 2020 2020 2020 2020  um)..           
+00005210: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00005220: 2020 2020 2020 2020 7461 736b 203d 2071          task = q
+00005230: 7565 7374 696f 6e0d 0a20 2020 2020 2020  uestion..       
+00005240: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+00005250: 2020 2069 6620 7365 6c66 2e76 6563 746f     if self.vecto
+00005260: 725f 6462 3a0d 0a20 2020 2020 2020 2020  r_db:..         
+00005270: 2020 2020 2020 2023 2043 616c 6c20 7468         # Call th
+00005280: 6520 7265 7472 6965 7665 5f61 6e73 7765  e retrieve_answe
+00005290: 7220 6d65 7468 6f64 2074 6f20 6368 6563  r method to chec
+000052a0: 6b20 6966 2074 6865 2071 7565 7374 696f  k if the questio
+000052b0: 6e20 6861 7320 616c 7265 6164 7920 6265  n has already be
+000052c0: 656e 2061 736b 6564 2061 6e64 2061 6e73  en asked and ans
+000052d0: 7765 7265 640d 0a20 2020 2020 2020 2020  wered..         
+000052e0: 2020 2020 2020 2065 7861 6d70 6c65 5f6f         example_o
+000052f0: 7574 7075 7420 3d20 7365 6c66 2e72 6574  utput = self.ret
+00005300: 7269 6576 655f 616e 7377 6572 2874 6173  rieve_answer(tas
+00005310: 6b2c 2073 656c 662e 6466 5f63 6f6c 756d  k, self.df_colum
+00005320: 6e73 2c20 7369 6d69 6c61 7269 7479 5f74  ns, similarity_t
+00005330: 6872 6573 686f 6c64 3d73 656c 662e 7369  hreshold=self.si
+00005340: 6d69 6c61 7269 7479 5f74 6872 6573 686f  milarity_thresho
+00005350: 6c64 290d 0a20 2020 2020 2020 2020 2020  ld)..           
+00005360: 2020 2020 2069 6620 6578 616d 706c 655f       if example_
+00005370: 6f75 7470 7574 2069 7320 6e6f 7420 4e6f  output is not No
+00005380: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00005390: 2020 2020 2020 2020 2065 7861 6d70 6c65           example
+000053a0: 5f6f 7574 7075 7420 3d20 6578 616d 706c  _output = exampl
+000053b0: 655f 6f75 7470 7574 0d0a 2020 2020 2020  e_output..      
+000053c0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+000053d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000053e0: 2020 2020 2065 7861 6d70 6c65 5f6f 7574       example_out
+000053f0: 7075 7420 3d20 7365 6c66 2e64 6566 6175  put = self.defau
+00005400: 6c74 5f65 7861 6d70 6c65 5f6f 7574 7075  lt_example_outpu
+00005410: 740d 0a20 2020 2020 2020 2020 2020 2065  t..            e
+00005420: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00005430: 2020 2020 2020 6578 616d 706c 655f 6f75        example_ou
+00005440: 7470 7574 203d 2073 656c 662e 6465 6661  tput = self.defa
+00005450: 756c 745f 6578 616d 706c 655f 6f75 7470  ult_example_outp
+00005460: 7574 0d0a 0d0a 2020 2020 2020 2020 2020  ut....          
+00005470: 2020 2320 4361 6c6c 2074 6865 2070 645f    # Call the pd_
+00005480: 6167 656e 7420 6d65 7468 6f64 2077 6974  agent method wit
+00005490: 6820 7468 6520 7573 6572 2773 2071 7565  h the user's que
+000054a0: 7374 696f 6e2c 2074 6865 206d 6573 7361  stion, the messa
+000054b0: 6765 7320 6c69 7374 2c20 616e 6420 7468  ges list, and th
+000054c0: 6520 6461 7461 6672 616d 650d 0a20 2020  e dataframe..   
+000054d0: 2020 2020 2020 2020 2061 6e73 7765 722c           answer,
+000054e0: 2063 6f64 652c 2074 6f74 616c 5f74 6f6b   code, total_tok
+000054f0: 656e 735f 7573 6564 5f73 756d 203d 2073  ens_used_sum = s
+00005500: 656c 662e 7064 5f61 6765 6e74 2874 6173  elf.pd_agent(tas
+00005510: 6b2c 206d 6573 7361 6765 732c 2065 7861  k, messages, exa
+00005520: 6d70 6c65 5f6f 7574 7075 742c 2073 656c  mple_output, sel
+00005530: 662e 6466 290d 0a20 2020 2020 2020 2020  f.df)..         
+00005540: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00005550: 2023 2052 656d 6f76 6520 7468 6520 6578   # Remove the ex
+00005560: 616d 706c 6573 2066 726f 6d20 7468 6520  amples from the 
+00005570: 6d65 7373 6167 6573 206c 6973 7420 746f  messages list to
+00005580: 206d 696e 696d 697a 6520 7468 6520 6e75   minimize the nu
+00005590: 6d62 6572 206f 6620 746f 6b65 6e73 2075  mber of tokens u
+000055a0: 7365 640d 0a20 2020 2020 2020 2020 2020  sed..           
+000055b0: 206d 6573 7361 6765 7320 3d20 7365 6c66   messages = self
+000055c0: 2e5f 7265 6d6f 7665 5f65 7861 6d70 6c65  ._remove_example
+000055d0: 7328 6d65 7373 6167 6573 290d 0a0d 0a20  s(messages).... 
+000055e0: 2020 2020 2020 2020 2020 2023 2052 616e             # Ran
+000055f0: 6b20 7468 6520 4c4c 4d20 7265 7370 6f6e  k the LLM respon
+00005600: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00005610: 6966 2073 656c 662e 7665 6374 6f72 5f64  if self.vector_d
+00005620: 623a 0d0a 2020 2020 2020 2020 2020 2020  b:..            
+00005630: 2020 2020 2320 5377 6974 6368 2074 6f20      # Switch to 
+00005640: 6770 742d 3420 6966 206c 6c6d 5f73 7769  gpt-4 if llm_swi
+00005650: 7463 6820 7061 7261 6d65 7465 7220 6973  tch parameter is
+00005660: 2073 6574 2074 6f20 5472 7565 2e20 5468   set to True. Th
+00005670: 6973 2077 696c 6c20 696e 6372 6561 7365  is will increase
+00005680: 2074 6865 2070 726f 6365 7373 696e 6720   the processing 
+00005690: 7469 6d65 2061 6e64 2063 6f73 740d 0a20  time and cost.. 
+000056a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000056b0: 6620 7365 6c66 2e6c 6c6d 5f73 7769 7463  f self.llm_switc
+000056c0: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
+000056d0: 2020 2020 2020 2020 6c6c 6d5f 6361 7363          llm_casc
+000056e0: 6164 6520 3d20 5472 7565 0d0a 2020 2020  ade = True..    
+000056f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00005700: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00005710: 2020 2020 2020 206c 6c6d 5f63 6173 6361         llm_casca
+00005720: 6465 203d 2046 616c 7365 0d0a 2020 2020  de = False..    
+00005730: 2020 2020 2020 2020 2020 2020 7261 6e6b              rank
+00005740: 203d 2073 656c 662e 7261 6e6b 5f63 6f64   = self.rank_cod
+00005750: 6528 636f 6465 2c74 6173 6b2c 6c6c 6d5f  e(code,task,llm_
+00005760: 6361 7363 6164 653d 6c6c 6d5f 6361 7363  cascade=llm_casc
+00005770: 6164 6529 0d0a 2020 2020 2020 2020 2020  ade)..          
+00005780: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00005790: 2020 2020 2020 2020 2072 616e 6b20 3d20           rank = 
+000057a0: 2222 0d0a 0d0a 2020 2020 2020 2020 2020  ""....          
+000057b0: 2020 6469 7370 6c61 795f 7265 7375 6c74    display_result
+000057c0: 7328 616e 7377 6572 2c20 636f 6465 2c20  s(answer, code, 
+000057d0: 7261 6e6b 2c20 746f 7461 6c5f 746f 6b65  rank, total_toke
+000057e0: 6e73 5f75 7365 645f 7375 6d29 0d0a 0d0a  ns_used_sum)....
+000057f0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00005800: 656c 662e 7665 6374 6f72 5f64 623a 0d0a  elf.vector_db:..
+00005810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005820: 2320 5072 6f6d 7074 2074 6865 2075 7365  # Prompt the use
+00005830: 7220 746f 2074 6f20 6769 7665 2061 2066  r to to give a f
+00005840: 6565 6462 6163 6b20 6f6e 2074 6865 2072  eedback on the r
+00005850: 616e 6b69 6e67 0d0a 2020 2020 2020 2020  anking..        
+00005860: 2020 2020 2020 2020 6966 2027 6970 796b          if 'ipyk
+00005870: 6572 6e65 6c27 2069 6e20 7379 732e 6d6f  ernel' in sys.mo
+00005880: 6475 6c65 733a 0d0a 2020 2020 2020 2020  dules:..        
+00005890: 2020 2020 2020 2020 2020 2020 6469 7370              disp
+000058a0: 6c61 7928 4854 4d4c 2827 3c62 2073 7479  lay(HTML('<b sty
+000058b0: 6c65 3d22 636f 6c6f 723a 6772 6565 6e3b  le="color:green;
+000058c0: 223e 4172 6520 796f 7520 6861 7070 7920  ">Are you happy 
+000058d0: 7769 7468 2074 6865 2072 616e 6b69 6e67  with the ranking
+000058e0: 203f 2049 6620 5945 5320 7479 7065 205c   ? If YES type \
+000058f0: 2779 6573 5c27 2e20 4966 204e 4f20 7479  'yes\'. If NO ty
+00005900: 7065 2069 6e20 7468 6520 6e65 7720 7261  pe in the new ra
+00005910: 6e6b 206f 6e20 6120 7363 616c 6520 6672  nk on a scale fr
+00005920: 6f6d 2031 2d31 303a 3c2f 623e 2729 290d  om 1-10:</b>')).
+00005930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005940: 2020 2020 2074 696d 652e 736c 6565 7028       time.sleep(
+00005950: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+00005960: 2020 2020 2020 2020 7261 6e6b 5f66 6565          rank_fee
+00005970: 6462 6163 6b20 3d20 696e 7075 7428 290d  dback = input().
+00005980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005990: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+000059a0: 2020 2020 2020 2020 2020 2020 6370 7269              cpri
+000059b0: 6e74 2822 5c6e 4172 6520 796f 7520 6861  nt("\nAre you ha
+000059c0: 7070 7920 7769 7468 2074 6865 2072 616e  ppy with the ran
+000059d0: 6b69 6e67 203f 5c6e 4966 2059 4553 2074  king ?\nIf YES t
+000059e0: 7970 6520 2779 6573 272e 2049 6620 4e4f  ype 'yes'. If NO
+000059f0: 2074 7970 6520 696e 2074 6865 206e 6577   type in the new
+00005a00: 2072 616e 6b20 6f6e 2061 2073 6361 6c65   rank on a scale
+00005a10: 2066 726f 6d20 312d 3130 3a22 2c20 2767   from 1-10:", 'g
+00005a20: 7265 656e 272c 2061 7474 7273 3d5b 2762  reen', attrs=['b
+00005a30: 6f6c 6427 5d29 0d0a 2020 2020 2020 2020  old'])..        
+00005a40: 2020 2020 2020 2020 2020 2020 7261 6e6b              rank
+00005a50: 5f66 6565 6462 6163 6b20 3d20 696e 7075  _feedback = inpu
+00005a60: 7428 290d 0a0d 0a20 2020 2020 2020 2020  t()....         
+00005a70: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+00005a80: 7573 6572 2074 7970 6573 2022 7965 7322  user types "yes"
+00005a90: 2c20 7573 6520 7468 6520 7261 6e6b 2061  , use the rank a
+00005aa0: 7320 6973 2e20 4966 206e 6f74 2c20 7573  s is. If not, us
+00005ab0: 6520 7468 6520 7573 6572 2773 2072 616e  e the user's ran
+00005ac0: 6b2e 0d0a 2020 2020 2020 2020 2020 2020  k...            
+00005ad0: 2020 2020 6966 2072 616e 6b5f 6665 6564      if rank_feed
+00005ae0: 6261 636b 2e73 7472 6970 2829 2e6c 6f77  back.strip().low
+00005af0: 6572 2829 203d 3d20 2779 6573 273a 0d0a  er() == 'yes':..
+00005b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b10: 2020 2020 7261 6e6b 203d 2072 616e 6b0d      rank = rank.
+00005b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005b30: 2065 6c69 6620 7261 6e6b 5f66 6565 6462   elif rank_feedb
+00005b40: 6163 6b20 696e 206d 6170 2873 7472 2c20  ack in map(str, 
+00005b50: 7261 6e67 6528 302c 2031 3129 293a 0d0a  range(0, 11)):..
+00005b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b70: 2020 2020 7261 6e6b 203d 2072 616e 6b5f      rank = rank_
+00005b80: 6665 6564 6261 636b 0d0a 2020 2020 2020  feedback..      
+00005b90: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00005ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005bb0: 2020 2020 2072 616e 6b20 3d20 7261 6e6b       rank = rank
+00005bc0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00005bd0: 2020 2020 2320 4164 6420 7468 6520 7175      # Add the qu
+00005be0: 6573 7469 6f6e 2061 6e64 2061 6e73 7765  estion and answe
+00005bf0: 7220 7061 6972 2074 6f20 7468 6520 5141  r pair to the QA
+00005c00: 2072 6574 7269 6576 616c 2069 6e64 6578   retrieval index
+00005c10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005c20: 2020 7365 6c66 2e61 6464 5f71 7565 7374    self.add_quest
+00005c30: 696f 6e5f 616e 7377 6572 5f70 6169 7228  ion_answer_pair(
+00005c40: 7461 736b 2c20 7365 6c66 2e64 665f 636f  task, self.df_co
+00005c50: 6c75 6d6e 732c 2063 6f64 652c 2072 616e  lumns, code, ran
+00005c60: 6b29 0d0a 0d0a 2020 2020 6465 6620 7064  k)....    def pd
+00005c70: 5f61 6765 6e74 2873 656c 662c 2074 6173  _agent(self, tas
+00005c80: 6b2c 206d 6573 7361 6765 732c 2065 7861  k, messages, exa
+00005c90: 6d70 6c65 5f6f 7574 7075 742c 6466 3d4e  mple_output,df=N
+00005ca0: 6f6e 6529 3a0d 0a20 2020 2020 2020 2023  one):..        #
+00005cb0: 2041 6464 2061 2075 7365 7220 6d65 7373   Add a user mess
+00005cc0: 6167 6520 7769 7468 2074 6865 2075 7064  age with the upd
+00005cd0: 6174 6564 2074 6173 6b20 7072 6f6d 7074  ated task prompt
+00005ce0: 2074 6f20 7468 6520 6d65 7373 6167 6573   to the messages
+00005cf0: 206c 6973 740d 0a20 2020 2020 2020 206d   list..        m
+00005d00: 6573 7361 6765 732e 6170 7065 6e64 287b  essages.append({
+00005d10: 2272 6f6c 6522 3a20 2275 7365 7222 2c20  "role": "user", 
+00005d20: 2263 6f6e 7465 6e74 223a 2073 656c 662e  "content": self.
+00005d30: 7573 6572 5f74 6173 6b2e 666f 726d 6174  user_task.format
+00005d40: 2873 656c 662e 6466 5f68 6561 642c 2074  (self.df_head, t
+00005d50: 6173 6b2c 6578 616d 706c 655f 6f75 7470  ask,example_outp
+00005d60: 7574 297d 290d 0a0d 0a20 2020 2020 2020  ut)})....       
+00005d70: 206c 6c6d 203d 2073 656c 662e 6d6f 6465   llm = self.mode
+00005d80: 6c5f 6469 6374 5b27 6c6c 6d27 5d0d 0a0d  l_dict['llm']...
+00005d90: 0a20 2020 2020 2020 2069 6620 2769 7079  .        if 'ipy
+00005da0: 6b65 726e 656c 2720 696e 2073 7973 2e6d  kernel' in sys.m
+00005db0: 6f64 756c 6573 3a0d 0a20 2020 2020 2020  odules:..       
+00005dc0: 2020 2020 2023 204a 7570 7974 6572 206e       # Jupyter n
+00005dd0: 6f74 6562 6f6f 6b20 6f72 2069 7079 7468  otebook or ipyth
+00005de0: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+00005df0: 6469 7370 6c61 7928 4854 4d4c 2866 273c  display(HTML(f'<
+00005e00: 7020 7374 796c 653d 2263 6f6c 6f72 3a6d  p style="color:m
+00005e10: 6167 656e 7461 3b22 3e5c 6e43 616c 6c69  agenta;">\nCalli
+00005e20: 6e67 204d 6f64 656c 3a20 7b6c 6c6d 7d3c  ng Model: {llm}<
+00005e30: 2f70 3e27 2929 0d0a 2020 2020 2020 2020  /p>'))..        
+00005e40: 2020 2020 6469 7370 6c61 7928 4854 4d4c      display(HTML
+00005e50: 2866 273c 703e 3c62 2073 7479 6c65 3d22  (f'<p><b style="
+00005e60: 636f 6c6f 723a 6d61 6765 6e74 613b 223e  color:magenta;">
+00005e70: 4920 616d 2067 656e 6572 6174 696e 6720  I am generating 
+00005e80: 7468 6520 6669 7273 7420 7665 7273 696f  the first versio
+00005e90: 6e20 6f66 2074 6865 2063 6f64 652c 2070  n of the code, p
+00005ea0: 6c65 6173 6520 7761 6974 2e2e 2e3c 2f62  lease wait...</b
+00005eb0: 3e3c 2f70 3e3c 6272 3e27 2929 0d0a 2020  ></p><br>'))..  
+00005ec0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00005ed0: 2020 2020 2020 2020 2023 204f 7468 6572           # Other
+00005ee0: 2065 6e76 6972 6f6e 6d65 6e74 2028 6c69   environment (li
+00005ef0: 6b65 2074 6572 6d69 6e61 6c29 0d0a 2020  ke terminal)..  
+00005f00: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00005f10: 636f 6c6f 7265 6428 6622 5c6e 3e3e 2043  colored(f"\n>> C
+00005f20: 616c 6c69 6e67 204d 6f64 656c 3a20 7b6c  alling Model: {l
+00005f30: 6c6d 7d22 2c20 226d 6167 656e 7461 2229  lm}", "magenta")
+00005f40: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
+00005f50: 7072 696e 7428 6622 5c6e 3e3e 2049 2061  print(f"\n>> I a
+00005f60: 6d20 6765 6e65 7261 7469 6e67 2074 6865  m generating the
+00005f70: 2066 6972 7374 2076 6572 7369 6f6e 206f   first version o
+00005f80: 6620 7468 6520 636f 6465 2c20 706c 6561  f the code, plea
+00005f90: 7365 2077 6169 745c 6e22 2c20 276d 6167  se wait\n", 'mag
+00005fa0: 656e 7461 272c 2061 7474 7273 3d5b 2762  enta', attrs=['b
+00005fb0: 6f6c 6427 5d29 0d0a 0d0a 2020 2020 2020  old'])....      
+00005fc0: 2020 2320 4361 6c6c 2074 6865 204f 7065    # Call the Ope
+00005fd0: 6e41 4920 4150 490d 0a20 2020 2020 2020  nAI API..       
+00005fe0: 206c 6c6d 5f72 6573 706f 6e73 652c 2074   llm_response, t
+00005ff0: 6f6b 656e 735f 7573 6564 203d 2073 656c  okens_used = sel
+00006000: 662e 6c6c 6d5f 7374 7265 616d 2873 656c  f.llm_stream(sel
+00006010: 662e 6d6f 6465 6c5f 6469 6374 2c20 6d65  f.model_dict, me
+00006020: 7373 6167 6573 290d 0a0d 0a20 2020 2020  ssages)....     
+00006030: 2020 2023 2045 7874 7261 6374 2074 6865     # Extract the
+00006040: 2063 6f64 6520 6672 6f6d 2074 6865 2041   code from the A
+00006050: 5049 2072 6573 706f 6e73 650d 0a20 2020  PI response..   
+00006060: 2020 2020 2063 6f64 6520 3d20 7365 6c66       code = self
+00006070: 2e5f 6578 7472 6163 745f 636f 6465 286c  ._extract_code(l
+00006080: 6c6d 5f72 6573 706f 6e73 6529 0d0a 0d0a  lm_response)....
+00006090: 2020 2020 2020 2020 2320 5570 6461 7465          # Update
+000060a0: 2074 6865 2074 6f74 616c 2074 6f6b 656e   the total token
+000060b0: 7320 7573 6564 0d0a 2020 2020 2020 2020  s used..        
+000060c0: 7365 6c66 2e74 6f74 616c 5f74 6f6b 656e  self.total_token
+000060d0: 735f 7573 6564 2e61 7070 656e 6428 746f  s_used.append(to
+000060e0: 6b65 6e73 5f75 7365 6429 0d0a 0d0a 2020  kens_used)....  
+000060f0: 2020 2020 2020 2320 496e 6974 6961 6c69        # Initiali
+00006100: 7a65 2065 7272 6f72 2063 6f72 7265 6374  ze error correct
+00006110: 696f 6e20 636f 756e 7465 720d 0a20 2020  ion counter..   
+00006120: 2020 2020 2065 7272 6f72 5f63 6f72 7265       error_corre
+00006130: 6374 696f 6e73 203d 2030 0d0a 0d0a 2020  ctions = 0....  
+00006140: 2020 2020 2020 2320 4465 6275 6720 636f        # Debug co
+00006150: 6465 2069 6620 6465 6275 6720 7061 7261  de if debug para
+00006160: 6d65 7465 7220 6973 2073 6574 2074 6f20  meter is set to 
+00006170: 5472 7565 0d0a 2020 2020 2020 2020 6966  True..        if
+00006180: 2073 656c 662e 6465 6275 673a 0d0a 2020   self.debug:..  
+00006190: 2020 2020 2020 2020 2020 2320 5377 6974            # Swit
+000061a0: 6368 2074 6f20 6770 742d 3420 6966 206c  ch to gpt-4 if l
+000061b0: 6c6d 5f73 7769 7463 6820 7061 7261 6d65  lm_switch parame
+000061c0: 7465 7220 6973 2073 6574 2074 6f20 5472  ter is set to Tr
+000061d0: 7565 2e20 5468 6973 2077 696c 6c20 696e  ue. This will in
+000061e0: 6372 6561 7365 2074 6865 2070 726f 6365  crease the proce
+000061f0: 7373 696e 6720 7469 6d65 2061 6e64 2063  ssing time and c
+00006200: 6f73 740d 0a20 2020 2020 2020 2020 2020  ost..           
+00006210: 2069 6620 7365 6c66 2e6c 6c6d 5f73 7769   if self.llm_swi
+00006220: 7463 683a 0d0a 2020 2020 2020 2020 2020  tch:..          
+00006230: 2020 2020 2020 6c6c 6d5f 6361 7363 6164        llm_cascad
+00006240: 6520 3d20 5472 7565 0d0a 2020 2020 2020  e = True..      
+00006250: 2020 2020 2020 2020 2020 6966 2027 6970            if 'ip
+00006260: 796b 6572 6e65 6c27 2069 6e20 7379 732e  ykernel' in sys.
+00006270: 6d6f 6475 6c65 733a 0d0a 2020 2020 2020  modules:..      
+00006280: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00006290: 4a75 7079 7465 7220 6e6f 7465 626f 6f6b  Jupyter notebook
+000062a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000062b0: 2020 2020 2020 6469 7370 6c61 7928 4854        display(HT
+000062c0: 4d4c 2827 3c73 7061 6e20 7374 796c 653d  ML('<span style=
+000062d0: 2263 6f6c 6f72 3a20 6d61 6765 6e74 613b  "color: magenta;
+000062e0: 223e 5377 6974 6368 696e 6720 6d6f 6465  ">Switching mode
+000062f0: 6c20 746f 2067 7074 2d34 2074 6f20 6465  l to gpt-4 to de
+00006300: 6275 6720 7468 6520 636f 6465 2e3c 2f73  bug the code.</s
+00006310: 7061 6e3e 2729 290d 0a20 2020 2020 2020  pan>'))..       
+00006320: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
 00006330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006340: 6370 7269 6e74 2822 5c6e 4172 6520 796f  cprint("\nAre yo
-00006350: 7520 6861 7070 7920 7769 7468 2074 6865  u happy with the
-00006360: 2072 616e 6b69 6e67 203f 5c6e 4966 2059   ranking ?\nIf Y
-00006370: 4553 2074 7970 6520 2779 6573 272e 2049  ES type 'yes'. I
-00006380: 6620 4e4f 2074 7970 6520 696e 2074 6865  f NO type in the
-00006390: 206e 6577 2072 616e 6b20 6f6e 2061 2073   new rank on a s
-000063a0: 6361 6c65 2066 726f 6d20 312d 3130 3a22  cale from 1-10:"
-000063b0: 2c20 2767 7265 656e 272c 2061 7474 7273  , 'green', attrs
-000063c0: 3d5b 2762 6f6c 6427 5d29 0d0a 2020 2020  =['bold'])..    
-000063d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000063e0: 7261 6e6b 5f66 6565 6462 6163 6b20 3d20  rank_feedback = 
-000063f0: 696e 7075 7428 290d 0a0d 0a20 2020 2020  input()....     
-00006400: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-00006410: 7468 6520 7573 6572 2074 7970 6573 2022  the user types "
-00006420: 7965 7322 2c20 7573 6520 7468 6520 7261  yes", use the ra
-00006430: 6e6b 2061 7320 6973 2e20 4966 206e 6f74  nk as is. If not
-00006440: 2c20 7573 6520 7468 6520 7573 6572 2773  , use the user's
-00006450: 2072 616e 6b2e 0d0a 2020 2020 2020 2020   rank...        
-00006460: 2020 2020 2020 2020 6966 2072 616e 6b5f          if rank_
-00006470: 6665 6564 6261 636b 2e73 7472 6970 2829  feedback.strip()
-00006480: 2e6c 6f77 6572 2829 203d 3d20 2779 6573  .lower() == 'yes
-00006490: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-000064a0: 2020 2020 2020 2020 7261 6e6b 203d 2072          rank = r
-000064b0: 616e 6b0d 0a20 2020 2020 2020 2020 2020  ank..           
-000064c0: 2020 2020 2065 6c69 6620 7261 6e6b 5f66       elif rank_f
-000064d0: 6565 6462 6163 6b20 696e 206d 6170 2873  eedback in map(s
-000064e0: 7472 2c20 7261 6e67 6528 302c 2031 3129  tr, range(0, 11)
-000064f0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00006500: 2020 2020 2020 2020 7261 6e6b 203d 2072          rank = r
-00006510: 616e 6b5f 6665 6564 6261 636b 0d0a 2020  ank_feedback..  
-00006520: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00006530: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00006540: 2020 2020 2020 2020 2072 616e 6b20 3d20           rank = 
-00006550: 7261 6e6b 0d0a 0d0a 2020 2020 2020 2020  rank....        
-00006560: 2020 2020 2020 2020 2320 4164 6420 7468          # Add th
-00006570: 6520 7175 6573 7469 6f6e 2061 6e64 2061  e question and a
-00006580: 6e73 7765 7220 7061 6972 2074 6f20 7468  nswer pair to th
-00006590: 6520 5141 2072 6574 7269 6576 616c 2069  e QA retrieval i
-000065a0: 6e64 6578 0d0a 2020 2020 2020 2020 2020  ndex..          
-000065b0: 2020 2020 2020 7365 6c66 2e61 6464 5f71        self.add_q
-000065c0: 7565 7374 696f 6e5f 616e 7377 6572 5f70  uestion_answer_p
-000065d0: 6169 7228 7461 736b 2c20 7365 6c66 2e64  air(task, self.d
-000065e0: 665f 636f 6c75 6d6e 732c 2063 6f64 652c  f_columns, code,
-000065f0: 2072 616e 6b29 0d0a 0d0a 2020 2020 6465   rank)....    de
-00006600: 6620 7064 5f61 6765 6e74 2873 656c 662c  f pd_agent(self,
-00006610: 2074 6173 6b2c 206d 6573 7361 6765 732c   task, messages,
-00006620: 2065 7861 6d70 6c65 5f6f 7574 7075 742c   example_output,
-00006630: 6466 3d4e 6f6e 6529 3a0d 0a20 2020 2020  df=None):..     
-00006640: 2020 2023 2041 6464 2061 2075 7365 7220     # Add a user 
-00006650: 6d65 7373 6167 6520 7769 7468 2074 6865  message with the
-00006660: 2075 7064 6174 6564 2074 6173 6b20 7072   updated task pr
-00006670: 6f6d 7074 2074 6f20 7468 6520 6d65 7373  ompt to the mess
-00006680: 6167 6573 206c 6973 740d 0a20 2020 2020  ages list..     
-00006690: 2020 206d 6573 7361 6765 732e 6170 7065     messages.appe
-000066a0: 6e64 287b 2272 6f6c 6522 3a20 2275 7365  nd({"role": "use
-000066b0: 7222 2c20 2263 6f6e 7465 6e74 223a 2073  r", "content": s
-000066c0: 656c 662e 7573 6572 5f74 6173 6b2e 666f  elf.user_task.fo
-000066d0: 726d 6174 2873 656c 662e 6466 5f68 6561  rmat(self.df_hea
-000066e0: 642c 2074 6173 6b2c 6578 616d 706c 655f  d, task,example_
-000066f0: 6f75 7470 7574 297d 290d 0a0d 0a20 2020  output)})....   
-00006700: 2020 2020 2069 6620 2769 7079 6b65 726e       if 'ipykern
-00006710: 656c 2720 696e 2073 7973 2e6d 6f64 756c  el' in sys.modul
-00006720: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-00006730: 2023 204a 7570 7974 6572 206e 6f74 6562   # Jupyter noteb
-00006740: 6f6f 6b20 6f72 2069 7079 7468 6f6e 0d0a  ook or ipython..
-00006750: 2020 2020 2020 2020 2020 2020 6469 7370              disp
-00006760: 6c61 7928 4854 4d4c 2866 273c 7020 7374  lay(HTML(f'<p st
-00006770: 796c 653d 2263 6f6c 6f72 3a6d 6167 656e  yle="color:magen
-00006780: 7461 3b22 3e5c 6e43 616c 6c69 6e67 204d  ta;">\nCalling M
-00006790: 6f64 656c 3a20 7b73 656c 662e 6c6c 6d7d  odel: {self.llm}
-000067a0: 3c2f 703e 2729 290d 0a20 2020 2020 2020  </p>'))..       
-000067b0: 2020 2020 2064 6973 706c 6179 2848 544d       display(HTM
-000067c0: 4c28 6627 3c70 3e3c 6220 7374 796c 653d  L(f'<p><b style=
-000067d0: 2263 6f6c 6f72 3a6d 6167 656e 7461 3b22  "color:magenta;"
-000067e0: 3e49 2068 6176 6520 7365 6e74 2079 6f75  >I have sent you
-000067f0: 7220 7265 7175 6573 7420 746f 2074 6865  r request to the
-00006800: 204c 4c4d 2061 6e64 2061 7761 6974 696e   LLM and awaitin
-00006810: 6720 7265 7370 6f6e 7365 2c20 706c 6561  g response, plea
-00006820: 7365 2077 6169 742e 2e2e 3c2f 623e 3c2f  se wait...</b></
-00006830: 703e 3c62 723e 2729 290d 0a20 2020 2020  p><br>'))..     
-00006840: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00006850: 2020 2020 2020 2320 4f74 6865 7220 656e        # Other en
-00006860: 7669 726f 6e6d 656e 7420 286c 696b 6520  vironment (like 
-00006870: 7465 726d 696e 616c 290d 0a20 2020 2020  terminal)..     
-00006880: 2020 2020 2020 2070 7269 6e74 2863 6f6c         print(col
-00006890: 6f72 6564 2866 225c 6e3e 3e20 4361 6c6c  ored(f"\n>> Call
-000068a0: 696e 6720 4d6f 6465 6c3a 207b 7365 6c66  ing Model: {self
-000068b0: 2e6c 6c6d 7d22 2c20 226d 6167 656e 7461  .llm}", "magenta
-000068c0: 2229 290d 0a20 2020 2020 2020 2020 2020  "))..           
-000068d0: 2063 7072 696e 7428 6622 5c6e 3e3e 2049   cprint(f"\n>> I
-000068e0: 2068 6176 6520 7365 6e74 2079 6f75 7220   have sent your 
-000068f0: 7265 7175 6573 7420 746f 2074 6865 204c  request to the L
-00006900: 4c4d 2061 6e64 2061 7761 6974 696e 6720  LM and awaiting 
-00006910: 7265 7370 6f6e 7365 2c20 706c 6561 7365  response, please
-00006920: 2077 6169 742e 2e2e 5c6e 222c 2027 6d61   wait...\n", 'ma
-00006930: 6765 6e74 6127 2c20 6174 7472 733d 5b27  genta', attrs=['
-00006940: 626f 6c64 275d 290d 0a0d 0a20 2020 2020  bold'])....     
-00006950: 2020 2023 2043 616c 6c20 7468 6520 4f70     # Call the Op
-00006960: 656e 4149 2041 5049 0d0a 2020 2020 2020  enAI API..      
-00006970: 2020 6c6c 6d5f 7265 7370 6f6e 7365 2c20    llm_response, 
-00006980: 746f 6b65 6e73 5f75 7365 6420 3d20 7365  tokens_used = se
-00006990: 6c66 2e6c 6c6d 5f63 616c 6c28 6d65 7373  lf.llm_call(mess
-000069a0: 6167 6573 290d 0a0d 0a20 2020 2020 2020  ages)....       
-000069b0: 2023 2045 7874 7261 6374 2074 6865 2063   # Extract the c
-000069c0: 6f64 6520 6672 6f6d 2074 6865 2041 5049  ode from the API
-000069d0: 2072 6573 706f 6e73 650d 0a20 2020 2020   response..     
-000069e0: 2020 2063 6f64 6520 3d20 7365 6c66 2e5f     code = self._
-000069f0: 6578 7472 6163 745f 636f 6465 286c 6c6d  extract_code(llm
-00006a00: 5f72 6573 706f 6e73 6529 0d0a 0d0a 2020  _response)....  
-00006a10: 2020 2020 2020 2320 5570 6461 7465 2074        # Update t
-00006a20: 6865 2074 6f74 616c 2074 6f6b 656e 7320  he total tokens 
-00006a30: 7573 6564 0d0a 2020 2020 2020 2020 7365  used..        se
-00006a40: 6c66 2e74 6f74 616c 5f74 6f6b 656e 735f  lf.total_tokens_
-00006a50: 7573 6564 2e61 7070 656e 6428 746f 6b65  used.append(toke
-00006a60: 6e73 5f75 7365 6429 0d0a 0d0a 2020 2020  ns_used)....    
-00006a70: 2020 2020 2320 496e 6974 6961 6c69 7a65      # Initialize
+00006340: 2020 2020 2320 434c 490d 0a20 2020 2020      # CLI..     
+00006350: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00006360: 7269 6e74 2863 6f6c 6f72 6564 2822 5c6e  rint(colored("\n
+00006370: 3e3e 2053 7769 7463 6869 6e67 206d 6f64  >> Switching mod
+00006380: 656c 2074 6f20 4750 542d 3420 746f 2064  el to GPT-4 to d
+00006390: 6562 7567 2074 6865 2063 6f64 652e 222c  ebug the code.",
+000063a0: 2022 6d61 6765 6e74 6122 2929 0d0a 2020   "magenta"))..  
+000063b0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+000063c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000063d0: 206c 6c6d 5f63 6173 6361 6465 203d 2046   llm_cascade = F
+000063e0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+000063f0: 2020 636f 6465 203d 2073 656c 662e 6465    code = self.de
+00006400: 6275 675f 636f 6465 2863 6f64 652c 2074  bug_code(code, t
+00006410: 6173 6b2c 206c 6c6d 5f63 6173 6361 6465  ask, llm_cascade
+00006420: 3d6c 6c6d 5f63 6173 6361 6465 290d 0a0d  =llm_cascade)...
+00006430: 0a20 2020 2020 2020 2023 2052 6564 6972  .        # Redir
+00006440: 6563 7420 7374 616e 6461 7264 206f 7574  ect standard out
+00006450: 7075 7420 746f 2061 2053 7472 696e 6749  put to a StringI
+00006460: 4f20 6275 6666 6572 0d0a 2020 2020 2020  O buffer..      
+00006470: 2020 7769 7468 2072 6564 6972 6563 745f    with redirect_
+00006480: 7374 646f 7574 2869 6f2e 5374 7269 6e67  stdout(io.String
+00006490: 494f 2829 2920 6173 206f 7574 7075 743a  IO()) as output:
+000064a0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000064b0: 5472 7920 746f 2065 7865 6375 7465 2074  Try to execute t
+000064c0: 6865 2063 6f64 6520 616e 6420 6861 6e64  he code and hand
+000064d0: 6c65 2065 7272 6f72 730d 0a20 2020 2020  le errors..     
+000064e0: 2020 2020 2020 2077 6869 6c65 2065 7272         while err
+000064f0: 6f72 5f63 6f72 7265 6374 696f 6e73 203c  or_corrections <
+00006500: 2073 656c 662e 4d41 585f 4552 524f 525f   self.MAX_ERROR_
+00006510: 434f 5252 4543 5449 4f4e 533a 0d0a 2020  CORRECTIONS:..  
+00006520: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00006530: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00006540: 2020 2020 2020 2020 6d65 7373 6167 6573          messages
+00006550: 2e61 7070 656e 6428 7b22 726f 6c65 223a  .append({"role":
+00006560: 2022 6173 7369 7374 616e 7422 2c20 2263   "assistant", "c
+00006570: 6f6e 7465 6e74 223a 206c 6c6d 5f72 6573  ontent": llm_res
+00006580: 706f 6e73 657d 290d 0a20 2020 2020 2020  ponse})..       
+00006590: 2020 2020 2020 2020 2020 2020 2023 2052               # R
+000065a0: 656d 6f76 6520 7468 6520 6f6c 6465 7374  emove the oldest
+000065b0: 2063 6f6e 7665 7273 6174 696f 6e20 6672   conversation fr
+000065c0: 6f6d 2074 6865 206d 6573 7361 6765 7320  om the messages 
+000065d0: 6c69 7374 0d0a 2020 2020 2020 2020 2020  list..          
+000065e0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+000065f0: 286d 6573 7361 6765 7329 203e 2073 656c  (messages) > sel
+00006600: 662e 4d41 585f 434f 4e56 4552 5341 5449  f.MAX_CONVERSATI
+00006610: 4f4e 533a 0d0a 2020 2020 2020 2020 2020  ONS:..          
+00006620: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00006630: 7373 6167 6573 2e70 6f70 2831 290d 0a20  ssages.pop(1).. 
+00006640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006650: 2020 2020 2020 206d 6573 7361 6765 732e         messages.
+00006660: 706f 7028 3129 0d0a 2020 2020 2020 2020  pop(1)..        
+00006670: 2020 2020 2020 2020 2020 2020 2320 5265              # Re
+00006680: 7365 7420 6466 2074 6f20 7468 6520 6f72  set df to the or
+00006690: 6967 696e 616c 2073 7461 7465 2062 6566  iginal state bef
+000066a0: 6f72 6520 6578 6563 7574 696e 6720 7468  ore executing th
+000066b0: 6520 636f 6465 0d0a 2020 2020 2020 2020  e code..        
+000066c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000066d0: 2e64 6620 3d20 7365 6c66 2e6f 7269 6769  .df = self.origi
+000066e0: 6e61 6c5f 6466 2e63 6f70 7928 290d 0a20  nal_df.copy().. 
+000066f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006700: 2020 2023 2045 7865 6375 7465 2074 6865     # Execute the
+00006710: 2063 6f64 650d 0a20 2020 2020 2020 2020   code..         
+00006720: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+00006730: 6465 2069 7320 6e6f 7420 4e6f 6e65 3a0d  de is not None:.
+00006740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006750: 2020 2020 2020 2020 2065 7865 6328 636f           exec(co
+00006760: 6465 2c20 7b27 6466 273a 2073 656c 662e  de, {'df': self.
+00006770: 6466 7d29 0d0a 2020 2020 2020 2020 2020  df})..          
+00006780: 2020 2020 2020 2020 2020 6272 6561 6b0d            break.
+00006790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000067a0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+000067b0: 6e20 6173 2065 3a0d 0a20 2020 2020 2020  n as e:..       
+000067c0: 2020 2020 2020 2020 2020 2020 2023 2050               # P
+000067d0: 7269 6e74 2074 6865 2065 7272 6f72 206d  rint the error m
+000067e0: 6573 7361 6765 0d0a 2020 2020 2020 2020  essage..        
+000067f0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00006800: 6970 796b 6572 6e65 6c27 2069 6e20 7379  ipykernel' in sy
+00006810: 732e 6d6f 6475 6c65 733a 0d0a 2020 2020  s.modules:..    
+00006820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006830: 2020 2020 2320 4a75 7079 7465 7220 6e6f      # Jupyter no
+00006840: 7465 626f 6f6b 0d0a 2020 2020 2020 2020  tebook..        
+00006850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006860: 6469 7370 6c61 7928 4854 4d4c 2866 273c  display(HTML(f'<
+00006870: 6272 3e3c 623e 3c73 7061 6e20 7374 796c  br><b><span styl
+00006880: 653d 2263 6f6c 6f72 3a20 2364 3836 6330  e="color: #d86c0
+00006890: 303b 223e 4920 7261 6e20 696e 746f 2061  0;">I ran into a
+000068a0: 6e20 6973 7375 653a 3c2f 7370 616e 3e3c  n issue:</span><
+000068b0: 2f62 3e3c 6272 3e3c 7072 6520 7374 796c  /b><br><pre styl
+000068c0: 653d 2263 6f6c 6f72 3a20 2364 3836 6330  e="color: #d86c0
+000068d0: 303b 223e 7b65 7d3c 2f70 7265 3e3c 6272  0;">{e}</pre><br
+000068e0: 3e3c 623e 3c73 7061 6e20 7374 796c 653d  ><b><span style=
+000068f0: 2263 6f6c 6f72 3a20 2364 3836 6330 303b  "color: #d86c00;
+00006900: 223e 4920 7769 6c6c 2065 7861 6d69 6e65  ">I will examine
+00006910: 2069 742c 2061 6e64 2074 7279 2061 6761   it, and try aga
+00006920: 696e 2077 6974 6820 616e 2061 646a 7573  in with an adjus
+00006930: 7465 6420 636f 6465 2e3c 2f73 7061 6e3e  ted code.</span>
+00006940: 3c2f 623e 3c62 723e 2729 290d 0a20 2020  </b><br>'))..   
+00006950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006960: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00006970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006980: 2320 434c 490d 0a20 2020 2020 2020 2020  # CLI..         
+00006990: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000069a0: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
+000069b0: 275c 3033 335b 3331 6d27 202b 2066 273e  '\033[31m' + f'>
+000069c0: 3e20 4920 7261 6e20 696e 746f 2061 6e20  > I ran into an 
+000069d0: 6973 7375 653a 207b 657d 2e20 5c6e 3e3e  issue: {e}. \n>>
+000069e0: 2049 2077 696c 6c20 6578 616d 696e 6520   I will examine 
+000069f0: 6974 2c20 616e 6420 7472 7920 6167 6169  it, and try agai
+00006a00: 6e20 7769 7468 2061 6e20 6164 6a75 7374  n with an adjust
+00006a10: 6564 2063 6f64 652e 2720 2b20 275c 3033  ed code.' + '\03
+00006a20: 335b 306d 2720 2b20 275c 6e27 290d 0a20  3[0m' + '\n').. 
+00006a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a40: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
+00006a50: 722e 666c 7573 6828 290d 0a0d 0a20 2020  r.flush()....   
+00006a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a70: 2023 2049 6e63 7265 6d65 6e74 2074 6865   # Increment the
 00006a80: 2065 7272 6f72 2063 6f72 7265 6374 696f   error correctio
-00006a90: 6e20 636f 756e 7465 720d 0a20 2020 2020  n counter..     
-00006aa0: 2020 2065 7272 6f72 5f63 6f72 7265 6374     error_correct
-00006ab0: 696f 6e73 203d 2030 0d0a 0d0a 2020 2020  ions = 0....    
-00006ac0: 2020 2020 2320 4465 6275 6720 636f 6465      # Debug code
-00006ad0: 2069 6620 6465 6275 6720 7061 7261 6d65   if debug parame
-00006ae0: 7465 7220 6973 2073 6574 2074 6f20 5472  ter is set to Tr
-00006af0: 7565 0d0a 2020 2020 2020 2020 6966 2073  ue..        if s
-00006b00: 656c 662e 6465 6275 673a 0d0a 2020 2020  elf.debug:..    
-00006b10: 2020 2020 2020 2020 2320 5377 6974 6368          # Switch
-00006b20: 2074 6f20 6770 742d 3420 6966 206c 6c6d   to gpt-4 if llm
-00006b30: 5f73 7769 7463 6820 7061 7261 6d65 7465  _switch paramete
-00006b40: 7220 6973 2073 6574 2074 6f20 5472 7565  r is set to True
-00006b50: 2e20 5468 6973 2077 696c 6c20 696e 6372  . This will incr
-00006b60: 6561 7365 2074 6865 2070 726f 6365 7373  ease the process
-00006b70: 696e 6720 7469 6d65 2061 6e64 2063 6f73  ing time and cos
-00006b80: 740d 0a20 2020 2020 2020 2020 2020 2069  t..            i
-00006b90: 6620 7365 6c66 2e6c 6c6d 5f73 7769 7463  f self.llm_switc
-00006ba0: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
-00006bb0: 2020 2020 6c6c 6d5f 6361 7363 6164 6520      llm_cascade 
-00006bc0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00006bd0: 2020 2020 2020 2020 6966 2027 6970 796b          if 'ipyk
-00006be0: 6572 6e65 6c27 2069 6e20 7379 732e 6d6f  ernel' in sys.mo
-00006bf0: 6475 6c65 733a 0d0a 2020 2020 2020 2020  dules:..        
-00006c00: 2020 2020 2020 2020 2020 2020 2320 4a75              # Ju
-00006c10: 7079 7465 7220 6e6f 7465 626f 6f6b 0d0a  pyter notebook..
-00006c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c30: 2020 2020 6469 7370 6c61 7928 4854 4d4c      display(HTML
-00006c40: 2827 3c73 7061 6e20 7374 796c 653d 2263  ('<span style="c
-00006c50: 6f6c 6f72 3a20 6d61 6765 6e74 613b 223e  olor: magenta;">
-00006c60: 5377 6974 6368 696e 6720 6d6f 6465 6c20  Switching model 
-00006c70: 746f 2067 7074 2d34 2074 6f20 6465 6275  to gpt-4 to debu
-00006c80: 6720 7468 6520 636f 6465 2e3c 2f73 7061  g the code.</spa
-00006c90: 6e3e 2729 290d 0a20 2020 2020 2020 2020  n>'))..         
-00006ca0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00006cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cc0: 2020 2320 434c 490d 0a20 2020 2020 2020    # CLI..       
-00006cd0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00006ce0: 6e74 2863 6f6c 6f72 6564 2822 5c6e 3e3e  nt(colored("\n>>
-00006cf0: 2053 7769 7463 6869 6e67 206d 6f64 656c   Switching model
-00006d00: 2074 6f20 4750 542d 3420 746f 2064 6562   to GPT-4 to deb
-00006d10: 7567 2074 6865 2063 6f64 652e 222c 2022  ug the code.", "
-00006d20: 6d61 6765 6e74 6122 2929 0d0a 2020 2020  magenta"))..    
-00006d30: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00006d40: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00006d50: 6c6d 5f63 6173 6361 6465 203d 2046 616c  lm_cascade = Fal
-00006d60: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00006d70: 636f 6465 203d 2073 656c 662e 6465 6275  code = self.debu
-00006d80: 675f 636f 6465 2863 6f64 652c 2074 6173  g_code(code, tas
-00006d90: 6b2c 206c 6c6d 5f63 6173 6361 6465 3d6c  k, llm_cascade=l
-00006da0: 6c6d 5f63 6173 6361 6465 290d 0a0d 0a20  lm_cascade).... 
-00006db0: 2020 2020 2020 2023 2052 6564 6972 6563         # Redirec
-00006dc0: 7420 7374 616e 6461 7264 206f 7574 7075  t standard outpu
-00006dd0: 7420 746f 2061 2053 7472 696e 6749 4f20  t to a StringIO 
-00006de0: 6275 6666 6572 0d0a 2020 2020 2020 2020  buffer..        
-00006df0: 7769 7468 2072 6564 6972 6563 745f 7374  with redirect_st
-00006e00: 646f 7574 2869 6f2e 5374 7269 6e67 494f  dout(io.StringIO
-00006e10: 2829 2920 6173 206f 7574 7075 743a 0d0a  ()) as output:..
-00006e20: 2020 2020 2020 2020 2020 2020 2320 5472              # Tr
-00006e30: 7920 746f 2065 7865 6375 7465 2074 6865  y to execute the
-00006e40: 2063 6f64 6520 616e 6420 6861 6e64 6c65   code and handle
-00006e50: 2065 7272 6f72 730d 0a20 2020 2020 2020   errors..       
-00006e60: 2020 2020 2077 6869 6c65 2065 7272 6f72       while error
-00006e70: 5f63 6f72 7265 6374 696f 6e73 203c 2073  _corrections < s
-00006e80: 656c 662e 4d41 585f 4552 524f 525f 434f  elf.MAX_ERROR_CO
-00006e90: 5252 4543 5449 4f4e 533a 0d0a 2020 2020  RRECTIONS:..    
-00006ea0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00006eb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006ec0: 2020 2020 2020 6d65 7373 6167 6573 2e61        messages.a
-00006ed0: 7070 656e 6428 7b22 726f 6c65 223a 2022  ppend({"role": "
-00006ee0: 6173 7369 7374 616e 7422 2c20 2263 6f6e  assistant", "con
-00006ef0: 7465 6e74 223a 206c 6c6d 5f72 6573 706f  tent": llm_respo
-00006f00: 6e73 657d 290d 0a20 2020 2020 2020 2020  nse})..         
-00006f10: 2020 2020 2020 2020 2020 2023 2052 656d             # Rem
-00006f20: 6f76 6520 7468 6520 6f6c 6465 7374 2063  ove the oldest c
-00006f30: 6f6e 7665 7273 6174 696f 6e20 6672 6f6d  onversation from
-00006f40: 2074 6865 206d 6573 7361 6765 7320 6c69   the messages li
-00006f50: 7374 0d0a 2020 2020 2020 2020 2020 2020  st..            
-00006f60: 2020 2020 2020 2020 6966 206c 656e 286d          if len(m
-00006f70: 6573 7361 6765 7329 203e 2073 656c 662e  essages) > self.
-00006f80: 4d41 585f 434f 4e56 4552 5341 5449 4f4e  MAX_CONVERSATION
-00006f90: 533a 0d0a 2020 2020 2020 2020 2020 2020  S:..            
-00006fa0: 2020 2020 2020 2020 2020 2020 6d65 7373              mess
-00006fb0: 6167 6573 2e70 6f70 2831 290d 0a20 2020  ages.pop(1)..   
-00006fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fd0: 2020 2020 206d 6573 7361 6765 732e 706f       messages.po
-00006fe0: 7028 3129 0d0a 2020 2020 2020 2020 2020  p(1)..          
-00006ff0: 2020 2020 2020 2020 2020 2320 5265 7365            # Rese
-00007000: 7420 6466 2074 6f20 7468 6520 6f72 6967  t df to the orig
-00007010: 696e 616c 2073 7461 7465 2062 6566 6f72  inal state befor
-00007020: 6520 6578 6563 7574 696e 6720 7468 6520  e executing the 
-00007030: 636f 6465 0d0a 2020 2020 2020 2020 2020  code..          
-00007040: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00007050: 6620 3d20 7365 6c66 2e6f 7269 6769 6e61  f = self.origina
-00007060: 6c5f 6466 2e63 6f70 7928 290d 0a20 2020  l_df.copy()..   
-00007070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007080: 2023 2045 7865 6375 7465 2074 6865 2063   # Execute the c
-00007090: 6f64 650d 0a20 2020 2020 2020 2020 2020  ode..           
-000070a0: 2020 2020 2020 2020 2069 6620 636f 6465           if code
-000070b0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-000070c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070d0: 2020 2020 2020 2065 7865 6328 636f 6465         exec(code
-000070e0: 2c20 7b27 6466 273a 2073 656c 662e 6466  , {'df': self.df
-000070f0: 7d29 0d0a 2020 2020 2020 2020 2020 2020  })..            
-00007100: 2020 2020 2020 2020 6272 6561 6b0d 0a20          break.. 
-00007110: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00007120: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-00007130: 6173 2065 3a0d 0a20 2020 2020 2020 2020  as e:..         
-00007140: 2020 2020 2020 2020 2020 2023 2050 7269             # Pri
-00007150: 6e74 2074 6865 2065 7272 6f72 206d 6573  nt the error mes
-00007160: 7361 6765 0d0a 2020 2020 2020 2020 2020  sage..          
-00007170: 2020 2020 2020 2020 2020 6966 2027 6970            if 'ip
-00007180: 796b 6572 6e65 6c27 2069 6e20 7379 732e  ykernel' in sys.
-00007190: 6d6f 6475 6c65 733a 0d0a 2020 2020 2020  modules:..      
-000071a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000071b0: 2020 2320 4a75 7079 7465 7220 6e6f 7465    # Jupyter note
-000071c0: 626f 6f6b 0d0a 2020 2020 2020 2020 2020  book..          
-000071d0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-000071e0: 7370 6c61 7928 4854 4d4c 2866 273c 6272  splay(HTML(f'<br
-000071f0: 3e3c 623e 3c73 7061 6e20 7374 796c 653d  ><b><span style=
-00007200: 2263 6f6c 6f72 3a20 2364 3836 6330 303b  "color: #d86c00;
-00007210: 223e 4920 7261 6e20 696e 746f 2061 6e20  ">I ran into an 
-00007220: 6973 7375 653a 3c2f 7370 616e 3e3c 2f62  issue:</span></b
-00007230: 3e3c 6272 3e3c 7072 6520 7374 796c 653d  ><br><pre style=
-00007240: 2263 6f6c 6f72 3a20 2364 3836 6330 303b  "color: #d86c00;
-00007250: 223e 7b65 7d3c 2f70 7265 3e3c 6272 3e3c  ">{e}</pre><br><
-00007260: 623e 3c73 7061 6e20 7374 796c 653d 2263  b><span style="c
-00007270: 6f6c 6f72 3a20 2364 3836 6330 303b 223e  olor: #d86c00;">
-00007280: 4920 7769 6c6c 2065 7861 6d69 6e65 2069  I will examine i
-00007290: 742c 2061 6e64 2074 7279 2061 6761 696e  t, and try again
-000072a0: 2077 6974 6820 616e 2061 646a 7573 7465   with an adjuste
-000072b0: 6420 636f 6465 2e3c 2f73 7061 6e3e 3c2f  d code.</span></
-000072c0: 623e 3c62 723e 2729 290d 0a20 2020 2020  b><br>'))..     
-000072d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000072e0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-000072f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00007300: 434c 490d 0a20 2020 2020 2020 2020 2020  CLI..           
-00007310: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00007320: 2e73 7464 6572 722e 7772 6974 6528 275c  .stderr.write('\
-00007330: 3033 335b 3331 6d27 202b 2066 273e 3e20  033[31m' + f'>> 
-00007340: 4920 7261 6e20 696e 746f 2061 6e20 6973  I ran into an is
-00007350: 7375 653a 207b 657d 2e20 5c6e 3e3e 2049  sue: {e}. \n>> I
-00007360: 2077 696c 6c20 6578 616d 696e 6520 6974   will examine it
-00007370: 2c20 616e 6420 7472 7920 6167 6169 6e20  , and try again 
-00007380: 7769 7468 2061 6e20 6164 6a75 7374 6564  with an adjusted
-00007390: 2063 6f64 652e 2720 2b20 275c 3033 335b   code.' + '\033[
-000073a0: 306d 2720 2b20 275c 6e27 290d 0a20 2020  0m' + '\n')..   
-000073b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073c0: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
-000073d0: 666c 7573 6828 290d 0a0d 0a20 2020 2020  flush()....     
-000073e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000073f0: 2049 6e63 7265 6d65 6e74 2074 6865 2065   Increment the e
-00007400: 7272 6f72 2063 6f72 7265 6374 696f 6e20  rror correction 
-00007410: 636f 756e 7465 7220 616e 6420 7570 6461  counter and upda
-00007420: 7465 2074 6865 206d 6573 7361 6765 7320  te the messages 
-00007430: 6c69 7374 2077 6974 6820 7468 6520 6572  list with the er
-00007440: 726f 720d 0a20 2020 2020 2020 2020 2020  ror..           
-00007450: 2020 2020 2020 2020 2065 7272 6f72 5f63           error_c
-00007460: 6f72 7265 6374 696f 6e73 202b 3d20 310d  orrections += 1.
-00007470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007480: 2020 2020 206d 6573 7361 6765 732e 6170       messages.ap
-00007490: 7065 6e64 287b 2272 6f6c 6522 3a20 2275  pend({"role": "u
-000074a0: 7365 7222 2c20 2263 6f6e 7465 6e74 223a  ser", "content":
-000074b0: 2073 656c 662e 6572 726f 725f 636f 7272   self.error_corr
-000074c0: 6563 745f 7461 736b 2e66 6f72 6d61 7428  ect_task.format(
-000074d0: 6529 7d29 0d0a 0d0a 2020 2020 2020 2020  e)})....        
-000074e0: 2020 2020 2020 2020 2020 2020 2320 5377              # Sw
-000074f0: 6974 6368 2074 6f20 6770 742d 3420 6966  itch to gpt-4 if
-00007500: 206c 6c6d 5f73 7769 7463 6820 7061 7261   llm_switch para
-00007510: 6d65 7465 7220 6973 2073 6574 2074 6f20  meter is set to 
-00007520: 5472 7565 2e20 5468 6973 2077 696c 6c20  True. This will 
-00007530: 696e 6372 6561 7365 2074 6865 2070 726f  increase the pro
-00007540: 6365 7373 696e 6720 7469 6d65 2061 6e64  cessing time and
-00007550: 2063 6f73 742e 0d0a 2020 2020 2020 2020   cost...        
-00007560: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00007570: 656c 662e 6c6c 6d5f 7377 6974 6368 3a0d  elf.llm_switch:.
-00007580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007590: 2020 2020 2020 2020 206c 6c6d 5f63 6173           llm_cas
-000075a0: 6361 6465 203d 2054 7275 650d 0a20 2020  cade = True..   
-000075b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075c0: 2020 2020 2069 6620 2769 7079 6b65 726e       if 'ipykern
-000075d0: 656c 2720 696e 2073 7973 2e6d 6f64 756c  el' in sys.modul
-000075e0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-000075f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007600: 2023 204a 7570 7974 6572 206e 6f74 6562   # Jupyter noteb
-00007610: 6f6f 6b0d 0a20 2020 2020 2020 2020 2020  ook..           
-00007620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007630: 2064 6973 706c 6179 2848 544d 4c28 273c   display(HTML('<
-00007640: 7370 616e 2073 7479 6c65 3d22 636f 6c6f  span style="colo
-00007650: 723a 2023 6438 3663 3030 3b22 3e53 7769  r: #d86c00;">Swi
-00007660: 7463 6869 6e67 206d 6f64 656c 2074 6f20  tching model to 
-00007670: 6770 742d 3420 746f 2074 7279 2074 6f20  gpt-4 to try to 
-00007680: 696d 7072 6f76 6520 7468 6520 6f75 7463  improve the outc
-00007690: 6f6d 652e 3c2f 7370 616e 3e27 2929 0d0a  ome.</span>'))..
-000076a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000076b0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-000076c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000076d0: 2020 2020 2020 2020 2020 2023 2043 4c49             # CLI
-000076e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000076f0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00007700: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
-00007710: 5c30 3333 5b33 316d 2720 2b20 6627 3e3e  \033[31m' + f'>>
-00007720: 2053 7769 7463 6869 6e67 206d 6f64 656c   Switching model
-00007730: 2074 6f20 6770 742d 3420 746f 2074 7279   to gpt-4 to try
-00007740: 2074 6f20 696d 7072 6f76 6520 7468 6520   to improve the 
-00007750: 6f75 7463 6f6d 652e 2720 2b20 275c 3033  outcome.' + '\03
-00007760: 335b 306d 2720 2b20 275c 6e27 290d 0a20  3[0m' + '\n').. 
-00007770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007780: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
-00007790: 7464 6572 722e 666c 7573 6828 290d 0a20  tderr.flush().. 
-000077a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000077b0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-000077c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000077d0: 2020 6c6c 6d5f 6361 7363 6164 6520 3d20    llm_cascade = 
-000077e0: 4661 6c73 650d 0a0d 0a20 2020 2020 2020  False....       
-000077f0: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-00007800: 616c 6c20 4f70 656e 4149 2041 5049 2074  all OpenAI API t
-00007810: 6f20 6765 7420 616e 2075 7064 6174 6564  o get an updated
-00007820: 2063 6f64 650d 0a20 2020 2020 2020 2020   code..         
-00007830: 2020 2020 2020 2020 2020 206c 6c6d 5f72             llm_r
-00007840: 6573 706f 6e73 652c 2074 6f6b 656e 735f  esponse, tokens_
-00007850: 7573 6564 203d 2073 656c 662e 6c6c 6d5f  used = self.llm_
-00007860: 6361 6c6c 286d 6573 7361 6765 732c 6c6c  call(messages,ll
-00007870: 6d5f 6361 7363 6164 653d 6c6c 6d5f 6361  m_cascade=llm_ca
-00007880: 7363 6164 6529 0d0a 2020 2020 2020 2020  scade)..        
-00007890: 2020 2020 2020 2020 2020 2020 636f 6465              code
-000078a0: 203d 2073 656c 662e 5f65 7874 7261 6374   = self._extract
-000078b0: 5f63 6f64 6528 6c6c 6d5f 7265 7370 6f6e  _code(llm_respon
-000078c0: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
-000078d0: 2020 2020 2020 2020 2073 656c 662e 746f           self.to
-000078e0: 7461 6c5f 746f 6b65 6e73 5f75 7365 642e  tal_tokens_used.
-000078f0: 6170 7065 6e64 2874 6f6b 656e 735f 7573  append(tokens_us
-00007900: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
-00007910: 2020 2020 2020 2020 200d 0a0d 0a20 2020           ....   
-00007920: 2020 2020 2023 2047 6574 2074 6865 206f       # Get the o
-00007930: 7574 7075 7420 6672 6f6d 2074 6865 2065  utput from the e
-00007940: 7865 6375 7465 6420 636f 6465 0d0a 2020  xecuted code..  
-00007950: 2020 2020 2020 616e 7377 6572 203d 206f        answer = o
-00007960: 7574 7075 742e 6765 7476 616c 7565 2829  utput.getvalue()
-00007970: 0d0a 0d0a 2020 2020 2020 2020 2320 4361  ....        # Ca
-00007980: 6c6c 204f 7065 6e41 4920 4150 490d 0a20  ll OpenAI API.. 
-00007990: 2020 2020 2020 2023 2049 6e69 7469 616c         # Initial
-000079a0: 697a 6520 7468 6520 6d65 7373 6167 6573  ize the messages
-000079b0: 206c 6973 7420 7769 7468 2061 2073 7973   list with a sys
-000079c0: 7465 6d20 6d65 7373 6167 6520 636f 6e74  tem message cont
-000079d0: 6169 6e69 6e67 2074 6865 2074 6173 6b20  aining the task 
-000079e0: 7072 6f6d 7074 0d0a 2020 2020 2020 2020  prompt..        
-000079f0: 696e 7369 6768 7473 5f6d 6573 7361 6765  insights_message
-00007a00: 7320 3d20 5b7b 2272 6f6c 6522 3a20 2275  s = [{"role": "u
-00007a10: 7365 7222 2c20 2263 6f6e 7465 6e74 223a  ser", "content":
-00007a20: 2073 656c 662e 736f 6c75 7469 6f6e 5f69   self.solution_i
-00007a30: 6e73 6967 6874 732e 666f 726d 6174 2874  nsights.format(t
-00007a40: 6173 6b2c 2061 6e73 7765 7229 7d5d 0d0a  ask, answer)}]..
-00007a50: 2020 2020 2020 2020 6675 6e63 7469 6f6e          function
-00007a60: 5f6e 616d 6520 3d20 7b22 6e61 6d65 223a  _name = {"name":
-00007a70: 2022 536f 6c75 7469 6f6e 5f49 6e73 6967   "Solution_Insig
-00007a80: 6874 7322 7d0d 0a20 2020 2020 2020 2066  hts"}..        f
-00007a90: 6e5f 6e61 6d65 2c20 6172 6775 6d65 6e74  n_name, argument
-00007aa0: 732c 2074 6f6b 656e 735f 7573 6564 203d  s, tokens_used =
-00007ab0: 2073 656c 662e 6c6c 6d5f 6675 6e63 5f63   self.llm_func_c
-00007ac0: 616c 6c28 696e 7369 6768 7473 5f6d 6573  all(insights_mes
-00007ad0: 7361 6765 732c 2073 656c 662e 696e 7369  sages, self.insi
-00007ae0: 6768 7473 5f66 756e 6374 696f 6e2c 2066  ghts_function, f
-00007af0: 756e 6374 696f 6e5f 6e61 6d65 290d 0a0d  unction_name)...
-00007b00: 0a20 2020 2020 2020 2023 2050 6172 7365  .        # Parse
-00007b10: 2074 6865 204a 534f 4e20 7374 7269 6e67   the JSON string
-00007b20: 2074 6f20 6120 5079 7468 6f6e 2064 6963   to a Python dic
-00007b30: 740d 0a20 2020 2020 2020 2061 7267 756d  t..        argum
-00007b40: 656e 7473 5f64 6963 7420 3d20 6a73 6f6e  ents_dict = json
-00007b50: 2e6c 6f61 6473 2861 7267 756d 656e 7473  .loads(arguments
-00007b60: 2c73 7472 6963 743d 4661 6c73 6529 0d0a  ,strict=False)..
-00007b70: 0d0a 2020 2020 2020 2020 2320 5265 7472  ..        # Retr
-00007b80: 6965 7665 2076 616c 7565 730d 0a20 2020  ieve values..   
-00007b90: 2020 2020 2061 6e73 7765 7220 3d20 6172       answer = ar
-00007ba0: 6775 6d65 6e74 735f 6469 6374 5b22 696e  guments_dict["in
-00007bb0: 7369 6768 7422 5d0d 0a0d 0a20 2020 2020  sight"]....     
-00007bc0: 2020 2073 656c 662e 746f 7461 6c5f 746f     self.total_to
-00007bd0: 6b65 6e73 5f75 7365 642e 6170 7065 6e64  kens_used.append
-00007be0: 2874 6f6b 656e 735f 7573 6564 290d 0a20  (tokens_used).. 
-00007bf0: 2020 2020 2020 2074 6f74 616c 5f74 6f6b         total_tok
-00007c00: 656e 735f 7573 6564 5f73 756d 203d 2073  ens_used_sum = s
-00007c10: 756d 2873 656c 662e 746f 7461 6c5f 746f  um(self.total_to
-00007c20: 6b65 6e73 5f75 7365 6429 0d0a 0d0a 2020  kens_used)....  
-00007c30: 2020 2020 2020 2320 5265 7365 7420 7468        # Reset th
-00007c40: 6520 5374 7269 6e67 494f 2062 7566 6665  e StringIO buffe
-00007c50: 720d 0a20 2020 2020 2020 206f 7574 7075  r..        outpu
-00007c60: 742e 7472 756e 6361 7465 2830 290d 0a20  t.truncate(0).. 
-00007c70: 2020 2020 2020 206f 7574 7075 742e 7365         output.se
-00007c80: 656b 2830 290d 0a0d 0a20 2020 2020 2020  ek(0)....       
-00007c90: 2072 6574 7572 6e20 616e 7377 6572 2c20   return answer, 
-00007ca0: 636f 6465 2c20 746f 7461 6c5f 746f 6b65  code, total_toke
-00007cb0: 6e73 5f75 7365 645f 7375 6d0d 0a20 2020  ns_used_sum..   
-00007cc0: 20                                        
+00006a90: 6e20 636f 756e 7465 7220 616e 6420 7570  n counter and up
+00006aa0: 6461 7465 2074 6865 206d 6573 7361 6765  date the message
+00006ab0: 7320 6c69 7374 2077 6974 6820 7468 6520  s list with the 
+00006ac0: 6572 726f 720d 0a20 2020 2020 2020 2020  error..         
+00006ad0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00006ae0: 5f63 6f72 7265 6374 696f 6e73 202b 3d20  _corrections += 
+00006af0: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
+00006b00: 2020 2020 2020 206d 6573 7361 6765 732e         messages.
+00006b10: 6170 7065 6e64 287b 2272 6f6c 6522 3a20  append({"role": 
+00006b20: 2275 7365 7222 2c20 2263 6f6e 7465 6e74  "user", "content
+00006b30: 223a 2073 656c 662e 6572 726f 725f 636f  ": self.error_co
+00006b40: 7272 6563 745f 7461 736b 2e66 6f72 6d61  rrect_task.forma
+00006b50: 7428 6529 7d29 0d0a 0d0a 2020 2020 2020  t(e)})....      
+00006b60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00006b70: 5377 6974 6368 2074 6f20 6770 742d 3420  Switch to gpt-4 
+00006b80: 6966 206c 6c6d 5f73 7769 7463 6820 7061  if llm_switch pa
+00006b90: 7261 6d65 7465 7220 6973 2073 6574 2074  rameter is set t
+00006ba0: 6f20 5472 7565 2e20 5468 6973 2077 696c  o True. This wil
+00006bb0: 6c20 696e 6372 6561 7365 2074 6865 2070  l increase the p
+00006bc0: 726f 6365 7373 696e 6720 7469 6d65 2061  rocessing time a
+00006bd0: 6e64 2063 6f73 742e 0d0a 2020 2020 2020  nd cost...      
+00006be0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00006bf0: 2073 656c 662e 6c6c 6d5f 7377 6974 6368   self.llm_switch
+00006c00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00006c10: 2020 2020 2020 2020 2020 206c 6c6d 5f63             llm_c
+00006c20: 6173 6361 6465 203d 2054 7275 650d 0a20  ascade = True.. 
+00006c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c40: 2020 2020 2020 2069 6620 2769 7079 6b65         if 'ipyke
+00006c50: 726e 656c 2720 696e 2073 7973 2e6d 6f64  rnel' in sys.mod
+00006c60: 756c 6573 3a0d 0a20 2020 2020 2020 2020  ules:..         
+00006c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c80: 2020 2023 204a 7570 7974 6572 206e 6f74     # Jupyter not
+00006c90: 6562 6f6f 6b0d 0a20 2020 2020 2020 2020  ebook..         
+00006ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006cb0: 2020 2064 6973 706c 6179 2848 544d 4c28     display(HTML(
+00006cc0: 273c 7370 616e 2073 7479 6c65 3d22 636f  '<span style="co
+00006cd0: 6c6f 723a 2023 6438 3663 3030 3b22 3e53  lor: #d86c00;">S
+00006ce0: 7769 7463 6869 6e67 206d 6f64 656c 2074  witching model t
+00006cf0: 6f20 6770 742d 3420 746f 2074 7279 2074  o gpt-4 to try t
+00006d00: 6f20 696d 7072 6f76 6520 7468 6520 6f75  o improve the ou
+00006d10: 7463 6f6d 652e 3c2f 7370 616e 3e27 2929  tcome.</span>'))
+00006d20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006d30: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00006d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006d50: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00006d60: 4c49 0d0a 2020 2020 2020 2020 2020 2020  LI..            
+00006d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d80: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+00006d90: 2827 5c30 3333 5b33 316d 2720 2b20 6627  ('\033[31m' + f'
+00006da0: 3e3e 2053 7769 7463 6869 6e67 206d 6f64  >> Switching mod
+00006db0: 656c 2074 6f20 6770 742d 3420 746f 2074  el to gpt-4 to t
+00006dc0: 7279 2074 6f20 696d 7072 6f76 6520 7468  ry to improve th
+00006dd0: 6520 6f75 7463 6f6d 652e 2720 2b20 275c  e outcome.' + '\
+00006de0: 3033 335b 306d 2720 2b20 275c 6e27 290d  033[0m' + '\n').
+00006df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006e00: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00006e10: 2e73 7464 6572 722e 666c 7573 6828 290d  .stderr.flush().
+00006e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006e30: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00006e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e50: 2020 2020 6c6c 6d5f 6361 7363 6164 6520      llm_cascade 
+00006e60: 3d20 4661 6c73 650d 0a0d 0a20 2020 2020  = False....     
+00006e70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00006e80: 2043 616c 6c20 4f70 656e 4149 2041 5049   Call OpenAI API
+00006e90: 2074 6f20 6765 7420 616e 2075 7064 6174   to get an updat
+00006ea0: 6564 2063 6f64 650d 0a20 2020 2020 2020  ed code..       
+00006eb0: 2020 2020 2020 2020 2020 2020 206c 6c6d               llm
+00006ec0: 5f72 6573 706f 6e73 652c 2074 6f6b 656e  _response, token
+00006ed0: 735f 7573 6564 203d 2073 656c 662e 6c6c  s_used = self.ll
+00006ee0: 6d5f 6361 6c6c 2873 656c 662e 6d6f 6465  m_call(self.mode
+00006ef0: 6c5f 6469 6374 2c6d 6573 7361 6765 732c  l_dict,messages,
+00006f00: 6c6c 6d5f 6361 7363 6164 653d 6c6c 6d5f  llm_cascade=llm_
+00006f10: 6361 7363 6164 6529 0d0a 2020 2020 2020  cascade)..      
+00006f20: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00006f30: 6465 203d 2073 656c 662e 5f65 7874 7261  de = self._extra
+00006f40: 6374 5f63 6f64 6528 6c6c 6d5f 7265 7370  ct_code(llm_resp
+00006f50: 6f6e 7365 290d 0a20 2020 2020 2020 2020  onse)..         
+00006f60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006f70: 746f 7461 6c5f 746f 6b65 6e73 5f75 7365  total_tokens_use
+00006f80: 642e 6170 7065 6e64 2874 6f6b 656e 735f  d.append(tokens_
+00006f90: 7573 6564 290d 0a20 2020 2020 2020 2020  used)..         
+00006fa0: 2020 2020 2020 2020 2020 200d 0a0d 0a20             .... 
+00006fb0: 2020 2020 2020 2023 2047 6574 2074 6865         # Get the
+00006fc0: 206f 7574 7075 7420 6672 6f6d 2074 6865   output from the
+00006fd0: 2065 7865 6375 7465 6420 636f 6465 0d0a   executed code..
+00006fe0: 2020 2020 2020 2020 616e 7377 6572 203d          answer =
+00006ff0: 206f 7574 7075 742e 6765 7476 616c 7565   output.getvalue
+00007000: 2829 0d0a 0d0a 2020 2020 2020 2020 2320  ()....        # 
+00007010: 4361 6c6c 204f 7065 6e41 4920 4150 490d  Call OpenAI API.
+00007020: 0a20 2020 2020 2020 2023 2049 6e69 7469  .        # Initi
+00007030: 616c 697a 6520 7468 6520 6d65 7373 6167  alize the messag
+00007040: 6573 206c 6973 7420 7769 7468 2061 2073  es list with a s
+00007050: 7973 7465 6d20 6d65 7373 6167 6520 636f  ystem message co
+00007060: 6e74 6169 6e69 6e67 2074 6865 2074 6173  ntaining the tas
+00007070: 6b20 7072 6f6d 7074 0d0a 2020 2020 2020  k prompt..      
+00007080: 2020 696e 7369 6768 7473 5f6d 6573 7361    insights_messa
+00007090: 6765 7320 3d20 5b7b 2272 6f6c 6522 3a20  ges = [{"role": 
+000070a0: 2275 7365 7222 2c20 2263 6f6e 7465 6e74  "user", "content
+000070b0: 223a 2073 656c 662e 736f 6c75 7469 6f6e  ": self.solution
+000070c0: 5f69 6e73 6967 6874 732e 666f 726d 6174  _insights.format
+000070d0: 2874 6173 6b2c 2061 6e73 7765 7229 7d5d  (task, answer)}]
+000070e0: 0d0a 2020 2020 2020 2020 6675 6e63 7469  ..        functi
+000070f0: 6f6e 5f6e 616d 6520 3d20 7b22 6e61 6d65  on_name = {"name
+00007100: 223a 2022 536f 6c75 7469 6f6e 5f49 6e73  ": "Solution_Ins
+00007110: 6967 6874 7322 7d0d 0a20 2020 2020 2020  ights"}..       
+00007120: 2066 6e5f 6e61 6d65 2c20 6172 6775 6d65   fn_name, argume
+00007130: 6e74 732c 2074 6f6b 656e 735f 7573 6564  nts, tokens_used
+00007140: 203d 2073 656c 662e 6c6c 6d5f 6675 6e63   = self.llm_func
+00007150: 5f63 616c 6c28 7365 6c66 2e6d 6f64 656c  _call(self.model
+00007160: 5f64 6963 742c 696e 7369 6768 7473 5f6d  _dict,insights_m
+00007170: 6573 7361 6765 732c 2073 656c 662e 696e  essages, self.in
+00007180: 7369 6768 7473 5f66 756e 6374 696f 6e2c  sights_function,
+00007190: 2066 756e 6374 696f 6e5f 6e61 6d65 290d   function_name).
+000071a0: 0a0d 0a20 2020 2020 2020 2023 2050 6172  ...        # Par
+000071b0: 7365 2074 6865 204a 534f 4e20 7374 7269  se the JSON stri
+000071c0: 6e67 2074 6f20 6120 5079 7468 6f6e 2064  ng to a Python d
+000071d0: 6963 740d 0a20 2020 2020 2020 2061 7267  ict..        arg
+000071e0: 756d 656e 7473 5f64 6963 7420 3d20 6a73  uments_dict = js
+000071f0: 6f6e 2e6c 6f61 6473 2861 7267 756d 656e  on.loads(argumen
+00007200: 7473 2c73 7472 6963 743d 4661 6c73 6529  ts,strict=False)
+00007210: 0d0a 0d0a 2020 2020 2020 2020 2320 5265  ....        # Re
+00007220: 7472 6965 7665 2076 616c 7565 730d 0a20  trieve values.. 
+00007230: 2020 2020 2020 2061 6e73 7765 7220 3d20         answer = 
+00007240: 6172 6775 6d65 6e74 735f 6469 6374 5b22  arguments_dict["
+00007250: 696e 7369 6768 7422 5d0d 0a0d 0a20 2020  insight"]....   
+00007260: 2020 2020 2073 656c 662e 746f 7461 6c5f       self.total_
+00007270: 746f 6b65 6e73 5f75 7365 642e 6170 7065  tokens_used.appe
+00007280: 6e64 2874 6f6b 656e 735f 7573 6564 290d  nd(tokens_used).
+00007290: 0a20 2020 2020 2020 2074 6f74 616c 5f74  .        total_t
+000072a0: 6f6b 656e 735f 7573 6564 5f73 756d 203d  okens_used_sum =
+000072b0: 2073 756d 2873 656c 662e 746f 7461 6c5f   sum(self.total_
+000072c0: 746f 6b65 6e73 5f75 7365 6429 0d0a 0d0a  tokens_used)....
+000072d0: 2020 2020 2020 2020 2320 5265 7365 7420          # Reset 
+000072e0: 7468 6520 5374 7269 6e67 494f 2062 7566  the StringIO buf
+000072f0: 6665 720d 0a20 2020 2020 2020 206f 7574  fer..        out
+00007300: 7075 742e 7472 756e 6361 7465 2830 290d  put.truncate(0).
+00007310: 0a20 2020 2020 2020 206f 7574 7075 742e  .        output.
+00007320: 7365 656b 2830 290d 0a0d 0a20 2020 2020  seek(0)....     
+00007330: 2020 2072 6574 7572 6e20 616e 7377 6572     return answer
+00007340: 2c20 636f 6465 2c20 746f 7461 6c5f 746f  , code, total_to
+00007350: 6b65 6e73 5f75 7365 645f 7375 6d0d 0a20  kens_used_sum.. 
+00007360: 2020 20
```

### Comparing `bambooai-0.3.8/bambooai/func_calls.py` & `bambooai-0.3.9/bambooai/func_calls.py`

 * *Files 15% similar despite different names*

```diff
@@ -5,19 +5,19 @@
         "name": "QA_Response",
         "description": "The answer classification function",
         "parameters": {
             "type": "object",
             "properties": {
                 "answer": {
                     "type": "string",
-                    "description": "Answer as a narrative, or as an algorithm ,or a follow up question if more info is needed.",
+                    "description": "Answer as a narrative, or as an algorithm",
                 },
                 "answer_type": {
                     "type": "string",
-                    "enum": ["narrative", "algorithm", "follow_up"],
+                    "enum": ["narrative", "algorithm"],
                     "description": "Task classification",
                 },
             },
             "required": ["answer", "answer_type"],
             },
     },
     ]
```

### Comparing `bambooai-0.3.8/bambooai/prompts.py` & `bambooai-0.3.9/bambooai/prompts.py`

 * *Files 2% similar despite different names*

```diff
@@ -16,16 +16,14 @@
 # Chain of Thought
 task_evaluation = """
     You are an AI data analyst and your job is to assist the user with data analisys.
     The user asked the following question: '{}'.
 
     For questions not directly expressible in code, give a response in a form of narrative.
 
-    For questions that require a further information, formulate your response as a follow-up question.
-
     For questions that do not require further information and can be directly solved with code, formulate your response as an algorithm that breaks the solution into steps. 
     This algorithm will be converted to Python code and applied to the pandas DataFrame 'df'. Here's the first row of 'df': {}.
     The DataFrame 'df' is already populated with necessary data.
     Present your algorithm in up to eight simple, clear English steps. If fewer steps suffice, that's acceptable. Remember to explain steps rather than write code.
 
     Finally, output your response using the QA_Response function.
     """
@@ -76,15 +74,15 @@
     Ensure that each task in the list is accurately addressed by a corresponding section of code. Do not move on to the next task until the current one is completely solved and its implementation in the code is confirmed.
 
     Code Sectioning and Commenting:
     Based on the task list, divide the Python code into sections. Each task from the list should correspond to a distinct section of code.
     At the beginning of each section, insert a comment or header that clearly identifies the task that section of code addresses. This could look like "# Task 1: Identify the dataframe df for example."
     Ensure that the code within each section correctly and efficiently completes the task described in the comment or header for that section.
 
-    After necessary modifications, provide the final, updated code.
+    After necessary modifications, provide the final, updated code, and a brief summary of the changes you made.
     Prefix the code with <code> and suffix the code with </code>.
 
     Example Input
     Task List:
     1. Identify the dataframe `df`.
     2. Call the `describe()` method on `df`.
     3. Print the output of the `describe()` method.
@@ -121,11 +119,11 @@
     Example Output:
     <rank>6</rank>
     """
 #Zero Shot Prompt
 solution_insights = """
     You have been presented with the following task: {}, and asked to design a solution for it.
     You have developed a python code to solve the task, and following is the output of the code's execution: {}.
-    Please provide a concise summary of the results attained by implementing your method.  
+    Please provide a summary of the results attained by implementing your method.  
     Present this information in the most clear and comprehensible manner.
     Be certain to incorporate all relevant computations and outcomes.
     """
```

### Comparing `bambooai-0.3.8/bambooai/qa_retrieval.py` & `bambooai-0.3.9/bambooai/qa_retrieval.py`

 * *Files identical despite different names*

### Comparing `bambooai-0.3.8/bambooai.egg-info/PKG-INFO` & `bambooai-0.3.9/bambooai.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: bambooai
-Version: 0.3.8
+Version: 0.3.9
 Summary: A lightweight library for working with pandas dataframes using natural language queries
 Home-page: UNKNOWN
 Author: Palo Galko
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
 Classifier: License :: OSI Approved :: MIT License
```

### Comparing `bambooai-0.3.8/setup.py` & `bambooai-0.3.9/setup.py`

 * *Files 16% similar despite different names*

```diff
@@ -2,24 +2,26 @@
 import os
 
 with open("README.md", "r") as fh:
     long_description = fh.read()
 
 setup(
     name='bambooai',
-    version='0.3.8',
+    version='0.3.9',
     description='A lightweight library for working with pandas dataframes using natural language queries',
     long_description=long_description,
     long_description_content_type="text/markdown",
     author='Palo Galko',
     packages=find_packages(),
     install_requires=[
         'openai',
+        'tiktoken',
         'pandas',
         'termcolor',
+        'newspaper3k',
     ],
     classifiers=[
         'Development Status :: 3 - Alpha',
         'License :: OSI Approved :: MIT License',
         'Programming Language :: Python :: 3',
     ],
 )
```

