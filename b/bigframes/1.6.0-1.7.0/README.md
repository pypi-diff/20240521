# Comparing `tmp/bigframes-1.6.0.tar.gz` & `tmp/bigframes-1.7.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "bigframes-1.6.0.tar", last modified: Tue May 14 18:04:26 2024, max compression
+gzip compressed data, was "bigframes-1.7.0.tar", last modified: Tue May 21 14:03:51 2024, max compression
```

## Comparing `bigframes-1.6.0.tar` & `bigframes-1.7.0.tar`

### file list

```diff
@@ -1,389 +1,390 @@
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.585627 bigframes-1.6.0/
--rw-rw-r--   0 root         (0)     1003    11358 2024-05-14 18:01:45.000000 bigframes-1.6.0/LICENSE
--rw-rw-r--   0 root         (0)     1003      914 2024-05-14 18:01:45.000000 bigframes-1.6.0/MANIFEST.in
--rw-r--r--   0 root         (0)     1003     4817 2024-05-14 18:04:26.585627 bigframes-1.6.0/PKG-INFO
--rw-rw-r--   0 root         (0)     1003     2391 2024-05-14 18:01:45.000000 bigframes-1.6.0/README.rst
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.509637 bigframes-1.6.0/bigframes/
--rw-rw-r--   0 root         (0)     1003     1216 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.513637 bigframes-1.6.0/bigframes/_config/
--rw-rw-r--   0 root         (0)     1003     4315 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/_config/__init__.py
--rw-rw-r--   0 root         (0)     1003     9229 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/_config/bigquery_options.py
--rw-rw-r--   0 root         (0)     1003     4369 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/_config/compute_options.py
--rw-rw-r--   0 root         (0)     1003     1661 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/_config/display_options.py
--rw-rw-r--   0 root         (0)     1003     1892 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/_config/sampling_options.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.513637 bigframes-1.6.0/bigframes/bigquery/
--rw-rw-r--   0 root         (0)     1003     1730 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/bigquery/__init__.py
--rw-rw-r--   0 root         (0)     1003     7152 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/clients.py
--rw-rw-r--   0 root         (0)     1003     2779 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/constants.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.517636 bigframes-1.6.0/bigframes/core/
--rw-rw-r--   0 root         (0)     1003    18113 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/__init__.py
--rw-rw-r--   0 root         (0)     1003    30581 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/block_transforms.py
--rw-rw-r--   0 root         (0)     1003    99761 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/blocks.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.521636 bigframes-1.6.0/bigframes/core/compile/
--rw-rw-r--   0 root         (0)     1003      832 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/compile/__init__.py
--rw-rw-r--   0 root         (0)     1003    17475 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/compile/aggregate_compiler.py
--rw-rw-r--   0 root         (0)     1003    53105 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/compile/compiled.py
--rw-rw-r--   0 root         (0)     1003     6341 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/compile/compiler.py
--rw-rw-r--   0 root         (0)     1003     3356 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/compile/concat.py
--rw-rw-r--   0 root         (0)     1003    49672 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/compile/scalar_op_compiler.py
--rw-rw-r--   0 root         (0)     1003     7121 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/compile/single_column.py
--rw-rw-r--   0 root         (0)     1003     2962 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/convert.py
--rw-rw-r--   0 root         (0)     1003     2495 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/eval.py
--rw-rw-r--   0 root         (0)     1003     6685 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/expression.py
--rw-rw-r--   0 root         (0)     1003     3887 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/global_session.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.521636 bigframes-1.6.0/bigframes/core/groupby/
--rw-rw-r--   0 root         (0)     1003    24020 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/groupby/__init__.py
--rw-rw-r--   0 root         (0)     1003      716 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/guid.py
--rw-rw-r--   0 root         (0)     1003    18056 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/indexers.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.521636 bigframes-1.6.0/bigframes/core/indexes/
--rw-rw-r--   0 root         (0)     1003      719 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/indexes/__init__.py
--rw-rw-r--   0 root         (0)     1003    16239 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/indexes/base.py
--rw-rw-r--   0 root         (0)     1003     1720 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/indexes/multi.py
--rw-rw-r--   0 root         (0)     1003     1730 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/join_def.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.521636 bigframes-1.6.0/bigframes/core/joins/
--rw-rw-r--   0 root         (0)     1003      691 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/joins/__init__.py
--rw-rw-r--   0 root         (0)     1003     2132 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/joins/merge.py
--rw-rw-r--   0 root         (0)     1003     2218 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/local_data.py
--rw-rw-r--   0 root         (0)     1003     3424 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/log_adapter.py
--rw-rw-r--   0 root         (0)     1003    18515 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/nodes.py
--rw-rw-r--   0 root         (0)     1003     9445 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/ordering.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.521636 bigframes-1.6.0/bigframes/core/reshape/
--rw-rw-r--   0 root         (0)     1003     6902 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/reshape/__init__.py
--rw-rw-r--   0 root         (0)     1003    11714 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/rewrite.py
--rw-rw-r--   0 root         (0)     1003      746 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/scalar.py
--rw-rw-r--   0 root         (0)     1003     2144 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/schema.py
--rw-rw-r--   0 root         (0)     1003     1668 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/sql.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.521636 bigframes-1.6.0/bigframes/core/tools/
--rw-rw-r--   0 root         (0)     1003      664 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/tools/__init__.py
--rw-rw-r--   0 root         (0)     1003     2515 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/tools/datetimes.py
--rw-rw-r--   0 root         (0)     1003     3002 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/tree_properties.py
--rw-rw-r--   0 root         (0)     1003     5483 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/utils.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.521636 bigframes-1.6.0/bigframes/core/window/
--rw-rw-r--   0 root         (0)     1003     3075 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/window/__init__.py
--rw-rw-r--   0 root         (0)     1003     4431 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/core/window_spec.py
--rw-rw-r--   0 root         (0)     1003   134480 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/dataframe.py
--rw-rw-r--   0 root         (0)     1003    27800 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/dtypes.py
--rw-rw-r--   0 root         (0)     1003     1029 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/enums.py
--rw-rw-r--   0 root         (0)     1003     1254 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/exceptions.py
--rw-rw-r--   0 root         (0)     1003     1273 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/features.py
--rw-rw-r--   0 root         (0)     1003    11179 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/formatting_helpers.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.521636 bigframes-1.6.0/bigframes/functions/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/functions/__init__.py
--rw-rw-r--   0 root         (0)     1003    47775 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/functions/remote_function.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.529635 bigframes-1.6.0/bigframes/ml/
--rw-rw-r--   0 root         (0)     1003      877 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/__init__.py
--rw-rw-r--   0 root         (0)     1003     8542 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/base.py
--rw-rw-r--   0 root         (0)     1003     6196 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/cluster.py
--rw-rw-r--   0 root         (0)     1003     8049 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/compose.py
--rw-rw-r--   0 root         (0)     1003    17897 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/core.py
--rw-rw-r--   0 root         (0)     1003     6757 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/decomposition.py
--rw-rw-r--   0 root         (0)     1003    23414 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/ensemble.py
--rw-rw-r--   0 root         (0)     1003    15801 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/forecasting.py
--rw-rw-r--   0 root         (0)     1003     1141 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/globals.py
--rw-rw-r--   0 root         (0)     1003    10837 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/imported.py
--rw-rw-r--   0 root         (0)     1003    12556 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/linear_model.py
--rw-rw-r--   0 root         (0)     1003    31790 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/llm.py
--rw-rw-r--   0 root         (0)     1003     4905 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/loader.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.529635 bigframes-1.6.0/bigframes/ml/metrics/
--rw-rw-r--   0 root         (0)     1003     1066 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/metrics/__init__.py
--rw-rw-r--   0 root         (0)     1003    11096 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/metrics/_metrics.py
--rw-rw-r--   0 root         (0)     1003     2373 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/metrics/pairwise.py
--rw-rw-r--   0 root         (0)     1003     3748 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/model_selection.py
--rw-rw-r--   0 root         (0)     1003     5067 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/pipeline.py
--rw-rw-r--   0 root         (0)     1003    23307 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/preprocessing.py
--rw-rw-r--   0 root         (0)     1003     5773 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/remote.py
--rw-rw-r--   0 root         (0)     1003    14865 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/sql.py
--rw-rw-r--   0 root         (0)     1003     3738 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/ml/utils.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.529635 bigframes-1.6.0/bigframes/operations/
--rw-rw-r--   0 root         (0)     1003    24000 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/operations/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.529635 bigframes-1.6.0/bigframes/operations/_matplotlib/
--rw-rw-r--   0 root         (0)     1003     1022 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/operations/_matplotlib/__init__.py
--rw-rw-r--   0 root         (0)     1003     4477 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/operations/_matplotlib/core.py
--rw-rw-r--   0 root         (0)     1003     5970 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/operations/_matplotlib/hist.py
--rw-rw-r--   0 root         (0)     1003    13346 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/operations/aggregations.py
--rw-rw-r--   0 root         (0)     1003     9947 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/operations/base.py
--rw-rw-r--   0 root         (0)     1003     3079 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/operations/datetimes.py
--rw-rw-r--   0 root         (0)     1003     2814 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/operations/plotting.py
--rw-rw-r--   0 root         (0)     1003     9461 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/operations/strings.py
--rw-rw-r--   0 root         (0)     1003     2089 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/operations/structs.py
--rw-rw-r--   0 root         (0)     1003     7613 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/operations/type.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.533634 bigframes-1.6.0/bigframes/pandas/
--rw-rw-r--   0 root         (0)     1003    26027 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/pandas/__init__.py
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/py.typed
--rw-rw-r--   0 root         (0)     1003    66345 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/series.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.533634 bigframes-1.6.0/bigframes/session/
--rw-rw-r--   0 root         (0)     1003    79388 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/session/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.533634 bigframes-1.6.0/bigframes/session/_io/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/session/_io/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.533634 bigframes-1.6.0/bigframes/session/_io/bigquery/
--rw-rw-r--   0 root         (0)     1003    14297 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/session/_io/bigquery/__init__.py
--rw-rw-r--   0 root         (0)     1003    16559 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/session/_io/bigquery/read_gbq_table.py
--rw-rw-r--   0 root         (0)     1003     4345 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/session/_io/pandas.py
--rw-rw-r--   0 root         (0)     1003     8043 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/session/clients.py
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/typing.py
--rw-rw-r--   0 root         (0)     1003      597 2024-05-14 18:01:45.000000 bigframes-1.6.0/bigframes/version.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.585627 bigframes-1.6.0/bigframes.egg-info/
--rw-r--r--   0 root         (0)     1003     4817 2024-05-14 18:04:26.000000 bigframes-1.6.0/bigframes.egg-info/PKG-INFO
--rw-r--r--   0 root         (0)     1003    12561 2024-05-14 18:04:26.000000 bigframes-1.6.0/bigframes.egg-info/SOURCES.txt
--rw-r--r--   0 root         (0)     1003        1 2024-05-14 18:04:26.000000 bigframes-1.6.0/bigframes.egg-info/dependency_links.txt
--rw-r--r--   0 root         (0)     1003        1 2024-05-14 18:04:26.000000 bigframes-1.6.0/bigframes.egg-info/not-zip-safe
--rw-r--r--   0 root         (0)     1003      749 2024-05-14 18:04:26.000000 bigframes-1.6.0/bigframes.egg-info/requires.txt
--rw-r--r--   0 root         (0)     1003       29 2024-05-14 18:04:26.000000 bigframes-1.6.0/bigframes.egg-info/top_level.txt
--rw-rw-r--   0 root         (0)     1003       81 2024-05-14 18:01:45.000000 bigframes-1.6.0/pyproject.toml
--rw-rw-r--   0 root         (0)     1003       67 2024-05-14 18:04:26.589626 bigframes-1.6.0/setup.cfg
--rw-rw-r--   0 root         (0)     1003     4454 2024-05-14 18:01:45.000000 bigframes-1.6.0/setup.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.533634 bigframes-1.6.0/tests/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.537634 bigframes-1.6.0/tests/data/
--rw-rw-r--   0 root         (0)     1003      619 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/hockey_players.json
--rw-rw-r--   0 root         (0)     1003     1250 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/hockey_players.jsonl
--rw-rw-r--   0 root         (0)     1003      340 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/matrix_2by3.json
--rw-rw-r--   0 root         (0)     1003       80 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/matrix_2by3.jsonl
--rw-rw-r--   0 root         (0)     1003      421 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/matrix_3by4.json
--rw-rw-r--   0 root         (0)     1003      154 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/matrix_3by4.jsonl
--rw-rw-r--   0 root         (0)     1003    33350 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/nested.jsonl
--rw-rw-r--   0 root         (0)     1003      966 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/nested_schema.json
--rw-rw-r--   0 root         (0)     1003    58869 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/penguins.jsonl
--rw-rw-r--   0 root         (0)     1003      636 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/penguins_schema.json
--rw-rw-r--   0 root         (0)     1003     3909 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/scalars.jsonl
--rw-rw-r--   0 root         (0)     1003     1458 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/scalars_schema.json
--rw-rw-r--   0 root         (0)     1003    23424 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/time_series.jsonl
--rw-rw-r--   0 root         (0)     1003      192 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/data/time_series_schema.json
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.537634 bigframes-1.6.0/tests/system/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/__init__.py
--rw-rw-r--   0 root         (0)     1003    37310 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/conftest.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.537634 bigframes-1.6.0/tests/system/large/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.541633 bigframes-1.6.0/tests/system/large/ml/
--rw-rw-r--   0 root         (0)     1003     5411 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/ml/test_cluster.py
--rw-rw-r--   0 root         (0)     1003     5391 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/ml/test_compose.py
--rw-rw-r--   0 root         (0)     1003     6516 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/ml/test_core.py
--rw-rw-r--   0 root         (0)     1003     6487 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/ml/test_decomposition.py
--rw-rw-r--   0 root         (0)     1003    14552 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/ml/test_ensemble.py
--rw-rw-r--   0 root         (0)     1003     4551 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/ml/test_forecasting.py
--rw-rw-r--   0 root         (0)     1003     8408 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/ml/test_linear_model.py
--rw-rw-r--   0 root         (0)     1003    30564 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/ml/test_pipeline.py
--rw-rw-r--   0 root         (0)     1003     4079 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/test_location.py
--rw-rw-r--   0 root         (0)     1003    66919 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/test_remote_function.py
--rw-rw-r--   0 root         (0)     1003     4573 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/large/test_session.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.541633 bigframes-1.6.0/tests/system/load/
--rw-rw-r--   0 root         (0)     1003     3000 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/load/test_large_tables.py
--rw-rw-r--   0 root         (0)     1003     4559 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/load/test_llm.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.545632 bigframes-1.6.0/tests/system/small/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.545632 bigframes-1.6.0/tests/system/small/bigquery/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/bigquery/__init__.py
--rw-rw-r--   0 root         (0)     1003     1154 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/bigquery/test_array.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.549632 bigframes-1.6.0/tests/system/small/ml/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/__init__.py
--rw-rw-r--   0 root         (0)     1003    11773 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/conftest.py
--rw-rw-r--   0 root         (0)     1003     7074 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_cluster.py
--rw-rw-r--   0 root         (0)     1003    13810 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_core.py
--rw-rw-r--   0 root         (0)     1003     6764 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_decomposition.py
--rw-rw-r--   0 root         (0)     1003    17015 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_ensemble.py
--rw-rw-r--   0 root         (0)     1003     6859 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_forecasting.py
--rw-rw-r--   0 root         (0)     1003     4983 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_imported.py
--rw-rw-r--   0 root         (0)     1003     8788 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_linear_model.py
--rw-rw-r--   0 root         (0)     1003    11929 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_llm.py
--rw-rw-r--   0 root         (0)     1003    25138 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_metrics.py
--rw-rw-r--   0 root         (0)     1003     2224 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_metrics_pairwise.py
--rw-rw-r--   0 root         (0)     1003     6197 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_model_selection.py
--rw-rw-r--   0 root         (0)     1003    29304 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_preprocessing.py
--rw-rw-r--   0 root         (0)     1003     2570 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_register.py
--rw-rw-r--   0 root         (0)     1003     1205 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/ml/test_remote.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.553631 bigframes-1.6.0/tests/system/small/operations/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/operations/__init__.py
--rw-rw-r--   0 root         (0)     1003    10399 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/operations/test_datetimes.py
--rw-rw-r--   0 root         (0)     1003    12453 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/operations/test_plotting.py
--rw-rw-r--   0 root         (0)     1003    16777 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/operations/test_strings.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.553631 bigframes-1.6.0/tests/system/small/regression/
--rw-rw-r--   0 root         (0)     1003     1999 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/regression/test_issue355_merge_after_filter.py
--rw-rw-r--   0 root         (0)     1003   145044 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_dataframe.py
--rw-rw-r--   0 root         (0)     1003    18968 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_dataframe_io.py
--rw-rw-r--   0 root         (0)     1003    10446 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_encryption.py
--rw-rw-r--   0 root         (0)     1003    13974 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_groupby.py
--rw-rw-r--   0 root         (0)     1003     1558 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_ibis.py
--rw-rw-r--   0 root         (0)     1003    13328 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_index.py
--rw-rw-r--   0 root         (0)     1003     1205 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_ipython.py
--rw-rw-r--   0 root         (0)     1003    41847 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_multiindex.py
--rw-rw-r--   0 root         (0)     1003     3839 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_numpy.py
--rw-rw-r--   0 root         (0)     1003    19608 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_pandas.py
--rw-rw-r--   0 root         (0)     1003    10842 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_pandas_options.py
--rw-rw-r--   0 root         (0)     1003     5133 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_progress_bar.py
--rw-rw-r--   0 root         (0)     1003    31445 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_remote_function.py
--rw-rw-r--   0 root         (0)     1003      913 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_scalar.py
--rw-rw-r--   0 root         (0)     1003   112970 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_series.py
--rw-rw-r--   0 root         (0)     1003    41782 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_session.py
--rw-rw-r--   0 root         (0)     1003     3343 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/small/test_window.py
--rw-rw-r--   0 root         (0)     1003    12113 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/system/utils.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.553631 bigframes-1.6.0/tests/unit/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.557631 bigframes-1.6.0/tests/unit/_config/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/_config/__init__.py
--rw-rw-r--   0 root         (0)     1003     4322 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/_config/test_bigquery_options.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.557631 bigframes-1.6.0/tests/unit/core/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/core/__init__.py
--rw-rw-r--   0 root         (0)     1003     1619 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/core/test_bf_utils.py
--rw-rw-r--   0 root         (0)     1003     2966 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/core/test_blocks.py
--rw-rw-r--   0 root         (0)     1003     1553 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/core/test_expression.py
--rw-rw-r--   0 root         (0)     1003     1813 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/core/test_log_adapter.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.557631 bigframes-1.6.0/tests/unit/ml/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/ml/__init__.py
--rw-rw-r--   0 root         (0)     1003     2323 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/ml/test_api_primitives.py
--rw-rw-r--   0 root         (0)     1003     6555 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/ml/test_compose.py
--rw-rw-r--   0 root         (0)     1003     7422 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/ml/test_golden_sql.py
--rw-rw-r--   0 root         (0)     1003     4058 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/ml/test_pipeline.py
--rw-rw-r--   0 root         (0)     1003    14808 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/ml/test_sql.py
--rw-rw-r--   0 root         (0)     1003     5298 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/resources.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.561630 bigframes-1.6.0/tests/unit/session/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/session/__init__.py
--rw-rw-r--   0 root         (0)     1003     4347 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/session/test_clients.py
--rw-rw-r--   0 root         (0)     1003     9959 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/session/test_io_bigquery.py
--rw-rw-r--   0 root         (0)     1003    18664 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/session/test_io_pandas.py
--rw-rw-r--   0 root         (0)     1003     1272 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/session/test_read_gbq_table.py
--rw-rw-r--   0 root         (0)     1003    13536 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/session/test_session.py
--rw-rw-r--   0 root         (0)     1003     1744 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/test_clients.py
--rw-rw-r--   0 root         (0)     1003     1056 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/test_compute_options.py
--rw-rw-r--   0 root         (0)     1003     6648 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/test_core.py
--rw-rw-r--   0 root         (0)     1003     2136 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/test_dataframe.py
--rw-rw-r--   0 root         (0)     1003     8819 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/test_dtypes.py
--rw-rw-r--   0 root         (0)     1003     1577 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/test_features.py
--rw-rw-r--   0 root         (0)     1003      528 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/test_formatting_helper.py
--rw-rw-r--   0 root         (0)     1003     1655 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/test_formatting_helpers.py
--rw-rw-r--   0 root         (0)     1003     4055 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/test_pandas.py
--rw-rw-r--   0 root         (0)     1003     1207 2024-05-14 18:01:45.000000 bigframes-1.6.0/tests/unit/test_remote_function.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.497639 bigframes-1.6.0/third_party/
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.561630 bigframes-1.6.0/third_party/bigframes_vendored/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.561630 bigframes-1.6.0/third_party/bigframes_vendored/cpython/
--rw-rw-r--   0 root         (0)     1003     2339 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/cpython/LICENSE
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/cpython/__init__.py
--rw-rw-r--   0 root         (0)     1003    18854 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/cpython/_pprint.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.561630 bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/
--rw-rw-r--   0 root         (0)     1003    11358 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/LICENSE
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/__init__.py
--rw-rw-r--   0 root         (0)     1003     5290 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/_pandas_helpers.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.561630 bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.561630 bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/
--rw-rw-r--   0 root         (0)     1003      574 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/__init__.py
--rw-rw-r--   0 root         (0)     1003    14045 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/test_pandas_helpers.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.561630 bigframes-1.6.0/third_party/bigframes_vendored/ibis/
--rw-rw-r--   0 root         (0)     1003    11358 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/LICENSE.txt
--rw-rw-r--   0 root         (0)     1003    11663 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/README.md
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.565629 bigframes-1.6.0/third_party/bigframes_vendored/ibis/backends/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/backends/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.565629 bigframes-1.6.0/third_party/bigframes_vendored/ibis/backends/bigquery/
--rw-rw-r--   0 root         (0)     1003      184 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/backends/bigquery/__init__.py
--rw-rw-r--   0 root         (0)     1003     2091 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/backends/bigquery/compiler.py
--rw-rw-r--   0 root         (0)     1003     6600 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/backends/bigquery/datatypes.py
--rw-rw-r--   0 root         (0)     1003     1892 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/backends/bigquery/registry.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.565629 bigframes-1.6.0/third_party/bigframes_vendored/ibis/expr/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/expr/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.565629 bigframes-1.6.0/third_party/bigframes_vendored/ibis/expr/operations/
--rw-rw-r--   0 root         (0)     1003      464 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/expr/operations/__init__.py
--rw-rw-r--   0 root         (0)     1003      536 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/expr/operations/analytic.py
--rw-rw-r--   0 root         (0)     1003      276 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/expr/operations/generic.py
--rw-rw-r--   0 root         (0)     1003      263 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/expr/operations/json.py
--rw-rw-r--   0 root         (0)     1003      690 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/ibis/expr/operations/reductions.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.565629 bigframes-1.6.0/third_party/bigframes_vendored/pandas/
--rw-rw-r--   0 root         (0)     1003     2284 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/AUTHORS.md
--rw-rw-r--   0 root         (0)     1003     1634 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/LICENSE
--rw-rw-r--   0 root         (0)     1003    10620 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/README.md
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.565629 bigframes-1.6.0/third_party/bigframes_vendored/pandas/_config/
--rw-rw-r--   0 root         (0)     1003     2352 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/_config/config.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.569629 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.569629 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/arrays/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/arrays/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.569629 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/__init__.py
--rw-rw-r--   0 root         (0)     1003     3831 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/accessors.py
--rw-rw-r--   0 root         (0)     1003     3689 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/arrays/datetimelike.py
--rw-rw-r--   0 root         (0)     1003     2086 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/common.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.573628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/
--rw-rw-r--   0 root         (0)     1003     6944 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/align.py
--rw-rw-r--   0 root         (0)     1003     1543 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/common.py
--rw-rw-r--   0 root         (0)     1003     2295 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/engines.py
--rw-rw-r--   0 root         (0)     1003    12685 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/eval.py
--rw-rw-r--   0 root         (0)     1003    25132 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/expr.py
--rw-rw-r--   0 root         (0)     1003    16244 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/ops.py
--rw-rw-r--   0 root         (0)     1003     6477 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/parsing.py
--rw-rw-r--   0 root         (0)     1003    10303 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/scope.py
--rw-rw-r--   0 root         (0)     1003     4394 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/config_init.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.573628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/dtypes/
--rw-rw-r--   0 root         (0)     1003      707 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/dtypes/inference.py
--rw-rw-r--   0 root         (0)     1003   229081 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/frame.py
--rw-rw-r--   0 root         (0)     1003    40215 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/generic.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.573628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/groupby/
--rw-rw-r--   0 root         (0)     1003    14023 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/groupby/__init__.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.573628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/indexes/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/indexes/__init__.py
--rw-rw-r--   0 root         (0)     1003     9589 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/indexes/accessor.py
--rw-rw-r--   0 root         (0)     1003    11461 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/indexes/base.py
--rw-rw-r--   0 root         (0)     1003     2941 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/indexes/multi.py
--rw-rw-r--   0 root         (0)     1003     2909 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/indexing.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.573628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/reshape/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/reshape/__init__.py
--rw-rw-r--   0 root         (0)     1003     4372 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/reshape/concat.py
--rw-rw-r--   0 root         (0)     1003     3804 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/reshape/encoding.py
--rw-rw-r--   0 root         (0)     1003     3220 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/reshape/merge.py
--rw-rw-r--   0 root         (0)     1003     5844 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/reshape/tile.py
--rw-rw-r--   0 root         (0)     1003   134990 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/series.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.573628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/strings/
--rw-rw-r--   0 root         (0)     1003    39467 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/strings/accessor.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.577628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/tools/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/tools/__init__.py
--rw-rw-r--   0 root         (0)     1003     2964 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/tools/datetimes.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.577628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/window/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/window/__init__.py
--rw-rw-r--   0 root         (0)     1003     1350 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/window/rolling.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.577628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/__init__.py
--rw-rw-r--   0 root         (0)     1003     1269 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/common.py
--rw-rw-r--   0 root         (0)     1003     8092 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/gbq.py
--rw-rw-r--   0 root         (0)     1003     1654 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/parquet.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.577628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/parsers/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/parsers/__init__.py
--rw-rw-r--   0 root         (0)     1003    11153 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/parsers/readers.py
--rw-rw-r--   0 root         (0)     1003     3329 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/pickle.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.577628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/pandas/
--rw-rw-r--   0 root         (0)     1003    12353 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/pandas/_typing.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.577628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/plotting/
--rw-rw-r--   0 root         (0)     1003    11460 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/plotting/_core.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.577628 bigframes-1.6.0/third_party/bigframes_vendored/pandas/util/
--rw-rw-r--   0 root         (0)     1003      765 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/util/_exceptions.py
--rw-rw-r--   0 root         (0)     1003     1573 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/pandas/util/_validators.py
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/py.typed
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.581627 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/
--rw-rw-r--   0 root         (0)     1003     1532 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/COPYING
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/__init__.py
--rw-rw-r--   0 root         (0)     1003     6212 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/base.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.581627 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/cluster/
--rw-rw-r--   0 root         (0)     1003     5924 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/cluster/_kmeans.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.581627 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/compose/
--rw-rw-r--   0 root         (0)     1003     2014 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/compose/_column_transformer.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.581627 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/decomposition/
--rw-rw-r--   0 root         (0)     1003     5387 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/decomposition/_pca.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.581627 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/ensemble/
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/ensemble/__init__.py
--rw-rw-r--   0 root         (0)     1003     8977 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/ensemble/_forest.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.581627 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/linear_model/
--rw-rw-r--   0 root         (0)     1003     5417 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/linear_model/_base.py
--rw-rw-r--   0 root         (0)     1003     4348 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/linear_model/_logistic.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.581627 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/metrics/
--rw-rw-r--   0 root         (0)     1003     9783 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/metrics/_classification.py
--rw-rw-r--   0 root         (0)     1003     6347 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/metrics/_ranking.py
--rw-rw-r--   0 root         (0)     1003     3550 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/metrics/_regression.py
--rw-rw-r--   0 root         (0)     1003     2124 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/metrics/pairwise.py
--rw-rw-r--   0 root         (0)     1003     2977 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/pipeline.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.581627 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/preprocessing/
--rw-rw-r--   0 root         (0)     1003     4980 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/preprocessing/_data.py
--rw-rw-r--   0 root         (0)     1003     1494 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/preprocessing/_discretization.py
--rw-rw-r--   0 root         (0)     1003     4059 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/preprocessing/_encoder.py
--rw-rw-r--   0 root         (0)     1003     2085 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/sklearn/preprocessing/_label.py
-drwxr-sr-x   0 root         (0)     1003        0 2024-05-14 18:04:26.585627 bigframes-1.6.0/third_party/bigframes_vendored/xgboost/
--rw-rw-r--   0 root         (0)     1003    11348 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/xgboost/LICENSE
--rw-rw-r--   0 root         (0)     1003        0 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/xgboost/__init__.py
--rw-rw-r--   0 root         (0)     1003     6919 2024-05-14 18:01:45.000000 bigframes-1.6.0/third_party/bigframes_vendored/xgboost/sklearn.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.963378 bigframes-1.7.0/
+-rw-rw-r--   0 root         (0)     1003    11358 2024-05-21 14:01:19.000000 bigframes-1.7.0/LICENSE
+-rw-rw-r--   0 root         (0)     1003      914 2024-05-21 14:01:19.000000 bigframes-1.7.0/MANIFEST.in
+-rw-r--r--   0 root         (0)     1003     4817 2024-05-21 14:03:51.963378 bigframes-1.7.0/PKG-INFO
+-rw-rw-r--   0 root         (0)     1003     2391 2024-05-21 14:01:19.000000 bigframes-1.7.0/README.rst
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.879368 bigframes-1.7.0/bigframes/
+-rw-rw-r--   0 root         (0)     1003     1216 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.883368 bigframes-1.7.0/bigframes/_config/
+-rw-rw-r--   0 root         (0)     1003     4315 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/_config/__init__.py
+-rw-rw-r--   0 root         (0)     1003     9229 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/_config/bigquery_options.py
+-rw-rw-r--   0 root         (0)     1003     4369 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/_config/compute_options.py
+-rw-rw-r--   0 root         (0)     1003     1661 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/_config/display_options.py
+-rw-rw-r--   0 root         (0)     1003     1892 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/_config/sampling_options.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.883368 bigframes-1.7.0/bigframes/bigquery/
+-rw-rw-r--   0 root         (0)     1003     3785 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/bigquery/__init__.py
+-rw-rw-r--   0 root         (0)     1003     7152 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/clients.py
+-rw-rw-r--   0 root         (0)     1003     2779 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/constants.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.887369 bigframes-1.7.0/bigframes/core/
+-rw-rw-r--   0 root         (0)     1003    18659 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/__init__.py
+-rw-rw-r--   0 root         (0)     1003    30854 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/block_transforms.py
+-rw-rw-r--   0 root         (0)     1003   102980 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/blocks.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.891369 bigframes-1.7.0/bigframes/core/compile/
+-rw-rw-r--   0 root         (0)     1003      832 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/compile/__init__.py
+-rw-rw-r--   0 root         (0)     1003    19325 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/compile/aggregate_compiler.py
+-rw-rw-r--   0 root         (0)     1003    54216 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/compile/compiled.py
+-rw-rw-r--   0 root         (0)     1003     6660 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/compile/compiler.py
+-rw-rw-r--   0 root         (0)     1003     3356 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/compile/concat.py
+-rw-rw-r--   0 root         (0)     1003    50210 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/compile/scalar_op_compiler.py
+-rw-rw-r--   0 root         (0)     1003     7121 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/compile/single_column.py
+-rw-rw-r--   0 root         (0)     1003     2962 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/convert.py
+-rw-rw-r--   0 root         (0)     1003     2495 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/eval.py
+-rw-rw-r--   0 root         (0)     1003     6685 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/expression.py
+-rw-rw-r--   0 root         (0)     1003     3887 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/global_session.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.891369 bigframes-1.7.0/bigframes/core/groupby/
+-rw-rw-r--   0 root         (0)     1003    24020 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/groupby/__init__.py
+-rw-rw-r--   0 root         (0)     1003      716 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/guid.py
+-rw-rw-r--   0 root         (0)     1003    18128 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/indexers.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.891369 bigframes-1.7.0/bigframes/core/indexes/
+-rw-rw-r--   0 root         (0)     1003      719 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/indexes/__init__.py
+-rw-rw-r--   0 root         (0)     1003    16569 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/indexes/base.py
+-rw-rw-r--   0 root         (0)     1003     1720 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/indexes/multi.py
+-rw-rw-r--   0 root         (0)     1003     1730 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/join_def.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.891369 bigframes-1.7.0/bigframes/core/joins/
+-rw-rw-r--   0 root         (0)     1003      691 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/joins/__init__.py
+-rw-rw-r--   0 root         (0)     1003     2132 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/joins/merge.py
+-rw-rw-r--   0 root         (0)     1003     2218 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/local_data.py
+-rw-rw-r--   0 root         (0)     1003     3424 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/log_adapter.py
+-rw-rw-r--   0 root         (0)     1003    18515 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/nodes.py
+-rw-rw-r--   0 root         (0)     1003     9445 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/ordering.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.891369 bigframes-1.7.0/bigframes/core/reshape/
+-rw-rw-r--   0 root         (0)     1003     6902 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/reshape/__init__.py
+-rw-rw-r--   0 root         (0)     1003    12249 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/rewrite.py
+-rw-rw-r--   0 root         (0)     1003      746 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/scalar.py
+-rw-rw-r--   0 root         (0)     1003     2144 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/schema.py
+-rw-rw-r--   0 root         (0)     1003     5862 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/sql.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.895370 bigframes-1.7.0/bigframes/core/tools/
+-rw-rw-r--   0 root         (0)     1003      664 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/tools/__init__.py
+-rw-rw-r--   0 root         (0)     1003     4177 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/tools/datetimes.py
+-rw-rw-r--   0 root         (0)     1003     3002 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/tree_properties.py
+-rw-rw-r--   0 root         (0)     1003     5483 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/utils.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.895370 bigframes-1.7.0/bigframes/core/window/
+-rw-rw-r--   0 root         (0)     1003     3075 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/window/__init__.py
+-rw-rw-r--   0 root         (0)     1003     4431 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/core/window_spec.py
+-rw-rw-r--   0 root         (0)     1003   136153 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/dataframe.py
+-rw-rw-r--   0 root         (0)     1003    27800 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/dtypes.py
+-rw-rw-r--   0 root         (0)     1003     1118 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/enums.py
+-rw-rw-r--   0 root         (0)     1003     1321 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/exceptions.py
+-rw-rw-r--   0 root         (0)     1003     1273 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/features.py
+-rw-rw-r--   0 root         (0)     1003    11179 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/formatting_helpers.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.895370 bigframes-1.7.0/bigframes/functions/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/functions/__init__.py
+-rw-rw-r--   0 root         (0)     1003    47835 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/functions/remote_function.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.899370 bigframes-1.7.0/bigframes/ml/
+-rw-rw-r--   0 root         (0)     1003      877 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/__init__.py
+-rw-rw-r--   0 root         (0)     1003     8542 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/base.py
+-rw-rw-r--   0 root         (0)     1003     6196 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/cluster.py
+-rw-rw-r--   0 root         (0)     1003     8049 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/compose.py
+-rw-rw-r--   0 root         (0)     1003    17897 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/core.py
+-rw-rw-r--   0 root         (0)     1003     6757 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/decomposition.py
+-rw-rw-r--   0 root         (0)     1003    23414 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/ensemble.py
+-rw-rw-r--   0 root         (0)     1003    15801 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/forecasting.py
+-rw-rw-r--   0 root         (0)     1003     1141 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/globals.py
+-rw-rw-r--   0 root         (0)     1003    10837 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/imported.py
+-rw-rw-r--   0 root         (0)     1003    12556 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/linear_model.py
+-rw-rw-r--   0 root         (0)     1003    31790 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/llm.py
+-rw-rw-r--   0 root         (0)     1003     4905 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/loader.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.899370 bigframes-1.7.0/bigframes/ml/metrics/
+-rw-rw-r--   0 root         (0)     1003     1066 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/metrics/__init__.py
+-rw-rw-r--   0 root         (0)     1003    11096 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/metrics/_metrics.py
+-rw-rw-r--   0 root         (0)     1003     2373 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/metrics/pairwise.py
+-rw-rw-r--   0 root         (0)     1003     3748 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/model_selection.py
+-rw-rw-r--   0 root         (0)     1003     5067 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/pipeline.py
+-rw-rw-r--   0 root         (0)     1003    23307 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/preprocessing.py
+-rw-rw-r--   0 root         (0)     1003     5773 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/remote.py
+-rw-rw-r--   0 root         (0)     1003    14865 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/sql.py
+-rw-rw-r--   0 root         (0)     1003     3738 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/ml/utils.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.903371 bigframes-1.7.0/bigframes/operations/
+-rw-rw-r--   0 root         (0)     1003    24936 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/operations/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.903371 bigframes-1.7.0/bigframes/operations/_matplotlib/
+-rw-rw-r--   0 root         (0)     1003     1078 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/operations/_matplotlib/__init__.py
+-rw-rw-r--   0 root         (0)     1003     4537 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/operations/_matplotlib/core.py
+-rw-rw-r--   0 root         (0)     1003     5970 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/operations/_matplotlib/hist.py
+-rw-rw-r--   0 root         (0)     1003    13856 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/operations/aggregations.py
+-rw-rw-r--   0 root         (0)     1003    10457 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/operations/base.py
+-rw-rw-r--   0 root         (0)     1003     3079 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/operations/datetimes.py
+-rw-rw-r--   0 root         (0)     1003     2814 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/operations/plotting.py
+-rw-rw-r--   0 root         (0)     1003     9461 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/operations/strings.py
+-rw-rw-r--   0 root         (0)     1003     2089 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/operations/structs.py
+-rw-rw-r--   0 root         (0)     1003     7613 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/operations/type.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.903371 bigframes-1.7.0/bigframes/pandas/
+-rw-rw-r--   0 root         (0)     1003    26327 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/pandas/__init__.py
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/py.typed
+-rw-rw-r--   0 root         (0)     1003    67401 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/series.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.903371 bigframes-1.7.0/bigframes/session/
+-rw-rw-r--   0 root         (0)     1003    81888 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/session/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.903371 bigframes-1.7.0/bigframes/session/_io/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/session/_io/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.903371 bigframes-1.7.0/bigframes/session/_io/bigquery/
+-rw-rw-r--   0 root         (0)     1003    15295 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/session/_io/bigquery/__init__.py
+-rw-rw-r--   0 root         (0)     1003    16057 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/session/_io/bigquery/read_gbq_table.py
+-rw-rw-r--   0 root         (0)     1003     4345 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/session/_io/pandas.py
+-rw-rw-r--   0 root         (0)     1003     8383 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/session/clients.py
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/typing.py
+-rw-rw-r--   0 root         (0)     1003      597 2024-05-21 14:01:19.000000 bigframes-1.7.0/bigframes/version.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.959378 bigframes-1.7.0/bigframes.egg-info/
+-rw-r--r--   0 root         (0)     1003     4817 2024-05-21 14:03:51.000000 bigframes-1.7.0/bigframes.egg-info/PKG-INFO
+-rw-r--r--   0 root         (0)     1003    12599 2024-05-21 14:03:51.000000 bigframes-1.7.0/bigframes.egg-info/SOURCES.txt
+-rw-r--r--   0 root         (0)     1003        1 2024-05-21 14:03:51.000000 bigframes-1.7.0/bigframes.egg-info/dependency_links.txt
+-rw-r--r--   0 root         (0)     1003        1 2024-05-21 14:03:51.000000 bigframes-1.7.0/bigframes.egg-info/not-zip-safe
+-rw-r--r--   0 root         (0)     1003      749 2024-05-21 14:03:51.000000 bigframes-1.7.0/bigframes.egg-info/requires.txt
+-rw-r--r--   0 root         (0)     1003       29 2024-05-21 14:03:51.000000 bigframes-1.7.0/bigframes.egg-info/top_level.txt
+-rw-rw-r--   0 root         (0)     1003       81 2024-05-21 14:01:19.000000 bigframes-1.7.0/pyproject.toml
+-rw-rw-r--   0 root         (0)     1003       67 2024-05-21 14:03:51.963378 bigframes-1.7.0/setup.cfg
+-rw-rw-r--   0 root         (0)     1003     4454 2024-05-21 14:01:19.000000 bigframes-1.7.0/setup.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.907371 bigframes-1.7.0/tests/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.907371 bigframes-1.7.0/tests/data/
+-rw-rw-r--   0 root         (0)     1003      619 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/hockey_players.json
+-rw-rw-r--   0 root         (0)     1003     1250 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/hockey_players.jsonl
+-rw-rw-r--   0 root         (0)     1003      340 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/matrix_2by3.json
+-rw-rw-r--   0 root         (0)     1003       80 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/matrix_2by3.jsonl
+-rw-rw-r--   0 root         (0)     1003      421 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/matrix_3by4.json
+-rw-rw-r--   0 root         (0)     1003      154 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/matrix_3by4.jsonl
+-rw-rw-r--   0 root         (0)     1003    33350 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/nested.jsonl
+-rw-rw-r--   0 root         (0)     1003      966 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/nested_schema.json
+-rw-rw-r--   0 root         (0)     1003    58869 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/penguins.jsonl
+-rw-rw-r--   0 root         (0)     1003      636 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/penguins_schema.json
+-rw-rw-r--   0 root         (0)     1003     3909 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/scalars.jsonl
+-rw-rw-r--   0 root         (0)     1003     1458 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/scalars_schema.json
+-rw-rw-r--   0 root         (0)     1003    23424 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/time_series.jsonl
+-rw-rw-r--   0 root         (0)     1003      192 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/data/time_series_schema.json
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.911372 bigframes-1.7.0/tests/system/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/__init__.py
+-rw-rw-r--   0 root         (0)     1003    37671 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/conftest.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.911372 bigframes-1.7.0/tests/system/large/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.911372 bigframes-1.7.0/tests/system/large/ml/
+-rw-rw-r--   0 root         (0)     1003     5108 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/ml/test_cluster.py
+-rw-rw-r--   0 root         (0)     1003     4278 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/ml/test_compose.py
+-rw-rw-r--   0 root         (0)     1003     4955 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/ml/test_core.py
+-rw-rw-r--   0 root         (0)     1003     5723 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/ml/test_decomposition.py
+-rw-rw-r--   0 root         (0)     1003    13316 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/ml/test_ensemble.py
+-rw-rw-r--   0 root         (0)     1003     4498 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/ml/test_forecasting.py
+-rw-rw-r--   0 root         (0)     1003     7196 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/ml/test_linear_model.py
+-rw-rw-r--   0 root         (0)     1003    26149 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/ml/test_pipeline.py
+-rw-rw-r--   0 root         (0)     1003     4079 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/test_location.py
+-rw-rw-r--   0 root         (0)     1003    66973 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/test_remote_function.py
+-rw-rw-r--   0 root         (0)     1003     4573 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/large/test_session.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.915372 bigframes-1.7.0/tests/system/load/
+-rw-rw-r--   0 root         (0)     1003     3179 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/load/test_large_tables.py
+-rw-rw-r--   0 root         (0)     1003     4559 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/load/test_llm.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.919373 bigframes-1.7.0/tests/system/small/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.919373 bigframes-1.7.0/tests/system/small/bigquery/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/bigquery/__init__.py
+-rw-rw-r--   0 root         (0)     1003     4314 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/bigquery/test_array.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.923373 bigframes-1.7.0/tests/system/small/ml/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/__init__.py
+-rw-rw-r--   0 root         (0)     1003    11773 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/conftest.py
+-rw-rw-r--   0 root         (0)     1003     7074 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_cluster.py
+-rw-rw-r--   0 root         (0)     1003    13810 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_core.py
+-rw-rw-r--   0 root         (0)     1003     6764 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_decomposition.py
+-rw-rw-r--   0 root         (0)     1003    17015 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_ensemble.py
+-rw-rw-r--   0 root         (0)     1003     6859 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_forecasting.py
+-rw-rw-r--   0 root         (0)     1003     4983 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_imported.py
+-rw-rw-r--   0 root         (0)     1003     8788 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_linear_model.py
+-rw-rw-r--   0 root         (0)     1003    11929 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_llm.py
+-rw-rw-r--   0 root         (0)     1003    26146 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_metrics.py
+-rw-rw-r--   0 root         (0)     1003     2224 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_metrics_pairwise.py
+-rw-rw-r--   0 root         (0)     1003     6757 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_model_selection.py
+-rw-rw-r--   0 root         (0)     1003    29304 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_preprocessing.py
+-rw-rw-r--   0 root         (0)     1003     2570 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_register.py
+-rw-rw-r--   0 root         (0)     1003     1205 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/ml/test_remote.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.923373 bigframes-1.7.0/tests/system/small/operations/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/operations/__init__.py
+-rw-rw-r--   0 root         (0)     1003    10455 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/operations/test_datetimes.py
+-rw-rw-r--   0 root         (0)     1003    12509 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/operations/test_plotting.py
+-rw-rw-r--   0 root         (0)     1003    16777 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/operations/test_strings.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.927374 bigframes-1.7.0/tests/system/small/regression/
+-rw-rw-r--   0 root         (0)     1003     1999 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/regression/test_issue355_merge_after_filter.py
+-rw-rw-r--   0 root         (0)     1003   146897 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_dataframe.py
+-rw-rw-r--   0 root         (0)     1003    18968 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_dataframe_io.py
+-rw-rw-r--   0 root         (0)     1003     7328 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_empty_index.py
+-rw-rw-r--   0 root         (0)     1003    10838 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_encryption.py
+-rw-rw-r--   0 root         (0)     1003    13974 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_groupby.py
+-rw-rw-r--   0 root         (0)     1003     1558 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_ibis.py
+-rw-rw-r--   0 root         (0)     1003    13720 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_index.py
+-rw-rw-r--   0 root         (0)     1003     1205 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_ipython.py
+-rw-rw-r--   0 root         (0)     1003    42183 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_multiindex.py
+-rw-rw-r--   0 root         (0)     1003     3839 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_numpy.py
+-rw-rw-r--   0 root         (0)     1003    22913 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_pandas.py
+-rw-rw-r--   0 root         (0)     1003    10842 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_pandas_options.py
+-rw-rw-r--   0 root         (0)     1003     5133 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_progress_bar.py
+-rw-rw-r--   0 root         (0)     1003    31505 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_remote_function.py
+-rw-rw-r--   0 root         (0)     1003      913 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_scalar.py
+-rw-rw-r--   0 root         (0)     1003   113344 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_series.py
+-rw-rw-r--   0 root         (0)     1003    44210 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_session.py
+-rw-rw-r--   0 root         (0)     1003     3343 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/small/test_window.py
+-rw-rw-r--   0 root         (0)     1003    13337 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/system/utils.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.927374 bigframes-1.7.0/tests/unit/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.927374 bigframes-1.7.0/tests/unit/_config/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/_config/__init__.py
+-rw-rw-r--   0 root         (0)     1003     4322 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/_config/test_bigquery_options.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.931374 bigframes-1.7.0/tests/unit/core/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/core/__init__.py
+-rw-rw-r--   0 root         (0)     1003     1619 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/core/test_bf_utils.py
+-rw-rw-r--   0 root         (0)     1003     2966 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/core/test_blocks.py
+-rw-rw-r--   0 root         (0)     1003     1553 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/core/test_expression.py
+-rw-rw-r--   0 root         (0)     1003     1813 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/core/test_log_adapter.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.931374 bigframes-1.7.0/tests/unit/ml/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/ml/__init__.py
+-rw-rw-r--   0 root         (0)     1003     2419 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/ml/test_api_primitives.py
+-rw-rw-r--   0 root         (0)     1003     6555 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/ml/test_compose.py
+-rw-rw-r--   0 root         (0)     1003     7422 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/ml/test_golden_sql.py
+-rw-rw-r--   0 root         (0)     1003     4058 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/ml/test_pipeline.py
+-rw-rw-r--   0 root         (0)     1003    14808 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/ml/test_sql.py
+-rw-rw-r--   0 root         (0)     1003     5298 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/resources.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.935375 bigframes-1.7.0/tests/unit/session/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/session/__init__.py
+-rw-rw-r--   0 root         (0)     1003     4347 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/session/test_clients.py
+-rw-rw-r--   0 root         (0)     1003    11007 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/session/test_io_bigquery.py
+-rw-rw-r--   0 root         (0)     1003    18664 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/session/test_io_pandas.py
+-rw-rw-r--   0 root         (0)     1003     3797 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/session/test_read_gbq_table.py
+-rw-rw-r--   0 root         (0)     1003    13816 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/session/test_session.py
+-rw-rw-r--   0 root         (0)     1003     1744 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/test_clients.py
+-rw-rw-r--   0 root         (0)     1003     1056 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/test_compute_options.py
+-rw-rw-r--   0 root         (0)     1003     6648 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/test_core.py
+-rw-rw-r--   0 root         (0)     1003     2136 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/test_dataframe.py
+-rw-rw-r--   0 root         (0)     1003     8819 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/test_dtypes.py
+-rw-rw-r--   0 root         (0)     1003     1577 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/test_features.py
+-rw-rw-r--   0 root         (0)     1003      528 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/test_formatting_helper.py
+-rw-rw-r--   0 root         (0)     1003     1655 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/test_formatting_helpers.py
+-rw-rw-r--   0 root         (0)     1003     4115 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/test_pandas.py
+-rw-rw-r--   0 root         (0)     1003     1207 2024-05-21 14:01:19.000000 bigframes-1.7.0/tests/unit/test_remote_function.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.867366 bigframes-1.7.0/third_party/
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.935375 bigframes-1.7.0/third_party/bigframes_vendored/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.935375 bigframes-1.7.0/third_party/bigframes_vendored/cpython/
+-rw-rw-r--   0 root         (0)     1003     2339 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/cpython/LICENSE
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/cpython/__init__.py
+-rw-rw-r--   0 root         (0)     1003    18854 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/cpython/_pprint.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.935375 bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/
+-rw-rw-r--   0 root         (0)     1003    11358 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/LICENSE
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/__init__.py
+-rw-rw-r--   0 root         (0)     1003     5290 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/_pandas_helpers.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.935375 bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.935375 bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/
+-rw-rw-r--   0 root         (0)     1003      574 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/__init__.py
+-rw-rw-r--   0 root         (0)     1003    14045 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/test_pandas_helpers.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.939375 bigframes-1.7.0/third_party/bigframes_vendored/ibis/
+-rw-rw-r--   0 root         (0)     1003    11358 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/LICENSE.txt
+-rw-rw-r--   0 root         (0)     1003    11663 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/README.md
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.939375 bigframes-1.7.0/third_party/bigframes_vendored/ibis/backends/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/backends/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.939375 bigframes-1.7.0/third_party/bigframes_vendored/ibis/backends/bigquery/
+-rw-rw-r--   0 root         (0)     1003      184 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/backends/bigquery/__init__.py
+-rw-rw-r--   0 root         (0)     1003     2091 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/backends/bigquery/compiler.py
+-rw-rw-r--   0 root         (0)     1003     6600 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/backends/bigquery/datatypes.py
+-rw-rw-r--   0 root         (0)     1003     2783 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/backends/bigquery/registry.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.939375 bigframes-1.7.0/third_party/bigframes_vendored/ibis/expr/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/expr/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.939375 bigframes-1.7.0/third_party/bigframes_vendored/ibis/expr/operations/
+-rw-rw-r--   0 root         (0)     1003      463 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/expr/operations/__init__.py
+-rw-rw-r--   0 root         (0)     1003      536 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/expr/operations/analytic.py
+-rw-rw-r--   0 root         (0)     1003      482 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/expr/operations/arrays.py
+-rw-rw-r--   0 root         (0)     1003      263 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/expr/operations/json.py
+-rw-rw-r--   0 root         (0)     1003     1191 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/ibis/expr/operations/reductions.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.939375 bigframes-1.7.0/third_party/bigframes_vendored/pandas/
+-rw-rw-r--   0 root         (0)     1003     2284 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/AUTHORS.md
+-rw-rw-r--   0 root         (0)     1003     1634 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/LICENSE
+-rw-rw-r--   0 root         (0)     1003    10620 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/README.md
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.939375 bigframes-1.7.0/third_party/bigframes_vendored/pandas/_config/
+-rw-rw-r--   0 root         (0)     1003     2352 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/_config/config.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.943376 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.943376 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/arrays/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/arrays/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.943376 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/__init__.py
+-rw-rw-r--   0 root         (0)     1003     3831 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/accessors.py
+-rw-rw-r--   0 root         (0)     1003     3689 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/arrays/datetimelike.py
+-rw-rw-r--   0 root         (0)     1003     2086 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/common.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.947376 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/
+-rw-rw-r--   0 root         (0)     1003     6944 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/align.py
+-rw-rw-r--   0 root         (0)     1003     1543 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/common.py
+-rw-rw-r--   0 root         (0)     1003     2295 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/engines.py
+-rw-rw-r--   0 root         (0)     1003    12685 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/eval.py
+-rw-rw-r--   0 root         (0)     1003    25132 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/expr.py
+-rw-rw-r--   0 root         (0)     1003    16244 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/ops.py
+-rw-rw-r--   0 root         (0)     1003     6477 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/parsing.py
+-rw-rw-r--   0 root         (0)     1003    10303 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/scope.py
+-rw-rw-r--   0 root         (0)     1003     4394 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/config_init.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.947376 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/dtypes/
+-rw-rw-r--   0 root         (0)     1003      707 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/dtypes/inference.py
+-rw-rw-r--   0 root         (0)     1003   229081 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/frame.py
+-rw-rw-r--   0 root         (0)     1003    40215 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/generic.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.947376 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/groupby/
+-rw-rw-r--   0 root         (0)     1003    14023 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/groupby/__init__.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.947376 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/indexes/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/indexes/__init__.py
+-rw-rw-r--   0 root         (0)     1003     9589 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/indexes/accessor.py
+-rw-rw-r--   0 root         (0)     1003    11461 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/indexes/base.py
+-rw-rw-r--   0 root         (0)     1003     2941 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/indexes/multi.py
+-rw-rw-r--   0 root         (0)     1003     2909 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/indexing.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.951377 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/reshape/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/reshape/__init__.py
+-rw-rw-r--   0 root         (0)     1003     4372 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/reshape/concat.py
+-rw-rw-r--   0 root         (0)     1003     3804 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/reshape/encoding.py
+-rw-rw-r--   0 root         (0)     1003     3220 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/reshape/merge.py
+-rw-rw-r--   0 root         (0)     1003     5844 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/reshape/tile.py
+-rw-rw-r--   0 root         (0)     1003   134990 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/series.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.951377 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/strings/
+-rw-rw-r--   0 root         (0)     1003    39467 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/strings/accessor.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.951377 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/tools/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/tools/__init__.py
+-rw-rw-r--   0 root         (0)     1003     2964 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/tools/datetimes.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.951377 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/window/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/window/__init__.py
+-rw-rw-r--   0 root         (0)     1003     1350 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/window/rolling.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.951377 bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/__init__.py
+-rw-rw-r--   0 root         (0)     1003     1269 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/common.py
+-rw-rw-r--   0 root         (0)     1003     8098 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/gbq.py
+-rw-rw-r--   0 root         (0)     1003     1654 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/parquet.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.951377 bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/parsers/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/parsers/__init__.py
+-rw-rw-r--   0 root         (0)     1003    11153 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/parsers/readers.py
+-rw-rw-r--   0 root         (0)     1003     3329 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/pickle.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.951377 bigframes-1.7.0/third_party/bigframes_vendored/pandas/pandas/
+-rw-rw-r--   0 root         (0)     1003    12353 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/pandas/_typing.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.951377 bigframes-1.7.0/third_party/bigframes_vendored/pandas/plotting/
+-rw-rw-r--   0 root         (0)     1003    11460 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/plotting/_core.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.955377 bigframes-1.7.0/third_party/bigframes_vendored/pandas/util/
+-rw-rw-r--   0 root         (0)     1003      765 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/util/_exceptions.py
+-rw-rw-r--   0 root         (0)     1003     1573 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/pandas/util/_validators.py
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/py.typed
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.955377 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/
+-rw-rw-r--   0 root         (0)     1003     1532 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/COPYING
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/__init__.py
+-rw-rw-r--   0 root         (0)     1003     6212 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/base.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.955377 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/cluster/
+-rw-rw-r--   0 root         (0)     1003     5924 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/cluster/_kmeans.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.955377 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/compose/
+-rw-rw-r--   0 root         (0)     1003     2014 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/compose/_column_transformer.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.955377 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/decomposition/
+-rw-rw-r--   0 root         (0)     1003     5387 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/decomposition/_pca.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.955377 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/ensemble/
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/ensemble/__init__.py
+-rw-rw-r--   0 root         (0)     1003     8977 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/ensemble/_forest.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.955377 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/linear_model/
+-rw-rw-r--   0 root         (0)     1003     5417 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/linear_model/_base.py
+-rw-rw-r--   0 root         (0)     1003     4348 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/linear_model/_logistic.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.959378 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/metrics/
+-rw-rw-r--   0 root         (0)     1003     9783 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/metrics/_classification.py
+-rw-rw-r--   0 root         (0)     1003     6347 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/metrics/_ranking.py
+-rw-rw-r--   0 root         (0)     1003     3550 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/metrics/_regression.py
+-rw-rw-r--   0 root         (0)     1003     2124 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/metrics/pairwise.py
+-rw-rw-r--   0 root         (0)     1003     2977 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/pipeline.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.959378 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/preprocessing/
+-rw-rw-r--   0 root         (0)     1003     4980 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/preprocessing/_data.py
+-rw-rw-r--   0 root         (0)     1003     1494 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/preprocessing/_discretization.py
+-rw-rw-r--   0 root         (0)     1003     4059 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/preprocessing/_encoder.py
+-rw-rw-r--   0 root         (0)     1003     2085 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/sklearn/preprocessing/_label.py
+drwxr-sr-x   0 root         (0)     1003        0 2024-05-21 14:03:51.959378 bigframes-1.7.0/third_party/bigframes_vendored/xgboost/
+-rw-rw-r--   0 root         (0)     1003    11348 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/xgboost/LICENSE
+-rw-rw-r--   0 root         (0)     1003        0 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/xgboost/__init__.py
+-rw-rw-r--   0 root         (0)     1003     6919 2024-05-21 14:01:19.000000 bigframes-1.7.0/third_party/bigframes_vendored/xgboost/sklearn.py
```

### Comparing `bigframes-1.6.0/LICENSE` & `bigframes-1.7.0/LICENSE`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/MANIFEST.in` & `bigframes-1.7.0/MANIFEST.in`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/PKG-INFO` & `bigframes-1.7.0/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: bigframes
-Version: 1.6.0
+Version: 1.7.0
 Summary: BigQuery DataFrames -- scalable analytics and machine learning with BigQuery
 Home-page: https://github.com/googleapis/python-bigquery-dataframes
 Author: Google LLC
 Author-email: bigframes-feedback@google.com
 License: Apache 2.0
 Platform: Posix; MacOS X; Windows
 Classifier: Development Status :: 5 - Production/Stable
```

### Comparing `bigframes-1.6.0/README.rst` & `bigframes-1.7.0/README.rst`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/__init__.py` & `bigframes-1.7.0/bigframes/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/_config/__init__.py` & `bigframes-1.7.0/bigframes/_config/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/_config/bigquery_options.py` & `bigframes-1.7.0/bigframes/_config/bigquery_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/_config/compute_options.py` & `bigframes-1.7.0/bigframes/_config/compute_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/_config/display_options.py` & `bigframes-1.7.0/bigframes/_config/display_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/_config/sampling_options.py` & `bigframes-1.7.0/bigframes/_config/sampling_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/clients.py` & `bigframes-1.7.0/bigframes/clients.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/constants.py` & `bigframes-1.7.0/bigframes/constants.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/__init__.py` & `bigframes-1.7.0/bigframes/core/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -452,14 +452,27 @@
             join=join_def,
             allow_row_identity_join=allow_row_identity_join,
         )
         if allow_row_identity_join:
             return ArrayValue(bigframes.core.rewrite.maybe_rewrite_join(join_node))
         return ArrayValue(join_node)
 
+    def try_align_as_projection(
+        self,
+        other: ArrayValue,
+        join_type: join_def.JoinType,
+        mappings: typing.Tuple[join_def.JoinColumnMapping, ...],
+    ) -> typing.Optional[ArrayValue]:
+        left_side = bigframes.core.rewrite.SquashedSelect.from_node(self.node)
+        right_side = bigframes.core.rewrite.SquashedSelect.from_node(other.node)
+        result = left_side.maybe_merge(right_side, join_type, mappings)
+        if result is not None:
+            return ArrayValue(result.expand())
+        return None
+
     def explode(self, column_ids: typing.Sequence[str]) -> ArrayValue:
         assert len(column_ids) > 0
         for column_id in column_ids:
             assert bigframes.dtypes.is_array_like(self.get_column_type(column_id))
 
         return ArrayValue(
             nodes.ExplodeNode(child=self.node, column_ids=tuple(column_ids))
```

### Comparing `bigframes-1.6.0/bigframes/core/block_transforms.py` & `bigframes-1.7.0/bigframes/core/block_transforms.py`

 * *Files 2% similar despite different names*

```diff
@@ -593,17 +593,19 @@
         block, skew_id = _skew_from_moments_and_count(
             block, count_id, moment3_id, var_id
         )
         skew_ids.append(skew_id)
 
     block = block.select_columns(skew_ids).with_column_labels(column_labels)
     if not grouping_column_ids:
-        # When ungrouped, stack everything into single column so can be returned as series
-        block = block.stack()
-        block = block.drop_levels([block.index_columns[0]])
+        # When ungrouped, transpose result row into a series
+        # perform transpose last, so as to not invalidate cache
+        block, index_col = block.create_constant(None, None)
+        block = block.set_index([index_col])
+        return block.transpose(original_row_index=pd.Index([None]))
     return block
 
 
 def kurt(
     block: blocks.Block,
     skew_column_ids: typing.Sequence[str],
     grouping_column_ids: typing.Sequence[str] = (),
@@ -633,17 +635,19 @@
         block, kurt_id = _kurt_from_moments_and_count(
             block, count_id, moment4_id, var_id
         )
         kurt_ids.append(kurt_id)
 
     block = block.select_columns(kurt_ids).with_column_labels(column_labels)
     if not grouping_column_ids:
-        # When ungrouped, stack everything into single column so can be returned as series
-        block = block.stack()
-        block = block.drop_levels([block.index_columns[0]])
+        # When ungrouped, transpose result row into a series
+        # perform transpose last, so as to not invalidate cache
+        block, index_col = block.create_constant(None, None)
+        block = block.set_index([index_col])
+        return block.transpose(original_row_index=pd.Index([None]))
     return block
 
 
 def _mean_delta_to_power(
     block: blocks.Block,
     n_power: int,
     column_ids: typing.Sequence[str],
@@ -816,15 +820,16 @@
 def idxmax(block: blocks.Block) -> blocks.Block:
     return _idx_extrema(block, "max")
 
 
 def _idx_extrema(
     block: blocks.Block, min_or_max: typing.Literal["min", "max"]
 ) -> blocks.Block:
-    if len(block.index_columns) != 1:
+    block._throw_if_null_index("idx")
+    if len(block.index_columns) > 1:
         # TODO: Need support for tuple dtype
         raise NotImplementedError(
             f"idxmin not support for multi-index. {constants.FEEDBACK_LINK}"
         )
 
     original_block = block
     result_cols = []
```

### Comparing `bigframes-1.6.0/bigframes/core/blocks.py` & `bigframes-1.7.0/bigframes/core/blocks.py`

 * *Files 2% similar despite different names*

```diff
@@ -47,14 +47,15 @@
 import bigframes.core.ordering as ordering
 import bigframes.core.schema as bf_schema
 import bigframes.core.sql as sql
 import bigframes.core.tree_properties as tree_properties
 import bigframes.core.utils as utils
 import bigframes.core.window_spec as window_specs
 import bigframes.dtypes
+import bigframes.exceptions
 import bigframes.features
 import bigframes.operations as ops
 import bigframes.operations.aggregations as agg_ops
 import bigframes.session._io.pandas
 
 # Type constraint for wherever column labels are used
 Label = typing.Hashable
@@ -116,27 +117,19 @@
         if index_labels is not None:
             index_labels = list(index_labels)
             if len(index_labels) != len(index_columns):
                 raise ValueError(
                     f"'index_columns' (size {len(index_columns)}) and 'index_labels' (size {len(index_labels)}) must have equal length"
                 )
 
-        # If no index columns are set, create one.
-        #
-        # Note: get_index_cols_and_uniqueness in
-        # bigframes/session/_io/bigquery/read_gbq_table.py depends on this
-        # being as sequential integer index column. If this default behavior
-        # ever changes, please also update get_index_cols_and_uniqueness so
-        # that users who explicitly request a sequential integer index can
-        # still get one.
         if len(index_columns) == 0:
-            new_index_col_id = guid.generate_guid()
-            expr = expr.promote_offsets(new_index_col_id)
-            index_columns = [new_index_col_id]
-
+            warnings.warn(
+                "Creating object with Null Index. Null Index is a preview feature.",
+                category=bigframes.exceptions.PreviewWarning,
+            )
         self._index_columns = tuple(index_columns)
         # Index labels don't need complicated hierarchical access so can store as tuple
         self._index_labels = (
             tuple(index_labels)
             if index_labels
             else tuple([None for _ in index_columns])
         )
@@ -513,15 +506,16 @@
             yield df
 
     def _copy_index_to_pandas(self, df: pd.DataFrame):
         """Set the index on pandas DataFrame to match this block.
 
         Warning: This method modifies ``df`` inplace.
         """
-        if self.index_columns:
+        # Note: If BigQuery DataFrame has null index, a default one will be created for the local materialization.
+        if len(self.index_columns) > 0:
             df.set_index(list(self.index_columns), inplace=True)
             # Pandas names is annotated as list[str] rather than the more
             # general Sequence[Label] that BigQuery DataFrames has.
             # See: https://github.com/pandas-dev/pandas-stubs/issues/804
             df.index.names = self.index.names  # type: ignore
         df.columns = self.column_labels
 
@@ -1089,24 +1083,33 @@
         ]
         output_col_ids = [agg_spec[1] for agg_spec in agg_specs]
         result_expr = self.expr.aggregate(agg_specs, by_column_ids, dropna=dropna)
 
         aggregate_labels = self._get_labels_for_columns(
             [agg[0] for agg in aggregations]
         )
+
         names: typing.List[Label] = []
-        for by_col_id in by_column_ids:
-            if by_col_id in self.value_columns:
-                names.append(self.col_id_to_label[by_col_id])
-            else:
-                names.append(self.col_id_to_index_name[by_col_id])
+        if len(by_column_ids) == 0:
+            label_id = guid.generate_guid()
+            result_expr = result_expr.assign_constant(label_id, 0, pd.Int64Dtype())
+            index_columns = (label_id,)
+            names = [None]
+        else:
+            index_columns = tuple(by_column_ids)  # type: ignore
+            for by_col_id in by_column_ids:
+                if by_col_id in self.value_columns:
+                    names.append(self.col_id_to_label[by_col_id])
+                else:
+                    names.append(self.col_id_to_index_name[by_col_id])
+
         return (
             Block(
                 result_expr,
-                index_columns=by_column_ids,
+                index_columns=index_columns,
                 column_labels=aggregate_labels,
                 index_labels=names,
             ),
             output_col_ids,
         )
 
     def get_stat(self, column_id: str, stat: agg_ops.UnaryAggregateOp):
@@ -1222,16 +1225,17 @@
                 guid.generate_guid(),
                 tuple(expr.column_ids[input_count * i : input_count * (i + 1)]),
             )
             for i in range(input_count)
         )
         labels = self._get_labels_for_columns(self.value_columns)
 
+        # TODO(b/340896143): fix type error
         expr = expr.unpivot(
-            row_labels=labels,
+            row_labels=labels,  # type: ignore
             index_col_ids=index_col_ids,
             unpivot_columns=unpivot_columns,
         )
 
         return Block(
             expr,
             column_labels=self.column_labels,
@@ -1251,19 +1255,20 @@
         ]
         if len(column_ids) == 0:
             expr = self.expr
         else:
             expr = self.expr.explode(column_ids)
 
         if ignore_index:
+            new_index_ids = guid.generate_guid()
             return Block(
-                expr.drop_columns(self.index_columns),
+                expr.drop_columns(self.index_columns).promote_offsets(new_index_ids),
                 column_labels=self.column_labels,
                 # Initiates default index creation using the block constructor.
-                index_columns=[],
+                index_columns=[new_index_ids],
             )
         else:
             return Block(
                 expr,
                 column_labels=self.column_labels,
                 index_columns=self.index_columns,
                 index_labels=self.column_labels.names,
@@ -1418,15 +1423,16 @@
         if count > max_results:
             head_block = self.slice(0, max_results)
         else:
             head_block = self
         computed_df, query_job = head_block.to_pandas()
         formatted_df = computed_df.set_axis(self.column_labels, axis=1)
         # we reset the axis and substitute the bf index name(s) for the default
-        formatted_df.index.names = self.index.names  # type: ignore
+        if len(self.index.names) > 0:
+            formatted_df.index.names = self.index.names  # type: ignore
         return formatted_df, count, query_job
 
     def promote_offsets(self, label: Label = None) -> typing.Tuple[Block, str]:
         result_id = guid.generate_guid()
         expr = self._expr.promote_offsets(result_id)
         return (
             Block(
@@ -1902,30 +1908,57 @@
         return Block(expr, index_columns=[offset_index_id], column_labels=labels)
 
     def join(
         self,
         other: Block,
         *,
         how="left",
-        sort=False,
+        sort: bool = False,
         block_identity_join: bool = False,
     ) -> Tuple[Block, Tuple[Mapping[str, str], Mapping[str, str]],]:
+        """
+        Join two blocks objects together, and provide mappings between source columns and output columns.
+
+        Args:
+            other (Block):
+                The right operand of the join operation
+            how (str):
+                Describes the join type. 'inner', 'outer', 'left', or 'right'
+            sort (bool):
+                if true will sort result by index
+            block_identity_join (bool):
+                If true, will not convert join to a projection (implicitly assuming unique indices)
+
+        Returns:
+            Block, (left_mapping, right_mapping): Result block and mappers from input column ids to result column ids.
+        """
+
         if not isinstance(other, Block):
             # TODO(swast): We need to improve this error message to be more
             # actionable for the user. For example, it's possible they
             # could call set_index and try again to resolve this error.
             raise ValueError(
                 f"Tried to join with an unexpected type: {type(other)}. {constants.FEEDBACK_LINK}"
             )
 
         # TODO(swast): Support cross-joins (requires reindexing).
         if how not in {"outer", "left", "right", "inner"}:
             raise NotImplementedError(
                 f"Only how='outer','left','right','inner' currently supported. {constants.FEEDBACK_LINK}"
             )
+        # Special case for null index,
+        if (
+            (self.index.nlevels == other.index.nlevels == 0)
+            and not sort
+            and not block_identity_join
+        ):
+            return join_indexless(self, other, how=how)
+
+        self._throw_if_null_index("join")
+        other._throw_if_null_index("join")
         if self.index.nlevels == other.index.nlevels == 1:
             return join_mono_indexed(
                 self, other, how=how, sort=sort, block_identity_join=block_identity_join
             )
         else:
             # Always sort mult-index join
             return join_multi_indexed(
@@ -2066,14 +2099,20 @@
         block, monotonic_result_id = block.apply_binary_op(
             last_result_id, last_notna_id, ops.and_op  # type: ignore
         )
         result = block.get_stat(monotonic_result_id, agg_ops.all_op)
         self._stats_cache[column_name].update({op_name: result})
         return result
 
+    def _throw_if_null_index(self, opname: str):
+        if len(self.index_columns) == 0:
+            raise bigframes.exceptions.NullIndexError(
+                f"Cannot do {opname} without an index. Set an index using set_index."
+            )
+
     def _get_rows_as_json_values(self) -> Block:
         # We want to preserve any ordering currently present before turning to
         # direct SQL manipulation. We will restore the ordering when we rebuild
         # expression.
         # TODO(shobs): Replace direct SQL manipulation by structured expression
         # manipulation
         ordering_column_name = guid.generate_guid()
@@ -2092,55 +2131,55 @@
             except Exception:
                 raise NameError(
                     f"Column name type '{type(col).__name__}' is not supported for row serialization."
                     " Please consider using a name for which literal_eval(repr(name)) works."
                 )
 
             column_names.append(serialized_column_name)
-        column_names_csv = sql.csv(column_names, quoted=True)
+        column_names_csv = sql.csv(map(sql.simple_literal, column_names))
 
         # index columns count
         index_columns_count = len(self.index_columns)
 
         # column references to form the array of values for the row
         column_references_csv = sql.csv(
             [sql.cast_as_string(col) for col in self.expr.column_ids]
         )
 
         # types of the columns to serialize for the row
         column_types = list(self.index.dtypes) + list(self.dtypes)
-        column_types_csv = sql.csv([str(typ) for typ in column_types], quoted=True)
+        column_types_csv = sql.csv(
+            [sql.simple_literal(str(typ)) for typ in column_types]
+        )
 
         # row dtype to use for deserializing the row as pandas series
         pandas_row_dtype = bigframes.dtypes.lcd_type(*column_types)
         if pandas_row_dtype is None:
             pandas_row_dtype = "object"
-        pandas_row_dtype = sql.quote(str(pandas_row_dtype))
+        pandas_row_dtype = sql.simple_literal(str(pandas_row_dtype))
 
         # create a json column representing row through SQL manipulation
         row_json_column_name = guid.generate_guid()
         select_columns = (
             [ordering_column_name] + list(self.index_columns) + [row_json_column_name]
         )
-        select_columns_csv = sql.csv(
-            [sql.column_reference(col) for col in select_columns]
-        )
+        select_columns_csv = sql.csv([sql.identifier(col) for col in select_columns])
         json_sql = f"""\
 With T0 AS (
 {textwrap.indent(expr_sql, "    ")}
 ),
 T1 AS (
     SELECT *,
            JSON_OBJECT(
                "names", [{column_names_csv}],
                "types", [{column_types_csv}],
                "values", [{column_references_csv}],
                "indexlength", {index_columns_count},
                "dtype", {pandas_row_dtype}
-           ) AS {row_json_column_name} FROM T0
+           ) AS {sql.identifier(row_json_column_name)} FROM T0
 )
 SELECT {select_columns_csv} FROM T1
 """
         ibis_table = self.session.ibis_client.sql(json_sql)
         order_for_ibis_table = ordering.ExpressionOrdering.from_offset_col(
             ordering_column_name
         )
@@ -2206,14 +2245,18 @@
         # TODO(swast): Avoid downloading the whole index by using job
         # metadata, like we do with DataFrame.
         preview = self.to_pandas()
         return repr(preview)
 
     def to_pandas(self) -> pd.Index:
         """Executes deferred operations and downloads the results."""
+        if len(self.column_ids) == 0:
+            raise bigframes.exceptions.NullIndexError(
+                "Cannot materialize index, as this object does not have an index. Set index column(s) using set_index."
+            )
         # Project down to only the index column. So the query can be cached to visualize other data.
         index_columns = list(self._block.index_columns)
         dtypes = dict(zip(index_columns, self.dtypes))
         expr = self._expr.select_columns(index_columns)
         results, _ = self.session._execute(expr)
         df = expr.session._rows_to_dataframe(results, dtypes)
         df = df.set_index(index_columns)
@@ -2247,14 +2290,61 @@
             raise ValueError(f"Cannot resolve index level name {label}")
         return matches[0]
 
     def is_uniquely_named(self: BlockIndexProperties):
         return len(set(self.names)) == len(self.names)
 
 
+def join_indexless(
+    left: Block,
+    right: Block,
+    *,
+    how="left",
+) -> Tuple[Block, Tuple[Mapping[str, str], Mapping[str, str]],]:
+    """Joins two blocks"""
+    left_expr = left.expr
+    right_expr = right.expr
+    left_mappings = [
+        join_defs.JoinColumnMapping(
+            source_table=join_defs.JoinSide.LEFT,
+            source_id=id,
+            destination_id=guid.generate_guid(),
+        )
+        for id in left_expr.column_ids
+    ]
+    right_mappings = [
+        join_defs.JoinColumnMapping(
+            source_table=join_defs.JoinSide.RIGHT,
+            source_id=id,
+            destination_id=guid.generate_guid(),
+        )
+        for id in right_expr.column_ids
+    ]
+    combined_expr = left_expr.try_align_as_projection(
+        right_expr,
+        join_type=how,
+        mappings=(*left_mappings, *right_mappings),
+    )
+    if combined_expr is None:
+        raise bigframes.exceptions.NullIndexError(
+            "Cannot implicitly align objects. Set an explicit index using set_index."
+        )
+    get_column_left = {m.source_id: m.destination_id for m in left_mappings}
+    get_column_right = {m.source_id: m.destination_id for m in right_mappings}
+    block = Block(
+        combined_expr,
+        column_labels=[*left.column_labels, *right.column_labels],
+        index_columns=(),
+    )
+    return (
+        block,
+        (get_column_left, get_column_right),
+    )
+
+
 def join_mono_indexed(
     left: Block,
     right: Block,
     *,
     how="left",
     sort=False,
     block_identity_join: bool = False,
```

### Comparing `bigframes-1.6.0/bigframes/core/compile/__init__.py` & `bigframes-1.7.0/bigframes/core/compile/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/compile/aggregate_compiler.py` & `bigframes-1.7.0/bigframes/core/compile/aggregate_compiler.py`

 * *Files 12% similar despite different names*

```diff
@@ -30,21 +30,22 @@
 
 scalar_compiler = scalar_compilers.scalar_op_compiler
 
 
 def compile_aggregate(
     aggregate: ex.Aggregation,
     bindings: typing.Dict[str, ibis_types.Value],
+    order_by: typing.Sequence[ibis_types.Value] = [],
 ) -> ibis_types.Value:
     if isinstance(aggregate, ex.UnaryAggregation):
         input = scalar_compiler.compile_expression(aggregate.arg, bindings=bindings)
-        return compile_unary_agg(
-            aggregate.op,
-            input,
-        )
+        if aggregate.op.can_order_by:
+            return compile_ordered_unary_agg(aggregate.op, input, order_by=order_by)
+        else:
+            return compile_unary_agg(aggregate.op, input)
     elif isinstance(aggregate, ex.BinaryAggregation):
         left = scalar_compiler.compile_expression(aggregate.left, bindings=bindings)
         right = scalar_compiler.compile_expression(aggregate.right, bindings=bindings)
         return compile_binary_agg(aggregate.op, left, right)
     else:
         raise ValueError(f"Unexpected aggregation: {aggregate}")
 
@@ -62,32 +63,48 @@
     else:
         raise ValueError(f"Unexpected analytic operation: {aggregate}")
 
 
 @functools.singledispatch
 def compile_binary_agg(
     op: agg_ops.WindowOp,
-    input: ibis_types.Column,
+    left: ibis_types.Column,
+    right: ibis_types.Column,
     window: Optional[window_spec.WindowSpec] = None,
 ) -> ibis_types.Value:
     raise ValueError(f"Can't compile unrecognized operation: {op}")
 
 
 @functools.singledispatch
 def compile_unary_agg(
     op: agg_ops.WindowOp,
     input: ibis_types.Column,
     window: Optional[window_spec.WindowSpec] = None,
 ) -> ibis_types.Value:
     raise ValueError(f"Can't compile unrecognized operation: {op}")
 
 
+@functools.singledispatch
+def compile_ordered_unary_agg(
+    op: agg_ops.WindowOp,
+    input: ibis_types.Column,
+    window: Optional[window_spec.WindowSpec] = None,
+    order_by: typing.Sequence[ibis_types.Value] = [],
+) -> ibis_types.Value:
+    raise ValueError(f"Can't compile unrecognized operation: {op}")
+
+
 def numeric_op(operation):
     @functools.wraps(operation)
-    def constrained_op(op, column: ibis_types.Column, window=None):
+    def constrained_op(
+        op,
+        column: ibis_types.Column,
+        window=None,
+        order_by: typing.Sequence[ibis_types.Value] = [],
+    ):
         if column.type().is_boolean():
             column = typing.cast(
                 ibis_types.NumericColumn, column.cast(ibis_dtypes.int64)
             )
         if column.type().is_numeric():
             return operation(op, column, window)
         else:
@@ -100,27 +117,31 @@
 
 ### Specific Op implementations Below
 
 
 @compile_unary_agg.register
 @numeric_op
 def _(
-    op: agg_ops.SumOp, column: ibis_types.NumericColumn, window=None
+    op: agg_ops.SumOp,
+    column: ibis_types.NumericColumn,
+    window=None,
 ) -> ibis_types.NumericValue:
     # Will be null if all inputs are null. Pandas defaults to zero sum though.
     bq_sum = _apply_window_if_present(column.sum(), window)
     return (
         ibis.case().when(bq_sum.isnull(), ibis_types.literal(0)).else_(bq_sum).end()  # type: ignore
     )
 
 
 @compile_unary_agg.register
 @numeric_op
 def _(
-    op: agg_ops.MedianOp, column: ibis_types.NumericColumn, window=None
+    op: agg_ops.MedianOp,
+    column: ibis_types.NumericColumn,
+    window=None,
 ) -> ibis_types.NumericValue:
     # PERCENTILE_CONT has very few allowed windows. For example, "window
     # framing clause is not allowed for analytic function percentile_cont".
     if window is not None:
         raise NotImplementedError(
             f"Median with windowing is not supported. {constants.FEEDBACK_LINK}"
         )
@@ -130,15 +151,17 @@
     # an aggregation, as PERCENTILE_CONT is only an analytic function.
     return cast(ibis_types.NumericValue, column.approx_median())
 
 
 @compile_unary_agg.register
 @numeric_op
 def _(
-    op: agg_ops.ApproxQuartilesOp, column: ibis_types.NumericColumn, window=None
+    op: agg_ops.ApproxQuartilesOp,
+    column: ibis_types.NumericColumn,
+    window=None,
 ) -> ibis_types.NumericValue:
     # PERCENTILE_CONT has very few allowed windows. For example, "window
     # framing clause is not allowed for analytic function percentile_cont".
     if window is not None:
         raise NotImplementedError(
             f"Approx Quartiles with windowing is not supported. {constants.FEEDBACK_LINK}"
         )
@@ -147,31 +170,38 @@
     ).to_expr()[op.quartile]
     return cast(ibis_types.NumericValue, value)
 
 
 @compile_unary_agg.register
 @numeric_op
 def _(
-    op: agg_ops.QuantileOp, column: ibis_types.NumericColumn, window=None
+    op: agg_ops.QuantileOp,
+    column: ibis_types.NumericColumn,
+    window=None,
 ) -> ibis_types.NumericValue:
     return _apply_window_if_present(column.quantile(op.q), window)
 
 
 @compile_unary_agg.register
 @numeric_op
 def _(
-    op: agg_ops.MeanOp, column: ibis_types.NumericColumn, window=None
+    op: agg_ops.MeanOp,
+    column: ibis_types.NumericColumn,
+    window=None,
+    # order_by: typing.Sequence[ibis_types.Value] = [],
 ) -> ibis_types.NumericValue:
     return _apply_window_if_present(column.mean(), window)
 
 
 @compile_unary_agg.register
 @numeric_op
 def _(
-    op: agg_ops.ProductOp, column: ibis_types.NumericColumn, window=None
+    op: agg_ops.ProductOp,
+    column: ibis_types.NumericColumn,
+    window=None,
 ) -> ibis_types.NumericValue:
     # Need to short-circuit as log with zeroes is illegal sql
     is_zero = cast(ibis_types.BooleanColumn, (column == 0))
 
     # There is no product sql aggregate function, so must implement as a sum of logs, and then
     # apply power after. Note, log and power base must be equal! This impl uses base 2.
     logs = cast(
@@ -198,52 +228,78 @@
         .else_(magnitude * pow(-1, negative_count_parity))
         .end()
     )
     return float_result
 
 
 @compile_unary_agg.register
-def _(op: agg_ops.MaxOp, column: ibis_types.Column, window=None) -> ibis_types.Value:
+def _(
+    op: agg_ops.MaxOp,
+    column: ibis_types.Column,
+    window=None,
+) -> ibis_types.Value:
     return _apply_window_if_present(column.max(), window)
 
 
 @compile_unary_agg.register
-def _(op: agg_ops.MinOp, column: ibis_types.Column, window=None) -> ibis_types.Value:
+def _(
+    op: agg_ops.MinOp,
+    column: ibis_types.Column,
+    window=None,
+) -> ibis_types.Value:
     return _apply_window_if_present(column.min(), window)
 
 
 @compile_unary_agg.register
 @numeric_op
-def _(op: agg_ops.StdOp, x: ibis_types.Column, window=None) -> ibis_types.Value:
+def _(
+    op: agg_ops.StdOp,
+    x: ibis_types.Column,
+    window=None,
+) -> ibis_types.Value:
     return _apply_window_if_present(cast(ibis_types.NumericColumn, x).std(), window)
 
 
 @compile_unary_agg.register
 @numeric_op
-def _(op: agg_ops.VarOp, x: ibis_types.Column, window=None) -> ibis_types.Value:
+def _(
+    op: agg_ops.VarOp,
+    x: ibis_types.Column,
+    window=None,
+) -> ibis_types.Value:
     return _apply_window_if_present(cast(ibis_types.NumericColumn, x).var(), window)
 
 
 @compile_unary_agg.register
 @numeric_op
-def _(op: agg_ops.PopVarOp, x: ibis_types.Column, window=None) -> ibis_types.Value:
+def _(
+    op: agg_ops.PopVarOp,
+    x: ibis_types.Column,
+    window=None,
+) -> ibis_types.Value:
     return _apply_window_if_present(
         cast(ibis_types.NumericColumn, x).var(how="pop"), window
     )
 
 
 @compile_unary_agg.register
 def _(
-    op: agg_ops.CountOp, column: ibis_types.Column, window=None
+    op: agg_ops.CountOp,
+    column: ibis_types.Column,
+    window=None,
 ) -> ibis_types.IntegerValue:
     return _apply_window_if_present(column.count(), window)
 
 
 @compile_unary_agg.register
-def _(op: agg_ops.CutOp, x: ibis_types.Column, window=None):
+def _(
+    op: agg_ops.CutOp,
+    x: ibis_types.Column,
+    window=None,
+):
     out = ibis.case()
     if isinstance(op.bins, int):
         col_min = _apply_window_if_present(x.min(), window)
         col_max = _apply_window_if_present(x.max(), window)
         bin_width = (col_max - col_min) / op.bins
 
         if op.labels is False:
@@ -288,15 +344,17 @@
             out = out.when(condition, interval_struct)
     return out.end()
 
 
 @compile_unary_agg.register
 @numeric_op
 def _(
-    self: agg_ops.QcutOp, column: ibis_types.Column, window=None
+    self: agg_ops.QcutOp,
+    column: ibis_types.Column,
+    window=None,
 ) -> ibis_types.IntegerValue:
     if isinstance(self.quantiles, int):
         quantiles_ibis = dtypes.literal_to_ibis_scalar(self.quantiles)
         percent_ranks = cast(
             ibis_types.FloatingColumn,
             _apply_window_if_present(column.percent_rank(), window),
         )
@@ -318,81 +376,105 @@
             )
         out = out.else_(None)
         return out.end()  # type: ignore
 
 
 @compile_unary_agg.register
 def _(
-    op: agg_ops.NuniqueOp, column: ibis_types.Column, window=None
+    op: agg_ops.NuniqueOp,
+    column: ibis_types.Column,
+    window=None,
 ) -> ibis_types.IntegerValue:
     return _apply_window_if_present(column.nunique(), window)
 
 
 @compile_unary_agg.register
 def _(
-    op: agg_ops.AnyValueOp, column: ibis_types.Column, window=None
+    op: agg_ops.AnyValueOp,
+    column: ibis_types.Column,
+    window=None,
 ) -> ibis_types.IntegerValue:
     return _apply_window_if_present(column.arbitrary(), window)
 
 
 @compile_unary_agg.register
 def _(
-    op: agg_ops.RankOp, column: ibis_types.Column, window=None
+    op: agg_ops.RankOp,
+    column: ibis_types.Column,
+    window=None,
 ) -> ibis_types.IntegerValue:
     # Ibis produces 0-based ranks, while pandas creates 1-based ranks
     return _apply_window_if_present(ibis.rank(), window) + 1
 
 
 @compile_unary_agg.register
 def _(
-    op: agg_ops.DenseRankOp, column: ibis_types.Column, window=None
+    op: agg_ops.DenseRankOp,
+    column: ibis_types.Column,
+    window=None,
 ) -> ibis_types.IntegerValue:
     # Ibis produces 0-based ranks, while pandas creates 1-based ranks
     return _apply_window_if_present(column.dense_rank(), window) + 1
 
 
 @compile_unary_agg.register
 def _(op: agg_ops.FirstOp, column: ibis_types.Column, window=None) -> ibis_types.Value:
     return _apply_window_if_present(column.first(), window)
 
 
 @compile_unary_agg.register
 def _(
-    op: agg_ops.FirstNonNullOp, column: ibis_types.Column, window=None
+    op: agg_ops.FirstNonNullOp,
+    column: ibis_types.Column,
+    window=None,
 ) -> ibis_types.Value:
     return _apply_window_if_present(
         vendored_ibis_ops.FirstNonNullValue(column).to_expr(), window  # type: ignore
     )
 
 
 @compile_unary_agg.register
-def _(op: agg_ops.LastOp, column: ibis_types.Column, window=None) -> ibis_types.Value:
+def _(
+    op: agg_ops.LastOp,
+    column: ibis_types.Column,
+    window=None,
+) -> ibis_types.Value:
     return _apply_window_if_present(column.last(), window)
 
 
 @compile_unary_agg.register
 def _(
-    op: agg_ops.LastNonNullOp, column: ibis_types.Column, window=None
+    op: agg_ops.LastNonNullOp,
+    column: ibis_types.Column,
+    window=None,
 ) -> ibis_types.Value:
     return _apply_window_if_present(
         vendored_ibis_ops.LastNonNullValue(column).to_expr(), window  # type: ignore
     )
 
 
 @compile_unary_agg.register
-def _(op: agg_ops.ShiftOp, column: ibis_types.Column, window=None) -> ibis_types.Value:
+def _(
+    op: agg_ops.ShiftOp,
+    column: ibis_types.Column,
+    window=None,
+) -> ibis_types.Value:
     if op.periods == 0:  # No-op
         return column
     if op.periods > 0:
         return _apply_window_if_present(column.lag(op.periods), window)
     return _apply_window_if_present(column.lead(-op.periods), window)
 
 
 @compile_unary_agg.register
-def _(op: agg_ops.DiffOp, column: ibis_types.Column, window=None) -> ibis_types.Value:
+def _(
+    op: agg_ops.DiffOp,
+    column: ibis_types.Column,
+    window=None,
+) -> ibis_types.Value:
     shifted = compile_unary_agg(agg_ops.ShiftOp(op.periods), column, window)
     if column.type().is_boolean():
         return cast(ibis_types.BooleanColumn, column) != cast(
             ibis_types.BooleanColumn, shifted
         )
     elif column.type().is_numeric():
         return cast(ibis_types.NumericColumn, column) - cast(
@@ -400,36 +482,65 @@
         )
     else:
         raise TypeError(f"Cannot perform diff on type{column.type()}")
 
 
 @compile_unary_agg.register
 def _(
-    op: agg_ops.AllOp, column: ibis_types.Column, window=None
+    op: agg_ops.AllOp,
+    column: ibis_types.Column,
+    window=None,
 ) -> ibis_types.BooleanValue:
     # BQ will return null for empty column, result would be true in pandas.
     result = _is_true(column).all()
     return cast(
         ibis_types.BooleanScalar,
         _apply_window_if_present(result, window).fillna(ibis_types.literal(True)),
     )
 
 
 @compile_unary_agg.register
 def _(
-    op: agg_ops.AnyOp, column: ibis_types.Column, window=None
+    op: agg_ops.AnyOp,
+    column: ibis_types.Column,
+    window=None,
 ) -> ibis_types.BooleanValue:
     # BQ will return null for empty column, result would be false in pandas.
     result = _is_true(column).any()
     return cast(
         ibis_types.BooleanScalar,
         _apply_window_if_present(result, window).fillna(ibis_types.literal(False)),
     )
 
 
+@compile_ordered_unary_agg.register
+def _(
+    op: agg_ops.ArrayAggOp,
+    column: ibis_types.Column,
+    window=None,
+    order_by: typing.Sequence[ibis_types.Value] = [],
+) -> ibis_types.ArrayValue:
+    # BigQuery doesn't currently support using ARRAY_AGG with both window and aggregate
+    # functions simultaneously. Some aggregate functions (or its equivalent syntax)
+    # are more important, such as:
+    #    - `IGNORE NULLS` are required to avoid an raised error if the final result
+    #      contains a NULL element.
+    #    - `ORDER BY` are required for the default ordering mode.
+    # To keep things simpler, windowing support is skipped for now.
+    if window is not None:
+        raise NotImplementedError(
+            f"ArrayAgg with windowing is not supported. {constants.FEEDBACK_LINK}"
+        )
+
+    return vendored_ibis_ops.ArrayAggregate(
+        column,
+        order_by=order_by,
+    ).to_expr()
+
+
 @compile_binary_agg.register
 def _(
     op: agg_ops.CorrOp, left: ibis_types.Column, right: ibis_types.Column, window=None
 ) -> ibis_types.NumericValue:
     # Will be null if all inputs are null. Pandas defaults to zero sum though.
     left_numeric = cast(ibis_types.NumericColumn, left)
     right_numeric = cast(ibis_types.NumericColumn, right)
```

### Comparing `bigframes-1.6.0/bigframes/core/compile/compiled.py` & `bigframes-1.7.0/bigframes/core/compile/compiled.py`

 * *Files 3% similar despite different names*

```diff
@@ -12,17 +12,16 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 from __future__ import annotations
 
 import abc
 import functools
 import itertools
-import textwrap
 import typing
-from typing import Collection, Iterable, Literal, Optional, Sequence
+from typing import Collection, Literal, Optional, Sequence
 
 import bigframes_vendored.ibis.expr.operations as vendored_ibis_ops
 import ibis
 import ibis.backends.bigquery as ibis_bigquery
 import ibis.common.deferred  # type: ignore
 import ibis.expr.datatypes as ibis_dtypes
 import ibis.expr.types as ibis_types
@@ -36,14 +35,15 @@
     ascending_over,
     encode_order_string,
     ExpressionOrdering,
     IntegerEncoding,
     OrderingExpression,
 )
 import bigframes.core.schema as schemata
+import bigframes.core.sql
 from bigframes.core.window_spec import RangeWindowBounds, RowsWindowBounds, WindowSpec
 import bigframes.dtypes
 import bigframes.operations.aggregations as agg_ops
 
 ORDER_ID_COLUMN = "bigframes_ordering_id"
 PREDICATE_COLUMN = "bigframes_predicate"
 
@@ -98,14 +98,20 @@
             else None
         )
 
     @property
     def _ibis_bindings(self) -> dict[str, ibis_types.Value]:
         return {col: self._get_ibis_column(col) for col in self.column_ids}
 
+    @property
+    @abc.abstractmethod
+    def is_ordered_ir(self: T) -> bool:
+        """Whether it is a OrderedIR or UnorderedIR."""
+        ...
+
     @abc.abstractmethod
     def filter(self: T, predicate: ex.Expression) -> T:
         """Filter the table on a given expression, the predicate must be a boolean expression."""
         ...
 
     @abc.abstractmethod
     def _reproject_to_table(self: T) -> T:
@@ -159,25 +165,76 @@
             bigframes.dtypes.IbisDtype, self._get_ibis_column(key).type()
         )
         return typing.cast(
             bigframes.dtypes.Dtype,
             bigframes.dtypes.ibis_dtype_to_bigframes_dtype(ibis_type),
         )
 
+    def _aggregate_base(
+        self,
+        table: ibis_types.Table,
+        order_by: typing.Sequence[ibis_types.Value] = [],
+        aggregations: typing.Sequence[typing.Tuple[ex.Aggregation, str]] = [],
+        by_column_ids: typing.Sequence[str] = (),
+        dropna: bool = True,
+    ) -> OrderedIR:
+        assert not self.is_ordered_ir or len(order_by) > 0
+
+        bindings = {col: table[col] for col in self.column_ids}
+        stats = {
+            col_out: agg_compiler.compile_aggregate(
+                aggregate, bindings, order_by=order_by
+            )
+            for aggregate, col_out in aggregations
+        }
+        if by_column_ids:
+            result = table.group_by(by_column_ids).aggregate(**stats)
+            # Must have deterministic ordering, so order by the unique "by" column
+            ordering = ExpressionOrdering(
+                tuple([ascending_over(column_id) for column_id in by_column_ids]),
+                total_ordering_columns=frozenset(by_column_ids),
+            )
+            columns = tuple(result[key] for key in result.columns)
+            expr = OrderedIR(result, columns=columns, ordering=ordering)
+            if dropna:
+                for column_id in by_column_ids:
+                    expr = expr._filter(expr._get_ibis_column(column_id).notnull())
+            return expr
+        else:
+            aggregates = {**stats, ORDER_ID_COLUMN: ibis_types.literal(0)}
+            result = table.aggregate(**aggregates)
+            # Ordering is irrelevant for single-row output, but set ordering id regardless
+            # as other ops(join etc.) expect it.
+            # TODO: Maybe can make completely empty
+            ordering = ExpressionOrdering(
+                ordering_value_columns=tuple([]),
+                total_ordering_columns=frozenset([]),
+            )
+            return OrderedIR(
+                result,
+                columns=[result[col_id] for col_id in [*stats.keys()]],
+                hidden_ordering_columns=[result[ORDER_ID_COLUMN]],
+                ordering=ordering,
+            )
+
 
 # Ibis Implementations
 class UnorderedIR(BaseIbisIR):
     def __init__(
         self,
         table: ibis_types.Table,
         columns: Sequence[ibis_types.Value],
         predicates: Optional[Collection[ibis_types.BooleanValue]] = None,
     ):
         super().__init__(table, columns, predicates)
 
+    @property
+    def is_ordered_ir(self) -> bool:
+        return False
+
     def builder(self):
         """Creates a mutable builder for expressions."""
         # Since ArrayValue is intended to be immutable (immutability offers
         # potential opportunities for caching, though we might need to introduce
         # more node types for that to be useful), we create a builder class.
         return UnorderedIR.Builder(
             self._table,
@@ -306,52 +363,25 @@
         by_column_ids: typing.Sequence[str] = (),
         dropna: bool = True,
     ) -> OrderedIR:
         """
         Apply aggregations to the expression.
         Arguments:
             aggregations: input_column_id, operation, output_column_id tuples
-            by_column_id: column id of the aggregation key, this is preserved through the transform
+            by_column_ids: column ids of the aggregation key, this is preserved through
+              the transform
             dropna: whether null keys should be dropped
+        Returns:
+            OrderedIR: the grouping key is a unique-valued column and has ordering
+              information.
         """
         table = self._to_ibis_expr()
-        bindings = {col: table[col] for col in self.column_ids}
-        stats = {
-            col_out: agg_compiler.compile_aggregate(aggregate, bindings)
-            for aggregate, col_out in aggregations
-        }
-        if by_column_ids:
-            result = table.group_by(by_column_ids).aggregate(**stats)
-            # Must have deterministic ordering, so order by the unique "by" column
-            ordering = ExpressionOrdering(
-                tuple([ascending_over(column_id) for column_id in by_column_ids]),
-                total_ordering_columns=frozenset(by_column_ids),
-            )
-            columns = tuple(result[key] for key in result.columns)
-            expr = OrderedIR(result, columns=columns, ordering=ordering)
-            if dropna:
-                for column_id in by_column_ids:
-                    expr = expr._filter(expr._get_ibis_column(column_id).notnull())
-            # Can maybe remove this as Ordering id is redundant as by_column is unique after aggregation
-            return expr._project_offsets()
-        else:
-            aggregates = {**stats, ORDER_ID_COLUMN: ibis_types.literal(0)}
-            result = table.aggregate(**aggregates)
-            # Ordering is irrelevant for single-row output, but set ordering id regardless as other ops(join etc.) expect it.
-            # TODO: Maybe can make completely empty
-            ordering = ExpressionOrdering(
-                ordering_value_columns=tuple([]),
-                total_ordering_columns=frozenset([]),
-            )
-            return OrderedIR(
-                result,
-                columns=[result[col_id] for col_id in [*stats.keys()]],
-                hidden_ordering_columns=[result[ORDER_ID_COLUMN]],
-                ordering=ordering,
-            )
+        return self._aggregate_base(
+            table, aggregations=aggregations, by_column_ids=by_column_ids, dropna=dropna
+        )
 
     def _uniform_sampling(self, fraction: float) -> UnorderedIR:
         """Sampling the table on given fraction.
 
         .. warning::
             The row numbers of result is non-deterministic, avoid to use.
         """
@@ -522,24 +552,29 @@
         if value_col_ids & hidden_col_ids:
             raise ValueError(
                 f"Keys in both hidden and exposed list: {value_col_ids & hidden_col_ids}"
             )
         if not ordering_valid:
             raise ValueError(f"Illegal ordering keys: {ordering.all_ordering_columns}")
 
+    @property
+    def is_ordered_ir(self) -> bool:
+        return True
+
     @classmethod
     def from_pandas(
         cls,
         pd_df: pandas.DataFrame,
         schema: schemata.ArraySchema,
     ) -> OrderedIR:
         """
         Builds an in-memory only (SQL only) expr from a pandas dataframe.
 
-        Assumed that the dataframe has unique string column names and bigframes-suppported dtypes.
+        Assumed that the dataframe has unique string column names and bigframes-suppported
+        dtypes.
         """
 
         # ibis memtable cannot handle NA, must convert to None
         # this destroys the schema however
         ibis_values = pd_df.astype("object").where(pandas.notnull(pd_df), None)  # type: ignore
         ibis_values = ibis_values.assign(**{ORDER_ID_COLUMN: range(len(pd_df))})
         # derive the ibis schema from the original pandas schema
@@ -568,15 +603,16 @@
 
     @property
     def _hidden_column_ids(self) -> typing.Sequence[str]:
         return tuple(self._hidden_ordering_column_names.keys())
 
     @property
     def _ibis_order(self) -> Sequence[ibis_types.Value]:
-        """Returns a sequence of ibis values which can be directly used to order a table expression. Has direction modifiers applied."""
+        """Returns a sequence of ibis values which can be directly used to order a
+        table expression. Has direction modifiers applied."""
         return _convert_ordering_to_table_values(
             {**self._column_names, **self._hidden_ordering_column_names},
             self._ordering.all_ordering_columns,
         )
 
     def to_unordered(self) -> UnorderedIR:
         return UnorderedIR(self._table, self._columns, self._predicates)
@@ -600,14 +636,52 @@
         return expr_builder.build()
 
     def reversed(self) -> OrderedIR:
         expr_builder = self.builder()
         expr_builder.ordering = self._ordering.with_reverse()
         return expr_builder.build()
 
+    def aggregate(
+        self,
+        aggregations: typing.Sequence[typing.Tuple[ex.Aggregation, str]],
+        by_column_ids: typing.Sequence[str] = (),
+        dropna: bool = True,
+    ) -> OrderedIR:
+        """
+        Apply aggregations to the expression.
+        Arguments:
+            aggregations: input_column_id, operation, output_column_id tuples
+            by_column_ids: column ids of the aggregation key, this is preserved through
+              the transform
+            dropna: whether null keys should be dropped
+        Returns:
+            OrderedIR
+        """
+        table = self._to_ibis_expr(ordering_mode="unordered", expose_hidden_cols=True)
+
+        all_columns = {
+            column_name: table[column_name]
+            for column_name in {
+                **self._column_names,
+                **self._hidden_ordering_column_names,
+            }
+        }
+        order_by = _convert_ordering_to_table_values(
+            all_columns,
+            self._ordering.all_ordering_columns,
+        )
+
+        return self._aggregate_base(
+            table,
+            order_by=order_by,
+            aggregations=aggregations,
+            by_column_ids=by_column_ids,
+            dropna=dropna,
+        )
+
     def _uniform_sampling(self, fraction: float) -> OrderedIR:
         """Sampling the table on given fraction.
 
         .. warning::
             The row numbers of result is non-deterministic, avoid to use.
         """
         table = self._to_ibis_expr(
@@ -817,52 +891,34 @@
                 baked_ir._to_ibis_expr(
                     ordering_mode="unordered",
                     col_id_overrides=col_id_overrides,
                     expose_hidden_cols=True,
                 )
             )
             output_columns = [
-                col_id_overrides.get(col) if (col in col_id_overrides) else col
-                for col in baked_ir.column_ids
+                col_id_overrides.get(col, col) for col in baked_ir.column_ids
             ]
-            selection = ", ".join(map(lambda col_id: f"`{col_id}`", output_columns))
+            sql = bigframes.core.sql.select_from_subquery(output_columns, sql)
 
-            sql = textwrap.dedent(f"SELECT {selection}\n" "FROM (\n" f"{sql}\n" ")\n")
             # Single row frames may not have any ordering columns
             if len(baked_ir._ordering.all_ordering_columns) > 0:
-                order_by_clause = baked_ir._ordering_clause(
+                order_by_clause = bigframes.core.sql.ordering_clause(
                     baked_ir._ordering.all_ordering_columns
                 )
                 sql += f"{order_by_clause}\n"
         else:
             sql = ibis_bigquery.Backend().compile(
                 self._to_ibis_expr(
                     ordering_mode="unordered",
                     col_id_overrides=col_id_overrides,
                     expose_hidden_cols=False,
                 )
             )
         return typing.cast(str, sql)
 
-    def _ordering_clause(self, ordering: Iterable[OrderingExpression]) -> str:
-        parts = []
-        for col_ref in ordering:
-            asc_desc = "ASC" if col_ref.direction.is_ascending else "DESC"
-            null_clause = "NULLS LAST" if col_ref.na_last else "NULLS FIRST"
-            ordering_expr = col_ref.scalar_expression
-            # We don't know how to compile scalar expressions in isolation
-            if ordering_expr.is_const:
-                # Probably shouldn't have constants in ordering definition, but best to ignore if somehow they end up here.
-                continue
-            if not isinstance(ordering_expr, ex.UnboundVariableExpression):
-                raise ValueError("Expected direct column reference.")
-            part = f"`{ordering_expr.id}` {asc_desc} {null_clause}"
-            parts.append(part)
-        return f"ORDER BY {' ,'.join(parts)}"
-
     def _to_ibis_expr(
         self,
         *,
         expose_hidden_cols: bool = False,
         fraction: Optional[float] = None,
         col_id_overrides: typing.Mapping[str, str] = {},
         ordering_mode: Literal["string_encoded", "offset_col", "unordered"],
@@ -1083,15 +1139,16 @@
             columns=self.columns,
             hidden_ordering_columns=tuple(new_baked_cols),
             ordering=new_ordering,
             predicates=self._predicates,
         )
 
     def _project_offsets(self) -> OrderedIR:
-        """Create a new expression that contains offsets. Should only be executed when offsets are needed for an operations. Has no effect on expression semantics."""
+        """Create a new expression that contains offsets. Should only be executed when
+        offsets are needed for an operations. Has no effect on expression semantics."""
         if self._ordering.is_sequential:
             return self
         table = self._to_ibis_expr(
             ordering_mode="offset_col", order_col_name=ORDER_ID_COLUMN
         )
         columns = [table[column_name] for column_name in self._column_names]
         ordering = ExpressionOrdering(
```

### Comparing `bigframes-1.6.0/bigframes/core/compile/compiler.py` & `bigframes-1.7.0/bigframes/core/compile/compiler.py`

 * *Files 3% similar despite different names*

```diff
@@ -151,18 +151,26 @@
 def compile_rowcount(node: nodes.RowCountNode, ordered: bool = True):
     result = compile_unordered_ir(node.child).row_count()
     return result if ordered else result.to_unordered()
 
 
 @_compile_node.register
 def compile_aggregate(node: nodes.AggregateNode, ordered: bool = True):
-    result = compile_unordered_ir(node.child).aggregate(
-        node.aggregations, node.by_column_ids, node.dropna
+    has_ordered_aggregation_ops = any(
+        aggregate.op.can_order_by for aggregate, _ in node.aggregations
     )
-    return result if ordered else result.to_unordered()
+    if ordered and has_ordered_aggregation_ops:
+        return compile_ordered_ir(node.child).aggregate(
+            node.aggregations, node.by_column_ids, node.dropna
+        )
+    else:
+        result = compile_unordered_ir(node.child).aggregate(
+            node.aggregations, node.by_column_ids, node.dropna
+        )
+        return result if ordered else result.to_unordered()
 
 
 @_compile_node.register
 def compile_window(node: nodes.WindowOpNode, ordered: bool = True):
     result = compile_ordered_ir(node.child).project_window_op(
         node.column_name,
         node.op,
@@ -176,14 +184,14 @@
 
 @_compile_node.register
 def compile_reproject(node: nodes.ReprojectOpNode, ordered: bool = True):
     return compile_node(node.child, ordered)._reproject_to_table()
 
 
 @_compile_node.register
-def compiler_explode(node: nodes.ExplodeNode, ordered: bool = True):
+def compile_explode(node: nodes.ExplodeNode, ordered: bool = True):
     return compile_node(node.child, ordered).explode(node.column_ids)
 
 
 @_compile_node.register
-def compiler_random_sample(node: nodes.RandomSampleNode, ordered: bool = True):
+def compile_random_sample(node: nodes.RandomSampleNode, ordered: bool = True):
     return compile_node(node.child, ordered)._uniform_sampling(node.fraction)
```

### Comparing `bigframes-1.6.0/bigframes/core/compile/concat.py` & `bigframes-1.7.0/bigframes/core/compile/concat.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/compile/scalar_op_compiler.py` & `bigframes-1.7.0/bigframes/core/compile/scalar_op_compiler.py`

 * *Files 2% similar despite different names*

```diff
@@ -13,14 +13,15 @@
 # limitations under the License.
 
 from __future__ import annotations
 
 import functools
 import typing
 
+import bigframes_vendored.ibis.expr.operations as vendored_ibis_ops
 import ibis
 import ibis.common.exceptions
 import ibis.expr.datatypes as ibis_dtypes
 import ibis.expr.operations.generic
 import ibis.expr.types as ibis_types
 import numpy as np
 import pandas as pd
@@ -733,15 +734,15 @@
     if isinstance(op.name_or_index, str):
         name = op.name_or_index
     else:
         name = struct_value.names[op.name_or_index]
     return struct_value[name].name(name)
 
 
-def numeric_to_datatime(x: ibis_types.Value, unit: str) -> ibis_types.TimestampValue:
+def numeric_to_datetime(x: ibis_types.Value, unit: str) -> ibis_types.TimestampValue:
     if not isinstance(x, ibis_types.IntegerValue) and not isinstance(
         x, ibis_types.FloatingValue
     ):
         raise TypeError("Non-numerical types are not supposed to reach this function.")
 
     if unit not in UNIT_TO_US_CONVERSION_FACTORS:
         raise ValueError(f"Cannot convert input with unit '{unit}'.")
@@ -775,15 +776,15 @@
         return x.delta(ibis.time("00:00:00"), part="microsecond")
 
     if x.type() == ibis_dtypes.int64:
         # The conversion unit is set to "us" (microseconds) for consistency
         # with pandas converting int64[pyarrow] to timestamp[us][pyarrow],
         # timestamp[us, tz=UTC][pyarrow], and time64[us][pyarrow].
         unit = "us"
-        x_converted = numeric_to_datatime(x, unit)
+        x_converted = numeric_to_datetime(x, unit)
         if to_type == ibis_dtypes.timestamp:
             return x_converted.cast(ibis_dtypes.Timestamp())
         elif to_type == ibis_dtypes.Timestamp(timezone="UTC"):
             return x_converted
         elif to_type == ibis_dtypes.time:
             return x_converted.time()
 
@@ -814,31 +815,47 @@
     else:
         return x.isin(matchable_ibis_values)
 
 
 @scalar_op_compiler.register_unary_op(ops.ToDatetimeOp, pass_op=True)
 def to_datetime_op_impl(x: ibis_types.Value, op: ops.ToDatetimeOp):
     if x.type() == ibis_dtypes.str:
-        x = x.to_timestamp(op.format) if op.format else timestamp(x)
-    elif x.type() == ibis_dtypes.Timestamp(timezone="UTC"):
+        return vendored_ibis_ops.SafeCastToDatetime(x).to_expr()
+    else:
+        # Numerical inputs.
         if op.format:
-            raise NotImplementedError(
-                f"Format parameter is not supported for Timestamp input types. {constants.FEEDBACK_LINK}"
-            )
-        return x
-    elif x.type() != ibis_dtypes.timestamp:
+            x = x.cast(ibis_dtypes.str).to_timestamp(op.format)
+        else:
+            # The default unit is set to "ns" (nanoseconds) for consistency
+            # with pandas, where "ns" is the default unit for datetime operations.
+            unit = op.unit or "ns"
+            x = numeric_to_datetime(x, unit)
+
+    return x.cast(ibis_dtypes.Timestamp(None))
+
+
+@scalar_op_compiler.register_unary_op(ops.ToTimestampOp, pass_op=True)
+def to_timestamp_op_impl(x: ibis_types.Value, op: ops.ToTimestampOp):
+    if x.type() == ibis_dtypes.str:
+        x = (
+            typing.cast(ibis_types.StringValue, x).to_timestamp(op.format)
+            if op.format
+            else timestamp(x)
+        )
+    else:
+        # Numerical inputs.
         if op.format:
             x = x.cast(ibis_dtypes.str).to_timestamp(op.format)
         else:
             # The default unit is set to "ns" (nanoseconds) for consistency
             # with pandas, where "ns" is the default unit for datetime operations.
             unit = op.unit or "ns"
-            x = numeric_to_datatime(x, unit)
+            x = numeric_to_datetime(x, unit)
 
-    return x.cast(ibis_dtypes.Timestamp(timezone="UTC" if op.utc else None))
+    return x.cast(ibis_dtypes.Timestamp(timezone="UTC"))
 
 
 @scalar_op_compiler.register_unary_op(ops.RemoteFunctionOp, pass_op=True)
 def remote_function_op_impl(x: ibis_types.Value, op: ops.RemoteFunctionOp):
     if not hasattr(op.func, "bigframes_remote_function"):
         raise TypeError(
             f"only a bigframes remote function is supported as a callable. {constants.FEEDBACK_LINK}"
```

### Comparing `bigframes-1.6.0/bigframes/core/compile/single_column.py` & `bigframes-1.7.0/bigframes/core/compile/single_column.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/convert.py` & `bigframes-1.7.0/bigframes/core/convert.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/eval.py` & `bigframes-1.7.0/bigframes/core/eval.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/expression.py` & `bigframes-1.7.0/bigframes/core/expression.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/global_session.py` & `bigframes-1.7.0/bigframes/core/global_session.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/groupby/__init__.py` & `bigframes-1.7.0/bigframes/core/groupby/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/guid.py` & `bigframes-1.7.0/bigframes/core/guid.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/indexers.py` & `bigframes-1.7.0/bigframes/core/indexers.py`

 * *Files 0% similar despite different names*

```diff
@@ -156,15 +156,16 @@
                 df = typing.cast(
                     bigframes.dataframe.DataFrame,
                     _loc_getitem_series_or_dataframe(self._dataframe, key[0]),
                 )
 
                 columns = key[1]
                 if isinstance(columns, pd.Series) and columns.dtype == "bool":
-                    columns = df.columns[columns]
+                    # TODO(b/340892590): fix type error
+                    columns = df.columns[columns]  # type: ignore
 
                 return df[columns]
 
         return typing.cast(
             bigframes.dataframe.DataFrame,
             _loc_getitem_series_or_dataframe(self._dataframe, key),
         )
```

### Comparing `bigframes-1.6.0/bigframes/core/indexes/__init__.py` & `bigframes-1.7.0/bigframes/core/indexes/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/indexes/base.py` & `bigframes-1.7.0/bigframes/core/indexes/base.py`

 * *Files 1% similar despite different names*

```diff
@@ -87,23 +87,29 @@
             pd_df = pandas.DataFrame(index=pd_index)
             block = df.DataFrame(pd_df, session=session)._block
 
         # TODO: Support more index subtypes
         from bigframes.core.indexes.multi import MultiIndex
 
         klass = MultiIndex if len(block._index_columns) > 1 else cls
-        result = typing.cast(Index, object.__new__(klass))
+        # TODO(b/340893286): fix type error
+        result = typing.cast(Index, object.__new__(klass))  # type: ignore
         result._query_job = None
         result._block = block
         return result
 
     @classmethod
     def from_frame(
         cls, frame: Union[bigframes.series.Series, bigframes.dataframe.DataFrame]
     ) -> Index:
+        if len(frame._block.index_columns) == 0:
+            raise bigframes.exceptions.NullIndexError(
+                "Cannot access index properties with Null Index. Set an index using set_index."
+            )
+        frame._block._throw_if_null_index("from_frame")
         index = Index(frame._block)
         index._linked_frame = frame
         return index
 
     @property
     def name(self) -> blocks.Label:
         names = self.names
```

### Comparing `bigframes-1.6.0/bigframes/core/indexes/multi.py` & `bigframes-1.7.0/bigframes/core/indexes/multi.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/join_def.py` & `bigframes-1.7.0/bigframes/core/join_def.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/joins/__init__.py` & `bigframes-1.7.0/bigframes/core/joins/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/joins/merge.py` & `bigframes-1.7.0/bigframes/core/joins/merge.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/local_data.py` & `bigframes-1.7.0/bigframes/core/local_data.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/log_adapter.py` & `bigframes-1.7.0/bigframes/core/log_adapter.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/nodes.py` & `bigframes-1.7.0/bigframes/core/nodes.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/ordering.py` & `bigframes-1.7.0/bigframes/core/ordering.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/reshape/__init__.py` & `bigframes-1.7.0/bigframes/core/reshape/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/rewrite.py` & `bigframes-1.7.0/bigframes/core/rewrite.py`

 * *Files 3% similar despite different names*

```diff
@@ -94,33 +94,40 @@
             order_part.bind_variables(self.column_lookup) for order_part in by
         ]
         new_ordering = (*adjusted_orderings, *self.ordering)
         return SquashedSelect(
             self.root, self.columns, self.predicate, new_ordering, self.reverse_root
         )
 
-    def maybe_join(
+    def can_join(
         self, right: SquashedSelect, join_def: join_defs.JoinDefinition
-    ) -> Optional[SquashedSelect]:
+    ) -> bool:
         if join_def.type == "cross":
             # Cannot convert cross join to projection
-            return None
+            return False
 
         r_exprs_by_id = {id: expr for expr, id in right.columns}
         l_exprs_by_id = {id: expr for expr, id in self.columns}
         l_join_exprs = [l_exprs_by_id[cond.left_id] for cond in join_def.conditions]
         r_join_exprs = [r_exprs_by_id[cond.right_id] for cond in join_def.conditions]
 
         if (self.root != right.root) or any(
             l_expr != r_expr for l_expr, r_expr in zip(l_join_exprs, r_join_exprs)
         ):
-            return None
-
-        join_type = join_def.type
+            return False
+        return True
 
+    def maybe_merge(
+        self,
+        right: SquashedSelect,
+        join_type: join_defs.JoinType,
+        mappings: Tuple[join_defs.JoinColumnMapping, ...],
+    ) -> Optional[SquashedSelect]:
+        if self.root != right.root:
+            return None
         # Mask columns and remap names to expected schema
         lselection = self.columns
         rselection = right.columns
         if join_type == "inner":
             new_predicate = and_predicates(self.predicate, right.predicate)
         elif join_type == "outer":
             new_predicate = or_predicates(self.predicate, right.predicate)
@@ -132,15 +139,15 @@
         l_relative, r_relative = relative_predicates(self.predicate, right.predicate)
         lmask = l_relative if join_type in {"right", "outer"} else None
         rmask = r_relative if join_type in {"left", "outer"} else None
         if lmask is not None:
             lselection = tuple((apply_mask(expr, lmask), id) for expr, id in lselection)
         if rmask is not None:
             rselection = tuple((apply_mask(expr, rmask), id) for expr, id in rselection)
-        new_columns = remap_names(join_def, lselection, rselection)
+        new_columns = remap_names(mappings, lselection, rselection)
 
         # Reconstruct ordering
         reverse_root = self.reverse_root
         if join_type == "right":
             new_ordering = right.ordering
             reverse_root = right.reverse_root
         elif join_type == "outer":
@@ -197,28 +204,35 @@
         return SquashedSelect.from_node(node, projections_only=True).expand()
     return node
 
 
 def maybe_rewrite_join(join_node: nodes.JoinNode) -> nodes.BigFrameNode:
     left_side = SquashedSelect.from_node(join_node.left_child)
     right_side = SquashedSelect.from_node(join_node.right_child)
-    joined = left_side.maybe_join(right_side, join_node.join)
-    if joined is not None:
-        return joined.expand()
+    if left_side.can_join(right_side, join_node.join):
+        merged = left_side.maybe_merge(
+            right_side, join_node.join.type, join_node.join.mappings
+        )
+        assert (
+            merged is not None
+        ), "Couldn't merge nodes. This shouldn't happen. Please share full stacktrace with the BigQuery DataFrames team at bigframes-feedback@google.com."
+        return merged.expand()
     else:
         return join_node
 
 
 def remap_names(
-    join: join_defs.JoinDefinition, lselection: Selection, rselection: Selection
+    mappings: Tuple[join_defs.JoinColumnMapping, ...],
+    lselection: Selection,
+    rselection: Selection,
 ) -> Selection:
     new_selection: Selection = tuple()
     l_exprs_by_id = {id: expr for expr, id in lselection}
     r_exprs_by_id = {id: expr for expr, id in rselection}
-    for mapping in join.mappings:
+    for mapping in mappings:
         if mapping.source_table == join_defs.JoinSide.LEFT:
             expr = l_exprs_by_id[mapping.source_id]
         else:  # Right
             expr = r_exprs_by_id[mapping.source_id]
         id = mapping.destination_id
         new_selection = (*new_selection, (expr, id))
     return new_selection
```

### Comparing `bigframes-1.6.0/bigframes/core/scalar.py` & `bigframes-1.7.0/bigframes/core/scalar.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/schema.py` & `bigframes-1.7.0/bigframes/core/schema.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/tools/__init__.py` & `bigframes-1.7.0/bigframes/core/tools/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/tools/datetimes.py` & `bigframes-1.7.0/bigframes/core/tools/datetimes.py`

 * *Files 26% similar despite different names*

```diff
@@ -17,14 +17,15 @@
 from typing import Optional, Union
 
 import bigframes_vendored.pandas.core.tools.datetimes as vendored_pandas_datetimes
 import pandas as pd
 
 import bigframes.constants as constants
 import bigframes.dataframe
+import bigframes.dtypes
 import bigframes.operations as ops
 import bigframes.series
 
 
 def to_datetime(
     arg: Union[
         vendored_pandas_datetimes.local_scalars,
@@ -47,29 +48,72 @@
 
     if isinstance(arg, (Mapping, pd.DataFrame, bigframes.dataframe.DataFrame)):
         raise NotImplementedError(
             "Conversion of Mapping, pandas.DataFrame, or bigframes.dataframe.DataFrame "
             f"to datetime is not implemented. {constants.FEEDBACK_LINK}"
         )
 
-    arg = bigframes.series.Series(arg)
+    arg = bigframes.series.Series(arg)._cached()
 
-    if not utc and arg.dtype not in ("Int64", "Float64"):  # type: ignore
-        raise NotImplementedError(
-            f"String and Timestamp requires utc=True. {constants.FEEDBACK_LINK}"
-        )
-
-    if format and unit and arg.dtype in ("Int64", "Float64"):  # type: ignore
+    if format and unit and arg.dtype in (bigframes.dtypes.INT_DTYPE, bigframes.dtypes.FLOAT_DTYPE):  # type: ignore
         raise ValueError("cannot specify both format and unit")
 
-    if unit and arg.dtype not in ("Int64", "Float64"):  # type: ignore
+    if unit and arg.dtype not in (bigframes.dtypes.INT_DTYPE, bigframes.dtypes.FLOAT_DTYPE):  # type: ignore
         raise NotImplementedError(
             f"Unit parameter is not supported for non-numerical input types. {constants.FEEDBACK_LINK}"
         )
 
-    return arg._apply_unary_op(  # type: ignore
-        ops.ToDatetimeOp(
-            utc=utc,
-            format=format,
-            unit=unit,
+    if arg.dtype in (bigframes.dtypes.TIMESTAMP_DTYPE, bigframes.dtypes.DATETIME_DTYPE):
+        to_type = (
+            bigframes.dtypes.TIMESTAMP_DTYPE if utc else bigframes.dtypes.DATETIME_DTYPE
+        )
+        return arg._apply_unary_op(ops.AsTypeOp(to_type=to_type))  # type: ignore
+    if (not utc) and arg.dtype == bigframes.dtypes.STRING_DTYPE:
+        if format:
+            raise NotImplementedError(
+                f"Customized formats are not supported for string inputs when utc=False. Please set utc=True if possible. {constants.FEEDBACK_LINK}"
+            )
+
+        assert unit is None
+        as_datetime = arg._apply_unary_op(  # type: ignore
+            ops.ToDatetimeOp(
+                format=format,
+                unit=unit,
+            )
+        )
+        failed_datetime_cast = arg.notnull() & as_datetime.isnull()
+        is_utc = arg._apply_unary_op(
+            ops.EndsWithOp(
+                pat=("Z", "-00:00", "+00:00", "-0000", "+0000", "-00", "+00")
+            )
+        )
+
+        # Cast to DATETIME shall succeed if all inputs are tz-naive.
+        if not failed_datetime_cast.any():
+            return as_datetime
+
+        if is_utc.all():
+            return arg._apply_unary_op(  # type: ignore
+                ops.ToTimestampOp(
+                    format=format,
+                    unit=unit,
+                )
+            )
+
+        raise NotImplementedError(
+            f"Non-UTC string inputs are not supported when utc=False. Please set utc=True if possible. {constants.FEEDBACK_LINK}"
+        )
+    # If utc:
+    elif utc:
+        return arg._apply_unary_op(  # type: ignore
+            ops.ToTimestampOp(
+                format=format,
+                unit=unit,
+            )
+        )
+    else:
+        return arg._apply_unary_op(  # type: ignore
+            ops.ToDatetimeOp(
+                format=format,
+                unit=unit,
+            )
         )
-    )
```

### Comparing `bigframes-1.6.0/bigframes/core/tree_properties.py` & `bigframes-1.7.0/bigframes/core/tree_properties.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/utils.py` & `bigframes-1.7.0/bigframes/core/utils.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/window/__init__.py` & `bigframes-1.7.0/bigframes/core/window/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/core/window_spec.py` & `bigframes-1.7.0/bigframes/core/window_spec.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/dataframe.py` & `bigframes-1.7.0/bigframes/dataframe.py`

 * *Files 1% similar despite different names*

```diff
@@ -13,14 +13,15 @@
 # limitations under the License.
 
 """DataFrame is a two dimensional data structure."""
 
 from __future__ import annotations
 
 import datetime
+import functools
 import inspect
 import re
 import sys
 import textwrap
 import typing
 from typing import (
     Callable,
@@ -38,14 +39,15 @@
 
 import bigframes_vendored.pandas.core.frame as vendored_pandas_frame
 import bigframes_vendored.pandas.pandas._typing as vendored_pandas_typing
 import google.api_core.exceptions
 import google.cloud.bigquery as bigquery
 import numpy
 import pandas
+import pandas.io.formats.format
 import tabulate
 
 import bigframes
 import bigframes._config.display_options as display_options
 import bigframes.constants as constants
 import bigframes.core
 from bigframes.core import log_adapter
@@ -83,14 +85,23 @@
 ERROR_IO_REQUIRES_WILDCARD = (
     "Google Cloud Storage path must contain a wildcard '*' character. See: "
     "https://cloud.google.com/bigquery/docs/reference/standard-sql/other-statements#export_data_statement"
     f"{constants.FEEDBACK_LINK}"
 )
 
 
+def requires_index(meth):
+    @functools.wraps(meth)
+    def guarded_meth(df: DataFrame, *args, **kwargs):
+        df._throw_if_null_index(meth.__name__)
+        return meth(df, *args, **kwargs)
+
+    return guarded_meth
+
+
 # Inherits from pandas DataFrame so that we can use the same docstrings.
 @log_adapter.class_logger
 class DataFrame(vendored_pandas_frame.DataFrame):
     __doc__ = vendored_pandas_frame.DataFrame.__doc__
 
     def __init__(
         self,
@@ -240,14 +251,15 @@
             col_ids = self._block.label_to_col_id.get(label, [])
             if not tolerance and len(col_ids) == 0:
                 raise ValueError(f"Column name {label} doesn't exist")
             results = (*results, *col_ids)
         return results
 
     @property
+    @requires_index
     def index(
         self,
     ) -> indexes.Index:
         return indexes.Index.from_frame(self)
 
     @index.setter
     def index(self, value):
@@ -255,26 +267,28 @@
         result = self._assign_single_item("_new_bf_index", value).set_index(
             "_new_bf_index"
         )
         self._set_block(result._get_block())
         self.index.name = value.name if hasattr(value, "name") else None
 
     @property
+    @requires_index
     def loc(self) -> indexers.LocDataFrameIndexer:
         return indexers.LocDataFrameIndexer(self)
 
     @property
     def iloc(self) -> indexers.ILocDataFrameIndexer:
         return indexers.ILocDataFrameIndexer(self)
 
     @property
     def iat(self) -> indexers.IatDataFrameIndexer:
         return indexers.IatDataFrameIndexer(self)
 
     @property
+    @requires_index
     def at(self) -> indexers.AtDataFrameIndexer:
         return indexers.AtDataFrameIndexer(self)
 
     @property
     def dtypes(self) -> pandas.Series:
         return pandas.Series(data=self._block.dtypes, index=self._block.column_labels)
 
@@ -314,17 +328,22 @@
         return self._session.bqclient
 
     @property
     def _session(self) -> bigframes.Session:
         return self._get_block().expr.session
 
     @property
+    def _has_index(self) -> bool:
+        return len(self._block.index_columns) > 0
+
+    @property
     def T(self) -> DataFrame:
         return DataFrame(self._get_block().transpose())
 
+    @requires_index
     def transpose(self) -> DataFrame:
         return self.T
 
     def __len__(self):
         rows, _ = self.shape
         return rows
 
@@ -609,15 +628,23 @@
         )
 
         self._set_internal_query_job(query_job)
 
         column_count = len(pandas_df.columns)
 
         with display_options.pandas_repr(opts):
-            repr_string = repr(pandas_df)
+            import pandas.io.formats
+
+            # safe to mutate this, this dict is owned by this code, and does not affect global config
+            to_string_kwargs = (
+                pandas.io.formats.format.get_dataframe_repr_params()  # type: ignore
+            )
+            if not self._has_index:
+                to_string_kwargs.update({"index": False})
+            repr_string = pandas_df.to_string(**to_string_kwargs)
 
         # Modify the end of the string to reflect count.
         lines = repr_string.split("\n")
         pattern = re.compile("\\[[0-9]+ rows x [0-9]+ columns\\]")
         if pattern.match(lines[-1]):
             lines = lines[:-2]
 
@@ -809,23 +836,26 @@
     ) -> DataFrame:
         # Join rows
         block, (get_column_left, get_column_right) = self._block.join(
             other._block, how=how
         )
         # join columns schema
         # indexers will be none for exact match
-        columns, lcol_indexer, rcol_indexer = self.columns.join(
-            other.columns, how=how, return_indexers=True
-        )
+        if self.columns.equals(other.columns):
+            columns, lcol_indexer, rcol_indexer = self.columns, None, None
+        else:
+            columns, lcol_indexer, rcol_indexer = self.columns.join(
+                other.columns, how=how, return_indexers=True
+            )
 
         binop_result_ids = []
 
         column_indices = zip(
             lcol_indexer if (lcol_indexer is not None) else range(len(columns)),
-            rcol_indexer if (lcol_indexer is not None) else range(len(columns)),
+            rcol_indexer if (rcol_indexer is not None) else range(len(columns)),
         )
 
         for left_index, right_index in column_indices:
             if left_index >= 0 and right_index >= 0:  # -1 indices indicate missing
                 self_col_id = get_column_left[self._block.value_columns[left_index]]
                 other_col_id = get_column_right[other._block.value_columns[right_index]]
                 expr = (
@@ -1325,14 +1355,15 @@
             if axis_n == 0:
                 index = labels
             else:
                 columns = labels
 
         block = self._block
         if index is not None:
+            self._throw_if_null_index("drop(axis=0)")
             level_id = self._resolve_levels(level or 0)[0]
 
             if utils.is_list_like(index):
                 # Only tuple is treated as multi-index value combinations
                 if isinstance(index, tuple):
                     if level is not None:
                         raise ValueError("Multi-index tuple can't specify level.")
@@ -1599,14 +1630,15 @@
         missing = [keys[i] for i in range(len(col_ids)) if col_ids[i] is None]
         if len(missing) > 0:
             raise KeyError(f"None of {missing} are in the columns")
         # convert col_ids to non-optional strs since we just determined they are not None
         col_ids_strs: List[str] = [col_id for col_id in col_ids if col_id is not None]
         return DataFrame(self._block.set_index(col_ids_strs, append=append, drop=drop))
 
+    @requires_index
     def sort_index(
         self, ascending: bool = True, na_position: Literal["first", "last"] = "last"
     ) -> DataFrame:
         if na_position not in ["first", "last"]:
             raise ValueError("Param na_position must be one of 'first' or 'last'")
         na_last = na_position == "last"
         index_columns = self._block.index_columns
@@ -1758,15 +1790,16 @@
         if (like is not None) or (regex is not None):
 
             def label_filter(label):
                 label_str = label if isinstance(label, str) else str(label)
                 if like:
                     return like in label_str
                 else:  # regex
-                    return re.match(regex, label_str) is not None
+                    # TODO(b/340891296): fix type error
+                    return re.match(regex, label_str) is not None  # type: ignore
 
             cols = [
                 col_id
                 for col_id, label in zip(self._block.value_columns, self.columns)
                 if label_filter(label)
             ]
             return DataFrame(self._block.select_columns(cols))
@@ -1799,14 +1832,15 @@
                 index, validate=validate or False
             )
         if index is not None:
             return self._reindex_rows(index, validate=validate or False)
         if columns is not None:
             return self._reindex_columns(columns)
 
+    @requires_index
     def _reindex_rows(
         self,
         index,
         *,
         validate: typing.Optional[bool] = None,
     ):
         if validate and not self.index.is_unique:
@@ -1845,17 +1879,19 @@
                     pandas.NA, label, dtype=pandas.Float64Dtype()
                 )
                 result_cols.append(null_col)
         result_df = DataFrame(block.select_columns(result_cols))
         result_df.columns = new_column_index
         return result_df
 
+    @requires_index
     def reindex_like(self, other: DataFrame, *, validate: typing.Optional[bool] = None):
         return self.reindex(index=other.index, columns=other.columns, validate=validate)
 
+    @requires_index
     def interpolate(self, method: str = "linear") -> DataFrame:
         if method == "pad":
             return self.ffill()
         result = block_ops.interpolate(self._block, method)
         return DataFrame(result)
 
     def fillna(self, value=None) -> DataFrame:
@@ -2039,22 +2075,21 @@
         multi_q = utils.is_list_like(q)
         result = block_ops.quantile(
             frame._block, frame._block.value_columns, qs=tuple(q) if multi_q else (q,)  # type: ignore
         )
         if multi_q:
             return DataFrame(result.stack()).droplevel(0)
         else:
-            result_df = (
-                DataFrame(result)
-                .stack(list(range(0, frame.columns.nlevels)))
-                .droplevel(0)
-            )
-            result_series = bigframes.series.Series(result_df._block)
-            result_series.name = q
-            return result_series
+            # Drop the last level, which contains q, unnecessary since only one q
+            result = result.with_column_labels(result.column_labels.droplevel(-1))
+            result, index_col = result.create_constant(q, None)
+            result = result.set_index([index_col])
+            return bigframes.series.Series(
+                result.transpose(original_row_index=pandas.Index([q]))
+            )
 
     def std(
         self, axis: typing.Union[str, int] = 0, *, numeric_only: bool = False
     ) -> bigframes.series.Series:
         if not numeric_only:
             frame = self._raise_on_non_numeric("std")
         else:
@@ -2141,17 +2176,19 @@
                     agg_ops.lookup_agg_func(typing.cast(str, func))
                 )
             )
 
     aggregate = agg
     aggregate.__doc__ = inspect.getdoc(vendored_pandas_frame.DataFrame.agg)
 
+    @requires_index
     def idxmin(self) -> bigframes.series.Series:
         return bigframes.series.Series(block_ops.idxmin(self._block))
 
+    @requires_index
     def idxmax(self) -> bigframes.series.Series:
         return bigframes.series.Series(block_ops.idxmax(self._block))
 
     def melt(
         self,
         id_vars: typing.Optional[typing.Iterable[typing.Hashable]] = None,
         value_vars: typing.Optional[typing.Iterable[typing.Hashable]] = None,
@@ -2250,27 +2287,29 @@
             columns=column_ids,
             values=value_col_ids,
             columns_unique_values=columns_unique_values,
             values_in_index=utils.is_list_like(values),
         )
         return DataFrame(pivot_block)
 
+    @requires_index
     def pivot(
         self,
         *,
         columns: typing.Union[blocks.Label, Sequence[blocks.Label]],
         index: typing.Optional[
             typing.Union[blocks.Label, Sequence[blocks.Label]]
         ] = None,
         values: typing.Optional[
             typing.Union[blocks.Label, Sequence[blocks.Label]]
         ] = None,
     ) -> DataFrame:
         return self._pivot(columns=columns, index=index, values=values)
 
+    @requires_index
     def pivot_table(
         self,
         values: typing.Optional[
             typing.Union[blocks.Label, Sequence[blocks.Label]]
         ] = None,
         index: typing.Optional[
             typing.Union[blocks.Label, Sequence[blocks.Label]]
@@ -2361,14 +2400,15 @@
         new_columns = original_columns.reorder_levels(new_order)
 
         block = self._block.with_column_labels(new_columns)
 
         block = block.stack(levels=len(level))
         return DataFrame(block)
 
+    @requires_index
     def unstack(self, level: LevelsType = -1):
         if not utils.is_list_like(level):
             level = [level]
 
         block = self._block
         # Special case, unstack with mono-index transpose into a series
         if self.index.nlevels == 1:
@@ -2608,14 +2648,15 @@
         if by is not None:
             return self._groupby_series(by, as_index=as_index, dropna=dropna)
         if level is not None:
             return self._groupby_level(level, as_index=as_index, dropna=dropna)
         else:
             raise TypeError("You have to supply one of 'by' and 'level'")
 
+    @requires_index
     def _groupby_level(
         self,
         level: LevelsType,
         as_index: bool = True,
         dropna: bool = True,
     ):
         return groupby.DataFrameGroupBy(
@@ -3573,7 +3614,13 @@
     def plot(self):
         return plotting.PlotAccessor(self)
 
     def __matmul__(self, other) -> DataFrame:
         return self.dot(other)
 
     __matmul__.__doc__ = inspect.getdoc(vendored_pandas_frame.DataFrame.__matmul__)
+
+    def _throw_if_null_index(self, opname: str):
+        if not self._has_index:
+            raise bigframes.exceptions.NullIndexError(
+                f"DataFrame cannot perform {opname} as it has no index. Set an index using set_index."
+            )
```

### Comparing `bigframes-1.6.0/bigframes/dtypes.py` & `bigframes-1.7.0/bigframes/dtypes.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/enums.py` & `bigframes-1.7.0/bigframes/enums.py`

 * *Files 19% similar despite different names*

```diff
@@ -23,7 +23,9 @@
 class DefaultIndexKind(enum.Enum):
     """Sentinel values used to override default indexing behavior."""
 
     #: Use consecutive integers as the index. This is ``0``, ``1``, ``2``, ...,
     #: ``n - 3``, ``n - 2``, ``n - 1``, where ``n`` is the number of items in
     #: the index.
     SEQUENTIAL_INT64 = enum.auto()
+    # A completely null index incapable of indexing or alignment.
+    NULL = enum.auto()
```

### Comparing `bigframes-1.6.0/bigframes/exceptions.py` & `bigframes-1.7.0/bigframes/exceptions.py`

 * *Files 8% similar despite different names*

```diff
@@ -33,7 +33,11 @@
 
 class DefaultIndexWarning(Warning):
     """Default index may cause unexpected costs."""
 
 
 class PreviewWarning(Warning):
     """The feature is in preview."""
+
+
+class NullIndexError(ValueError):
+    """Object has no index."""
```

### Comparing `bigframes-1.6.0/bigframes/features.py` & `bigframes-1.7.0/bigframes/features.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/formatting_helpers.py` & `bigframes-1.7.0/bigframes/formatting_helpers.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/functions/__init__.py` & `bigframes-1.7.0/bigframes/functions/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/functions/remote_function.py` & `bigframes-1.7.0/bigframes/functions/remote_function.py`

 * *Files 0% similar despite different names*

```diff
@@ -1019,16 +1019,17 @@
     bq_connection_manager = None if session is None else session.bqconnectionmanager
 
     def wrapper(f):
         if not callable(f):
             raise TypeError("f must be callable, got {}".format(f))
 
         signature = inspect.signature(f)
+        # TODO(b/340898611): fix type error
         ibis_signature = ibis_signature_from_python_signature(
-            signature, input_types, output_type
+            signature, input_types, output_type  # type: ignore
         )
 
         remote_function_client = RemoteFunctionClient(
             dataset_ref.project,
             cloud_function_region,
             cloud_functions_client,
             bq_location,
```

### Comparing `bigframes-1.6.0/bigframes/ml/__init__.py` & `bigframes-1.7.0/bigframes/ml/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/base.py` & `bigframes-1.7.0/bigframes/ml/base.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/cluster.py` & `bigframes-1.7.0/bigframes/ml/cluster.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/compose.py` & `bigframes-1.7.0/bigframes/ml/compose.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/core.py` & `bigframes-1.7.0/bigframes/ml/core.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/decomposition.py` & `bigframes-1.7.0/bigframes/ml/decomposition.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/ensemble.py` & `bigframes-1.7.0/bigframes/ml/ensemble.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/forecasting.py` & `bigframes-1.7.0/bigframes/ml/forecasting.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/globals.py` & `bigframes-1.7.0/bigframes/ml/globals.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/imported.py` & `bigframes-1.7.0/bigframes/ml/imported.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/linear_model.py` & `bigframes-1.7.0/bigframes/ml/linear_model.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/llm.py` & `bigframes-1.7.0/bigframes/ml/llm.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/loader.py` & `bigframes-1.7.0/bigframes/ml/loader.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/metrics/__init__.py` & `bigframes-1.7.0/bigframes/ml/metrics/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/metrics/_metrics.py` & `bigframes-1.7.0/bigframes/ml/metrics/_metrics.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/metrics/pairwise.py` & `bigframes-1.7.0/bigframes/ml/metrics/pairwise.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/model_selection.py` & `bigframes-1.7.0/bigframes/ml/model_selection.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/pipeline.py` & `bigframes-1.7.0/bigframes/ml/pipeline.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/preprocessing.py` & `bigframes-1.7.0/bigframes/ml/preprocessing.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/remote.py` & `bigframes-1.7.0/bigframes/ml/remote.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/sql.py` & `bigframes-1.7.0/bigframes/ml/sql.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/ml/utils.py` & `bigframes-1.7.0/bigframes/ml/utils.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/operations/__init__.py` & `bigframes-1.7.0/bigframes/operations/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -19,14 +19,15 @@
 import typing
 from typing import Union
 
 import numpy as np
 import pandas as pd
 import pyarrow as pa
 
+import bigframes.dtypes
 import bigframes.dtypes as dtypes
 import bigframes.operations.type as op_typing
 
 if typing.TYPE_CHECKING:
     # Avoids circular dependency
     import bigframes.core.expression
 
@@ -486,15 +487,16 @@
     to_type: dtypes.DtypeString | dtypes.Dtype
 
     def output_type(self, *input_types):
         # TODO: We should do this conversion earlier
         if self.to_type == pa.string():
             return dtypes.STRING_DTYPE
         if isinstance(self.to_type, str):
-            return dtypes.BIGFRAMES_STRING_TO_BIGFRAMES[self.to_type]
+            # TODO(b/340895446): fix type error
+            return dtypes.BIGFRAMES_STRING_TO_BIGFRAMES[self.to_type]  # type: ignore
         return self.to_type
 
 
 @dataclasses.dataclass(frozen=True)
 class IsInOp(UnaryOp):
     name: typing.ClassVar[str] = "is_in"
     values: typing.Tuple
@@ -508,36 +510,58 @@
 class RemoteFunctionOp(UnaryOp):
     name: typing.ClassVar[str] = "remote_function"
     func: typing.Callable
     apply_on_null: bool
 
     def output_type(self, *input_types):
         # This property should be set to a valid Dtype by the @remote_function decorator or read_gbq_function method
-        return self.func.output_dtype
+        # TODO(b/340895446): fix type error
+        return self.func.output_dtype  # type: ignore
 
 
 @dataclasses.dataclass(frozen=True)
 class MapOp(UnaryOp):
     name = "map_values"
     mappings: typing.Tuple[typing.Tuple[typing.Hashable, typing.Hashable], ...]
 
     def output_type(self, *input_types):
         return input_types[0]
 
 
 @dataclasses.dataclass(frozen=True)
 class ToDatetimeOp(UnaryOp):
     name: typing.ClassVar[str] = "to_datetime"
-    utc: bool = False
     format: typing.Optional[str] = None
     unit: typing.Optional[str] = None
 
     def output_type(self, *input_types):
-        timezone = "UTC" if self.utc else None
-        return pd.ArrowDtype(pa.timestamp("us", tz=timezone))
+        if input_types[0] not in (
+            bigframes.dtypes.FLOAT_DTYPE,
+            bigframes.dtypes.INT_DTYPE,
+            bigframes.dtypes.STRING_DTYPE,
+        ):
+            raise TypeError("expected string or numeric input")
+        return pd.ArrowDtype(pa.timestamp("us", tz=None))
+
+
+@dataclasses.dataclass(frozen=True)
+class ToTimestampOp(UnaryOp):
+    name: typing.ClassVar[str] = "to_timestamp"
+    format: typing.Optional[str] = None
+    unit: typing.Optional[str] = None
+
+    def output_type(self, *input_types):
+        # Must be numeric or string
+        if input_types[0] not in (
+            bigframes.dtypes.FLOAT_DTYPE,
+            bigframes.dtypes.INT_DTYPE,
+            bigframes.dtypes.STRING_DTYPE,
+        ):
+            raise TypeError("expected string or numeric input")
+        return pd.ArrowDtype(pa.timestamp("us", tz="UTC"))
 
 
 @dataclasses.dataclass(frozen=True)
 class StrftimeOp(UnaryOp):
     name: typing.ClassVar[str] = "strftime"
     date_format: str
 
@@ -601,15 +625,16 @@
 @dataclasses.dataclass(frozen=True)
 class BinaryRemoteFunctionOp(BinaryOp):
     name: typing.ClassVar[str] = "binary_remote_function"
     func: typing.Callable
 
     def output_type(self, *input_types):
         # This property should be set to a valid Dtype by the @remote_function decorator or read_gbq_function method
-        return self.func.output_dtype
+        # TODO(b/340895446): fix type error
+        return self.func.output_dtype  # type: ignore
 
 
 add_op = AddOp()
 sub_op = SubOp()
 mul_op = create_binary_op(name="mul", type_signature=op_typing.BINARY_NUMERIC)
 div_op = create_binary_op(name="div", type_signature=op_typing.BINARY_REAL_NUMERIC)
 floordiv_op = create_binary_op(name="floordiv", type_signature=op_typing.BINARY_NUMERIC)
```

### Comparing `bigframes-1.6.0/bigframes/operations/_matplotlib/__init__.py` & `bigframes-1.7.0/bigframes/operations/_matplotlib/__init__.py`

 * *Files 6% similar despite different names*

```diff
@@ -20,14 +20,15 @@
     "line": core.LinePlot,
     "area": core.AreaPlot,
     "scatter": core.ScatterPlot,
 }
 
 
 def plot(data, kind, **kwargs):
-    plot_obj = PLOT_CLASSES[kind](data, **kwargs)
+    # TODO(b/340896123): fix type error
+    plot_obj = PLOT_CLASSES[kind](data, **kwargs)  # type: ignore
     plot_obj.generate()
     plot_obj.draw()
     return plot_obj.result
 
 
 __all__ = ["plot"]
```

### Comparing `bigframes-1.6.0/bigframes/operations/_matplotlib/core.py` & `bigframes-1.7.0/bigframes/operations/_matplotlib/core.py`

 * *Files 7% similar despite different names*

```diff
@@ -35,15 +35,16 @@
         # our parallel test suite from triggering this.
         import matplotlib.pyplot as plt
 
         plt.draw_if_interactive()
 
     @property
     def result(self):
-        return self.axes
+        # TODO(b/340896123): fix type error
+        return self.axes  # type: ignore
 
 
 class SamplingPlot(MPLPlot):
     @abc.abstractproperty
     def _kind(self):
         pass
```

### Comparing `bigframes-1.6.0/bigframes/operations/_matplotlib/hist.py` & `bigframes-1.7.0/bigframes/operations/_matplotlib/hist.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/operations/aggregations.py` & `bigframes-1.7.0/bigframes/operations/aggregations.py`

 * *Files 1% similar despite different names*

```diff
@@ -34,14 +34,18 @@
         return True
 
     @property
     def uses_total_row_ordering(self):
         """Whether the operator needs total row ordering. (eg. lead, lag, array_agg)"""
         return False
 
+    @property
+    def can_order_by(self):
+        return False
+
     @abc.abstractmethod
     def output_type(self, *input_types: dtypes.ExpressionType) -> dtypes.ExpressionType:
         ...
 
 
 @dataclasses.dataclass(frozen=True)
 class UnaryWindowOp(WindowOp):
@@ -111,27 +115,27 @@
 
 @dataclasses.dataclass(frozen=True)
 class QuantileOp(UnaryAggregateOp):
     q: float
 
     @property
     def name(self):
-        return f"{int(self.q*100)}%"
+        return f"{int(self.q * 100)}%"
 
     def output_type(self, *input_types: dtypes.ExpressionType) -> dtypes.ExpressionType:
         return signatures.UNARY_REAL_NUMERIC.output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
 class ApproxQuartilesOp(UnaryAggregateOp):
     quartile: int
 
     @property
     def name(self):
-        return f"{self.quartile*25}%"
+        return f"{self.quartile * 25}%"
 
     def output_type(self, *input_types: dtypes.ExpressionType) -> dtypes.ExpressionType:
         if not dtypes.is_orderable(input_types[0]):
             raise TypeError(f"Type {input_types[0]} is not orderable")
         if pd.api.types.is_bool_dtype(input_types[0]) or pd.api.types.is_integer_dtype(
             input_types[0]
         ):
@@ -219,14 +223,32 @@
     def output_type(self, *input_types: dtypes.ExpressionType) -> dtypes.ExpressionType:
         return signatures.FixedOutputType(
             lambda x: True, dtypes.INT_DTYPE, ""
         ).output_type(input_types[0])
 
 
 @dataclasses.dataclass(frozen=True)
+class ArrayAggOp(UnaryAggregateOp):
+    name: ClassVar[str] = "arrayagg"
+
+    @property
+    def can_order_by(self):
+        return True
+
+    @property
+    def skips_nulls(self):
+        return True
+
+    def output_type(self, *input_types: dtypes.ExpressionType) -> dtypes.ExpressionType:
+        return pd.ArrowDtype(
+            pa.list_(dtypes.bigframes_dtype_to_arrow_dtype(input_types[0]))
+        )
+
+
+@dataclasses.dataclass(frozen=True)
 class CutOp(UnaryWindowOp):
     # TODO: Unintuitive, refactor into multiple ops?
     bins: typing.Union[int, Iterable]
     labels: Optional[bool]
 
     @property
     def skips_nulls(self):
```

### Comparing `bigframes-1.6.0/bigframes/operations/base.py` & `bigframes-1.7.0/bigframes/operations/base.py`

 * *Files 4% similar despite different names*

```diff
@@ -10,14 +10,15 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 from __future__ import annotations
 
+import functools
 import typing
 from typing import List, Sequence
 
 import bigframes_vendored.pandas.pandas._typing as vendored_pandas_typing
 import numpy
 import pandas as pd
 
@@ -30,14 +31,23 @@
 import bigframes.dtypes
 import bigframes.operations as ops
 import bigframes.operations.aggregations as agg_ops
 import bigframes.series as series
 import bigframes.session
 
 
+def requires_index(meth):
+    @functools.wraps(meth)
+    def guarded_meth(df: SeriesMethods, *args, **kwargs):
+        df._throw_if_null_index(meth.__name__)
+        return meth(df, *args, **kwargs)
+
+    return guarded_meth
+
+
 class SeriesMethods:
     def __init__(
         self,
         data=None,
         index: vendored_pandas_typing.Axes | None = None,
         dtype: typing.Optional[
             bigframes.dtypes.DtypeString | bigframes.dtypes.Dtype
@@ -262,7 +272,13 @@
                 ]
             else:
                 # Will throw if can't interpret as scalar.
                 dtype = typing.cast(bigframes.dtypes.Dtype, self._dtype)
                 block, constant_col_id = block.create_constant(other, dtype=dtype)
                 value_ids = [*value_ids, constant_col_id]
         return (value_ids, block)
+
+    def _throw_if_null_index(self, opname: str):
+        if len(self._block.index_columns) == 0:
+            raise bigframes.exceptions.NullIndexError(
+                f"Series cannot perform {opname} as it has no index. Set an index using set_index."
+            )
```

### Comparing `bigframes-1.6.0/bigframes/operations/datetimes.py` & `bigframes-1.7.0/bigframes/operations/datetimes.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/operations/plotting.py` & `bigframes-1.7.0/bigframes/operations/plotting.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/operations/strings.py` & `bigframes-1.7.0/bigframes/operations/strings.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/operations/structs.py` & `bigframes-1.7.0/bigframes/operations/structs.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/operations/type.py` & `bigframes-1.7.0/bigframes/operations/type.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/pandas/__init__.py` & `bigframes-1.7.0/bigframes/pandas/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -15,15 +15,14 @@
 """BigQuery DataFrames provides a DataFrame API backed by the BigQuery engine."""
 
 from __future__ import annotations
 
 from collections import namedtuple
 from datetime import datetime
 import inspect
-import resource
 import sys
 import typing
 from typing import (
     Any,
     Callable,
     Dict,
     IO,
@@ -66,14 +65,21 @@
 import bigframes.enums
 import bigframes.operations as ops
 import bigframes.series
 import bigframes.session
 import bigframes.session._io.bigquery
 import bigframes.session.clients
 
+try:
+    import resource
+except ImportError:
+    # resource is only available on Unix-like systems.
+    # https://docs.python.org/3/library/resource.html
+    resource = None  # type: ignore
+
 
 # Include method definition so that the method appears in our docs for
 # bigframes.pandas general functions.
 @typing.overload
 def concat(
     objs: Iterable[bigframes.series.Series],
     *,
@@ -539,25 +545,27 @@
     *,
     index_col: Iterable[str] | str | bigframes.enums.DefaultIndexKind = (),
     columns: Iterable[str] = (),
     configuration: Optional[Dict] = None,
     max_results: Optional[int] = None,
     use_cache: Optional[bool] = None,
     col_order: Iterable[str] = (),
+    filters: vendored_pandas_gbq.FiltersType = (),
 ) -> bigframes.dataframe.DataFrame:
     _set_default_session_location_if_possible(query)
     return global_session.with_default_session(
         bigframes.session.Session.read_gbq_query,
         query,
         index_col=index_col,
         columns=columns,
         configuration=configuration,
         max_results=max_results,
         use_cache=use_cache,
         col_order=col_order,
+        filters=filters,
     )
 
 
 read_gbq_query.__doc__ = inspect.getdoc(bigframes.session.Session.read_gbq_query)
 
 
 def read_gbq_table(
@@ -806,20 +814,21 @@
 # SQL Compilation uses recursive algorithms on deep trees
 # 10M tree depth should be sufficient to generate any sql that is under bigquery limit
 # Note: This limit does not have the desired effect on Python 3.12 in
 # which the applicable limit is now hard coded. See:
 # https://github.com/python/cpython/issues/112282
 sys.setrecursionlimit(max(10000000, sys.getrecursionlimit()))
 
-soft_limit, hard_limit = resource.getrlimit(resource.RLIMIT_STACK)
-if soft_limit < hard_limit or hard_limit == resource.RLIM_INFINITY:
-    try:
-        resource.setrlimit(resource.RLIMIT_STACK, (hard_limit, hard_limit))
-    except Exception:
-        pass
+if resource is not None:
+    soft_limit, hard_limit = resource.getrlimit(resource.RLIMIT_STACK)
+    if soft_limit < hard_limit or hard_limit == resource.RLIM_INFINITY:
+        try:
+            resource.setrlimit(resource.RLIMIT_STACK, (hard_limit, hard_limit))
+        except Exception:
+            pass
 
 # Use __all__ to let type checkers know what is part of the public API.
 __all___ = [
     # Functions
     "concat",
     "merge",
     "read_csv",
```

### Comparing `bigframes-1.6.0/bigframes/series.py` & `bigframes-1.7.0/bigframes/series.py`

 * *Files 4% similar despite different names*

```diff
@@ -47,14 +47,15 @@
 import bigframes.core.window_spec
 import bigframes.dataframe
 import bigframes.dtypes
 import bigframes.formatting_helpers as formatter
 import bigframes.operations as ops
 import bigframes.operations.aggregations as agg_ops
 import bigframes.operations.base
+from bigframes.operations.base import requires_index
 import bigframes.operations.datetimes as dt
 import bigframes.operations.plotting as plotting
 import bigframes.operations.strings as strings
 import bigframes.operations.structs as structs
 
 LevelType = typing.Union[str, int]
 LevelsType = typing.Union[LevelType, typing.Sequence[LevelType]]
@@ -81,26 +82,28 @@
         return self._dtype
 
     @property
     def dtypes(self):
         return self._dtype
 
     @property
+    @requires_index
     def loc(self) -> bigframes.core.indexers.LocSeriesIndexer:
         return bigframes.core.indexers.LocSeriesIndexer(self)
 
     @property
     def iloc(self) -> bigframes.core.indexers.IlocSeriesIndexer:
         return bigframes.core.indexers.IlocSeriesIndexer(self)
 
     @property
     def iat(self) -> bigframes.core.indexers.IatSeriesIndexer:
         return bigframes.core.indexers.IatSeriesIndexer(self)
 
     @property
+    @requires_index
     def at(self) -> bigframes.core.indexers.AtSeriesIndexer:
         return bigframes.core.indexers.AtSeriesIndexer(self)
 
     @property
     def name(self) -> blocks.Label:
         return self._name
 
@@ -131,14 +134,15 @@
         return self.isnull().any()
 
     @property
     def values(self) -> numpy.ndarray:
         return self.to_numpy()
 
     @property
+    @requires_index
     def index(self) -> indexes.Index:
         return indexes.Index.from_frame(self)
 
     @property
     def query_job(self) -> Optional[bigquery.QueryJob]:
         """BigQuery job metadata for the most recent query.
 
@@ -232,14 +236,15 @@
         if isinstance(index, typing.Hashable):
             index = typing.cast(Optional[str], index)
             block = self._block.with_column_labels([index])
             return Series(block)
 
         raise ValueError(f"Unsupported type of parameter index: {type(index)}")
 
+    @requires_index
     def rename_axis(
         self,
         mapper: typing.Union[blocks.Label, typing.Sequence[blocks.Label]],
         **kwargs,
     ) -> Series:
         if len(kwargs) != 0:
             raise NotImplementedError(
@@ -284,15 +289,25 @@
         if opts.repr_mode == "deferred":
             return formatter.repr_query_job(self._compute_dry_run())
 
         self._cached()
         pandas_df, _, query_job = self._block.retrieve_repr_request_results(max_results)
         self._set_internal_query_job(query_job)
 
-        return repr(pandas_df.iloc[:, 0])
+        pd_series = pandas_df.iloc[:, 0]
+
+        import pandas.io.formats
+
+        # safe to mutate this, this dict is owned by this code, and does not affect global config
+        to_string_kwargs = pandas.io.formats.format.get_series_repr_params()  # type: ignore
+        if len(self._block.index_columns) == 0:
+            to_string_kwargs.update({"index": False})
+        repr_string = pd_series.to_string(**to_string_kwargs)
+
+        return repr_string
 
     def astype(
         self,
         dtype: Union[bigframes.dtypes.DtypeString, bigframes.dtypes.Dtype],
     ) -> Series:
         return self._apply_unary_op(bigframes.operations.AsTypeOp(to_type=dtype))
 
@@ -375,27 +390,30 @@
             block, condition_id = block.project_expr(
                 ops.ne_op.as_expr(level_id, ex.const(index))
             )
         block = block.filter_by_id(condition_id, keep_null=True)
         block = block.drop_columns([condition_id])
         return Series(block.select_column(self._value_column))
 
+    @requires_index
     def droplevel(self, level: LevelsType, axis: int | str = 0):
         resolved_level_ids = self._resolve_levels(level)
         return Series(self._block.drop_levels(resolved_level_ids))
 
+    @requires_index
     def swaplevel(self, i: int = -2, j: int = -1):
         level_i = self._block.index_columns[i]
         level_j = self._block.index_columns[j]
         mapping = {level_i: level_j, level_j: level_i}
         reordering = [
             mapping.get(index_id, index_id) for index_id in self._block.index_columns
         ]
         return Series(self._block.reorder_levels(reordering))
 
+    @requires_index
     def reorder_levels(self, order: LevelsType, axis: int | str = 0):
         resolved_level_ids = self._resolve_levels(order)
         return Series(self._block.reorder_levels(resolved_level_ids))
 
     def _resolve_levels(self, level: LevelsType) -> typing.Sequence[str]:
         return self._block.index.resolve_level(level)
 
@@ -566,14 +584,15 @@
                 f"Cannot replace {self.dtype} elements with incompatible mapping {mapping} as mixed-type columns not supported. {constants.FEEDBACK_LINK}"
             )
         block, result = self._block.apply_unary_op(
             self._value_column, ops.MapOp(tuple(tuples))
         )
         return Series(block.select_column(result))
 
+    @requires_index
     def interpolate(self, method: str = "linear") -> Series:
         if method == "pad":
             return self.ffill()
         result = block_ops.interpolate(self._block, method)
         return Series(result)
 
     def dropna(
@@ -982,17 +1001,21 @@
         else:
             return typing.cast(float, self._apply_aggregation(agg_ops.median_op))
 
     def quantile(self, q: Union[float, Sequence[float]] = 0.5) -> Union[Series, float]:
         qs = tuple(q) if utils.is_list_like(q) else (q,)
         result = block_ops.quantile(self._block, (self._value_column,), qs=qs)
         if utils.is_list_like(q):
-            result = result.stack()
-            result = result.drop_levels([result.index_columns[0]])
-            return Series(result)
+            # Drop the first level, since only one column
+            result = result.with_column_labels(result.column_labels.droplevel(0))
+            result, index_col = result.create_constant(self.name, None)
+            result = result.set_index([index_col])
+            return Series(
+                result.transpose(original_row_index=pandas.Index([self.name]))
+            )
         else:
             return cast(float, Series(result).to_pandas().squeeze())
 
     def sum(self) -> float:
         return typing.cast(float, self._apply_aggregation(agg_ops.sum_op))
 
     def prod(self) -> float:
@@ -1060,14 +1083,15 @@
                 order.ascending_over(row_nums),
             ]
         )
         return typing.cast(
             scalars.Scalar, Series(block.select_column(row_nums)).iloc[0]
         )
 
+    @requires_index
     def unstack(self, level: LevelsType = -1):
         if isinstance(level, int) or isinstance(level, str):
             level = [level]
 
         block = self._block
 
         if self.index.nlevels == 1:
@@ -1083,27 +1107,29 @@
         pivot_block = block.pivot(
             columns=unstack_ids,
             values=self._block.value_columns,
             values_in_index=False,
         )
         return bigframes.dataframe.DataFrame(pivot_block)
 
+    @requires_index
     def idxmax(self) -> blocks.Label:
         block = self._block.order_by(
             [
                 order.descending_over(self._value_column),
                 *[
                     order.ascending_over(idx_col)
                     for idx_col in self._block.index_columns
                 ],
             ]
         )
         block = block.slice(0, 1)
         return indexes.Index(block).to_pandas()[0]
 
+    @requires_index
     def idxmin(self) -> blocks.Label:
         block = self._block.order_by(
             [
                 order.ascending_over(self._value_column),
                 *[
                     order.ascending_over(idx_col)
                     for idx_col in self._block.index_columns
@@ -1205,14 +1231,15 @@
                 order.ascending_over(self._value_column, (na_position == "last"))
                 if ascending
                 else order.descending_over(self._value_column, (na_position == "last"))
             ],
         )
         return Series(block)
 
+    @requires_index
     def sort_index(self, *, axis=0, ascending=True, na_position="last") -> Series:
         # TODO(tbergeron): Support level parameter once multi-index introduced.
         if na_position not in ["first", "last"]:
             raise ValueError("Param na_position must be one of 'first' or 'last'")
         block = self._block
         na_last = na_position == "last"
         ordering = [
@@ -1265,14 +1292,15 @@
         if by is not None:
             return self._groupby_values(by, dropna)
         if level is not None:
             return self._groupby_level(level, dropna)
         else:
             raise TypeError("You have to supply one of 'by' and 'level'")
 
+    @requires_index
     def _groupby_level(
         self,
         level: int | str | typing.Sequence[int] | typing.Sequence[str],
         dropna: bool = True,
     ) -> bigframes.core.groupby.SeriesGroupBy:
         return groupby.SeriesGroupBy(
             self._block,
@@ -1402,17 +1430,19 @@
         )
 
         # return Series with materialized result so that any error in the remote
         # function is caught early
         materialized_series = result_series._cached()
         return materialized_series
 
+    @requires_index
     def add_prefix(self, prefix: str, axis: int | str | None = None) -> Series:
         return Series(self._get_block().add_prefix(prefix))
 
+    @requires_index
     def add_suffix(self, suffix: str, axis: int | str | None = None) -> Series:
         return Series(self._get_block().add_suffix(suffix))
 
     def filter(
         self,
         items: typing.Optional[typing.Iterable] = None,
         like: typing.Optional[str] = None,
@@ -1456,14 +1486,15 @@
             )
             block = block.filter_by_id(mask_id)
             block = block.select_columns([self._value_column])
             return Series(block)
         else:
             raise ValueError("Need to provide 'items', 'like', or 'regex'")
 
+    @requires_index
     def reindex(self, index=None, *, validate: typing.Optional[bool] = None):
         if validate and not self.index.is_unique:
             raise ValueError("Original index must be unique to reindex")
         keep_original_names = False
         if isinstance(index, indexes.Index):
             new_indexer = bigframes.dataframe.DataFrame(data=index._block)[[]]
         else:
@@ -1484,14 +1515,15 @@
         )
         # and then reset the names after the join
         result_block = result.rename_axis(
             self.index.names if keep_original_names else index.names
         )._block
         return Series(result_block)
 
+    @requires_index
     def reindex_like(self, other: Series, *, validate: typing.Optional[bool] = None):
         return self.reindex(other.index, validate=validate)
 
     def drop_duplicates(self, *, keep: str = "first") -> Series:
         block = block_ops.drop_duplicates(self._block, (self._value_column,), keep)
         return Series(block)
```

### Comparing `bigframes-1.6.0/bigframes/session/__init__.py` & `bigframes-1.7.0/bigframes/session/__init__.py`

 * *Files 5% similar despite different names*

```diff
@@ -44,4919 +44,5075 @@
 000002b0: 650a 696d 706f 7274 206c 6f67 6769 6e67  e.import logging
 000002c0: 0a69 6d70 6f72 7420 6f73 0a69 6d70 6f72  .import os.impor
 000002d0: 7420 7365 6372 6574 730a 696d 706f 7274  t secrets.import
 000002e0: 2074 7970 696e 670a 6672 6f6d 2074 7970   typing.from typ
 000002f0: 696e 6720 696d 706f 7274 2028 0a20 2020  ing import (.   
 00000300: 2041 6e79 2c0a 2020 2020 4361 6c6c 6162   Any,.    Callab
 00000310: 6c65 2c0a 2020 2020 4469 6374 2c0a 2020  le,.    Dict,.  
-00000320: 2020 494f 2c0a 2020 2020 4974 6572 6162    IO,.    Iterab
-00000330: 6c65 2c0a 2020 2020 4c69 7374 2c0a 2020  le,.    List,.  
-00000340: 2020 4c69 7465 7261 6c2c 0a20 2020 204d    Literal,.    M
-00000350: 6170 7069 6e67 2c0a 2020 2020 4d75 7461  apping,.    Muta
-00000360: 626c 6553 6571 7565 6e63 652c 0a20 2020  bleSequence,.   
-00000370: 204f 7074 696f 6e61 6c2c 0a20 2020 2053   Optional,.    S
-00000380: 6571 7565 6e63 652c 0a20 2020 2054 7570  equence,.    Tup
-00000390: 6c65 2c0a 2020 2020 556e 696f 6e2c 0a29  le,.    Union,.)
-000003a0: 0a69 6d70 6f72 7420 7575 6964 0a69 6d70  .import uuid.imp
-000003b0: 6f72 7420 7761 726e 696e 6773 0a0a 2320  ort warnings..# 
-000003c0: 4576 656e 2074 686f 7567 6820 7468 6520  Even though the 
-000003d0: 6962 6973 2e62 6163 6b65 6e64 732e 6269  ibis.backends.bi
-000003e0: 6771 7565 7279 2069 6d70 6f72 7420 6973  gquery import is
-000003f0: 2075 6e75 7365 642c 2069 7427 7320 6e65   unused, it's ne
-00000400: 6564 6564 0a23 2074 6f20 7265 6769 7374  eded.# to regist
-00000410: 6572 206e 6577 2061 6e64 2072 6570 6c61  er new and repla
-00000420: 6365 6d65 6e74 206f 7073 2077 6974 6820  cement ops with 
-00000430: 7468 6520 4962 6973 2042 6967 5175 6572  the Ibis BigQuer
-00000440: 7920 6261 636b 656e 642e 0a69 6d70 6f72  y backend..impor
-00000450: 7420 6269 6766 7261 6d65 735f 7665 6e64  t bigframes_vend
-00000460: 6f72 6564 2e69 6269 732e 6261 636b 656e  ored.ibis.backen
-00000470: 6473 2e62 6967 7175 6572 7920 2023 206e  ds.bigquery  # n
-00000480: 6f71 610a 696d 706f 7274 2062 6967 6672  oqa.import bigfr
-00000490: 616d 6573 5f76 656e 646f 7265 642e 7061  ames_vendored.pa
-000004a0: 6e64 6173 2e69 6f2e 6762 7120 6173 2074  ndas.io.gbq as t
-000004b0: 6869 7264 5f70 6172 7479 5f70 616e 6461  hird_party_panda
-000004c0: 735f 6762 710a 696d 706f 7274 2062 6967  s_gbq.import big
-000004d0: 6672 616d 6573 5f76 656e 646f 7265 642e  frames_vendored.
-000004e0: 7061 6e64 6173 2e69 6f2e 7061 7271 7565  pandas.io.parque
-000004f0: 7420 6173 2074 6869 7264 5f70 6172 7479  t as third_party
-00000500: 5f70 616e 6461 735f 7061 7271 7565 740a  _pandas_parquet.
-00000510: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
-00000520: 5f76 656e 646f 7265 642e 7061 6e64 6173  _vendored.pandas
-00000530: 2e69 6f2e 7061 7273 6572 732e 7265 6164  .io.parsers.read
-00000540: 6572 7320 6173 2074 6869 7264 5f70 6172  ers as third_par
-00000550: 7479 5f70 616e 6461 735f 7265 6164 6572  ty_pandas_reader
-00000560: 730a 696d 706f 7274 2062 6967 6672 616d  s.import bigfram
-00000570: 6573 5f76 656e 646f 7265 642e 7061 6e64  es_vendored.pand
-00000580: 6173 2e69 6f2e 7069 636b 6c65 2061 7320  as.io.pickle as 
-00000590: 7468 6972 645f 7061 7274 795f 7061 6e64  third_party_pand
-000005a0: 6173 5f70 6963 6b6c 650a 696d 706f 7274  as_pickle.import
-000005b0: 2067 6f6f 676c 652e 6170 695f 636f 7265   google.api_core
-000005c0: 2e63 6c69 656e 745f 696e 666f 0a69 6d70  .client_info.imp
-000005d0: 6f72 7420 676f 6f67 6c65 2e61 7069 5f63  ort google.api_c
-000005e0: 6f72 652e 636c 6965 6e74 5f6f 7074 696f  ore.client_optio
-000005f0: 6e73 0a69 6d70 6f72 7420 676f 6f67 6c65  ns.import google
-00000600: 2e61 7069 5f63 6f72 652e 6578 6365 7074  .api_core.except
-00000610: 696f 6e73 0a69 6d70 6f72 7420 676f 6f67  ions.import goog
-00000620: 6c65 2e61 7069 5f63 6f72 652e 6761 7069  le.api_core.gapi
-00000630: 635f 7631 2e63 6c69 656e 745f 696e 666f  c_v1.client_info
-00000640: 0a69 6d70 6f72 7420 676f 6f67 6c65 2e61  .import google.a
-00000650: 7574 682e 6372 6564 656e 7469 616c 730a  uth.credentials.
-00000660: 696d 706f 7274 2067 6f6f 676c 652e 636c  import google.cl
-00000670: 6f75 642e 6269 6771 7565 7279 2061 7320  oud.bigquery as 
-00000680: 6269 6771 7565 7279 0a69 6d70 6f72 7420  bigquery.import 
-00000690: 676f 6f67 6c65 2e63 6c6f 7564 2e62 6967  google.cloud.big
-000006a0: 7175 6572 792e 7461 626c 650a 696d 706f  query.table.impo
-000006b0: 7274 2067 6f6f 676c 652e 636c 6f75 642e  rt google.cloud.
-000006c0: 6269 6771 7565 7279 5f63 6f6e 6e65 6374  bigquery_connect
-000006d0: 696f 6e5f 7631 0a69 6d70 6f72 7420 676f  ion_v1.import go
-000006e0: 6f67 6c65 2e63 6c6f 7564 2e62 6967 7175  ogle.cloud.bigqu
-000006f0: 6572 795f 7374 6f72 6167 655f 7631 0a69  ery_storage_v1.i
-00000700: 6d70 6f72 7420 676f 6f67 6c65 2e63 6c6f  mport google.clo
-00000710: 7564 2e66 756e 6374 696f 6e73 5f76 320a  ud.functions_v2.
-00000720: 696d 706f 7274 2067 6f6f 676c 652e 636c  import google.cl
-00000730: 6f75 642e 7265 736f 7572 6365 6d61 6e61  oud.resourcemana
-00000740: 6765 725f 7633 0a69 6d70 6f72 7420 676f  ger_v3.import go
-00000750: 6f67 6c65 2e63 6c6f 7564 2e73 746f 7261  ogle.cloud.stora
-00000760: 6765 2061 7320 7374 6f72 6167 6520 2023  ge as storage  #
-00000770: 2074 7970 653a 2069 676e 6f72 650a 696d   type: ignore.im
-00000780: 706f 7274 2069 6269 730a 696d 706f 7274  port ibis.import
-00000790: 2069 6269 732e 6261 636b 656e 6473 2e62   ibis.backends.b
-000007a0: 6967 7175 6572 7920 6173 2069 6269 735f  igquery as ibis_
-000007b0: 6269 6771 7565 7279 0a69 6d70 6f72 7420  bigquery.import 
-000007c0: 6962 6973 2e65 7870 722e 7479 7065 7320  ibis.expr.types 
-000007d0: 6173 2069 6269 735f 7479 7065 730a 696d  as ibis_types.im
-000007e0: 706f 7274 206e 756d 7079 2061 7320 6e70  port numpy as np
-000007f0: 0a69 6d70 6f72 7420 7061 6e64 6173 0a66  .import pandas.f
-00000800: 726f 6d20 7061 6e64 6173 2e5f 7479 7069  rom pandas._typi
-00000810: 6e67 2069 6d70 6f72 7420 280a 2020 2020  ng import (.    
-00000820: 436f 6d70 7265 7373 696f 6e4f 7074 696f  CompressionOptio
-00000830: 6e73 2c0a 2020 2020 4669 6c65 5061 7468  ns,.    FilePath
-00000840: 2c0a 2020 2020 5265 6164 5069 636b 6c65  ,.    ReadPickle
-00000850: 4275 6666 6572 2c0a 2020 2020 5374 6f72  Buffer,.    Stor
-00000860: 6167 654f 7074 696f 6e73 2c0a 290a 696d  ageOptions,.).im
-00000870: 706f 7274 2070 7961 7272 6f77 2061 7320  port pyarrow as 
-00000880: 7061 0a0a 696d 706f 7274 2062 6967 6672  pa..import bigfr
-00000890: 616d 6573 2e5f 636f 6e66 6967 2e62 6967  ames._config.big
-000008a0: 7175 6572 795f 6f70 7469 6f6e 7320 6173  query_options as
-000008b0: 2062 6967 7175 6572 795f 6f70 7469 6f6e   bigquery_option
-000008c0: 730a 696d 706f 7274 2062 6967 6672 616d  s.import bigfram
-000008d0: 6573 2e63 6c69 656e 7473 0a69 6d70 6f72  es.clients.impor
-000008e0: 7420 6269 6766 7261 6d65 732e 636f 6e73  t bigframes.cons
-000008f0: 7461 6e74 7320 6173 2063 6f6e 7374 616e  tants as constan
-00000900: 7473 0a69 6d70 6f72 7420 6269 6766 7261  ts.import bigfra
-00000910: 6d65 732e 636f 7265 2061 7320 636f 7265  mes.core as core
-00000920: 0a69 6d70 6f72 7420 6269 6766 7261 6d65  .import bigframe
-00000930: 732e 636f 7265 2e62 6c6f 636b 7320 6173  s.core.blocks as
-00000940: 2062 6c6f 636b 730a 696d 706f 7274 2062   blocks.import b
-00000950: 6967 6672 616d 6573 2e63 6f72 652e 636f  igframes.core.co
-00000960: 6d70 696c 650a 696d 706f 7274 2062 6967  mpile.import big
-00000970: 6672 616d 6573 2e63 6f72 652e 6e6f 6465  frames.core.node
-00000980: 7320 6173 206e 6f64 6573 0a66 726f 6d20  s as nodes.from 
-00000990: 6269 6766 7261 6d65 732e 636f 7265 2e6f  bigframes.core.o
-000009a0: 7264 6572 696e 6720 696d 706f 7274 2049  rdering import I
-000009b0: 6e74 6567 6572 456e 636f 6469 6e67 0a69  ntegerEncoding.i
-000009c0: 6d70 6f72 7420 6269 6766 7261 6d65 732e  mport bigframes.
-000009d0: 636f 7265 2e6f 7264 6572 696e 6720 6173  core.ordering as
-000009e0: 206f 7264 6572 0a69 6d70 6f72 7420 6269   order.import bi
-000009f0: 6766 7261 6d65 732e 636f 7265 2e74 7265  gframes.core.tre
-00000a00: 655f 7072 6f70 6572 7469 6573 2061 7320  e_properties as 
-00000a10: 7472 6176 6572 7361 6c73 0a69 6d70 6f72  traversals.impor
-00000a20: 7420 6269 6766 7261 6d65 732e 636f 7265  t bigframes.core
-00000a30: 2e74 7265 655f 7072 6f70 6572 7469 6573  .tree_properties
-00000a40: 2061 7320 7472 6565 5f70 726f 7065 7274   as tree_propert
-00000a50: 6965 730a 696d 706f 7274 2062 6967 6672  ies.import bigfr
-00000a60: 616d 6573 2e63 6f72 652e 7574 696c 7320  ames.core.utils 
-00000a70: 6173 2075 7469 6c73 0a69 6d70 6f72 7420  as utils.import 
-00000a80: 6269 6766 7261 6d65 732e 6474 7970 6573  bigframes.dtypes
-00000a90: 0a69 6d70 6f72 7420 6269 6766 7261 6d65  .import bigframe
-00000aa0: 732e 6578 6365 7074 696f 6e73 0a69 6d70  s.exceptions.imp
-00000ab0: 6f72 7420 6269 6766 7261 6d65 732e 666f  ort bigframes.fo
-00000ac0: 726d 6174 7469 6e67 5f68 656c 7065 7273  rmatting_helpers
-00000ad0: 2061 7320 666f 726d 6174 7469 6e67 5f68   as formatting_h
-00000ae0: 656c 7065 7273 0a66 726f 6d20 6269 6766  elpers.from bigf
-00000af0: 7261 6d65 732e 6675 6e63 7469 6f6e 732e  rames.functions.
-00000b00: 7265 6d6f 7465 5f66 756e 6374 696f 6e20  remote_function 
-00000b10: 696d 706f 7274 2072 6561 645f 6762 715f  import read_gbq_
-00000b20: 6675 6e63 7469 6f6e 2061 7320 6269 6766  function as bigf
-00000b30: 7261 6d65 735f 7267 660a 6672 6f6d 2062  rames_rgf.from b
-00000b40: 6967 6672 616d 6573 2e66 756e 6374 696f  igframes.functio
-00000b50: 6e73 2e72 656d 6f74 655f 6675 6e63 7469  ns.remote_functi
-00000b60: 6f6e 2069 6d70 6f72 7420 7265 6d6f 7465  on import remote
-00000b70: 5f66 756e 6374 696f 6e20 6173 2062 6967  _function as big
-00000b80: 6672 616d 6573 5f72 660a 696d 706f 7274  frames_rf.import
-00000b90: 2062 6967 6672 616d 6573 2e73 6573 7369   bigframes.sessi
-00000ba0: 6f6e 2e5f 696f 2e62 6967 7175 6572 7920  on._io.bigquery 
-00000bb0: 6173 2062 665f 696f 5f62 6967 7175 6572  as bf_io_bigquer
-00000bc0: 790a 696d 706f 7274 2062 6967 6672 616d  y.import bigfram
-00000bd0: 6573 2e73 6573 7369 6f6e 2e5f 696f 2e62  es.session._io.b
-00000be0: 6967 7175 6572 792e 7265 6164 5f67 6271  igquery.read_gbq
-00000bf0: 5f74 6162 6c65 2061 7320 6266 5f72 6561  _table as bf_rea
-00000c00: 645f 6762 715f 7461 626c 650a 696d 706f  d_gbq_table.impo
-00000c10: 7274 2062 6967 6672 616d 6573 2e73 6573  rt bigframes.ses
-00000c20: 7369 6f6e 2e63 6c69 656e 7473 0a69 6d70  sion.clients.imp
-00000c30: 6f72 7420 6269 6766 7261 6d65 732e 7665  ort bigframes.ve
-00000c40: 7273 696f 6e0a 0a23 2041 766f 6964 2063  rsion..# Avoid c
-00000c50: 6972 6375 6c61 7220 696d 706f 7274 732e  ircular imports.
-00000c60: 0a69 6620 7479 7069 6e67 2e54 5950 455f  .if typing.TYPE_
-00000c70: 4348 4543 4b49 4e47 3a0a 2020 2020 696d  CHECKING:.    im
-00000c80: 706f 7274 2062 6967 6672 616d 6573 2e63  port bigframes.c
-00000c90: 6f72 652e 696e 6465 7865 730a 2020 2020  ore.indexes.    
-00000ca0: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
-00000cb0: 2e64 6174 6166 7261 6d65 2061 7320 6461  .dataframe as da
-00000cc0: 7461 6672 616d 650a 2020 2020 696d 706f  taframe.    impo
-00000cd0: 7274 2062 6967 6672 616d 6573 2e73 6572  rt bigframes.ser
-00000ce0: 6965 730a 0a5f 4249 4746 5241 4d45 535f  ies.._BIGFRAMES_
-00000cf0: 4445 4641 554c 545f 434f 4e4e 4543 5449  DEFAULT_CONNECTI
-00000d00: 4f4e 5f49 4420 3d20 2262 6967 6672 616d  ON_ID = "bigfram
-00000d10: 6573 2d64 6566 6175 6c74 2d63 6f6e 6e65  es-default-conne
-00000d20: 6374 696f 6e22 0a0a 5f54 454d 505f 5441  ction".._TEMP_TA
-00000d30: 424c 455f 4944 5f46 4f52 4d41 5420 3d20  BLE_ID_FORMAT = 
-00000d40: 2262 7164 667b 6461 7465 7d5f 7b73 6573  "bqdf{date}_{ses
-00000d50: 7369 6f6e 5f69 647d 5f7b 7261 6e64 6f6d  sion_id}_{random
-00000d60: 5f69 647d 220a 0a5f 4d41 585f 434c 5553  _id}".._MAX_CLUS
-00000d70: 5445 525f 434f 4c55 4d4e 5320 3d20 340a  TER_COLUMNS = 4.
-00000d80: 0a23 2054 4f44 4f28 7377 6173 7429 3a20  .# TODO(swast): 
-00000d90: 4e65 6564 2074 6f20 636f 6e6e 6563 7420  Need to connect 
-00000da0: 746f 2072 6567 696f 6e61 6c20 656e 6470  to regional endp
-00000db0: 6f69 6e74 7320 7768 656e 2070 6572 666f  oints when perfo
-00000dc0: 726d 696e 6720 7265 6d6f 7465 0a23 2066  rming remote.# f
-00000dd0: 756e 6374 696f 6e73 206f 7065 7261 7469  unctions operati
-00000de0: 6f6e 7320 2842 5120 436f 6e6e 6563 7469  ons (BQ Connecti
-00000df0: 6f6e 2049 414d 2c20 436c 6f75 6420 5275  on IAM, Cloud Ru
-00000e00: 6e20 2f20 436c 6f75 6420 4675 6e63 7469  n / Cloud Functi
-00000e10: 6f6e 7329 2e0a 2320 416c 736f 2073 6565  ons)..# Also see
-00000e20: 2069 6620 7265 736f 7572 6365 206d 616e   if resource man
-00000e30: 6167 6572 2063 6c69 656e 7420 6c69 6272  ager client libr
-00000e40: 6172 7920 7375 7070 6f72 7473 2072 6567  ary supports reg
-00000e50: 696f 6e61 6c20 656e 6470 6f69 6e74 732e  ional endpoints.
-00000e60: 0a0a 5f56 414c 4944 5f45 4e43 4f44 494e  .._VALID_ENCODIN
-00000e70: 4753 203d 207b 0a20 2020 2022 5554 462d  GS = {.    "UTF-
-00000e80: 3822 2c0a 2020 2020 2249 534f 2d38 3835  8",.    "ISO-885
-00000e90: 392d 3122 2c0a 2020 2020 2255 5446 2d31  9-1",.    "UTF-1
-00000ea0: 3642 4522 2c0a 2020 2020 2255 5446 2d31  6BE",.    "UTF-1
-00000eb0: 364c 4522 2c0a 2020 2020 2255 5446 2d33  6LE",.    "UTF-3
-00000ec0: 3242 4522 2c0a 2020 2020 2255 5446 2d33  2BE",.    "UTF-3
-00000ed0: 324c 4522 2c0a 7d0a 0a23 2042 6967 5175  2LE",.}..# BigQu
-00000ee0: 6572 7920 6861 7320 3120 4d42 2071 7565  ery has 1 MB que
-00000ef0: 7279 2073 697a 6520 6c69 6d69 742e 2044  ry size limit. D
-00000f00: 6f6e 2774 2077 616e 7420 746f 2074 616b  on't want to tak
-00000f10: 6520 7570 206d 6f72 6520 7468 616e 2061  e up more than a
-00000f20: 2066 6577 2025 206f 6620 7468 6174 2069   few % of that i
-00000f30: 6e6c 696e 696e 6720 6120 7461 626c 652e  nlining a table.
-00000f40: 0a23 2041 6c73 6f20 6d75 7374 2061 7373  .# Also must ass
-00000f50: 756d 6520 7468 6174 2074 6578 7420 656e  ume that text en
-00000f60: 636f 6469 6e67 2061 7320 6c69 7465 7261  coding as litera
-00000f70: 6c73 2069 7320 6d75 6368 206c 6573 7320  ls is much less 
-00000f80: 6566 6669 6369 656e 7420 7468 616e 2069  efficient than i
-00000f90: 6e2d 6d65 6d6f 7279 2072 6570 7265 7365  n-memory represe
-00000fa0: 6e74 6174 696f 6e2e 0a4d 4158 5f49 4e4c  ntation..MAX_INL
-00000fb0: 494e 455f 4446 5f42 5954 4553 203d 2035  INE_DF_BYTES = 5
-00000fc0: 3030 300a 0a23 204d 6178 2063 6f6d 706c  000..# Max compl
-00000fd0: 6578 6974 7920 7468 6174 2073 686f 756c  exity that shoul
-00000fe0: 6420 6265 2065 7865 6375 7465 6420 6173  d be executed as
-00000ff0: 2061 2073 696e 676c 6520 7175 6572 790a   a single query.
-00001000: 5155 4552 595f 434f 4d50 4c45 5849 5459  QUERY_COMPLEXITY
-00001010: 5f4c 494d 4954 203d 2031 6537 0a23 204e  _LIMIT = 1e7.# N
-00001020: 756d 6265 7220 6f66 2074 696d 6573 2074  umber of times t
-00001030: 6f20 6661 6374 6f72 206f 7574 2073 7562  o factor out sub
-00001040: 7175 6572 6965 7320 6265 666f 7265 2067  queries before g
-00001050: 6976 696e 6720 7570 2e0a 4d41 585f 5355  iving up..MAX_SU
-00001060: 4254 5245 455f 4641 4354 4f52 494e 4753  BTREE_FACTORINGS
-00001070: 203d 2035 0a0a 6c6f 6767 6572 203d 206c   = 5..logger = l
-00001080: 6f67 6769 6e67 2e67 6574 4c6f 6767 6572  ogging.getLogger
-00001090: 285f 5f6e 616d 655f 5f29 0a0a 2320 4578  (__name__)..# Ex
-000010a0: 636c 7564 6573 2067 656f 6772 6170 6879  cludes geography
-000010b0: 2c20 6279 7465 732c 2061 6e64 206e 6573  , bytes, and nes
-000010c0: 7465 6420 2861 7272 6179 2c20 7374 7275  ted (array, stru
-000010d0: 6374 2920 6461 7461 7479 7065 730a 494e  ct) datatypes.IN
-000010e0: 4c49 4e41 424c 455f 4454 5950 4553 3a20  LINABLE_DTYPES: 
-000010f0: 5365 7175 656e 6365 5b62 6967 6672 616d  Sequence[bigfram
-00001100: 6573 2e64 7479 7065 732e 4474 7970 655d  es.dtypes.Dtype]
-00001110: 203d 2028 0a20 2020 2070 616e 6461 732e   = (.    pandas.
-00001120: 426f 6f6c 6561 6e44 7479 7065 2829 2c0a  BooleanDtype(),.
-00001130: 2020 2020 7061 6e64 6173 2e46 6c6f 6174      pandas.Float
-00001140: 3634 4474 7970 6528 292c 0a20 2020 2070  64Dtype(),.    p
-00001150: 616e 6461 732e 496e 7436 3444 7479 7065  andas.Int64Dtype
-00001160: 2829 2c0a 2020 2020 7061 6e64 6173 2e53  (),.    pandas.S
-00001170: 7472 696e 6744 7479 7065 2873 746f 7261  tringDtype(stora
-00001180: 6765 3d22 7079 6172 726f 7722 292c 0a20  ge="pyarrow"),. 
-00001190: 2020 2070 616e 6461 732e 4172 726f 7744     pandas.ArrowD
-000011a0: 7479 7065 2870 612e 6461 7465 3332 2829  type(pa.date32()
-000011b0: 292c 0a20 2020 2070 616e 6461 732e 4172  ),.    pandas.Ar
-000011c0: 726f 7744 7479 7065 2870 612e 7469 6d65  rowDtype(pa.time
-000011d0: 3634 2822 7573 2229 292c 0a20 2020 2070  64("us")),.    p
-000011e0: 616e 6461 732e 4172 726f 7744 7479 7065  andas.ArrowDtype
-000011f0: 2870 612e 7469 6d65 7374 616d 7028 2275  (pa.timestamp("u
-00001200: 7322 2929 2c0a 2020 2020 7061 6e64 6173  s")),.    pandas
-00001210: 2e41 7272 6f77 4474 7970 6528 7061 2e74  .ArrowDtype(pa.t
-00001220: 696d 6573 7461 6d70 2822 7573 222c 2074  imestamp("us", t
-00001230: 7a3d 2255 5443 2229 292c 0a20 2020 2070  z="UTC")),.    p
-00001240: 616e 6461 732e 4172 726f 7744 7479 7065  andas.ArrowDtype
-00001250: 2870 612e 6465 6369 6d61 6c31 3238 2833  (pa.decimal128(3
-00001260: 382c 2039 2929 2c0a 2020 2020 7061 6e64  8, 9)),.    pand
-00001270: 6173 2e41 7272 6f77 4474 7970 6528 7061  as.ArrowDtype(pa
-00001280: 2e64 6563 696d 616c 3235 3628 3736 2c20  .decimal256(76, 
-00001290: 3338 2929 2c0a 290a 0a0a 6465 6620 5f74  38)),.)...def _t
-000012a0: 6f5f 696e 6465 785f 636f 6c73 280a 2020  o_index_cols(.  
-000012b0: 2020 696e 6465 785f 636f 6c3a 2049 7465    index_col: Ite
-000012c0: 7261 626c 655b 7374 725d 207c 2073 7472  rable[str] | str
-000012d0: 207c 2062 6967 6672 616d 6573 2e65 6e75   | bigframes.enu
-000012e0: 6d73 2e44 6566 6175 6c74 496e 6465 784b  ms.DefaultIndexK
-000012f0: 696e 6420 3d20 2829 2c0a 2920 2d3e 204c  ind = (),.) -> L
-00001300: 6973 745b 7374 725d 3a0a 2020 2020 2222  ist[str]:.    ""
-00001310: 2243 6f6e 7665 7274 2069 6e64 6578 5f63  "Convert index_c
-00001320: 6f6c 2069 6e74 6f20 6120 6c69 7374 206f  ol into a list o
-00001330: 6620 636f 6c75 6d6e 206e 616d 6573 2e22  f column names."
-00001340: 2222 0a20 2020 2069 6620 6973 696e 7374  "".    if isinst
-00001350: 616e 6365 2869 6e64 6578 5f63 6f6c 2c20  ance(index_col, 
-00001360: 6269 6766 7261 6d65 732e 656e 756d 732e  bigframes.enums.
-00001370: 4465 6661 756c 7449 6e64 6578 4b69 6e64  DefaultIndexKind
-00001380: 293a 0a20 2020 2020 2020 2069 6e64 6578  ):.        index
-00001390: 5f63 6f6c 733a 204c 6973 745b 7374 725d  _cols: List[str]
-000013a0: 203d 205b 5d0a 2020 2020 656c 6966 2069   = [].    elif i
-000013b0: 7369 6e73 7461 6e63 6528 696e 6465 785f  sinstance(index_
-000013c0: 636f 6c2c 2073 7472 293a 0a20 2020 2020  col, str):.     
-000013d0: 2020 2069 6e64 6578 5f63 6f6c 7320 3d20     index_cols = 
-000013e0: 5b69 6e64 6578 5f63 6f6c 5d0a 2020 2020  [index_col].    
-000013f0: 656c 7365 3a0a 2020 2020 2020 2020 696e  else:.        in
-00001400: 6465 785f 636f 6c73 203d 206c 6973 7428  dex_cols = list(
-00001410: 696e 6465 785f 636f 6c29 0a0a 2020 2020  index_col)..    
-00001420: 7265 7475 726e 2069 6e64 6578 5f63 6f6c  return index_col
-00001430: 730a 0a0a 636c 6173 7320 5365 7373 696f  s...class Sessio
-00001440: 6e28 0a20 2020 2074 6869 7264 5f70 6172  n(.    third_par
-00001450: 7479 5f70 616e 6461 735f 6762 712e 4742  ty_pandas_gbq.GB
-00001460: 5149 4f4d 6978 696e 2c0a 2020 2020 7468  QIOMixin,.    th
-00001470: 6972 645f 7061 7274 795f 7061 6e64 6173  ird_party_pandas
-00001480: 5f70 6172 7175 6574 2e50 6172 7175 6574  _parquet.Parquet
-00001490: 494f 4d69 7869 6e2c 0a20 2020 2074 6869  IOMixin,.    thi
-000014a0: 7264 5f70 6172 7479 5f70 616e 6461 735f  rd_party_pandas_
-000014b0: 7069 636b 6c65 2e50 6963 6b6c 6549 4f4d  pickle.PickleIOM
-000014c0: 6978 696e 2c0a 2020 2020 7468 6972 645f  ixin,.    third_
-000014d0: 7061 7274 795f 7061 6e64 6173 5f72 6561  party_pandas_rea
-000014e0: 6465 7273 2e52 6561 6465 7249 4f4d 6978  ders.ReaderIOMix
-000014f0: 696e 2c0a 293a 0a20 2020 2022 2222 4573  in,.):.    """Es
-00001500: 7461 626c 6973 6865 7320 6120 4269 6751  tablishes a BigQ
-00001510: 7565 7279 2063 6f6e 6e65 6374 696f 6e20  uery connection 
-00001520: 746f 2063 6170 7475 7265 2061 2067 726f  to capture a gro
-00001530: 7570 206f 6620 6a6f 6220 6163 7469 7669  up of job activi
-00001540: 7469 6573 2072 656c 6174 6564 2074 6f0a  ties related to.
-00001550: 2020 2020 4461 7461 4672 616d 6573 2e0a      DataFrames..
-00001560: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
-00001570: 2020 2063 6f6e 7465 7874 2028 6269 6766     context (bigf
-00001580: 7261 6d65 732e 5f63 6f6e 6669 672e 6269  rames._config.bi
-00001590: 6771 7565 7279 5f6f 7074 696f 6e73 2e42  gquery_options.B
-000015a0: 6967 5175 6572 794f 7074 696f 6e73 293a  igQueryOptions):
-000015b0: 0a20 2020 2020 2020 2020 2020 2043 6f6e  .            Con
-000015c0: 6669 6775 7261 7469 6f6e 2061 646a 7573  figuration adjus
-000015d0: 7469 6e67 2068 6f77 2074 6f20 636f 6e6e  ting how to conn
-000015e0: 6563 7420 746f 2042 6967 5175 6572 7920  ect to BigQuery 
-000015f0: 616e 6420 7265 6c61 7465 640a 2020 2020  and related.    
-00001600: 2020 2020 2020 2020 4150 4973 2e20 4e6f          APIs. No
-00001610: 7465 2074 6861 7420 736f 6d65 206f 7074  te that some opt
-00001620: 696f 6e73 2061 7265 2069 676e 6f72 6564  ions are ignored
-00001630: 2069 6620 6060 636c 6965 6e74 735f 7072   if ``clients_pr
-00001640: 6f76 6964 6572 6060 2069 730a 2020 2020  ovider`` is.    
-00001650: 2020 2020 2020 2020 7365 742e 0a20 2020          set..   
-00001660: 2020 2020 2063 6c69 656e 7473 5f70 726f       clients_pro
-00001670: 7669 6465 7220 2862 6967 6672 616d 6573  vider (bigframes
-00001680: 2e73 6573 7369 6f6e 2e63 6c69 656e 7473  .session.clients
-00001690: 2e43 6c69 656e 7473 5072 6f76 6964 6572  .ClientsProvider
-000016a0: 293a 0a20 2020 2020 2020 2020 2020 2041  ):.            A
-000016b0: 6e20 6f62 6a65 6374 2070 726f 7669 6469  n object providi
-000016c0: 6e67 2063 6c69 656e 7420 6c69 6272 6172  ng client librar
-000016d0: 7920 6f62 6a65 6374 732e 0a20 2020 2022  y objects..    "
-000016e0: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-000016f0: 6974 5f5f 280a 2020 2020 2020 2020 7365  it__(.        se
-00001700: 6c66 2c0a 2020 2020 2020 2020 636f 6e74  lf,.        cont
-00001710: 6578 743a 204f 7074 696f 6e61 6c5b 6269  ext: Optional[bi
-00001720: 6771 7565 7279 5f6f 7074 696f 6e73 2e42  gquery_options.B
-00001730: 6967 5175 6572 794f 7074 696f 6e73 5d20  igQueryOptions] 
-00001740: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00001750: 636c 6965 6e74 735f 7072 6f76 6964 6572  clients_provider
-00001760: 3a20 4f70 7469 6f6e 616c 5b62 6967 6672  : Optional[bigfr
-00001770: 616d 6573 2e73 6573 7369 6f6e 2e63 6c69  ames.session.cli
-00001780: 656e 7473 2e43 6c69 656e 7473 5072 6f76  ents.ClientsProv
-00001790: 6964 6572 5d20 3d20 4e6f 6e65 2c0a 2020  ider] = None,.  
-000017a0: 2020 293a 0a20 2020 2020 2020 2069 6620    ):.        if 
-000017b0: 636f 6e74 6578 7420 6973 204e 6f6e 653a  context is None:
-000017c0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-000017d0: 7465 7874 203d 2062 6967 7175 6572 795f  text = bigquery_
-000017e0: 6f70 7469 6f6e 732e 4269 6751 7565 7279  options.BigQuery
-000017f0: 4f70 7469 6f6e 7328 290a 0a20 2020 2020  Options()..     
-00001800: 2020 2069 6620 636f 6e74 6578 742e 6c6f     if context.lo
-00001810: 6361 7469 6f6e 2069 7320 4e6f 6e65 3a0a  cation is None:.
-00001820: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00001830: 2e5f 6c6f 6361 7469 6f6e 203d 2022 5553  ._location = "US
-00001840: 220a 2020 2020 2020 2020 2020 2020 7761  ".            wa
-00001850: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
-00001860: 2020 2020 2020 2020 2020 2020 2066 224e               f"N
-00001870: 6f20 6578 706c 6963 6974 206c 6f63 6174  o explicit locat
-00001880: 696f 6e20 6973 2073 6574 2c20 736f 2075  ion is set, so u
-00001890: 7369 6e67 206c 6f63 6174 696f 6e20 7b73  sing location {s
-000018a0: 656c 662e 5f6c 6f63 6174 696f 6e7d 2066  elf._location} f
-000018b0: 6f72 2074 6865 2073 6573 7369 6f6e 2e22  or the session."
-000018c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000018d0: 2020 2320 5573 6572 2773 2063 6f64 650a    # User's code.
-000018e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000018f0: 2320 2d3e 2067 6574 5f67 6c6f 6261 6c5f  # -> get_global_
-00001900: 7365 7373 696f 6e28 290a 2020 2020 2020  session().      
-00001910: 2020 2020 2020 2020 2020 2320 2d3e 2063            # -> c
-00001920: 6f6e 6e65 6374 2829 0a20 2020 2020 2020  onnect().       
-00001930: 2020 2020 2020 2020 2023 202d 3e20 5365           # -> Se
-00001940: 7373 696f 6e28 290a 2020 2020 2020 2020  ssion().        
-00001950: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
-00001960: 2020 2020 2020 2020 2020 2320 4e6f 7465            # Note
-00001970: 3a20 5765 2063 6f75 6c64 2061 6c73 6f20  : We could also 
-00001980: 6861 7665 3a0a 2020 2020 2020 2020 2020  have:.          
-00001990: 2020 2020 2020 2320 5573 6572 2773 2063        # User's c
-000019a0: 6f64 650a 2020 2020 2020 2020 2020 2020  ode.            
-000019b0: 2020 2020 2320 2d3e 2072 6561 645f 6762      # -> read_gb
-000019c0: 7128 290a 2020 2020 2020 2020 2020 2020  q().            
-000019d0: 2020 2020 2320 2d3e 2077 6974 685f 6465      # -> with_de
-000019e0: 6661 756c 745f 7365 7373 696f 6e28 290a  fault_session().
-000019f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001a00: 2320 2d3e 2067 6574 5f67 6c6f 6261 6c5f  # -> get_global_
-00001a10: 7365 7373 696f 6e28 290a 2020 2020 2020  session().      
-00001a20: 2020 2020 2020 2020 2020 2320 2d3e 2063            # -> c
-00001a30: 6f6e 6e65 6374 2829 0a20 2020 2020 2020  onnect().       
-00001a40: 2020 2020 2020 2020 2023 202d 3e20 5365           # -> Se
-00001a50: 7373 696f 6e28 290a 2020 2020 2020 2020  ssion().        
-00001a60: 2020 2020 2020 2020 2320 6275 7420 7765          # but we
-00001a70: 2063 7572 7265 6e74 6c79 2068 6176 6520   currently have 
-00001a80: 6e6f 2077 6179 2074 6f20 6469 7361 6d62  no way to disamb
-00001a90: 6967 7561 7465 2074 6865 7365 0a20 2020  iguate these.   
-00001aa0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-00001ab0: 6974 7561 7469 6f6e 732e 0a20 2020 2020  ituations..     
-00001ac0: 2020 2020 2020 2020 2020 2073 7461 636b             stack
-00001ad0: 6c65 7665 6c3d 342c 0a20 2020 2020 2020  level=4,.       
-00001ae0: 2020 2020 2020 2020 2063 6174 6567 6f72           categor
-00001af0: 793d 6269 6766 7261 6d65 732e 6578 6365  y=bigframes.exce
-00001b00: 7074 696f 6e73 2e44 6566 6175 6c74 4c6f  ptions.DefaultLo
-00001b10: 6361 7469 6f6e 5761 726e 696e 672c 0a20  cationWarning,. 
-00001b20: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00001b30: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00001b40: 2020 2020 2020 2073 656c 662e 5f6c 6f63         self._loc
-00001b50: 6174 696f 6e20 3d20 636f 6e74 6578 742e  ation = context.
-00001b60: 6c6f 6361 7469 6f6e 0a0a 2020 2020 2020  location..      
-00001b70: 2020 7365 6c66 2e5f 6271 5f6b 6d73 5f6b    self._bq_kms_k
-00001b80: 6579 5f6e 616d 6520 3d20 636f 6e74 6578  ey_name = contex
-00001b90: 742e 6b6d 735f 6b65 795f 6e61 6d65 0a0a  t.kms_key_name..
-00001ba0: 2020 2020 2020 2020 2320 496e 7374 616e          # Instan
-00001bb0: 7469 6174 6520 6120 636c 6965 6e74 7320  tiate a clients 
-00001bc0: 7072 6f76 6964 6572 2074 6f20 6865 6c70  provider to help
-00001bd0: 2077 6974 6820 636c 6f75 6420 636c 6965   with cloud clie
-00001be0: 6e74 7320 7468 6174 2077 696c 6c20 6265  nts that will be
-00001bf0: 0a20 2020 2020 2020 2023 2075 7365 6420  .        # used 
-00001c00: 696e 2074 6865 2066 7574 7572 6520 6f70  in the future op
-00001c10: 6572 6174 696f 6e73 2069 6e20 7468 6520  erations in the 
-00001c20: 7365 7373 696f 6e0a 2020 2020 2020 2020  session.        
-00001c30: 6966 2063 6c69 656e 7473 5f70 726f 7669  if clients_provi
-00001c40: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-00001c50: 2073 656c 662e 5f63 6c69 656e 7473 5f70   self._clients_p
-00001c60: 726f 7669 6465 7220 3d20 636c 6965 6e74  rovider = client
-00001c70: 735f 7072 6f76 6964 6572 0a20 2020 2020  s_provider.     
-00001c80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00001c90: 2020 2020 2073 656c 662e 5f63 6c69 656e       self._clien
-00001ca0: 7473 5f70 726f 7669 6465 7220 3d20 6269  ts_provider = bi
-00001cb0: 6766 7261 6d65 732e 7365 7373 696f 6e2e  gframes.session.
-00001cc0: 636c 6965 6e74 732e 436c 6965 6e74 7350  clients.ClientsP
-00001cd0: 726f 7669 6465 7228 0a20 2020 2020 2020  rovider(.       
-00001ce0: 2020 2020 2020 2020 2070 726f 6a65 6374           project
-00001cf0: 3d63 6f6e 7465 7874 2e70 726f 6a65 6374  =context.project
-00001d00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00001d10: 2020 6c6f 6361 7469 6f6e 3d73 656c 662e    location=self.
-00001d20: 5f6c 6f63 6174 696f 6e2c 0a20 2020 2020  _location,.     
-00001d30: 2020 2020 2020 2020 2020 2075 7365 5f72             use_r
-00001d40: 6567 696f 6e61 6c5f 656e 6470 6f69 6e74  egional_endpoint
-00001d50: 733d 636f 6e74 6578 742e 7573 655f 7265  s=context.use_re
-00001d60: 6769 6f6e 616c 5f65 6e64 706f 696e 7473  gional_endpoints
-00001d70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00001d80: 2020 6372 6564 656e 7469 616c 733d 636f    credentials=co
-00001d90: 6e74 6578 742e 6372 6564 656e 7469 616c  ntext.credential
-00001da0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00001db0: 2020 2061 7070 6c69 6361 7469 6f6e 5f6e     application_n
-00001dc0: 616d 653d 636f 6e74 6578 742e 6170 706c  ame=context.appl
-00001dd0: 6963 6174 696f 6e5f 6e61 6d65 2c0a 2020  ication_name,.  
-00001de0: 2020 2020 2020 2020 2020 2020 2020 6271                bq
-00001df0: 5f6b 6d73 5f6b 6579 5f6e 616d 653d 7365  _kms_key_name=se
-00001e00: 6c66 2e5f 6271 5f6b 6d73 5f6b 6579 5f6e  lf._bq_kms_key_n
-00001e10: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00001e20: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
-00001e30: 2e5f 616e 6f6e 796d 6f75 735f 6461 7461  ._anonymous_data
-00001e40: 7365 7420 3d20 280a 2020 2020 2020 2020  set = (.        
-00001e50: 2020 2020 6269 6766 7261 6d65 732e 7365      bigframes.se
-00001e60: 7373 696f 6e2e 5f69 6f2e 6269 6771 7565  ssion._io.bigque
-00001e70: 7279 2e63 7265 6174 655f 6271 5f64 6174  ry.create_bq_dat
-00001e80: 6173 6574 5f72 6566 6572 656e 6365 280a  aset_reference(.
-00001e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ea0: 7365 6c66 2e62 7163 6c69 656e 742c 206c  self.bqclient, l
-00001eb0: 6f63 6174 696f 6e3d 7365 6c66 2e5f 6c6f  ocation=self._lo
-00001ec0: 6361 7469 6f6e 0a20 2020 2020 2020 2020  cation.         
-00001ed0: 2020 2029 0a20 2020 2020 2020 2029 0a0a     ).        )..
-00001ee0: 2020 2020 2020 2020 2320 544f 444f 2873          # TODO(s
-00001ef0: 686f 6273 293a 2052 656d 6f76 6520 7468  hobs): Remove th
-00001f00: 6973 206c 6f67 6963 2061 6674 6572 2068  is logic after h
-00001f10: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-00001f20: 6d2f 6962 6973 2d70 726f 6a65 6374 2f69  m/ibis-project/i
-00001f30: 6269 732f 6973 7375 6573 2f38 3439 340a  bis/issues/8494.
-00001f40: 2020 2020 2020 2020 2320 6861 7320 6265          # has be
-00001f50: 656e 2066 6978 6564 2e20 5468 6520 6962  en fixed. The ib
-00001f60: 6973 2063 6c69 656e 7420 6368 616e 6765  is client change
-00001f70: 7320 7468 6520 6465 6661 756c 7420 7175  s the default qu
-00001f80: 6572 7920 6a6f 6220 636f 6e66 6967 0a20  ery job config. 
-00001f90: 2020 2020 2020 2023 2073 6f20 7765 2061         # so we a
-00001fa0: 7265 2067 6f69 6e67 2074 6f20 7265 6d65  re going to reme
-00001fb0: 6d62 6572 2074 6865 2063 7572 7265 6e74  mber the current
-00001fc0: 2063 6f6e 6669 6720 616e 6420 7265 7374   config and rest
-00001fd0: 6f72 6520 6974 2061 6674 6572 0a20 2020  ore it after.   
-00001fe0: 2020 2020 2023 2074 6865 2069 6269 7320       # the ibis 
-00001ff0: 636c 6965 6e74 2068 6173 2062 6565 6e20  client has been 
-00002000: 6372 6561 7465 640a 2020 2020 2020 2020  created.        
-00002010: 6f72 6967 696e 616c 5f64 6566 6175 6c74  original_default
-00002020: 5f71 7565 7279 5f6a 6f62 5f63 6f6e 6669  _query_job_confi
-00002030: 6720 3d20 7365 6c66 2e62 7163 6c69 656e  g = self.bqclien
-00002040: 742e 6465 6661 756c 745f 7175 6572 795f  t.default_query_
-00002050: 6a6f 625f 636f 6e66 6967 0a0a 2020 2020  job_config..    
-00002060: 2020 2020 7365 6c66 2e69 6269 735f 636c      self.ibis_cl
-00002070: 6965 6e74 203d 2074 7970 696e 672e 6361  ient = typing.ca
-00002080: 7374 280a 2020 2020 2020 2020 2020 2020  st(.            
-00002090: 6962 6973 5f62 6967 7175 6572 792e 4261  ibis_bigquery.Ba
-000020a0: 636b 656e 642c 0a20 2020 2020 2020 2020  ckend,.         
-000020b0: 2020 2069 6269 732e 6269 6771 7565 7279     ibis.bigquery
-000020c0: 2e63 6f6e 6e65 6374 280a 2020 2020 2020  .connect(.      
-000020d0: 2020 2020 2020 2020 2020 7072 6f6a 6563            projec
-000020e0: 745f 6964 3d63 6f6e 7465 7874 2e70 726f  t_id=context.pro
-000020f0: 6a65 6374 2c0a 2020 2020 2020 2020 2020  ject,.          
-00002100: 2020 2020 2020 636c 6965 6e74 3d73 656c        client=sel
-00002110: 662e 6271 636c 6965 6e74 2c0a 2020 2020  f.bqclient,.    
-00002120: 2020 2020 2020 2020 2020 2020 7374 6f72              stor
-00002130: 6167 655f 636c 6965 6e74 3d73 656c 662e  age_client=self.
-00002140: 6271 7374 6f72 6167 6572 6561 6463 6c69  bqstoragereadcli
-00002150: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
-00002160: 2029 2c0a 2020 2020 2020 2020 290a 0a20   ),.        ).. 
-00002170: 2020 2020 2020 2073 656c 662e 6271 636c         self.bqcl
-00002180: 6965 6e74 2e64 6566 6175 6c74 5f71 7565  ient.default_que
-00002190: 7279 5f6a 6f62 5f63 6f6e 6669 6720 3d20  ry_job_config = 
-000021a0: 6f72 6967 696e 616c 5f64 6566 6175 6c74  original_default
-000021b0: 5f71 7565 7279 5f6a 6f62 5f63 6f6e 6669  _query_job_confi
-000021c0: 670a 0a20 2020 2020 2020 2023 2052 6573  g..        # Res
-000021d0: 6f6c 7665 2074 6865 2042 5120 636f 6e6e  olve the BQ conn
-000021e0: 6563 7469 6f6e 2066 6f72 2072 656d 6f74  ection for remot
-000021f0: 6520 6675 6e63 7469 6f6e 2061 6e64 2056  e function and V
-00002200: 6572 7465 7820 4149 2069 6e74 6567 7261  ertex AI integra
-00002210: 7469 6f6e 0a20 2020 2020 2020 2073 656c  tion.        sel
-00002220: 662e 5f62 715f 636f 6e6e 6563 7469 6f6e  f._bq_connection
-00002230: 203d 2063 6f6e 7465 7874 2e62 715f 636f   = context.bq_co
-00002240: 6e6e 6563 7469 6f6e 206f 7220 5f42 4947  nnection or _BIG
-00002250: 4652 414d 4553 5f44 4546 4155 4c54 5f43  FRAMES_DEFAULT_C
-00002260: 4f4e 4e45 4354 494f 4e5f 4944 0a20 2020  ONNECTION_ID.   
-00002270: 2020 2020 2073 656c 662e 5f73 6b69 705f       self._skip_
-00002280: 6271 5f63 6f6e 6e65 6374 696f 6e5f 6368  bq_connection_ch
-00002290: 6563 6b20 3d20 636f 6e74 6578 742e 5f73  eck = context._s
-000022a0: 6b69 705f 6271 5f63 6f6e 6e65 6374 696f  kip_bq_connectio
-000022b0: 6e5f 6368 6563 6b0a 0a20 2020 2020 2020  n_check..       
-000022c0: 2023 204e 6f77 2074 6861 7420 7765 2772   # Now that we'r
-000022d0: 6520 7374 6172 7469 6e67 2074 6865 2073  e starting the s
-000022e0: 6573 7369 6f6e 2c20 646f 6e27 7420 616c  ession, don't al
-000022f0: 6c6f 7720 7468 6520 6f70 7469 6f6e 7320  low the options 
-00002300: 746f 2062 650a 2020 2020 2020 2020 2320  to be.        # 
-00002310: 6368 616e 6765 642e 0a20 2020 2020 2020  changed..       
-00002320: 2063 6f6e 7465 7874 2e5f 7365 7373 696f   context._sessio
-00002330: 6e5f 7374 6172 7465 6420 3d20 5472 7565  n_started = True
-00002340: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
-00002350: 665f 736e 6170 7368 6f74 3a20 4469 6374  f_snapshot: Dict
-00002360: 5b0a 2020 2020 2020 2020 2020 2020 6269  [.            bi
-00002370: 6771 7565 7279 2e54 6162 6c65 5265 6665  gquery.TableRefe
-00002380: 7265 6e63 652c 2054 7570 6c65 5b64 6174  rence, Tuple[dat
-00002390: 6574 696d 652e 6461 7465 7469 6d65 2c20  etime.datetime, 
-000023a0: 6269 6771 7565 7279 2e54 6162 6c65 5d0a  bigquery.Table].
-000023b0: 2020 2020 2020 2020 5d20 3d20 7b7d 0a0a          ] = {}..
-000023c0: 2020 2020 2020 2020 2320 756e 6971 7565          # unique
-000023d0: 2073 6573 7369 6f6e 2069 6465 6e74 6966   session identif
-000023e0: 6965 722c 2073 686f 7274 2065 6e6f 7567  ier, short enoug
-000023f0: 6820 746f 2062 6520 6875 6d61 6e20 7265  h to be human re
-00002400: 6164 6162 6c65 0a20 2020 2020 2020 2023  adable.        #
-00002410: 206f 6e6c 7920 6e65 6564 7320 746f 2062   only needs to b
-00002420: 6520 756e 6971 7565 2061 6d6f 6e67 2073  e unique among s
-00002430: 6573 7369 6f6e 7320 6372 6561 7465 6420  essions created 
-00002440: 6279 2074 6865 2073 616d 6520 7573 6572  by the same user
-00002450: 0a20 2020 2020 2020 2023 2061 7420 7468  .        # at th
-00002460: 6520 7361 6d65 2074 696d 6520 696e 2074  e same time in t
-00002470: 6865 2073 616d 6520 7265 6769 6f6e 0a20  he same region. 
-00002480: 2020 2020 2020 2073 656c 662e 5f73 6573         self._ses
-00002490: 7369 6f6e 5f69 643a 2073 7472 203d 2022  sion_id: str = "
-000024a0: 7365 7373 696f 6e22 202b 2073 6563 7265  session" + secre
-000024b0: 7473 2e74 6f6b 656e 5f68 6578 2833 290a  ts.token_hex(3).
-000024c0: 2020 2020 2020 2020 7365 6c66 2e5f 7461          self._ta
-000024d0: 626c 655f 6964 733a 204c 6973 745b 7374  ble_ids: List[st
-000024e0: 725d 203d 205b 5d0a 2020 2020 2020 2020  r] = [].        
-000024f0: 2320 7374 6f72 6520 7461 626c 6520 6964  # store table id
-00002500: 7320 616e 6420 6465 6c65 7465 2074 6865  s and delete the
-00002510: 6d20 7768 656e 2074 6865 2073 6573 7369  m when the sessi
-00002520: 6f6e 2069 7320 636c 6f73 6564 0a0a 2020  on is closed..  
-00002530: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00002540: 6465 6620 6271 636c 6965 6e74 2873 656c  def bqclient(sel
-00002550: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-00002560: 726e 2073 656c 662e 5f63 6c69 656e 7473  rn self._clients
-00002570: 5f70 726f 7669 6465 722e 6271 636c 6965  _provider.bqclie
-00002580: 6e74 0a0a 2020 2020 4070 726f 7065 7274  nt..    @propert
-00002590: 790a 2020 2020 6465 6620 6271 636f 6e6e  y.    def bqconn
-000025a0: 6563 7469 6f6e 636c 6965 6e74 2873 656c  ectionclient(sel
-000025b0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-000025c0: 726e 2073 656c 662e 5f63 6c69 656e 7473  rn self._clients
-000025d0: 5f70 726f 7669 6465 722e 6271 636f 6e6e  _provider.bqconn
-000025e0: 6563 7469 6f6e 636c 6965 6e74 0a0a 2020  ectionclient..  
-000025f0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00002600: 6465 6620 6271 7374 6f72 6167 6572 6561  def bqstoragerea
-00002610: 6463 6c69 656e 7428 7365 6c66 293a 0a20  dclient(self):. 
-00002620: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00002630: 6c66 2e5f 636c 6965 6e74 735f 7072 6f76  lf._clients_prov
-00002640: 6964 6572 2e62 7173 746f 7261 6765 7265  ider.bqstoragere
-00002650: 6164 636c 6965 6e74 0a0a 2020 2020 4070  adclient..    @p
-00002660: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00002670: 636c 6f75 6466 756e 6374 696f 6e73 636c  cloudfunctionscl
-00002680: 6965 6e74 2873 656c 6629 3a0a 2020 2020  ient(self):.    
-00002690: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000026a0: 5f63 6c69 656e 7473 5f70 726f 7669 6465  _clients_provide
-000026b0: 722e 636c 6f75 6466 756e 6374 696f 6e73  r.cloudfunctions
-000026c0: 636c 6965 6e74 0a0a 2020 2020 4070 726f  client..    @pro
-000026d0: 7065 7274 790a 2020 2020 6465 6620 7265  perty.    def re
-000026e0: 736f 7572 6365 6d61 6e61 6765 7263 6c69  sourcemanagercli
-000026f0: 656e 7428 7365 6c66 293a 0a20 2020 2020  ent(self):.     
-00002700: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00002710: 636c 6965 6e74 735f 7072 6f76 6964 6572  clients_provider
-00002720: 2e72 6573 6f75 7263 656d 616e 6167 6572  .resourcemanager
-00002730: 636c 6965 6e74 0a0a 2020 2020 5f62 715f  client..    _bq_
-00002740: 636f 6e6e 6563 7469 6f6e 5f6d 616e 6167  connection_manag
-00002750: 6572 3a20 4f70 7469 6f6e 616c 5b62 6967  er: Optional[big
-00002760: 6672 616d 6573 2e63 6c69 656e 7473 2e42  frames.clients.B
-00002770: 7143 6f6e 6e65 6374 696f 6e4d 616e 6167  qConnectionManag
-00002780: 6572 5d20 3d20 4e6f 6e65 0a0a 2020 2020  er] = None..    
-00002790: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-000027a0: 6620 6271 636f 6e6e 6563 7469 6f6e 6d61  f bqconnectionma
-000027b0: 6e61 6765 7228 7365 6c66 293a 0a20 2020  nager(self):.   
-000027c0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-000027d0: 2e5f 736b 6970 5f62 715f 636f 6e6e 6563  ._skip_bq_connec
-000027e0: 7469 6f6e 5f63 6865 636b 2061 6e64 206e  tion_check and n
-000027f0: 6f74 2073 656c 662e 5f62 715f 636f 6e6e  ot self._bq_conn
-00002800: 6563 7469 6f6e 5f6d 616e 6167 6572 3a0a  ection_manager:.
-00002810: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00002820: 2e5f 6271 5f63 6f6e 6e65 6374 696f 6e5f  ._bq_connection_
-00002830: 6d61 6e61 6765 7220 3d20 6269 6766 7261  manager = bigfra
-00002840: 6d65 732e 636c 6965 6e74 732e 4271 436f  mes.clients.BqCo
-00002850: 6e6e 6563 7469 6f6e 4d61 6e61 6765 7228  nnectionManager(
-00002860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002870: 2073 656c 662e 6271 636f 6e6e 6563 7469   self.bqconnecti
-00002880: 6f6e 636c 6965 6e74 2c20 7365 6c66 2e72  onclient, self.r
-00002890: 6573 6f75 7263 656d 616e 6167 6572 636c  esourcemanagercl
-000028a0: 6965 6e74 0a20 2020 2020 2020 2020 2020  ient.           
-000028b0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-000028c0: 6e20 7365 6c66 2e5f 6271 5f63 6f6e 6e65  n self._bq_conne
-000028d0: 6374 696f 6e5f 6d61 6e61 6765 720a 0a20  ction_manager.. 
-000028e0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-000028f0: 2064 6566 2073 6573 7369 6f6e 5f69 6428   def session_id(
-00002900: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-00002910: 6574 7572 6e20 7365 6c66 2e5f 7365 7373  eturn self._sess
-00002920: 696f 6e5f 6964 0a0a 2020 2020 4070 726f  ion_id..    @pro
-00002930: 7065 7274 790a 2020 2020 6465 6620 5f70  perty.    def _p
-00002940: 726f 6a65 6374 2873 656c 6629 3a0a 2020  roject(self):.  
-00002950: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00002960: 662e 6271 636c 6965 6e74 2e70 726f 6a65  f.bqclient.proje
-00002970: 6374 0a0a 2020 2020 6465 6620 5f5f 6861  ct..    def __ha
-00002980: 7368 5f5f 2873 656c 6629 3a0a 2020 2020  sh__(self):.    
-00002990: 2020 2020 2320 5374 6162 6c65 2068 6173      # Stable has
-000029a0: 6820 6e65 6564 6564 2074 6f20 7573 6520  h needed to use 
-000029b0: 696e 2065 7870 7265 7373 696f 6e20 7472  in expression tr
-000029c0: 6565 0a20 2020 2020 2020 2072 6574 7572  ee.        retur
-000029d0: 6e20 6861 7368 2873 7472 2873 656c 662e  n hash(str(self.
-000029e0: 5f61 6e6f 6e79 6d6f 7573 5f64 6174 6173  _anonymous_datas
-000029f0: 6574 2929 0a0a 2020 2020 6465 6620 636c  et))..    def cl
-00002a00: 6f73 6528 7365 6c66 293a 0a20 2020 2020  ose(self):.     
-00002a10: 2020 2022 2222 4465 6c65 7465 2074 6162     """Delete tab
-00002a20: 6c65 7320 7468 6174 2077 6572 6520 6372  les that were cr
-00002a30: 6561 7465 6420 7769 7468 2074 6869 7320  eated with this 
-00002a40: 7365 7373 696f 6e27 7320 7365 7373 696f  session's sessio
-00002a50: 6e5f 6964 2e22 2222 0a20 2020 2020 2020  n_id.""".       
-00002a60: 2063 6c69 656e 7420 3d20 7365 6c66 2e62   client = self.b
-00002a70: 7163 6c69 656e 740a 2020 2020 2020 2020  qclient.        
-00002a80: 7072 6f6a 6563 745f 6964 203d 2073 656c  project_id = sel
-00002a90: 662e 5f61 6e6f 6e79 6d6f 7573 5f64 6174  f._anonymous_dat
-00002aa0: 6173 6574 2e70 726f 6a65 6374 0a20 2020  aset.project.   
-00002ab0: 2020 2020 2064 6174 6173 6574 5f69 6420       dataset_id 
-00002ac0: 3d20 7365 6c66 2e5f 616e 6f6e 796d 6f75  = self._anonymou
-00002ad0: 735f 6461 7461 7365 742e 6461 7461 7365  s_dataset.datase
-00002ae0: 745f 6964 0a0a 2020 2020 2020 2020 666f  t_id..        fo
-00002af0: 7220 7461 626c 655f 6964 2069 6e20 7365  r table_id in se
-00002b00: 6c66 2e5f 7461 626c 655f 6964 733a 0a20  lf._table_ids:. 
-00002b10: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
-00002b20: 6964 203d 2022 2e22 2e6a 6f69 6e28 5b70  id = ".".join([p
-00002b30: 726f 6a65 6374 5f69 642c 2064 6174 6173  roject_id, datas
-00002b40: 6574 5f69 642c 2074 6162 6c65 5f69 645d  et_id, table_id]
-00002b50: 290a 2020 2020 2020 2020 2020 2020 636c  ).            cl
-00002b60: 6965 6e74 2e64 656c 6574 655f 7461 626c  ient.delete_tabl
-00002b70: 6528 6675 6c6c 5f69 642c 206e 6f74 5f66  e(full_id, not_f
-00002b80: 6f75 6e64 5f6f 6b3d 5472 7565 290a 0a20  ound_ok=True).. 
-00002b90: 2020 2064 6566 2072 6561 645f 6762 7128     def read_gbq(
-00002ba0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00002bb0: 2020 2020 2020 2071 7565 7279 5f6f 725f         query_or_
-00002bc0: 7461 626c 653a 2073 7472 2c0a 2020 2020  table: str,.    
-00002bd0: 2020 2020 2a2c 0a20 2020 2020 2020 2069      *,.        i
-00002be0: 6e64 6578 5f63 6f6c 3a20 4974 6572 6162  ndex_col: Iterab
-00002bf0: 6c65 5b73 7472 5d20 7c20 7374 7220 7c20  le[str] | str | 
-00002c00: 6269 6766 7261 6d65 732e 656e 756d 732e  bigframes.enums.
-00002c10: 4465 6661 756c 7449 6e64 6578 4b69 6e64  DefaultIndexKind
-00002c20: 203d 2028 292c 0a20 2020 2020 2020 2063   = (),.        c
-00002c30: 6f6c 756d 6e73 3a20 4974 6572 6162 6c65  olumns: Iterable
-00002c40: 5b73 7472 5d20 3d20 2829 2c0a 2020 2020  [str] = (),.    
-00002c50: 2020 2020 636f 6e66 6967 7572 6174 696f      configuratio
-00002c60: 6e3a 204f 7074 696f 6e61 6c5b 4469 6374  n: Optional[Dict
-00002c70: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00002c80: 2020 6d61 785f 7265 7375 6c74 733a 204f    max_results: O
-00002c90: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
-00002ca0: 6f6e 652c 0a20 2020 2020 2020 2066 696c  one,.        fil
-00002cb0: 7465 7273 3a20 7468 6972 645f 7061 7274  ters: third_part
-00002cc0: 795f 7061 6e64 6173 5f67 6271 2e46 696c  y_pandas_gbq.Fil
-00002cd0: 7465 7273 5479 7065 203d 2028 292c 0a20  tersType = (),. 
-00002ce0: 2020 2020 2020 2075 7365 5f63 6163 6865         use_cache
-00002cf0: 3a20 4f70 7469 6f6e 616c 5b62 6f6f 6c5d  : Optional[bool]
-00002d00: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00002d10: 2063 6f6c 5f6f 7264 6572 3a20 4974 6572   col_order: Iter
-00002d20: 6162 6c65 5b73 7472 5d20 3d20 2829 2c0a  able[str] = (),.
-00002d30: 2020 2020 2020 2020 2320 4164 6420 6120          # Add a 
-00002d40: 7665 7269 6679 2069 6e64 6578 2061 7267  verify index arg
-00002d50: 756d 656e 7420 7468 6174 2066 6169 6c73  ument that fails
-00002d60: 2069 6620 7468 6520 696e 6465 7820 6973   if the index is
-00002d70: 206e 6f74 2075 6e69 7175 652e 0a20 2020   not unique..   
-00002d80: 2029 202d 3e20 6461 7461 6672 616d 652e   ) -> dataframe.
-00002d90: 4461 7461 4672 616d 653a 0a20 2020 2020  DataFrame:.     
-00002da0: 2020 2023 2054 4f44 4f28 622f 3238 3135     # TODO(b/2815
-00002db0: 3731 3231 3429 3a20 4765 6e65 7261 7465  71214): Generate
-00002dc0: 2070 726f 6d70 7420 746f 2073 686f 7720   prompt to show 
-00002dd0: 7468 6520 7072 6f67 7265 7373 206f 6620  the progress of 
-00002de0: 7265 6164 5f67 6271 2e0a 2020 2020 2020  read_gbq..      
-00002df0: 2020 6966 2063 6f6c 756d 6e73 2061 6e64    if columns and
-00002e00: 2063 6f6c 5f6f 7264 6572 3a0a 2020 2020   col_order:.    
-00002e10: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00002e20: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00002e30: 2020 2020 2020 2020 2020 224d 7573 7420            "Must 
-00002e40: 7370 6563 6966 7920 6569 7468 6572 2063  specify either c
-00002e50: 6f6c 756d 6e73 2028 7072 6566 6572 7265  olumns (preferre
-00002e60: 6429 206f 7220 636f 6c5f 6f72 6465 722c  d) or col_order,
-00002e70: 206e 6f74 2062 6f74 6822 0a20 2020 2020   not both".     
-00002e80: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00002e90: 2065 6c69 6620 636f 6c5f 6f72 6465 723a   elif col_order:
-00002ea0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00002eb0: 756d 6e73 203d 2063 6f6c 5f6f 7264 6572  umns = col_order
-00002ec0: 0a0a 2020 2020 2020 2020 6669 6c74 6572  ..        filter
-00002ed0: 7320 3d20 6c69 7374 2866 696c 7465 7273  s = list(filters
-00002ee0: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
-00002ef0: 2866 696c 7465 7273 2920 213d 2030 206f  (filters) != 0 o
-00002f00: 7220 6266 5f69 6f5f 6269 6771 7565 7279  r bf_io_bigquery
-00002f10: 2e69 735f 7461 626c 655f 7769 7468 5f77  .is_table_with_w
-00002f20: 696c 6463 6172 645f 7375 6666 6978 280a  ildcard_suffix(.
-00002f30: 2020 2020 2020 2020 2020 2020 7175 6572              quer
-00002f40: 795f 6f72 5f74 6162 6c65 0a20 2020 2020  y_or_table.     
-00002f50: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00002f60: 2020 2320 544f 444f 2862 2f33 3338 3131    # TODO(b/33811
-00002f70: 3133 3434 293a 2054 6869 7320 6170 7065  1344): This appe
-00002f80: 6172 7320 746f 2062 6520 6d69 7373 696e  ars to be missin
-00002f90: 6720 696e 6465 785f 636f 6c73 2c20 7768  g index_cols, wh
-00002fa0: 6963 680a 2020 2020 2020 2020 2020 2020  ich.            
-00002fb0: 2320 6172 6520 6e65 6365 7373 6172 7920  # are necessary 
-00002fc0: 746f 2062 6520 7365 6c65 6374 6564 2e0a  to be selected..
-00002fd0: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
-00002fe0: 444f 2862 2f33 3338 3033 3935 3137 293a  DO(b/338039517):
-00002ff0: 2052 6566 6163 746f 7220 7468 6973 2074   Refactor this t
-00003000: 6f20 6265 2063 616c 6c65 6420 696e 7369  o be called insi
-00003010: 6465 2062 6f74 680a 2020 2020 2020 2020  de both.        
-00003020: 2020 2020 2320 5f72 6561 645f 6762 715f      # _read_gbq_
-00003030: 7175 6572 7920 616e 6420 5f72 6561 645f  query and _read_
-00003040: 6762 715f 7461 626c 6520 2861 6674 6572  gbq_table (after
-00003050: 2064 6574 6563 7469 6e67 2070 7269 6d61   detecting prima
-00003060: 7279 206b 6579 7329 0a20 2020 2020 2020  ry keys).       
-00003070: 2020 2020 2023 2073 6f20 7765 2063 616e       # so we can
-00003080: 206d 616b 6520 7375 7265 2069 6e64 6578   make sure index
-00003090: 5f63 6f6c 2f69 6e64 6578 5f63 6f6c 7320  _col/index_cols 
-000030a0: 7265 666c 6563 7473 2070 7269 6d61 7279  reflects primary
-000030b0: 206b 6579 732e 0a20 2020 2020 2020 2020   keys..         
-000030c0: 2020 2071 7565 7279 5f6f 725f 7461 626c     query_or_tabl
-000030d0: 6520 3d20 6266 5f69 6f5f 6269 6771 7565  e = bf_io_bigque
-000030e0: 7279 2e74 6f5f 7175 6572 7928 0a20 2020  ry.to_query(.   
-000030f0: 2020 2020 2020 2020 2020 2020 2071 7565               que
-00003100: 7279 5f6f 725f 7461 626c 652c 205f 746f  ry_or_table, _to
-00003110: 5f69 6e64 6578 5f63 6f6c 7328 696e 6465  _index_cols(inde
-00003120: 785f 636f 6c29 2c20 636f 6c75 6d6e 732c  x_col), columns,
-00003130: 2066 696c 7465 7273 0a20 2020 2020 2020   filters.       
-00003140: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00003150: 6966 2062 665f 696f 5f62 6967 7175 6572  if bf_io_bigquer
-00003160: 792e 6973 5f71 7565 7279 2871 7565 7279  y.is_query(query
-00003170: 5f6f 725f 7461 626c 6529 3a0a 2020 2020  _or_table):.    
-00003180: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00003190: 656c 662e 5f72 6561 645f 6762 715f 7175  elf._read_gbq_qu
-000031a0: 6572 7928 0a20 2020 2020 2020 2020 2020  ery(.           
-000031b0: 2020 2020 2071 7565 7279 5f6f 725f 7461       query_or_ta
-000031c0: 626c 652c 0a20 2020 2020 2020 2020 2020  ble,.           
-000031d0: 2020 2020 2069 6e64 6578 5f63 6f6c 3d69       index_col=i
-000031e0: 6e64 6578 5f63 6f6c 2c0a 2020 2020 2020  ndex_col,.      
-000031f0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00003200: 733d 636f 6c75 6d6e 732c 0a20 2020 2020  s=columns,.     
-00003210: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-00003220: 6775 7261 7469 6f6e 3d63 6f6e 6669 6775  guration=configu
-00003230: 7261 7469 6f6e 2c0a 2020 2020 2020 2020  ration,.        
-00003240: 2020 2020 2020 2020 6d61 785f 7265 7375          max_resu
-00003250: 6c74 733d 6d61 785f 7265 7375 6c74 732c  lts=max_results,
-00003260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003270: 2061 7069 5f6e 616d 653d 2272 6561 645f   api_name="read_
-00003280: 6762 7122 2c0a 2020 2020 2020 2020 2020  gbq",.          
-00003290: 2020 2020 2020 7573 655f 6361 6368 653d        use_cache=
-000032a0: 7573 655f 6361 6368 652c 0a20 2020 2020  use_cache,.     
-000032b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000032c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000032d0: 2020 2069 6620 636f 6e66 6967 7572 6174     if configurat
-000032e0: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
-000032f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003300: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00003310: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00003320: 2020 2020 2020 2022 5468 6520 2763 6f6e         "The 'con
-00003330: 6669 6775 7261 7469 6f6e 2720 6172 6775  figuration' argu
-00003340: 6d65 6e74 2069 7320 6e6f 7420 616c 6c6f  ment is not allo
-00003350: 7765 6420 7768 656e 2022 0a20 2020 2020  wed when ".     
-00003360: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00003370: 6469 7265 6374 6c79 2072 6561 6469 6e67  directly reading
-00003380: 2066 726f 6d20 6120 7461 626c 652e 2050   from a table. P
-00003390: 6c65 6173 6520 7265 6d6f 7665 2022 0a20  lease remove ". 
-000033a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000033b0: 2020 2022 2763 6f6e 6669 6775 7261 7469     "'configurati
-000033c0: 6f6e 2720 6f72 2075 7365 2061 2071 7565  on' or use a que
-000033d0: 7279 2e22 0a20 2020 2020 2020 2020 2020  ry.".           
-000033e0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-000033f0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00003400: 5f72 6561 645f 6762 715f 7461 626c 6528  _read_gbq_table(
-00003410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003420: 2071 7565 7279 5f6f 725f 7461 626c 652c   query_or_table,
-00003430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003440: 2069 6e64 6578 5f63 6f6c 3d69 6e64 6578   index_col=index
-00003450: 5f63 6f6c 2c0a 2020 2020 2020 2020 2020  _col,.          
-00003460: 2020 2020 2020 636f 6c75 6d6e 733d 636f        columns=co
-00003470: 6c75 6d6e 732c 0a20 2020 2020 2020 2020  lumns,.         
-00003480: 2020 2020 2020 206d 6178 5f72 6573 756c         max_resul
-00003490: 7473 3d6d 6178 5f72 6573 756c 7473 2c0a  ts=max_results,.
-000034a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000034b0: 6170 695f 6e61 6d65 3d22 7265 6164 5f67  api_name="read_g
-000034c0: 6271 222c 0a20 2020 2020 2020 2020 2020  bq",.           
-000034d0: 2020 2020 2075 7365 5f63 6163 6865 3d75       use_cache=u
-000034e0: 7365 5f63 6163 6865 2069 6620 7573 655f  se_cache if use_
-000034f0: 6361 6368 6520 6973 206e 6f74 204e 6f6e  cache is not Non
-00003500: 6520 656c 7365 2054 7275 652c 0a20 2020  e else True,.   
-00003510: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00003520: 6465 6620 5f71 7565 7279 5f74 6f5f 6465  def _query_to_de
-00003530: 7374 696e 6174 696f 6e28 0a20 2020 2020  stination(.     
-00003540: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00003550: 2071 7565 7279 3a20 7374 722c 0a20 2020   query: str,.   
-00003560: 2020 2020 2069 6e64 6578 5f63 6f6c 733a       index_cols:
-00003570: 204c 6973 745b 7374 725d 2c0a 2020 2020   List[str],.    
-00003580: 2020 2020 6170 695f 6e61 6d65 3a20 7374      api_name: st
-00003590: 722c 0a20 2020 2020 2020 2063 6f6e 6669  r,.        confi
-000035a0: 6775 7261 7469 6f6e 3a20 6469 6374 203d  guration: dict =
-000035b0: 207b 2271 7565 7279 223a 207b 2275 7365   {"query": {"use
-000035c0: 5175 6572 7943 6163 6865 223a 2054 7275  QueryCache": Tru
-000035d0: 657d 7d2c 0a20 2020 2020 2020 2064 6f5f  e}},.        do_
-000035e0: 636c 7573 7465 7269 6e67 3d54 7275 652c  clustering=True,
-000035f0: 0a20 2020 2029 202d 3e20 5475 706c 655b  .    ) -> Tuple[
-00003600: 4f70 7469 6f6e 616c 5b62 6967 7175 6572  Optional[bigquer
-00003610: 792e 5461 626c 6552 6566 6572 656e 6365  y.TableReference
-00003620: 5d2c 2062 6967 7175 6572 792e 5175 6572  ], bigquery.Quer
-00003630: 794a 6f62 5d3a 0a20 2020 2020 2020 2023  yJob]:.        #
-00003640: 2049 6620 6120 6472 795f 7275 6e20 696e   If a dry_run in
-00003650: 6469 6361 7465 7320 7468 6973 2069 7320  dicates this is 
-00003660: 6e6f 7420 6120 7175 6572 7920 7479 7065  not a query type
-00003670: 206a 6f62 2c20 7468 656e 2064 6f6e 2774   job, then don't
-00003680: 0a20 2020 2020 2020 2023 2062 6f74 6865  .        # bothe
-00003690: 7220 7472 7969 6e67 2074 6f20 646f 2061  r trying to do a
-000036a0: 2043 5245 4154 4520 5445 4d50 2054 4142   CREATE TEMP TAB
-000036b0: 4c45 202e 2e2e 2041 5320 5345 4c45 4354  LE ... AS SELECT
-000036c0: 202e 2e2e 2073 7461 7465 6d65 6e74 2e0a   ... statement..
-000036d0: 2020 2020 2020 2020 6472 795f 7275 6e5f          dry_run_
-000036e0: 636f 6e66 6967 203d 2062 6967 7175 6572  config = bigquer
-000036f0: 792e 5175 6572 794a 6f62 436f 6e66 6967  y.QueryJobConfig
-00003700: 2829 0a20 2020 2020 2020 2064 7279 5f72  ().        dry_r
-00003710: 756e 5f63 6f6e 6669 672e 6472 795f 7275  un_config.dry_ru
-00003720: 6e20 3d20 5472 7565 0a20 2020 2020 2020  n = True.       
-00003730: 205f 2c20 6472 795f 7275 6e5f 6a6f 6220   _, dry_run_job 
-00003740: 3d20 7365 6c66 2e5f 7374 6172 745f 7175  = self._start_qu
-00003750: 6572 7928 7175 6572 792c 206a 6f62 5f63  ery(query, job_c
-00003760: 6f6e 6669 673d 6472 795f 7275 6e5f 636f  onfig=dry_run_co
-00003770: 6e66 6967 290a 2020 2020 2020 2020 6966  nfig).        if
-00003780: 2064 7279 5f72 756e 5f6a 6f62 2e73 7461   dry_run_job.sta
-00003790: 7465 6d65 6e74 5f74 7970 6520 213d 2022  tement_type != "
-000037a0: 5345 4c45 4354 223a 0a20 2020 2020 2020  SELECT":.       
-000037b0: 2020 2020 205f 2c20 7175 6572 795f 6a6f       _, query_jo
-000037c0: 6220 3d20 7365 6c66 2e5f 7374 6172 745f  b = self._start_
-000037d0: 7175 6572 7928 7175 6572 7929 0a20 2020  query(query).   
-000037e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000037f0: 7175 6572 795f 6a6f 622e 6465 7374 696e  query_job.destin
-00003800: 6174 696f 6e2c 2071 7565 7279 5f6a 6f62  ation, query_job
-00003810: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
-00003820: 7465 2061 2074 6162 6c65 2074 6f20 776f  te a table to wo
-00003830: 726b 6172 6f75 6e64 2042 6967 5175 6572  rkaround BigQuer
-00003840: 7920 3130 2047 4220 7175 6572 7920 7265  y 10 GB query re
-00003850: 7375 6c74 7320 6c69 6d69 742e 2053 6565  sults limit. See
-00003860: 3a0a 2020 2020 2020 2020 2320 696e 7465  :.        # inte
-00003870: 726e 616c 2069 7373 7565 2033 3033 3035  rnal issue 30305
-00003880: 3733 3336 2e0a 2020 2020 2020 2020 2320  7336..        # 
-00003890: 5369 6e63 6520 7765 2068 6176 6520 6120  Since we have a 
-000038a0: 6073 7461 7465 6d65 6e74 5f74 7970 6520  `statement_type 
-000038b0: 3d3d 2027 5345 4c45 4354 2760 2c20 7363  == 'SELECT'`, sc
-000038c0: 6865 6d61 2073 686f 756c 6420 6265 2070  hema should be p
-000038d0: 6f70 756c 6174 6564 2e0a 2020 2020 2020  opulated..      
-000038e0: 2020 7363 6865 6d61 203d 2074 7970 696e    schema = typin
-000038f0: 672e 6361 7374 2849 7465 7261 626c 655b  g.cast(Iterable[
-00003900: 6269 6771 7565 7279 2e53 6368 656d 6146  bigquery.SchemaF
-00003910: 6965 6c64 5d2c 2064 7279 5f72 756e 5f6a  ield], dry_run_j
-00003920: 6f62 2e73 6368 656d 6129 0a20 2020 2020  ob.schema).     
-00003930: 2020 2069 6620 646f 5f63 6c75 7374 6572     if do_cluster
-00003940: 696e 673a 0a20 2020 2020 2020 2020 2020  ing:.           
-00003950: 2063 6c75 7374 6572 5f63 6f6c 7320 3d20   cluster_cols = 
-00003960: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00003970: 2020 6974 656d 2e6e 616d 650a 2020 2020    item.name.    
-00003980: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00003990: 6974 656d 2069 6e20 7363 6865 6d61 0a20  item in schema. 
-000039a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000039b0: 6620 2869 7465 6d2e 6e61 6d65 2069 6e20  f (item.name in 
-000039c0: 696e 6465 785f 636f 6c73 2920 616e 6420  index_cols) and 
-000039d0: 5f63 616e 5f63 6c75 7374 6572 5f62 7128  _can_cluster_bq(
-000039e0: 6974 656d 290a 2020 2020 2020 2020 2020  item).          
-000039f0: 2020 5d5b 3a5f 4d41 585f 434c 5553 5445    ][:_MAX_CLUSTE
-00003a00: 525f 434f 4c55 4d4e 535d 0a20 2020 2020  R_COLUMNS].     
-00003a10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00003a20: 2020 2020 2063 6c75 7374 6572 5f63 6f6c       cluster_col
-00003a30: 7320 3d20 5b5d 0a20 2020 2020 2020 2074  s = [].        t
-00003a40: 656d 705f 7461 626c 6520 3d20 7365 6c66  emp_table = self
-00003a50: 2e5f 6372 6561 7465 5f65 6d70 7479 5f74  ._create_empty_t
-00003a60: 656d 705f 7461 626c 6528 7363 6865 6d61  emp_table(schema
-00003a70: 2c20 636c 7573 7465 725f 636f 6c73 290a  , cluster_cols).
-00003a80: 0a20 2020 2020 2020 2074 696d 656f 7574  .        timeout
-00003a90: 5f6d 7320 3d20 636f 6e66 6967 7572 6174  _ms = configurat
-00003aa0: 696f 6e2e 6765 7428 226a 6f62 5469 6d65  ion.get("jobTime
-00003ab0: 6f75 744d 7322 2920 6f72 2063 6f6e 6669  outMs") or confi
-00003ac0: 6775 7261 7469 6f6e 5b22 7175 6572 7922  guration["query"
-00003ad0: 5d2e 6765 7428 0a20 2020 2020 2020 2020  ].get(.         
-00003ae0: 2020 2022 7469 6d65 6f75 744d 7322 0a20     "timeoutMs". 
-00003af0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00003b00: 2020 2320 436f 6e76 6572 7420 7469 6d65    # Convert time
-00003b10: 6f75 745f 6d73 2074 6f20 7365 636f 6e64  out_ms to second
-00003b20: 732c 2065 6e73 7572 696e 6720 6120 6d69  s, ensuring a mi
-00003b30: 6e69 6d75 6d20 6f66 2030 2e31 2073 6563  nimum of 0.1 sec
-00003b40: 6f6e 6473 2074 6f20 6176 6f69 640a 2020  onds to avoid.  
-00003b50: 2020 2020 2020 2320 7468 6520 7072 6f67        # the prog
-00003b60: 7261 6d20 6765 7474 696e 6720 7374 7563  ram getting stuc
-00003b70: 6b20 6f6e 2074 6f6f 2d73 686f 7274 2074  k on too-short t
-00003b80: 696d 656f 7574 732e 0a20 2020 2020 2020  imeouts..       
-00003b90: 2074 696d 656f 7574 203d 206d 6178 2869   timeout = max(i
-00003ba0: 6e74 2874 696d 656f 7574 5f6d 7329 202a  nt(timeout_ms) *
-00003bb0: 2031 652d 332c 2030 2e31 2920 6966 2074   1e-3, 0.1) if t
-00003bc0: 696d 656f 7574 5f6d 7320 656c 7365 204e  imeout_ms else N
-00003bd0: 6f6e 650a 0a20 2020 2020 2020 206a 6f62  one..        job
-00003be0: 5f63 6f6e 6669 6720 3d20 7479 7069 6e67  _config = typing
-00003bf0: 2e63 6173 7428 0a20 2020 2020 2020 2020  .cast(.         
-00003c00: 2020 2062 6967 7175 6572 792e 5175 6572     bigquery.Quer
-00003c10: 794a 6f62 436f 6e66 6967 2c0a 2020 2020  yJobConfig,.    
-00003c20: 2020 2020 2020 2020 6269 6771 7565 7279          bigquery
-00003c30: 2e51 7565 7279 4a6f 6243 6f6e 6669 672e  .QueryJobConfig.
-00003c40: 6672 6f6d 5f61 7069 5f72 6570 7228 636f  from_api_repr(co
-00003c50: 6e66 6967 7572 6174 696f 6e29 2c0a 2020  nfiguration),.  
-00003c60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00003c70: 6a6f 625f 636f 6e66 6967 2e6c 6162 656c  job_config.label
-00003c80: 735b 2262 6967 6672 616d 6573 2d61 7069  s["bigframes-api
-00003c90: 225d 203d 2061 7069 5f6e 616d 650a 2020  "] = api_name.  
-00003ca0: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
-00003cb0: 2e64 6573 7469 6e61 7469 6f6e 203d 2074  .destination = t
-00003cc0: 656d 705f 7461 626c 650a 0a20 2020 2020  emp_table..     
-00003cd0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00003ce0: 2020 2020 2320 5772 6974 6520 746f 2074      # Write to t
-00003cf0: 656d 7020 7461 626c 6520 746f 2077 6f72  emp table to wor
-00003d00: 6b61 726f 756e 6420 4269 6751 7565 7279  karound BigQuery
-00003d10: 2031 3020 4742 2071 7565 7279 2072 6573   10 GB query res
-00003d20: 756c 7473 0a20 2020 2020 2020 2020 2020  ults.           
-00003d30: 2023 206c 696d 6974 2e20 5365 653a 2069   # limit. See: i
-00003d40: 6e74 6572 6e61 6c20 6973 7375 6520 3330  nternal issue 30
-00003d50: 3330 3537 3333 362e 0a20 2020 2020 2020  3057336..       
-00003d60: 2020 2020 206a 6f62 5f63 6f6e 6669 672e       job_config.
-00003d70: 6c61 6265 6c73 5b22 6572 726f 725f 6361  labels["error_ca
-00003d80: 7567 6874 225d 203d 2022 7472 7565 220a  ught"] = "true".
-00003d90: 2020 2020 2020 2020 2020 2020 5f2c 2071              _, q
-00003da0: 7565 7279 5f6a 6f62 203d 2073 656c 662e  uery_job = self.
-00003db0: 5f73 7461 7274 5f71 7565 7279 280a 2020  _start_query(.  
-00003dc0: 2020 2020 2020 2020 2020 2020 2020 7175                qu
-00003dd0: 6572 792c 206a 6f62 5f63 6f6e 6669 673d  ery, job_config=
-00003de0: 6a6f 625f 636f 6e66 6967 2c20 7469 6d65  job_config, time
-00003df0: 6f75 743d 7469 6d65 6f75 740a 2020 2020  out=timeout.    
-00003e00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00003e10: 2020 2020 2020 7265 7475 726e 2071 7565        return que
-00003e20: 7279 5f6a 6f62 2e64 6573 7469 6e61 7469  ry_job.destinati
-00003e30: 6f6e 2c20 7175 6572 795f 6a6f 620a 2020  on, query_job.  
-00003e40: 2020 2020 2020 6578 6365 7074 2067 6f6f        except goo
-00003e50: 676c 652e 6170 695f 636f 7265 2e65 7863  gle.api_core.exc
-00003e60: 6570 7469 6f6e 732e 4261 6452 6571 7565  eptions.BadReque
-00003e70: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00003e80: 2320 536f 6d65 2053 454c 4543 5420 7374  # Some SELECT st
-00003e90: 6174 656d 656e 7473 2073 7469 6c6c 2061  atements still a
-00003ea0: 7265 6e27 7420 636f 6d70 6174 6962 6c65  ren't compatible
-00003eb0: 2077 6974 6820 636c 7573 7465 720a 2020   with cluster.  
-00003ec0: 2020 2020 2020 2020 2020 2320 7461 626c            # tabl
-00003ed0: 6573 2061 7320 7468 6520 6465 7374 696e  es as the destin
-00003ee0: 6174 696f 6e2e 2046 6f72 2065 7861 6d70  ation. For examp
-00003ef0: 6c65 2c20 6966 2074 6865 2071 7565 7279  le, if the query
-00003f00: 2068 6173 2061 0a20 2020 2020 2020 2020   has a.         
-00003f10: 2020 2023 2074 6f70 2d6c 6576 656c 204f     # top-level O
-00003f20: 5244 4552 2042 592c 2074 6869 7320 636f  RDER BY, this co
-00003f30: 6e66 6c69 6374 7320 7769 7468 206f 7572  nflicts with our
-00003f40: 2061 6269 6c69 7479 2074 6f20 636c 7573   ability to clus
-00003f50: 7465 720a 2020 2020 2020 2020 2020 2020  ter.            
-00003f60: 2320 7468 6520 7461 626c 6520 6279 2074  # the table by t
-00003f70: 6865 2069 6e64 6578 2063 6f6c 756d 6e28  he index column(
-00003f80: 7329 2e0a 2020 2020 2020 2020 2020 2020  s)..            
-00003f90: 5f2c 2071 7565 7279 5f6a 6f62 203d 2073  _, query_job = s
-00003fa0: 656c 662e 5f73 7461 7274 5f71 7565 7279  elf._start_query
-00003fb0: 2871 7565 7279 2c20 7469 6d65 6f75 743d  (query, timeout=
-00003fc0: 7469 6d65 6f75 7429 0a20 2020 2020 2020  timeout).       
-00003fd0: 2020 2020 2072 6574 7572 6e20 7175 6572       return quer
-00003fe0: 795f 6a6f 622e 6465 7374 696e 6174 696f  y_job.destinatio
-00003ff0: 6e2c 2071 7565 7279 5f6a 6f62 0a0a 2020  n, query_job..  
-00004000: 2020 6465 6620 7265 6164 5f67 6271 5f71    def read_gbq_q
-00004010: 7565 7279 280a 2020 2020 2020 2020 7365  uery(.        se
-00004020: 6c66 2c0a 2020 2020 2020 2020 7175 6572  lf,.        quer
-00004030: 793a 2073 7472 2c0a 2020 2020 2020 2020  y: str,.        
-00004040: 2a2c 0a20 2020 2020 2020 2069 6e64 6578  *,.        index
-00004050: 5f63 6f6c 3a20 4974 6572 6162 6c65 5b73  _col: Iterable[s
-00004060: 7472 5d20 7c20 7374 7220 7c20 6269 6766  tr] | str | bigf
-00004070: 7261 6d65 732e 656e 756d 732e 4465 6661  rames.enums.Defa
-00004080: 756c 7449 6e64 6578 4b69 6e64 203d 2028  ultIndexKind = (
-00004090: 292c 0a20 2020 2020 2020 2063 6f6c 756d  ),.        colum
-000040a0: 6e73 3a20 4974 6572 6162 6c65 5b73 7472  ns: Iterable[str
-000040b0: 5d20 3d20 2829 2c0a 2020 2020 2020 2020  ] = (),.        
-000040c0: 636f 6e66 6967 7572 6174 696f 6e3a 204f  configuration: O
-000040d0: 7074 696f 6e61 6c5b 4469 6374 5d20 3d20  ptional[Dict] = 
-000040e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d61  None,.        ma
-000040f0: 785f 7265 7375 6c74 733a 204f 7074 696f  x_results: Optio
-00004100: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
-00004110: 0a20 2020 2020 2020 2075 7365 5f63 6163  .        use_cac
-00004120: 6865 3a20 4f70 7469 6f6e 616c 5b62 6f6f  he: Optional[boo
-00004130: 6c5d 203d 204e 6f6e 652c 0a20 2020 2020  l] = None,.     
-00004140: 2020 2063 6f6c 5f6f 7264 6572 3a20 4974     col_order: It
-00004150: 6572 6162 6c65 5b73 7472 5d20 3d20 2829  erable[str] = ()
-00004160: 2c0a 2020 2020 2920 2d3e 2064 6174 6166  ,.    ) -> dataf
-00004170: 7261 6d65 2e44 6174 6146 7261 6d65 3a0a  rame.DataFrame:.
-00004180: 2020 2020 2020 2020 2222 2254 7572 6e20          """Turn 
-00004190: 6120 5351 4c20 7175 6572 7920 696e 746f  a SQL query into
-000041a0: 2061 2044 6174 6146 7261 6d65 2e0a 0a20   a DataFrame... 
-000041b0: 2020 2020 2020 204e 6f74 653a 2042 6563         Note: Bec
-000041c0: 6175 7365 2074 6865 2072 6573 756c 7473  ause the results
-000041d0: 2061 7265 2077 7269 7474 656e 2074 6f20   are written to 
-000041e0: 6120 7465 6d70 6f72 6172 7920 7461 626c  a temporary tabl
-000041f0: 652c 206f 7264 6572 696e 6720 6279 0a20  e, ordering by. 
-00004200: 2020 2020 2020 2060 604f 5244 4552 2042         ``ORDER B
-00004210: 5960 6020 6973 206e 6f74 2070 7265 7365  Y`` is not prese
-00004220: 7276 6564 2e20 4120 756e 6971 7565 2060  rved. A unique `
-00004230: 696e 6465 785f 636f 6c60 2069 7320 7265  index_col` is re
-00004240: 636f 6d6d 656e 6465 642e 2055 7365 0a20  commended. Use. 
-00004250: 2020 2020 2020 2060 6072 6f77 5f6e 756d         ``row_num
-00004260: 6265 7228 2920 6f76 6572 2028 2960 6020  ber() over ()`` 
-00004270: 6966 2074 6865 7265 2069 7320 6e6f 206e  if there is no n
-00004280: 6174 7572 616c 2075 6e69 7175 6520 696e  atural unique in
-00004290: 6465 7820 6f72 2079 6f75 0a20 2020 2020  dex or you.     
-000042a0: 2020 2077 616e 7420 746f 2070 7265 7365     want to prese
-000042b0: 7276 6520 6f72 6465 7269 6e67 2e0a 0a20  rve ordering... 
-000042c0: 2020 2020 2020 202a 2a45 7861 6d70 6c65         **Example
-000042d0: 733a 2a2a 0a0a 2020 2020 2020 2020 2020  s:**..          
-000042e0: 2020 3e3e 3e20 696d 706f 7274 2062 6967    >>> import big
-000042f0: 6672 616d 6573 2e70 616e 6461 7320 6173  frames.pandas as
-00004300: 2062 7064 0a20 2020 2020 2020 2020 2020   bpd.           
-00004310: 203e 3e3e 2062 7064 2e6f 7074 696f 6e73   >>> bpd.options
-00004320: 2e64 6973 706c 6179 2e70 726f 6772 6573  .display.progres
-00004330: 735f 6261 7220 3d20 4e6f 6e65 0a0a 2020  s_bar = None..  
-00004340: 2020 2020 2020 5369 6d70 6c65 2071 7565        Simple que
-00004350: 7279 2069 6e70 7574 3a0a 0a20 2020 2020  ry input:..     
-00004360: 2020 2020 2020 203e 3e3e 2064 6620 3d20         >>> df = 
-00004370: 6270 642e 7265 6164 5f67 6271 5f71 7565  bpd.read_gbq_que
-00004380: 7279 2827 2727 0a20 2020 2020 2020 2020  ry('''.         
-00004390: 2020 202e 2e2e 2020 2020 5345 4c45 4354     ...    SELECT
-000043a0: 0a20 2020 2020 2020 2020 2020 202e 2e2e  .            ...
-000043b0: 2020 2020 2020 2070 6974 6368 6572 4669         pitcherFi
-000043c0: 7273 744e 616d 652c 0a20 2020 2020 2020  rstName,.       
-000043d0: 2020 2020 202e 2e2e 2020 2020 2020 2070       ...       p
-000043e0: 6974 6368 6572 4c61 7374 4e61 6d65 2c0a  itcherLastName,.
-000043f0: 2020 2020 2020 2020 2020 2020 2e2e 2e20              ... 
-00004400: 2020 2020 2020 7069 7463 6853 7065 6564        pitchSpeed
-00004410: 2c0a 2020 2020 2020 2020 2020 2020 2e2e  ,.            ..
-00004420: 2e20 2020 2046 524f 4d20 6062 6967 7175  .    FROM `bigqu
-00004430: 6572 792d 7075 626c 6963 2d64 6174 612e  ery-public-data.
-00004440: 6261 7365 6261 6c6c 2e67 616d 6573 5f77  baseball.games_w
-00004450: 6964 6560 0a20 2020 2020 2020 2020 2020  ide`.           
-00004460: 202e 2e2e 2027 2727 290a 0a20 2020 2020   ... ''')..     
-00004470: 2020 2050 7265 7365 7276 6520 6f72 6465     Preserve orde
-00004480: 7269 6e67 2069 6e20 6120 7175 6572 7920  ring in a query 
-00004490: 696e 7075 742e 0a0a 2020 2020 2020 2020  input...        
-000044a0: 2020 2020 3e3e 3e20 6466 203d 2062 7064      >>> df = bpd
-000044b0: 2e72 6561 645f 6762 715f 7175 6572 7928  .read_gbq_query(
-000044c0: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
-000044d0: 2e2e 2e20 2020 2053 454c 4543 540a 2020  ...    SELECT.  
-000044e0: 2020 2020 2020 2020 2020 2e2e 2e20 2020            ...   
-000044f0: 2020 2020 2d2d 2049 6e73 7465 6164 206f      -- Instead o
-00004500: 6620 616e 204f 5244 4552 2042 5920 636c  f an ORDER BY cl
-00004510: 6175 7365 206f 6e20 7468 6520 7175 6572  ause on the quer
-00004520: 792c 2075 7365 0a20 2020 2020 2020 2020  y, use.         
-00004530: 2020 202e 2e2e 2020 2020 2020 202d 2d20     ...       -- 
-00004540: 524f 575f 4e55 4d42 4552 2829 2074 6f20  ROW_NUMBER() to 
-00004550: 6372 6561 7465 2061 6e20 6f72 6465 7265  create an ordere
-00004560: 6420 4461 7461 4672 616d 652e 0a20 2020  d DataFrame..   
-00004570: 2020 2020 2020 2020 202e 2e2e 2020 2020           ...    
-00004580: 2020 2052 4f57 5f4e 554d 4245 5228 2920     ROW_NUMBER() 
-00004590: 4f56 4552 2028 4f52 4445 5220 4259 2041  OVER (ORDER BY A
-000045a0: 5647 2870 6974 6368 5370 6565 6429 2044  VG(pitchSpeed) D
-000045b0: 4553 4329 0a20 2020 2020 2020 2020 2020  ESC).           
-000045c0: 202e 2e2e 2020 2020 2020 2020 2041 5320   ...         AS 
-000045d0: 726f 7769 6e64 6578 2c0a 2020 2020 2020  rowindex,.      
-000045e0: 2020 2020 2020 2e2e 2e0a 2020 2020 2020        ....      
-000045f0: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
-00004600: 7069 7463 6865 7246 6972 7374 4e61 6d65  pitcherFirstName
-00004610: 2c0a 2020 2020 2020 2020 2020 2020 2e2e  ,.            ..
-00004620: 2e20 2020 2020 2020 7069 7463 6865 724c  .       pitcherL
-00004630: 6173 744e 616d 652c 0a20 2020 2020 2020  astName,.       
-00004640: 2020 2020 202e 2e2e 2020 2020 2020 2041       ...       A
-00004650: 5647 2870 6974 6368 5370 6565 6429 2041  VG(pitchSpeed) A
-00004660: 5320 6176 6572 6167 6550 6974 6368 5370  S averagePitchSp
-00004670: 6565 640a 2020 2020 2020 2020 2020 2020  eed.            
-00004680: 2e2e 2e20 2020 2020 4652 4f4d 2060 6269  ...     FROM `bi
-00004690: 6771 7565 7279 2d70 7562 6c69 632d 6461  gquery-public-da
-000046a0: 7461 2e62 6173 6562 616c 6c2e 6761 6d65  ta.baseball.game
-000046b0: 735f 7769 6465 600a 2020 2020 2020 2020  s_wide`.        
-000046c0: 2020 2020 2e2e 2e20 2020 2020 5748 4552      ...     WHER
-000046d0: 4520 7965 6172 203d 2032 3031 360a 2020  E year = 2016.  
-000046e0: 2020 2020 2020 2020 2020 2e2e 2e20 2020            ...   
-000046f0: 2020 4752 4f55 5020 4259 2070 6974 6368    GROUP BY pitch
-00004700: 6572 4669 7273 744e 616d 652c 2070 6974  erFirstName, pit
-00004710: 6368 6572 4c61 7374 4e61 6d65 0a20 2020  cherLastName.   
-00004720: 2020 2020 2020 2020 202e 2e2e 2027 2727           ... '''
-00004730: 2c20 696e 6465 785f 636f 6c3d 2272 6f77  , index_col="row
-00004740: 696e 6465 7822 290a 2020 2020 2020 2020  index").        
-00004750: 2020 2020 3e3e 3e20 6466 2e68 6561 6428      >>> df.head(
-00004760: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
-00004770: 2020 2020 2020 2020 7069 7463 6865 7246          pitcherF
-00004780: 6972 7374 4e61 6d65 2070 6974 6368 6572  irstName pitcher
-00004790: 4c61 7374 4e61 6d65 2020 6176 6572 6167  LastName  averag
-000047a0: 6550 6974 6368 5370 6565 640a 2020 2020  ePitchSpeed.    
-000047b0: 2020 2020 2020 2020 726f 7769 6e64 6578          rowindex
-000047c0: 0a20 2020 2020 2020 2020 2020 2031 2020  .            1  
-000047d0: 2020 2020 2020 2020 2020 2020 2020 416c                Al
-000047e0: 6265 7274 696e 2020 2020 2020 2020 2043  bertin         C
-000047f0: 6861 706d 616e 2020 2020 2020 2020 2020  hapman          
-00004800: 3936 2e35 3134 3131 330a 2020 2020 2020  96.514113.      
-00004810: 2020 2020 2020 3220 2020 2020 2020 2020        2         
-00004820: 2020 2020 2020 2020 5a61 6368 6172 7920          Zachary 
-00004830: 2020 2020 2020 2020 4272 6974 746f 6e20          Britton 
-00004840: 2020 2020 2020 2020 2039 342e 3539 3130           94.5910
-00004850: 3339 0a20 2020 2020 2020 2020 2020 203c  39.            <
-00004860: 424c 414e 4b4c 494e 453e 0a20 2020 2020  BLANKLINE>.     
-00004870: 2020 2020 2020 205b 3220 726f 7773 2078         [2 rows x
-00004880: 2033 2063 6f6c 756d 6e73 5d0a 0a20 2020   3 columns]..   
-00004890: 2020 2020 2053 6565 2061 6c73 6f3a 203a       See also: :
-000048a0: 6d65 7468 3a60 5365 7373 696f 6e2e 7265  meth:`Session.re
-000048b0: 6164 5f67 6271 602e 0a20 2020 2020 2020  ad_gbq`..       
-000048c0: 2022 2222 0a20 2020 2020 2020 2023 204e   """.        # N
-000048d0: 4f54 453a 2054 6869 7320 6d65 7468 6f64  OTE: This method
-000048e0: 2064 6f65 736e 2774 2028 7965 7429 2065   doesn't (yet) e
-000048f0: 7869 7374 2069 6e20 7061 6e64 6173 206f  xist in pandas o
-00004900: 7220 7061 6e64 6173 2d67 6271 2c20 736f  r pandas-gbq, so
-00004910: 0a20 2020 2020 2020 2023 2074 6865 7365  .        # these
-00004920: 2064 6f63 7374 7269 6e67 7320 6172 6520   docstrings are 
-00004930: 696e 6c69 6e65 2e0a 2020 2020 2020 2020  inline..        
-00004940: 6966 2063 6f6c 756d 6e73 2061 6e64 2063  if columns and c
-00004950: 6f6c 5f6f 7264 6572 3a0a 2020 2020 2020  ol_order:.      
-00004960: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00004970: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00004980: 2020 2020 2020 2020 224d 7573 7420 7370          "Must sp
-00004990: 6563 6966 7920 6569 7468 6572 2063 6f6c  ecify either col
-000049a0: 756d 6e73 2028 7072 6566 6572 7265 6429  umns (preferred)
-000049b0: 206f 7220 636f 6c5f 6f72 6465 722c 206e   or col_order, n
-000049c0: 6f74 2062 6f74 6822 0a20 2020 2020 2020  ot both".       
-000049d0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-000049e0: 6c69 6620 636f 6c5f 6f72 6465 723a 0a20  lif col_order:. 
-000049f0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-00004a00: 6e73 203d 2063 6f6c 5f6f 7264 6572 0a0a  ns = col_order..
-00004a10: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00004a20: 656c 662e 5f72 6561 645f 6762 715f 7175  elf._read_gbq_qu
-00004a30: 6572 7928 0a20 2020 2020 2020 2020 2020  ery(.           
-00004a40: 2071 7565 7279 3d71 7565 7279 2c0a 2020   query=query,.  
-00004a50: 2020 2020 2020 2020 2020 696e 6465 785f            index_
-00004a60: 636f 6c3d 696e 6465 785f 636f 6c2c 0a20  col=index_col,. 
-00004a70: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-00004a80: 6e73 3d63 6f6c 756d 6e73 2c0a 2020 2020  ns=columns,.    
-00004a90: 2020 2020 2020 2020 636f 6e66 6967 7572          configur
-00004aa0: 6174 696f 6e3d 636f 6e66 6967 7572 6174  ation=configurat
-00004ab0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-00004ac0: 206d 6178 5f72 6573 756c 7473 3d6d 6178   max_results=max
-00004ad0: 5f72 6573 756c 7473 2c0a 2020 2020 2020  _results,.      
-00004ae0: 2020 2020 2020 6170 695f 6e61 6d65 3d22        api_name="
-00004af0: 7265 6164 5f67 6271 5f71 7565 7279 222c  read_gbq_query",
-00004b00: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
-00004b10: 5f63 6163 6865 3d75 7365 5f63 6163 6865  _cache=use_cache
-00004b20: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00004b30: 2064 6566 205f 7265 6164 5f67 6271 5f71   def _read_gbq_q
-00004b40: 7565 7279 280a 2020 2020 2020 2020 7365  uery(.        se
-00004b50: 6c66 2c0a 2020 2020 2020 2020 7175 6572  lf,.        quer
-00004b60: 793a 2073 7472 2c0a 2020 2020 2020 2020  y: str,.        
-00004b70: 2a2c 0a20 2020 2020 2020 2069 6e64 6578  *,.        index
-00004b80: 5f63 6f6c 3a20 4974 6572 6162 6c65 5b73  _col: Iterable[s
-00004b90: 7472 5d20 7c20 7374 7220 7c20 6269 6766  tr] | str | bigf
-00004ba0: 7261 6d65 732e 656e 756d 732e 4465 6661  rames.enums.Defa
-00004bb0: 756c 7449 6e64 6578 4b69 6e64 203d 2028  ultIndexKind = (
-00004bc0: 292c 0a20 2020 2020 2020 2063 6f6c 756d  ),.        colum
-00004bd0: 6e73 3a20 4974 6572 6162 6c65 5b73 7472  ns: Iterable[str
-00004be0: 5d20 3d20 2829 2c0a 2020 2020 2020 2020  ] = (),.        
-00004bf0: 636f 6e66 6967 7572 6174 696f 6e3a 204f  configuration: O
-00004c00: 7074 696f 6e61 6c5b 4469 6374 5d20 3d20  ptional[Dict] = 
-00004c10: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d61  None,.        ma
-00004c20: 785f 7265 7375 6c74 733a 204f 7074 696f  x_results: Optio
-00004c30: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
-00004c40: 0a20 2020 2020 2020 2061 7069 5f6e 616d  .        api_nam
-00004c50: 653a 2073 7472 203d 2022 7265 6164 5f67  e: str = "read_g
-00004c60: 6271 5f71 7565 7279 222c 0a20 2020 2020  bq_query",.     
-00004c70: 2020 2075 7365 5f63 6163 6865 3a20 4f70     use_cache: Op
-00004c80: 7469 6f6e 616c 5b62 6f6f 6c5d 203d 204e  tional[bool] = N
-00004c90: 6f6e 652c 0a20 2020 2029 202d 3e20 6461  one,.    ) -> da
-00004ca0: 7461 6672 616d 652e 4461 7461 4672 616d  taframe.DataFram
-00004cb0: 653a 0a20 2020 2020 2020 2069 6d70 6f72  e:.        impor
-00004cc0: 7420 6269 6766 7261 6d65 732e 6461 7461  t bigframes.data
-00004cd0: 6672 616d 6520 6173 2064 6174 6166 7261  frame as datafra
-00004ce0: 6d65 0a0a 2020 2020 2020 2020 636f 6e66  me..        conf
-00004cf0: 6967 7572 6174 696f 6e20 3d20 5f74 7261  iguration = _tra
-00004d00: 6e73 666f 726d 5f72 6561 645f 6762 715f  nsform_read_gbq_
-00004d10: 636f 6e66 6967 7572 6174 696f 6e28 636f  configuration(co
-00004d20: 6e66 6967 7572 6174 696f 6e29 0a0a 2020  nfiguration)..  
-00004d30: 2020 2020 2020 6966 2022 7175 6572 7922        if "query"
-00004d40: 206e 6f74 2069 6e20 636f 6e66 6967 7572   not in configur
-00004d50: 6174 696f 6e3a 0a20 2020 2020 2020 2020  ation:.         
-00004d60: 2020 2063 6f6e 6669 6775 7261 7469 6f6e     configuration
-00004d70: 5b22 7175 6572 7922 5d20 3d20 7b7d 0a0a  ["query"] = {}..
-00004d80: 2020 2020 2020 2020 6966 2022 7175 6572          if "quer
-00004d90: 7922 2069 6e20 636f 6e66 6967 7572 6174  y" in configurat
-00004da0: 696f 6e5b 2271 7565 7279 225d 3a0a 2020  ion["query"]:.  
-00004db0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00004dc0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00004dd0: 2020 2020 2020 2020 2020 2020 2254 6865              "The
-00004de0: 2071 7565 7279 2073 7461 7465 6d65 6e74   query statement
-00004df0: 206d 7573 7420 6e6f 7420 6265 2069 6e63   must not be inc
-00004e00: 6c75 6465 6420 696e 2074 6865 2022 2c0a  luded in the ",.
-00004e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e20: 2227 636f 6e66 6967 7572 6174 696f 6e27  "'configuration'
-00004e30: 2062 6563 6175 7365 2069 7420 6973 2061   because it is a
-00004e40: 6c72 6561 6479 2070 726f 7669 6465 6420  lready provided 
-00004e50: 6173 222c 0a20 2020 2020 2020 2020 2020  as",.           
-00004e60: 2020 2020 2022 2061 2073 6570 6172 6174       " a separat
-00004e70: 6520 7061 7261 6d65 7465 722e 222c 0a20  e parameter.",. 
-00004e80: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00004e90: 2020 2020 2020 6966 2022 7573 6551 7565        if "useQue
-00004ea0: 7279 4361 6368 6522 2069 6e20 636f 6e66  ryCache" in conf
-00004eb0: 6967 7572 6174 696f 6e5b 2271 7565 7279  iguration["query
-00004ec0: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-00004ed0: 6966 2075 7365 5f63 6163 6865 2069 7320  if use_cache is 
-00004ee0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00004ef0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00004f00: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00004f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f20: 2227 7573 6551 7565 7279 4361 6368 6527  "'useQueryCache'
-00004f30: 2069 6e20 2763 6f6e 6669 6775 7261 7469   in 'configurati
-00004f40: 6f6e 2720 636f 6e66 6c69 6374 7320 7769  on' conflicts wi
-00004f50: 7468 220a 2020 2020 2020 2020 2020 2020  th".            
-00004f60: 2020 2020 2020 2020 2220 2775 7365 5f63          " 'use_c
-00004f70: 6163 6865 2720 7061 7261 6d65 7465 722e  ache' parameter.
-00004f80: 2050 6c65 6173 6520 7370 6563 6966 7920   Please specify 
-00004f90: 6f6e 6c79 206f 6e65 2e22 0a20 2020 2020  only one.".     
-00004fa0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00004fb0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00004fc0: 2020 2020 2020 2063 6f6e 6669 6775 7261         configura
-00004fd0: 7469 6f6e 5b22 7175 6572 7922 5d5b 2275  tion["query"]["u
-00004fe0: 7365 5175 6572 7943 6163 6865 225d 203d  seQueryCache"] =
-00004ff0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00005000: 2020 2054 7275 6520 6966 2075 7365 5f63     True if use_c
-00005010: 6163 6865 2069 7320 4e6f 6e65 2065 6c73  ache is None els
-00005020: 6520 7573 655f 6361 6368 650a 2020 2020  e use_cache.    
-00005030: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00005040: 2020 2069 6e64 6578 5f63 6f6c 7320 3d20     index_cols = 
-00005050: 5f74 6f5f 696e 6465 785f 636f 6c73 2869  _to_index_cols(i
-00005060: 6e64 6578 5f63 6f6c 290a 0a20 2020 2020  ndex_col)..     
-00005070: 2020 2064 6573 7469 6e61 7469 6f6e 2c20     destination, 
-00005080: 7175 6572 795f 6a6f 6220 3d20 7365 6c66  query_job = self
-00005090: 2e5f 7175 6572 795f 746f 5f64 6573 7469  ._query_to_desti
-000050a0: 6e61 7469 6f6e 280a 2020 2020 2020 2020  nation(.        
-000050b0: 2020 2020 7175 6572 792c 0a20 2020 2020      query,.     
-000050c0: 2020 2020 2020 2069 6e64 6578 5f63 6f6c         index_col
-000050d0: 732c 0a20 2020 2020 2020 2020 2020 2061  s,.            a
-000050e0: 7069 5f6e 616d 653d 6170 695f 6e61 6d65  pi_name=api_name
-000050f0: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00005100: 6e66 6967 7572 6174 696f 6e3d 636f 6e66  nfiguration=conf
-00005110: 6967 7572 6174 696f 6e2c 0a20 2020 2020  iguration,.     
-00005120: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00005130: 4966 2074 6865 7265 2077 6173 206e 6f20  If there was no 
-00005140: 6465 7374 696e 6174 696f 6e20 7461 626c  destination tabl
-00005150: 652c 2074 6861 7420 6d65 616e 7320 7468  e, that means th
-00005160: 6520 7175 6572 7920 6d75 7374 2068 6176  e query must hav
-00005170: 650a 2020 2020 2020 2020 2320 6265 656e  e.        # been
-00005180: 2044 444c 206f 7220 444d 4c2e 2052 6574   DDL or DML. Ret
-00005190: 7572 6e20 736f 6d65 206a 6f62 206d 6574  urn some job met
-000051a0: 6164 6174 612c 2069 6e73 7465 6164 2e0a  adata, instead..
-000051b0: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-000051c0: 6573 7469 6e61 7469 6f6e 3a0a 2020 2020  estination:.    
-000051d0: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-000051e0: 6174 6166 7261 6d65 2e44 6174 6146 7261  ataframe.DataFra
-000051f0: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
-00005200: 2020 2020 6461 7461 3d70 616e 6461 732e      data=pandas.
-00005210: 4461 7461 4672 616d 6528 0a20 2020 2020  DataFrame(.     
-00005220: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-00005230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005240: 2020 2020 2020 2020 2022 7374 6174 656d           "statem
-00005250: 656e 745f 7479 7065 223a 205b 0a20 2020  ent_type": [.   
-00005260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005270: 2020 2020 2020 2020 2071 7565 7279 5f6a           query_j
-00005280: 6f62 2e73 7461 7465 6d65 6e74 5f74 7970  ob.statement_typ
-00005290: 6520 6966 2071 7565 7279 5f6a 6f62 2065  e if query_job e
-000052a0: 6c73 6520 2275 6e6b 6e6f 776e 220a 2020  lse "unknown".  
-000052b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052c0: 2020 2020 2020 5d2c 0a20 2020 2020 2020        ],.       
-000052d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052e0: 2022 6a6f 625f 6964 223a 205b 7175 6572   "job_id": [quer
-000052f0: 795f 6a6f 622e 6a6f 625f 6964 2069 6620  y_job.job_id if 
-00005300: 7175 6572 795f 6a6f 6220 656c 7365 2022  query_job else "
-00005310: 756e 6b6e 6f77 6e22 5d2c 0a20 2020 2020  unknown"],.     
-00005320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005330: 2020 2022 6c6f 6361 7469 6f6e 223a 205b     "location": [
-00005340: 7175 6572 795f 6a6f 622e 6c6f 6361 7469  query_job.locati
-00005350: 6f6e 2069 6620 7175 6572 795f 6a6f 6220  on if query_job 
-00005360: 656c 7365 2022 756e 6b6e 6f77 6e22 5d2c  else "unknown"],
-00005370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005380: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00005390: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-000053a0: 2020 2020 2020 2020 2020 7365 7373 696f            sessio
-000053b0: 6e3d 7365 6c66 2c0a 2020 2020 2020 2020  n=self,.        
-000053c0: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
-000053d0: 6574 7572 6e20 7365 6c66 2e72 6561 645f  eturn self.read_
-000053e0: 6762 715f 7461 626c 6528 0a20 2020 2020  gbq_table(.     
-000053f0: 2020 2020 2020 2066 227b 6465 7374 696e         f"{destin
-00005400: 6174 696f 6e2e 7072 6f6a 6563 747d 2e7b  ation.project}.{
-00005410: 6465 7374 696e 6174 696f 6e2e 6461 7461  destination.data
-00005420: 7365 745f 6964 7d2e 7b64 6573 7469 6e61  set_id}.{destina
-00005430: 7469 6f6e 2e74 6162 6c65 5f69 647d 222c  tion.table_id}",
-00005440: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-00005450: 6578 5f63 6f6c 3d69 6e64 6578 5f63 6f6c  ex_col=index_col
-00005460: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00005470: 6c75 6d6e 733d 636f 6c75 6d6e 732c 0a20  lumns=columns,. 
-00005480: 2020 2020 2020 2020 2020 206d 6178 5f72             max_r
-00005490: 6573 756c 7473 3d6d 6178 5f72 6573 756c  esults=max_resul
-000054a0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-000054b0: 7573 655f 6361 6368 653d 636f 6e66 6967  use_cache=config
-000054c0: 7572 6174 696f 6e5b 2271 7565 7279 225d  uration["query"]
-000054d0: 5b22 7573 6551 7565 7279 4361 6368 6522  ["useQueryCache"
-000054e0: 5d2c 0a20 2020 2020 2020 2029 0a0a 2020  ],.        )..  
-000054f0: 2020 6465 6620 7265 6164 5f67 6271 5f74    def read_gbq_t
-00005500: 6162 6c65 280a 2020 2020 2020 2020 7365  able(.        se
-00005510: 6c66 2c0a 2020 2020 2020 2020 7175 6572  lf,.        quer
-00005520: 793a 2073 7472 2c0a 2020 2020 2020 2020  y: str,.        
-00005530: 2a2c 0a20 2020 2020 2020 2069 6e64 6578  *,.        index
-00005540: 5f63 6f6c 3a20 4974 6572 6162 6c65 5b73  _col: Iterable[s
-00005550: 7472 5d20 7c20 7374 7220 7c20 6269 6766  tr] | str | bigf
-00005560: 7261 6d65 732e 656e 756d 732e 4465 6661  rames.enums.Defa
-00005570: 756c 7449 6e64 6578 4b69 6e64 203d 2028  ultIndexKind = (
-00005580: 292c 0a20 2020 2020 2020 2063 6f6c 756d  ),.        colum
-00005590: 6e73 3a20 4974 6572 6162 6c65 5b73 7472  ns: Iterable[str
-000055a0: 5d20 3d20 2829 2c0a 2020 2020 2020 2020  ] = (),.        
-000055b0: 6d61 785f 7265 7375 6c74 733a 204f 7074  max_results: Opt
-000055c0: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
-000055d0: 652c 0a20 2020 2020 2020 2066 696c 7465  e,.        filte
-000055e0: 7273 3a20 7468 6972 645f 7061 7274 795f  rs: third_party_
-000055f0: 7061 6e64 6173 5f67 6271 2e46 696c 7465  pandas_gbq.Filte
-00005600: 7273 5479 7065 203d 2028 292c 0a20 2020  rsType = (),.   
-00005610: 2020 2020 2075 7365 5f63 6163 6865 3a20       use_cache: 
-00005620: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
-00005630: 2020 2020 2063 6f6c 5f6f 7264 6572 3a20       col_order: 
-00005640: 4974 6572 6162 6c65 5b73 7472 5d20 3d20  Iterable[str] = 
-00005650: 2829 2c0a 2020 2020 2920 2d3e 2064 6174  (),.    ) -> dat
-00005660: 6166 7261 6d65 2e44 6174 6146 7261 6d65  aframe.DataFrame
-00005670: 3a0a 2020 2020 2020 2020 2222 2254 7572  :.        """Tur
-00005680: 6e20 6120 4269 6751 7565 7279 2074 6162  n a BigQuery tab
-00005690: 6c65 2069 6e74 6f20 6120 4461 7461 4672  le into a DataFr
-000056a0: 616d 652e 0a0a 2020 2020 2020 2020 2a2a  ame...        **
-000056b0: 4578 616d 706c 6573 3a2a 2a0a 0a20 2020  Examples:**..   
-000056c0: 2020 2020 2020 2020 203e 3e3e 2069 6d70           >>> imp
-000056d0: 6f72 7420 6269 6766 7261 6d65 732e 7061  ort bigframes.pa
-000056e0: 6e64 6173 2061 7320 6270 640a 2020 2020  ndas as bpd.    
-000056f0: 2020 2020 2020 2020 3e3e 3e20 6270 642e          >>> bpd.
-00005700: 6f70 7469 6f6e 732e 6469 7370 6c61 792e  options.display.
-00005710: 7072 6f67 7265 7373 5f62 6172 203d 204e  progress_bar = N
-00005720: 6f6e 650a 0a20 2020 2020 2020 2052 6561  one..        Rea
-00005730: 6420 6120 7768 6f6c 6520 7461 626c 652c  d a whole table,
-00005740: 2077 6974 6820 6172 6269 7472 6172 7920   with arbitrary 
-00005750: 6f72 6465 7269 6e67 206f 7220 6f72 6465  ordering or orde
-00005760: 7269 6e67 2063 6f72 7265 7370 6f6e 6469  ring correspondi
-00005770: 6e67 2074 6f20 7468 6520 7072 696d 6172  ng to the primar
-00005780: 7920 6b65 7928 7329 2e0a 0a20 2020 2020  y key(s)...     
-00005790: 2020 2020 2020 203e 3e3e 2064 6620 3d20         >>> df = 
-000057a0: 6270 642e 7265 6164 5f67 6271 5f74 6162  bpd.read_gbq_tab
-000057b0: 6c65 2822 6269 6771 7565 7279 2d70 7562  le("bigquery-pub
-000057c0: 6c69 632d 6461 7461 2e6d 6c5f 6461 7461  lic-data.ml_data
-000057d0: 7365 7473 2e70 656e 6775 696e 7322 290a  sets.penguins").
-000057e0: 0a20 2020 2020 2020 2053 6565 2061 6c73  .        See als
-000057f0: 6f3a 203a 6d65 7468 3a60 5365 7373 696f  o: :meth:`Sessio
-00005800: 6e2e 7265 6164 5f67 6271 602e 0a20 2020  n.read_gbq`..   
-00005810: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00005820: 2023 204e 4f54 453a 2054 6869 7320 6d65   # NOTE: This me
-00005830: 7468 6f64 2064 6f65 736e 2774 2028 7965  thod doesn't (ye
-00005840: 7429 2065 7869 7374 2069 6e20 7061 6e64  t) exist in pand
-00005850: 6173 206f 7220 7061 6e64 6173 2d67 6271  as or pandas-gbq
-00005860: 2c20 736f 0a20 2020 2020 2020 2023 2074  , so.        # t
-00005870: 6865 7365 2064 6f63 7374 7269 6e67 7320  hese docstrings 
-00005880: 6172 6520 696e 6c69 6e65 2e0a 2020 2020  are inline..    
-00005890: 2020 2020 6966 2063 6f6c 756d 6e73 2061      if columns a
-000058a0: 6e64 2063 6f6c 5f6f 7264 6572 3a0a 2020  nd col_order:.  
-000058b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000058c0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-000058d0: 2020 2020 2020 2020 2020 2020 224d 7573              "Mus
-000058e0: 7420 7370 6563 6966 7920 6569 7468 6572  t specify either
-000058f0: 2063 6f6c 756d 6e73 2028 7072 6566 6572   columns (prefer
-00005900: 7265 6429 206f 7220 636f 6c5f 6f72 6465  red) or col_orde
-00005910: 722c 206e 6f74 2062 6f74 6822 0a20 2020  r, not both".   
-00005920: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00005930: 2020 2065 6c69 6620 636f 6c5f 6f72 6465     elif col_orde
-00005940: 723a 0a20 2020 2020 2020 2020 2020 2063  r:.            c
-00005950: 6f6c 756d 6e73 203d 2063 6f6c 5f6f 7264  olumns = col_ord
-00005960: 6572 0a0a 2020 2020 2020 2020 6669 6c74  er..        filt
-00005970: 6572 7320 3d20 6c69 7374 2866 696c 7465  ers = list(filte
-00005980: 7273 290a 2020 2020 2020 2020 6966 206c  rs).        if l
-00005990: 656e 2866 696c 7465 7273 2920 213d 2030  en(filters) != 0
-000059a0: 206f 7220 6266 5f69 6f5f 6269 6771 7565   or bf_io_bigque
-000059b0: 7279 2e69 735f 7461 626c 655f 7769 7468  ry.is_table_with
-000059c0: 5f77 696c 6463 6172 645f 7375 6666 6978  _wildcard_suffix
-000059d0: 2871 7565 7279 293a 0a20 2020 2020 2020  (query):.       
-000059e0: 2020 2020 2023 2054 4f44 4f28 622f 3333       # TODO(b/33
-000059f0: 3830 3339 3531 3729 3a20 5265 6661 6374  8039517): Refact
-00005a00: 6f72 2074 6869 7320 746f 2062 6520 6361  or this to be ca
-00005a10: 6c6c 6564 2069 6e73 6964 6520 626f 7468  lled inside both
-00005a20: 0a20 2020 2020 2020 2020 2020 2023 205f  .            # _
-00005a30: 7265 6164 5f67 6271 5f71 7565 7279 2061  read_gbq_query a
-00005a40: 6e64 205f 7265 6164 5f67 6271 5f74 6162  nd _read_gbq_tab
-00005a50: 6c65 2028 6166 7465 7220 6465 7465 6374  le (after detect
-00005a60: 696e 6720 7072 696d 6172 7920 6b65 7973  ing primary keys
-00005a70: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-00005a80: 736f 2077 6520 6361 6e20 6d61 6b65 2073  so we can make s
-00005a90: 7572 6520 696e 6465 785f 636f 6c2f 696e  ure index_col/in
-00005aa0: 6465 785f 636f 6c73 2072 6566 6c65 6374  dex_cols reflect
-00005ab0: 7320 7072 696d 6172 7920 6b65 7973 2e0a  s primary keys..
-00005ac0: 2020 2020 2020 2020 2020 2020 7175 6572              quer
-00005ad0: 7920 3d20 6266 5f69 6f5f 6269 6771 7565  y = bf_io_bigque
-00005ae0: 7279 2e74 6f5f 7175 6572 7928 0a20 2020  ry.to_query(.   
-00005af0: 2020 2020 2020 2020 2020 2020 2071 7565               que
-00005b00: 7279 2c20 5f74 6f5f 696e 6465 785f 636f  ry, _to_index_co
-00005b10: 6c73 2869 6e64 6578 5f63 6f6c 292c 2063  ls(index_col), c
-00005b20: 6f6c 756d 6e73 2c20 6669 6c74 6572 730a  olumns, filters.
-00005b30: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00005b40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00005b50: 6e20 7365 6c66 2e5f 7265 6164 5f67 6271  n self._read_gbq
-00005b60: 5f71 7565 7279 280a 2020 2020 2020 2020  _query(.        
-00005b70: 2020 2020 2020 2020 7175 6572 792c 0a20          query,. 
-00005b80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00005b90: 6e64 6578 5f63 6f6c 3d69 6e64 6578 5f63  ndex_col=index_c
-00005ba0: 6f6c 2c0a 2020 2020 2020 2020 2020 2020  ol,.            
-00005bb0: 2020 2020 636f 6c75 6d6e 733d 636f 6c75      columns=colu
-00005bc0: 6d6e 732c 0a20 2020 2020 2020 2020 2020  mns,.           
-00005bd0: 2020 2020 206d 6178 5f72 6573 756c 7473       max_results
-00005be0: 3d6d 6178 5f72 6573 756c 7473 2c0a 2020  =max_results,.  
-00005bf0: 2020 2020 2020 2020 2020 2020 2020 6170                ap
-00005c00: 695f 6e61 6d65 3d22 7265 6164 5f67 6271  i_name="read_gbq
-00005c10: 5f74 6162 6c65 222c 0a20 2020 2020 2020  _table",.       
-00005c20: 2020 2020 2020 2020 2075 7365 5f63 6163           use_cac
-00005c30: 6865 3d75 7365 5f63 6163 6865 2c0a 2020  he=use_cache,.  
-00005c40: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00005c50: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00005c60: 2e5f 7265 6164 5f67 6271 5f74 6162 6c65  ._read_gbq_table
-00005c70: 280a 2020 2020 2020 2020 2020 2020 7175  (.            qu
-00005c80: 6572 793d 7175 6572 792c 0a20 2020 2020  ery=query,.     
-00005c90: 2020 2020 2020 2069 6e64 6578 5f63 6f6c         index_col
-00005ca0: 3d69 6e64 6578 5f63 6f6c 2c0a 2020 2020  =index_col,.    
-00005cb0: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
-00005cc0: 636f 6c75 6d6e 732c 0a20 2020 2020 2020  columns,.       
-00005cd0: 2020 2020 206d 6178 5f72 6573 756c 7473       max_results
-00005ce0: 3d6d 6178 5f72 6573 756c 7473 2c0a 2020  =max_results,.  
-00005cf0: 2020 2020 2020 2020 2020 6170 695f 6e61            api_na
-00005d00: 6d65 3d22 7265 6164 5f67 6271 5f74 6162  me="read_gbq_tab
-00005d10: 6c65 222c 0a20 2020 2020 2020 2020 2020  le",.           
-00005d20: 2075 7365 5f63 6163 6865 3d75 7365 5f63   use_cache=use_c
-00005d30: 6163 6865 2c0a 2020 2020 2020 2020 290a  ache,.        ).
-00005d40: 0a20 2020 2064 6566 205f 7265 6164 5f67  .    def _read_g
-00005d50: 6271 5f74 6162 6c65 280a 2020 2020 2020  bq_table(.      
-00005d60: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00005d70: 7175 6572 793a 2073 7472 2c0a 2020 2020  query: str,.    
-00005d80: 2020 2020 2a2c 0a20 2020 2020 2020 2069      *,.        i
-00005d90: 6e64 6578 5f63 6f6c 3a20 4974 6572 6162  ndex_col: Iterab
-00005da0: 6c65 5b73 7472 5d20 7c20 7374 7220 7c20  le[str] | str | 
-00005db0: 6269 6766 7261 6d65 732e 656e 756d 732e  bigframes.enums.
-00005dc0: 4465 6661 756c 7449 6e64 6578 4b69 6e64  DefaultIndexKind
-00005dd0: 203d 2028 292c 0a20 2020 2020 2020 2063   = (),.        c
-00005de0: 6f6c 756d 6e73 3a20 4974 6572 6162 6c65  olumns: Iterable
-00005df0: 5b73 7472 5d20 3d20 2829 2c0a 2020 2020  [str] = (),.    
-00005e00: 2020 2020 6d61 785f 7265 7375 6c74 733a      max_results:
-00005e10: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-00005e20: 204e 6f6e 652c 0a20 2020 2020 2020 2061   None,.        a
-00005e30: 7069 5f6e 616d 653a 2073 7472 2c0a 2020  pi_name: str,.  
-00005e40: 2020 2020 2020 7573 655f 6361 6368 653a        use_cache:
-00005e50: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
-00005e60: 2020 2920 2d3e 2064 6174 6166 7261 6d65    ) -> dataframe
-00005e70: 2e44 6174 6146 7261 6d65 3a0a 2020 2020  .DataFrame:.    
-00005e80: 2020 2020 696d 706f 7274 2062 6967 6672      import bigfr
-00005e90: 616d 6573 2e64 6174 6166 7261 6d65 2061  ames.dataframe a
-00005ea0: 7320 6461 7461 6672 616d 650a 0a20 2020  s dataframe..   
-00005eb0: 2020 2020 2023 202d 2d2d 2d2d 2d2d 2d2d       # ---------
-00005ec0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00005ed0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00005ee0: 2023 2056 616c 6964 6174 6520 616e 6420   # Validate and 
-00005ef0: 7472 616e 7366 6f72 6d20 7061 7261 6d65  transform parame
-00005f00: 7465 7273 0a20 2020 2020 2020 2023 202d  ters.        # -
-00005f10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00005f20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00005f30: 0a0a 2020 2020 2020 2020 6966 206d 6178  ..        if max
-00005f40: 5f72 6573 756c 7473 2061 6e64 206d 6178  _results and max
-00005f50: 5f72 6573 756c 7473 203c 3d20 303a 0a20  _results <= 0:. 
-00005f60: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00005f70: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00005f80: 2020 2020 2020 2020 2020 2020 2066 2260               f"`
-00005f90: 6d61 785f 7265 7375 6c74 7360 2073 686f  max_results` sho
-00005fa0: 756c 6420 6265 2061 2070 6f73 6974 6976  uld be a positiv
-00005fb0: 6520 6e75 6d62 6572 2c20 676f 7420 7b6d  e number, got {m
-00005fc0: 6178 5f72 6573 756c 7473 7d2e 220a 2020  ax_results}.".  
-00005fd0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00005fe0: 2020 2020 2074 6162 6c65 5f72 6566 203d       table_ref =
-00005ff0: 2062 6967 7175 6572 792e 7461 626c 652e   bigquery.table.
-00006000: 5461 626c 6552 6566 6572 656e 6365 2e66  TableReference.f
-00006010: 726f 6d5f 7374 7269 6e67 280a 2020 2020  rom_string(.    
-00006020: 2020 2020 2020 2020 7175 6572 792c 2064          query, d
-00006030: 6566 6175 6c74 5f70 726f 6a65 6374 3d73  efault_project=s
-00006040: 656c 662e 6271 636c 6965 6e74 2e70 726f  elf.bqclient.pro
-00006050: 6a65 6374 0a20 2020 2020 2020 2029 0a0a  ject.        )..
-00006060: 2020 2020 2020 2020 2320 2d2d 2d2d 2d2d          # ------
-00006070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006080: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
-00006090: 2020 2020 2320 4665 7463 6820 7461 626c      # Fetch tabl
-000060a0: 6520 6d65 7461 6461 7461 2061 6e64 2076  e metadata and v
-000060b0: 616c 6964 6174 650a 2020 2020 2020 2020  alidate.        
-000060c0: 2320 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  # --------------
-000060d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000060e0: 2d2d 2d0a 0a20 2020 2020 2020 2028 7469  ---..        (ti
-000060f0: 6d65 5f74 7261 7665 6c5f 7469 6d65 7374  me_travel_timest
-00006100: 616d 702c 2074 6162 6c65 2c29 203d 2062  amp, table,) = b
-00006110: 665f 7265 6164 5f67 6271 5f74 6162 6c65  f_read_gbq_table
-00006120: 2e67 6574 5f74 6162 6c65 5f6d 6574 6164  .get_table_metad
-00006130: 6174 6128 0a20 2020 2020 2020 2020 2020  ata(.           
-00006140: 2073 656c 662e 6271 636c 6965 6e74 2c0a   self.bqclient,.
-00006150: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-00006160: 655f 7265 663d 7461 626c 655f 7265 662c  e_ref=table_ref,
-00006170: 0a20 2020 2020 2020 2020 2020 2061 7069  .            api
-00006180: 5f6e 616d 653d 6170 695f 6e61 6d65 2c0a  _name=api_name,.
-00006190: 2020 2020 2020 2020 2020 2020 6361 6368              cach
-000061a0: 653d 7365 6c66 2e5f 6466 5f73 6e61 7073  e=self._df_snaps
-000061b0: 686f 742c 0a20 2020 2020 2020 2020 2020  hot,.           
-000061c0: 2075 7365 5f63 6163 6865 3d75 7365 5f63   use_cache=use_c
-000061d0: 6163 6865 2c0a 2020 2020 2020 2020 290a  ache,.        ).
-000061e0: 0a20 2020 2020 2020 2069 6620 7461 626c  .        if tabl
-000061f0: 652e 6c6f 6361 7469 6f6e 2e63 6173 6566  e.location.casef
-00006200: 6f6c 6428 2920 213d 2073 656c 662e 5f6c  old() != self._l
-00006210: 6f63 6174 696f 6e2e 6361 7365 666f 6c64  ocation.casefold
-00006220: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00006230: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00006240: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00006250: 2020 6622 4375 7272 656e 7420 7365 7373    f"Current sess
-00006260: 696f 6e20 6973 2069 6e20 7b73 656c 662e  ion is in {self.
-00006270: 5f6c 6f63 6174 696f 6e7d 2062 7574 2064  _location} but d
-00006280: 6174 6173 6574 2027 7b74 6162 6c65 2e70  ataset '{table.p
-00006290: 726f 6a65 6374 7d2e 7b74 6162 6c65 2e64  roject}.{table.d
-000062a0: 6174 6173 6574 5f69 647d 2720 6973 206c  ataset_id}' is l
-000062b0: 6f63 6174 6564 2069 6e20 7b74 6162 6c65  ocated in {table
-000062c0: 2e6c 6f63 6174 696f 6e7d 220a 2020 2020  .location}".    
-000062d0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000062e0: 2020 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d     # -----------
-000062f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006300: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
-00006310: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
-00006320: 4962 6973 2074 6162 6c65 2065 7870 7265  Ibis table expre
-00006330: 7373 696f 6e20 616e 6420 7661 6c69 6461  ssion and valida
-00006340: 7465 0a20 2020 2020 2020 2023 202d 2d2d  te.        # ---
-00006350: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006360: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006370: 2d2d 2d2d 2d2d 0a0a 2020 2020 2020 2020  ------..        
-00006380: 2320 5573 6520 6120 7469 6d65 2074 7261  # Use a time tra
-00006390: 7665 6c20 746f 206d 616b 6520 7375 7265  vel to make sure
-000063a0: 2074 6865 2044 6174 6146 7261 6d65 2069   the DataFrame i
-000063b0: 7320 6465 7465 726d 696e 6973 7469 632c  s deterministic,
-000063c0: 2065 7665 6e0a 2020 2020 2020 2020 2320   even.        # 
-000063d0: 6966 2074 6865 2075 6e64 6572 6c79 696e  if the underlyin
-000063e0: 6720 7461 626c 6520 6368 616e 6765 732e  g table changes.
-000063f0: 0a20 2020 2020 2020 2074 6162 6c65 5f65  .        table_e
-00006400: 7870 7265 7373 696f 6e20 3d20 6266 5f72  xpression = bf_r
-00006410: 6561 645f 6762 715f 7461 626c 652e 6765  ead_gbq_table.ge
-00006420: 745f 6962 6973 5f74 696d 655f 7472 6176  t_ibis_time_trav
-00006430: 656c 5f74 6162 6c65 280a 2020 2020 2020  el_table(.      
-00006440: 2020 2020 2020 7365 6c66 2e69 6269 735f        self.ibis_
-00006450: 636c 6965 6e74 2c0a 2020 2020 2020 2020  client,.        
-00006460: 2020 2020 7461 626c 655f 7265 662c 0a20      table_ref,. 
-00006470: 2020 2020 2020 2020 2020 2074 696d 655f             time_
-00006480: 7472 6176 656c 5f74 696d 6573 7461 6d70  travel_timestamp
-00006490: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-000064a0: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
-000064b0: 636f 6c75 6d6e 733a 0a20 2020 2020 2020  columns:.       
-000064c0: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
-000064d0: 696e 2074 6162 6c65 5f65 7870 7265 7373  in table_express
-000064e0: 696f 6e2e 636f 6c75 6d6e 733a 0a20 2020  ion.columns:.   
-000064f0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00006500: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-00006510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006520: 2020 2066 2243 6f6c 756d 6e20 277b 6b65     f"Column '{ke
-00006530: 797d 2720 6f66 2060 636f 6c75 6d6e 7360  y}' of `columns`
-00006540: 206e 6f74 2066 6f75 6e64 2069 6e20 7468   not found in th
-00006550: 6973 2074 6162 6c65 2e22 0a20 2020 2020  is table.".     
-00006560: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00006570: 2020 2020 2020 2320 2d2d 2d2d 2d2d 2d2d        # --------
-00006580: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006590: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-000065a0: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
-000065b0: 2061 206e 6f6e 2d64 6566 6175 6c74 2069   a non-default i
-000065c0: 6e64 6578 2061 6e64 2076 616c 6964 6174  ndex and validat
-000065d0: 650a 2020 2020 2020 2020 2320 2d2d 2d2d  e.        # ----
-000065e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000065f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006600: 2d2d 2d0a 0a20 2020 2020 2020 2023 2054  ---..        # T
-00006610: 4f44 4f28 622f 3333 3739 3235 3134 3229  ODO(b/337925142)
-00006620: 3a20 4d6f 7665 2069 6e64 6578 5f63 6f6c  : Move index_col
-00006630: 7320 6372 6561 7469 6f6e 2074 6f20 6265  s creation to be
-00006640: 666f 7265 2077 6520 6372 6561 7465 2074  fore we create t
-00006650: 6865 0a20 2020 2020 2020 2023 2049 6269  he.        # Ibi
-00006660: 7320 7461 626c 6520 6578 7072 6573 7369  s table expressi
-00006670: 6f6e 2073 6f20 7765 2064 6f6e 2774 2068  on so we don't h
-00006680: 6176 6520 6120 2253 454c 4543 5420 2a22  ave a "SELECT *"
-00006690: 2073 7562 7175 6572 7920 696e 2074 6865   subquery in the
-000066a0: 0a20 2020 2020 2020 2023 2071 7565 7279  .        # query
-000066b0: 2074 6861 7420 6368 6563 6b73 2066 6f72   that checks for
-000066c0: 2069 6e64 6578 2075 6e69 7175 656e 6573   index uniquenes
-000066d0: 732e 0a0a 2020 2020 2020 2020 696e 6465  s...        inde
-000066e0: 785f 636f 6c73 2c20 6973 5f69 6e64 6578  x_cols, is_index
-000066f0: 5f75 6e69 7175 6520 3d20 6266 5f72 6561  _unique = bf_rea
-00006700: 645f 6762 715f 7461 626c 652e 6765 745f  d_gbq_table.get_
-00006710: 696e 6465 785f 636f 6c73 5f61 6e64 5f75  index_cols_and_u
-00006720: 6e69 7175 656e 6573 7328 0a20 2020 2020  niqueness(.     
-00006730: 2020 2020 2020 2062 7163 6c69 656e 743d         bqclient=
-00006740: 7365 6c66 2e62 7163 6c69 656e 742c 0a20  self.bqclient,. 
-00006750: 2020 2020 2020 2020 2020 2069 6269 735f             ibis_
-00006760: 636c 6965 6e74 3d73 656c 662e 6962 6973  client=self.ibis
-00006770: 5f63 6c69 656e 742c 0a20 2020 2020 2020  _client,.       
-00006780: 2020 2020 2074 6162 6c65 3d74 6162 6c65       table=table
-00006790: 2c0a 2020 2020 2020 2020 2020 2020 7461  ,.            ta
-000067a0: 626c 655f 6578 7072 6573 7369 6f6e 3d74  ble_expression=t
-000067b0: 6162 6c65 5f65 7870 7265 7373 696f 6e2c  able_expression,
-000067c0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-000067d0: 6578 5f63 6f6c 3d69 6e64 6578 5f63 6f6c  ex_col=index_col
-000067e0: 2c0a 2020 2020 2020 2020 2020 2020 6170  ,.            ap
-000067f0: 695f 6e61 6d65 3d61 7069 5f6e 616d 652c  i_name=api_name,
-00006800: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00006810: 2020 2020 666f 7220 6b65 7920 696e 2069      for key in i
-00006820: 6e64 6578 5f63 6f6c 733a 0a20 2020 2020  ndex_cols:.     
-00006830: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
-00006840: 7420 696e 2074 6162 6c65 5f65 7870 7265  t in table_expre
-00006850: 7373 696f 6e2e 636f 6c75 6d6e 733a 0a20  ssion.columns:. 
-00006860: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00006870: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00006880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006890: 2020 2020 2066 2243 6f6c 756d 6e20 607b       f"Column `{
-000068a0: 6b65 797d 6020 6f66 2060 696e 6465 785f  key}` of `index_
-000068b0: 636f 6c60 206e 6f74 2066 6f75 6e64 2069  col` not found i
-000068c0: 6e20 7468 6973 2074 6162 6c65 2e22 0a20  n this table.". 
-000068d0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000068e0: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
-000068f0: 2862 2f33 3337 3932 3531 3432 293a 2057  (b/337925142): W
-00006900: 6520 7368 6f75 6c64 2070 7573 6820 646f  e should push do
-00006910: 776e 2063 6f6c 756d 6e20 6669 6c74 6572  wn column filter
-00006920: 7320 7768 656e 2077 6520 6765 7420 7468  s when we get th
-00006930: 6520 7469 6d65 0a20 2020 2020 2020 2023  e time.        #
-00006940: 2074 7261 7665 6c20 7461 626c 6520 746f   travel table to
-00006950: 2061 766f 6964 2022 5345 4c45 4354 202a   avoid "SELECT *
-00006960: 2220 7375 6271 7565 7269 6573 2e0a 2020  " subqueries..  
-00006970: 2020 2020 2020 6966 2063 6f6c 756d 6e73        if columns
-00006980: 3a0a 2020 2020 2020 2020 2020 2020 7461  :.            ta
-00006990: 626c 655f 6578 7072 6573 7369 6f6e 203d  ble_expression =
-000069a0: 2074 6162 6c65 5f65 7870 7265 7373 696f   table_expressio
-000069b0: 6e2e 7365 6c65 6374 285b 2a69 6e64 6578  n.select([*index
-000069c0: 5f63 6f6c 732c 202a 636f 6c75 6d6e 735d  _cols, *columns]
-000069d0: 290a 0a20 2020 2020 2020 2023 202d 2d2d  )..        # ---
-000069e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000069f0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00006a00: 2020 2320 4372 6561 7465 206f 7264 6572    # Create order
-00006a10: 696e 6720 616e 6420 7661 6c69 6461 7465  ing and validate
-00006a20: 0a20 2020 2020 2020 2023 202d 2d2d 2d2d  .        # -----
-00006a30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006a40: 2d2d 2d2d 2d2d 2d0a 0a20 2020 2020 2020  -------..       
-00006a50: 2069 6620 6973 5f69 6e64 6578 5f75 6e69   if is_index_uni
-00006a60: 7175 653a 0a20 2020 2020 2020 2020 2020  que:.           
-00006a70: 2061 7272 6179 5f76 616c 7565 203d 2062   array_value = b
-00006a80: 665f 7265 6164 5f67 6271 5f74 6162 6c65  f_read_gbq_table
-00006a90: 2e74 6f5f 6172 7261 795f 7661 6c75 655f  .to_array_value_
-00006aa0: 7769 7468 5f74 6f74 616c 5f6f 7264 6572  with_total_order
-00006ab0: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
-00006ac0: 2020 2020 2073 6573 7369 6f6e 3d73 656c       session=sel
-00006ad0: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
-00006ae0: 2020 2074 6162 6c65 5f65 7870 7265 7373     table_express
-00006af0: 696f 6e3d 7461 626c 655f 6578 7072 6573  ion=table_expres
-00006b00: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
-00006b10: 2020 2020 2020 746f 7461 6c5f 6f72 6465        total_orde
-00006b20: 7269 6e67 5f63 6f6c 733d 696e 6465 785f  ring_cols=index_
-00006b30: 636f 6c73 2c0a 2020 2020 2020 2020 2020  cols,.          
-00006b40: 2020 290a 2020 2020 2020 2020 656c 7365    ).        else
-00006b50: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00006b60: 4e6f 7465 3a20 4576 656e 2074 686f 7567  Note: Even thoug
-00006b70: 6820 7765 2772 6520 6164 6469 6e67 2061  h we're adding a
-00006b80: 2064 6566 6175 6c74 206f 7264 6572 696e   default orderin
-00006b90: 6720 6865 7265 2c20 7468 6174 2773 0a20  g here, that's. 
-00006ba0: 2020 2020 2020 2020 2020 2023 206a 7573             # jus
-00006bb0: 7420 736f 2077 6520 6861 7665 2061 2064  t so we have a d
-00006bc0: 6574 6572 6d69 6e69 7374 6963 2074 6f74  eterministic tot
-00006bd0: 616c 206f 7264 6572 696e 672e 2049 6620  al ordering. If 
-00006be0: 7468 6520 7573 6572 0a20 2020 2020 2020  the user.       
-00006bf0: 2020 2020 2023 2073 7065 6369 6669 6564       # specified
-00006c00: 2061 206e 6f6e 2d75 6e69 7175 6520 696e   a non-unique in
-00006c10: 6465 782c 2077 6520 7374 696c 6c20 736f  dex, we still so
-00006c20: 7274 2062 7920 7468 6174 206c 6174 6572  rt by that later
-00006c30: 2e0a 2020 2020 2020 2020 2020 2020 6172  ..            ar
-00006c40: 7261 795f 7661 6c75 6520 3d20 6266 5f72  ray_value = bf_r
-00006c50: 6561 645f 6762 715f 7461 626c 652e 746f  ead_gbq_table.to
-00006c60: 5f61 7272 6179 5f76 616c 7565 5f77 6974  _array_value_wit
-00006c70: 685f 6465 6661 756c 745f 6f72 6465 7269  h_default_orderi
-00006c80: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
-00006c90: 2020 2020 7365 7373 696f 6e3d 7365 6c66      session=self
-00006ca0: 2c20 7461 626c 653d 7461 626c 655f 6578  , table=table_ex
-00006cb0: 7072 6573 7369 6f6e 2c20 7461 626c 655f  pression, table_
-00006cc0: 726f 7773 3d74 6162 6c65 2e6e 756d 5f72  rows=table.num_r
-00006cd0: 6f77 730a 2020 2020 2020 2020 2020 2020  ows.            
-00006ce0: 290a 0a20 2020 2020 2020 2023 202d 2d2d  )..        # ---
-00006cf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006d00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006d10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006d20: 2d0a 2020 2020 2020 2020 2320 4372 6561  -.        # Crea
-00006d30: 7465 2042 6c6f 636b 2026 2064 6566 6175  te Block & defau
-00006d40: 6c74 2069 6e64 6578 2069 6620 6c65 6e28  lt index if len(
-00006d50: 696e 6465 785f 636f 6c73 2920 3d3d 2030  index_cols) == 0
-00006d60: 0a20 2020 2020 2020 2023 202d 2d2d 2d2d  .        # -----
-00006d70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006d80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006d90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-00006da0: 0a20 2020 2020 2020 2076 616c 7565 5f63  .        value_c
-00006db0: 6f6c 756d 6e73 203d 205b 636f 6c20 666f  olumns = [col fo
-00006dc0: 7220 636f 6c20 696e 2061 7272 6179 5f76  r col in array_v
-00006dd0: 616c 7565 2e63 6f6c 756d 6e5f 6964 7320  alue.column_ids 
-00006de0: 6966 2063 6f6c 206e 6f74 2069 6e20 696e  if col not in in
-00006df0: 6465 785f 636f 6c73 5d0a 2020 2020 2020  dex_cols].      
-00006e00: 2020 626c 6f63 6b20 3d20 626c 6f63 6b73    block = blocks
-00006e10: 2e42 6c6f 636b 280a 2020 2020 2020 2020  .Block(.        
-00006e20: 2020 2020 6172 7261 795f 7661 6c75 652c      array_value,
-00006e30: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-00006e40: 6578 5f63 6f6c 756d 6e73 3d69 6e64 6578  ex_columns=index
-00006e50: 5f63 6f6c 732c 0a20 2020 2020 2020 2020  _cols,.         
-00006e60: 2020 2063 6f6c 756d 6e5f 6c61 6265 6c73     column_labels
-00006e70: 3d76 616c 7565 5f63 6f6c 756d 6e73 2c0a  =value_columns,.
-00006e80: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00006e90: 785f 6c61 6265 6c73 3d69 6e64 6578 5f63  x_labels=index_c
-00006ea0: 6f6c 732c 0a20 2020 2020 2020 2029 0a20  ols,.        ). 
-00006eb0: 2020 2020 2020 2069 6620 6d61 785f 7265         if max_re
-00006ec0: 7375 6c74 733a 0a20 2020 2020 2020 2020  sults:.         
-00006ed0: 2020 2062 6c6f 636b 203d 2062 6c6f 636b     block = block
-00006ee0: 2e73 6c69 6365 2873 746f 703d 6d61 785f  .slice(stop=max_
-00006ef0: 7265 7375 6c74 7329 0a20 2020 2020 2020  results).       
-00006f00: 2064 6620 3d20 6461 7461 6672 616d 652e   df = dataframe.
-00006f10: 4461 7461 4672 616d 6528 626c 6f63 6b29  DataFrame(block)
-00006f20: 0a0a 2020 2020 2020 2020 2320 4966 2075  ..        # If u
-00006f30: 7365 7220 7072 6f76 6964 6564 2069 6e64  ser provided ind
-00006f40: 6578 2063 6f6c 756d 6e73 2c20 7368 6f75  ex columns, shou
-00006f50: 6c64 2073 6f72 7420 6f76 6572 2069 740a  ld sort over it.
-00006f60: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
-00006f70: 6e64 6578 5f63 6f6c 7329 203e 2030 3a0a  ndex_cols) > 0:.
-00006f80: 2020 2020 2020 2020 2020 2020 6466 2e73              df.s
-00006f90: 6f72 745f 696e 6465 7828 290a 2020 2020  ort_index().    
-00006fa0: 2020 2020 7265 7475 726e 2064 660a 0a20      return df.. 
-00006fb0: 2020 2064 6566 205f 7265 6164 5f62 6967     def _read_big
-00006fc0: 7175 6572 795f 6c6f 6164 5f6a 6f62 280a  query_load_job(.
-00006fd0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00006fe0: 2020 2020 2020 6669 6c65 7061 7468 5f6f        filepath_o
-00006ff0: 725f 6275 6666 6572 3a20 7374 7220 7c20  r_buffer: str | 
-00007000: 494f 5b22 6279 7465 7322 5d2c 0a20 2020  IO["bytes"],.   
-00007010: 2020 2020 2074 6162 6c65 3a20 556e 696f       table: Unio
-00007020: 6e5b 6269 6771 7565 7279 2e54 6162 6c65  n[bigquery.Table
-00007030: 2c20 6269 6771 7565 7279 2e54 6162 6c65  , bigquery.Table
-00007040: 5265 6665 7265 6e63 655d 2c0a 2020 2020  Reference],.    
-00007050: 2020 2020 2a2c 0a20 2020 2020 2020 206a      *,.        j
-00007060: 6f62 5f63 6f6e 6669 673a 2062 6967 7175  ob_config: bigqu
-00007070: 6572 792e 4c6f 6164 4a6f 6243 6f6e 6669  ery.LoadJobConfi
-00007080: 672c 0a20 2020 2020 2020 2069 6e64 6578  g,.        index
-00007090: 5f63 6f6c 3a20 4974 6572 6162 6c65 5b73  _col: Iterable[s
-000070a0: 7472 5d20 7c20 7374 7220 7c20 6269 6766  tr] | str | bigf
-000070b0: 7261 6d65 732e 656e 756d 732e 4465 6661  rames.enums.Defa
-000070c0: 756c 7449 6e64 6578 4b69 6e64 203d 2028  ultIndexKind = (
-000070d0: 292c 0a20 2020 2020 2020 2063 6f6c 756d  ),.        colum
-000070e0: 6e73 3a20 4974 6572 6162 6c65 5b73 7472  ns: Iterable[str
-000070f0: 5d20 3d20 2829 2c0a 2020 2020 2920 2d3e  ] = (),.    ) ->
-00007100: 2064 6174 6166 7261 6d65 2e44 6174 6146   dataframe.DataF
-00007110: 7261 6d65 3a0a 2020 2020 2020 2020 696e  rame:.        in
-00007120: 6465 785f 636f 6c73 203d 205f 746f 5f69  dex_cols = _to_i
-00007130: 6e64 6578 5f63 6f6c 7328 696e 6465 785f  ndex_cols(index_
-00007140: 636f 6c29 0a0a 2020 2020 2020 2020 6966  col)..        if
-00007150: 206e 6f74 206a 6f62 5f63 6f6e 6669 672e   not job_config.
-00007160: 636c 7573 7465 7269 6e67 5f66 6965 6c64  clustering_field
-00007170: 7320 616e 6420 696e 6465 785f 636f 6c73  s and index_cols
-00007180: 3a0a 2020 2020 2020 2020 2020 2020 6a6f  :.            jo
-00007190: 625f 636f 6e66 6967 2e63 6c75 7374 6572  b_config.cluster
-000071a0: 696e 675f 6669 656c 6473 203d 2069 6e64  ing_fields = ind
-000071b0: 6578 5f63 6f6c 735b 3a5f 4d41 585f 434c  ex_cols[:_MAX_CL
-000071c0: 5553 5445 525f 434f 4c55 4d4e 535d 0a0a  USTER_COLUMNS]..
-000071d0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000071e0: 7461 6e63 6528 6669 6c65 7061 7468 5f6f  tance(filepath_o
-000071f0: 725f 6275 6666 6572 2c20 7374 7229 3a0a  r_buffer, str):.
-00007200: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00007210: 696c 6570 6174 685f 6f72 5f62 7566 6665  ilepath_or_buffe
-00007220: 722e 7374 6172 7473 7769 7468 2822 6773  r.startswith("gs
-00007230: 3a2f 2f22 293a 0a20 2020 2020 2020 2020  ://"):.         
-00007240: 2020 2020 2020 206c 6f61 645f 6a6f 6220         load_job 
-00007250: 3d20 7365 6c66 2e62 7163 6c69 656e 742e  = self.bqclient.
-00007260: 6c6f 6164 5f74 6162 6c65 5f66 726f 6d5f  load_table_from_
-00007270: 7572 6928 0a20 2020 2020 2020 2020 2020  uri(.           
-00007280: 2020 2020 2020 2020 2066 696c 6570 6174           filepat
-00007290: 685f 6f72 5f62 7566 6665 722c 2074 6162  h_or_buffer, tab
-000072a0: 6c65 2c20 6a6f 625f 636f 6e66 6967 3d6a  le, job_config=j
-000072b0: 6f62 5f63 6f6e 6669 670a 2020 2020 2020  ob_config.      
-000072c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000072d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000072e0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-000072f0: 7468 206f 7065 6e28 6669 6c65 7061 7468  th open(filepath
-00007300: 5f6f 725f 6275 6666 6572 2c20 2272 6222  _or_buffer, "rb"
-00007310: 2920 6173 2073 6f75 7263 655f 6669 6c65  ) as source_file
-00007320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007330: 2020 2020 2020 6c6f 6164 5f6a 6f62 203d        load_job =
-00007340: 2073 656c 662e 6271 636c 6965 6e74 2e6c   self.bqclient.l
-00007350: 6f61 645f 7461 626c 655f 6672 6f6d 5f66  oad_table_from_f
-00007360: 696c 6528 0a20 2020 2020 2020 2020 2020  ile(.           
-00007370: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
-00007380: 7263 655f 6669 6c65 2c20 7461 626c 652c  rce_file, table,
-00007390: 206a 6f62 5f63 6f6e 6669 673d 6a6f 625f   job_config=job_
-000073a0: 636f 6e66 6967 0a20 2020 2020 2020 2020  config.         
-000073b0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000073c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000073d0: 2020 2020 2020 206c 6f61 645f 6a6f 6220         load_job 
-000073e0: 3d20 7365 6c66 2e62 7163 6c69 656e 742e  = self.bqclient.
-000073f0: 6c6f 6164 5f74 6162 6c65 5f66 726f 6d5f  load_table_from_
-00007400: 6669 6c65 280a 2020 2020 2020 2020 2020  file(.          
-00007410: 2020 2020 2020 6669 6c65 7061 7468 5f6f        filepath_o
-00007420: 725f 6275 6666 6572 2c20 7461 626c 652c  r_buffer, table,
-00007430: 206a 6f62 5f63 6f6e 6669 673d 6a6f 625f   job_config=job_
-00007440: 636f 6e66 6967 0a20 2020 2020 2020 2020  config.         
-00007450: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
-00007460: 6c66 2e5f 7374 6172 745f 6765 6e65 7269  lf._start_generi
-00007470: 635f 6a6f 6228 6c6f 6164 5f6a 6f62 290a  c_job(load_job).
-00007480: 2020 2020 2020 2020 7461 626c 655f 6964          table_id
-00007490: 203d 2066 227b 7461 626c 652e 7072 6f6a   = f"{table.proj
-000074a0: 6563 747d 2e7b 7461 626c 652e 6461 7461  ect}.{table.data
-000074b0: 7365 745f 6964 7d2e 7b74 6162 6c65 2e74  set_id}.{table.t
-000074c0: 6162 6c65 5f69 647d 220a 0a20 2020 2020  able_id}"..     
-000074d0: 2020 2023 2055 7064 6174 6520 7468 6520     # Update the 
-000074e0: 7461 626c 6520 6578 7069 7261 7469 6f6e  table expiration
-000074f0: 2073 6f20 7765 2061 7265 6e27 7420 6c69   so we aren't li
-00007500: 6d69 7465 6420 746f 2074 6865 2064 6566  mited to the def
-00007510: 6175 6c74 2032 340a 2020 2020 2020 2020  ault 24.        
-00007520: 2320 686f 7572 7320 6f66 2074 6865 2061  # hours of the a
-00007530: 6e6f 6e79 6d6f 7573 2064 6174 6173 6574  nonymous dataset
-00007540: 2e0a 2020 2020 2020 2020 7461 626c 655f  ..        table_
-00007550: 6578 7069 7261 7469 6f6e 203d 2062 6967  expiration = big
-00007560: 7175 6572 792e 5461 626c 6528 7461 626c  query.Table(tabl
-00007570: 655f 6964 290a 2020 2020 2020 2020 7461  e_id).        ta
-00007580: 626c 655f 6578 7069 7261 7469 6f6e 2e65  ble_expiration.e
-00007590: 7870 6972 6573 203d 2028 0a20 2020 2020  xpires = (.     
-000075a0: 2020 2020 2020 2064 6174 6574 696d 652e         datetime.
-000075b0: 6461 7465 7469 6d65 2e6e 6f77 2864 6174  datetime.now(dat
-000075c0: 6574 696d 652e 7469 6d65 7a6f 6e65 2e75  etime.timezone.u
-000075d0: 7463 2920 2b20 636f 6e73 7461 6e74 732e  tc) + constants.
-000075e0: 4445 4641 554c 545f 4558 5049 5241 5449  DEFAULT_EXPIRATI
-000075f0: 4f4e 0a20 2020 2020 2020 2029 0a20 2020  ON.        ).   
-00007600: 2020 2020 2073 656c 662e 6271 636c 6965       self.bqclie
-00007610: 6e74 2e75 7064 6174 655f 7461 626c 6528  nt.update_table(
-00007620: 7461 626c 655f 6578 7069 7261 7469 6f6e  table_expiration
-00007630: 2c20 5b22 6578 7069 7265 7322 5d29 0a0a  , ["expires"])..
-00007640: 2020 2020 2020 2020 2320 5468 6520 4269          # The Bi
-00007650: 6751 7565 7279 2052 4553 5420 4150 4920  gQuery REST API 
-00007660: 666f 7220 7461 626c 6573 2e67 6574 2064  for tables.get d
-00007670: 6f65 736e 2774 2074 616b 6520 6120 7365  oesn't take a se
-00007680: 7373 696f 6e20 4944 2c20 736f 2077 650a  ssion ID, so we.
-00007690: 2020 2020 2020 2020 2320 6361 6e27 7420          # can't 
-000076a0: 6765 7420 7468 6520 7363 6865 6d61 2066  get the schema f
-000076b0: 6f72 2061 2074 656d 7020 7461 626c 6520  or a temp table 
-000076c0: 7468 6174 2077 6179 2e0a 2020 2020 2020  that way..      
-000076d0: 2020 7265 7475 726e 2073 656c 662e 7265    return self.re
-000076e0: 6164 5f67 6271 5f74 6162 6c65 280a 2020  ad_gbq_table(.  
-000076f0: 2020 2020 2020 2020 2020 7461 626c 655f            table_
-00007700: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-00007710: 696e 6465 785f 636f 6c3d 696e 6465 785f  index_col=index_
-00007720: 636f 6c2c 0a20 2020 2020 2020 2020 2020  col,.           
-00007730: 2063 6f6c 756d 6e73 3d63 6f6c 756d 6e73   columns=columns
-00007740: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00007750: 2064 6566 2072 6561 645f 6762 715f 6d6f   def read_gbq_mo
-00007760: 6465 6c28 7365 6c66 2c20 6d6f 6465 6c5f  del(self, model_
-00007770: 6e61 6d65 3a20 7374 7229 3a0a 2020 2020  name: str):.    
-00007780: 2020 2020 2222 224c 6f61 6473 2061 2042      """Loads a B
-00007790: 6967 5175 6572 7920 4d4c 206d 6f64 656c  igQuery ML model
-000077a0: 2066 726f 6d20 4269 6751 7565 7279 2e0a   from BigQuery..
-000077b0: 0a20 2020 2020 2020 202a 2a45 7861 6d70  .        **Examp
-000077c0: 6c65 733a 2a2a 0a0a 2020 2020 2020 2020  les:**..        
-000077d0: 2020 2020 3e3e 3e20 696d 706f 7274 2062      >>> import b
-000077e0: 6967 6672 616d 6573 2e70 616e 6461 7320  igframes.pandas 
-000077f0: 6173 2062 7064 0a20 2020 2020 2020 2020  as bpd.         
-00007800: 2020 203e 3e3e 2062 7064 2e6f 7074 696f     >>> bpd.optio
-00007810: 6e73 2e64 6973 706c 6179 2e70 726f 6772  ns.display.progr
-00007820: 6573 735f 6261 7220 3d20 4e6f 6e65 0a0a  ess_bar = None..
-00007830: 2020 2020 2020 2020 5265 6164 2061 6e20          Read an 
-00007840: 6578 6973 7469 6e67 2042 6967 5175 6572  existing BigQuer
-00007850: 7920 4d4c 206d 6f64 656c 2e0a 0a20 2020  y ML model...   
-00007860: 2020 2020 2020 2020 203e 3e3e 206d 6f64           >>> mod
-00007870: 656c 5f6e 616d 6520 3d20 2262 6967 6672  el_name = "bigfr
-00007880: 616d 6573 2d64 6576 2e62 716d 6c5f 7475  ames-dev.bqml_tu
-00007890: 746f 7269 616c 2e70 656e 6775 696e 735f  torial.penguins_
-000078a0: 6d6f 6465 6c22 0a20 2020 2020 2020 2020  model".         
-000078b0: 2020 203e 3e3e 206d 6f64 656c 203d 2062     >>> model = b
-000078c0: 7064 2e72 6561 645f 6762 715f 6d6f 6465  pd.read_gbq_mode
-000078d0: 6c28 6d6f 6465 6c5f 6e61 6d65 290a 0a20  l(model_name).. 
-000078e0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-000078f0: 2020 2020 2020 2020 206d 6f64 656c 5f6e           model_n
-00007900: 616d 6520 2873 7472 293a 0a20 2020 2020  ame (str):.     
-00007910: 2020 2020 2020 2020 2020 2074 6865 206d             the m
-00007920: 6f64 656c 2773 206e 616d 6520 696e 2042  odel's name in B
-00007930: 6967 5175 6572 7920 696e 2074 6865 2066  igQuery in the f
-00007940: 6f72 6d61 740a 2020 2020 2020 2020 2020  ormat.          
-00007950: 2020 2020 2020 6070 726f 6a65 6374 5f69        `project_i
-00007960: 642e 6461 7461 7365 745f 6964 2e6d 6f64  d.dataset_id.mod
-00007970: 656c 5f69 6460 2c20 6f72 206a 7573 7420  el_id`, or just 
-00007980: 6064 6174 6173 6574 5f69 642e 6d6f 6465  `dataset_id.mode
-00007990: 6c5f 6964 600a 2020 2020 2020 2020 2020  l_id`.          
-000079a0: 2020 2020 2020 746f 206c 6f61 6420 6672        to load fr
-000079b0: 6f6d 2074 6865 2064 6566 6175 6c74 2070  om the default p
-000079c0: 726f 6a65 6374 2e0a 0a20 2020 2020 2020  roject...       
-000079d0: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
-000079e0: 2020 2020 2020 4120 6269 6766 7261 6d65        A bigframe
-000079f0: 732e 6d6c 204d 6f64 656c 2c20 5472 616e  s.ml Model, Tran
-00007a00: 7366 6f72 6d65 7220 6f72 2050 6970 656c  sformer or Pipel
-00007a10: 696e 6520 7772 6170 7069 6e67 2074 6865  ine wrapping the
-00007a20: 206d 6f64 656c 2e0a 2020 2020 2020 2020   model..        
-00007a30: 2222 220a 2020 2020 2020 2020 696d 706f  """.        impo
-00007a40: 7274 2062 6967 6672 616d 6573 2e6d 6c2e  rt bigframes.ml.
-00007a50: 6c6f 6164 6572 0a0a 2020 2020 2020 2020  loader..        
-00007a60: 6d6f 6465 6c5f 7265 6620 3d20 6269 6771  model_ref = bigq
-00007a70: 7565 7279 2e4d 6f64 656c 5265 6665 7265  uery.ModelRefere
-00007a80: 6e63 652e 6672 6f6d 5f73 7472 696e 6728  nce.from_string(
-00007a90: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-00007aa0: 656c 5f6e 616d 652c 2064 6566 6175 6c74  el_name, default
-00007ab0: 5f70 726f 6a65 6374 3d73 656c 662e 6271  _project=self.bq
-00007ac0: 636c 6965 6e74 2e70 726f 6a65 6374 0a20  client.project. 
-00007ad0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00007ae0: 206d 6f64 656c 203d 2073 656c 662e 6271   model = self.bq
-00007af0: 636c 6965 6e74 2e67 6574 5f6d 6f64 656c  client.get_model
-00007b00: 286d 6f64 656c 5f72 6566 290a 2020 2020  (model_ref).    
-00007b10: 2020 2020 7265 7475 726e 2062 6967 6672      return bigfr
-00007b20: 616d 6573 2e6d 6c2e 6c6f 6164 6572 2e66  ames.ml.loader.f
-00007b30: 726f 6d5f 6271 2873 656c 662c 206d 6f64  rom_bq(self, mod
-00007b40: 656c 290a 0a20 2020 2040 7479 7069 6e67  el)..    @typing
-00007b50: 2e6f 7665 726c 6f61 640a 2020 2020 6465  .overload.    de
-00007b60: 6620 7265 6164 5f70 616e 6461 7328 0a20  f read_pandas(. 
-00007b70: 2020 2020 2020 2073 656c 662c 2070 616e         self, pan
-00007b80: 6461 735f 6461 7461 6672 616d 653a 2070  das_dataframe: p
-00007b90: 616e 6461 732e 496e 6465 780a 2020 2020  andas.Index.    
-00007ba0: 2920 2d3e 2062 6967 6672 616d 6573 2e63  ) -> bigframes.c
-00007bb0: 6f72 652e 696e 6465 7865 732e 496e 6465  ore.indexes.Inde
-00007bc0: 783a 0a20 2020 2020 2020 202e 2e2e 0a0a  x:.        .....
-00007bd0: 2020 2020 4074 7970 696e 672e 6f76 6572      @typing.over
-00007be0: 6c6f 6164 0a20 2020 2064 6566 2072 6561  load.    def rea
-00007bf0: 645f 7061 6e64 6173 2873 656c 662c 2070  d_pandas(self, p
-00007c00: 616e 6461 735f 6461 7461 6672 616d 653a  andas_dataframe:
-00007c10: 2070 616e 6461 732e 5365 7269 6573 2920   pandas.Series) 
-00007c20: 2d3e 2062 6967 6672 616d 6573 2e73 6572  -> bigframes.ser
-00007c30: 6965 732e 5365 7269 6573 3a0a 2020 2020  ies.Series:.    
-00007c40: 2020 2020 2e2e 2e0a 0a20 2020 2040 7479      .....    @ty
-00007c50: 7069 6e67 2e6f 7665 726c 6f61 640a 2020  ping.overload.  
-00007c60: 2020 6465 6620 7265 6164 5f70 616e 6461    def read_panda
-00007c70: 7328 7365 6c66 2c20 7061 6e64 6173 5f64  s(self, pandas_d
-00007c80: 6174 6166 7261 6d65 3a20 7061 6e64 6173  ataframe: pandas
-00007c90: 2e44 6174 6146 7261 6d65 2920 2d3e 2064  .DataFrame) -> d
-00007ca0: 6174 6166 7261 6d65 2e44 6174 6146 7261  ataframe.DataFra
-00007cb0: 6d65 3a0a 2020 2020 2020 2020 2e2e 2e0a  me:.        ....
-00007cc0: 0a20 2020 2064 6566 2072 6561 645f 7061  .    def read_pa
-00007cd0: 6e64 6173 280a 2020 2020 2020 2020 7365  ndas(.        se
-00007ce0: 6c66 2c20 7061 6e64 6173 5f64 6174 6166  lf, pandas_dataf
-00007cf0: 7261 6d65 3a20 556e 696f 6e5b 7061 6e64  rame: Union[pand
-00007d00: 6173 2e44 6174 6146 7261 6d65 2c20 7061  as.DataFrame, pa
-00007d10: 6e64 6173 2e53 6572 6965 732c 2070 616e  ndas.Series, pan
-00007d20: 6461 732e 496e 6465 785d 0a20 2020 2029  das.Index].    )
-00007d30: 3a0a 2020 2020 2020 2020 2222 224c 6f61  :.        """Loa
-00007d40: 6473 2044 6174 6146 7261 6d65 2066 726f  ds DataFrame fro
-00007d50: 6d20 6120 7061 6e64 6173 2044 6174 6146  m a pandas DataF
-00007d60: 7261 6d65 2e0a 0a20 2020 2020 2020 2054  rame...        T
-00007d70: 6865 2070 616e 6461 7320 4461 7461 4672  he pandas DataFr
-00007d80: 616d 6520 7769 6c6c 2062 6520 7065 7273  ame will be pers
-00007d90: 6973 7465 6420 6173 2061 2074 656d 706f  isted as a tempo
-00007da0: 7261 7279 2042 6967 5175 6572 7920 7461  rary BigQuery ta
-00007db0: 626c 652c 2077 6869 6368 2063 616e 2062  ble, which can b
-00007dc0: 650a 2020 2020 2020 2020 6175 746f 6d61  e.        automa
-00007dd0: 7469 6361 6c6c 7920 7265 6379 636c 6564  tically recycled
-00007de0: 2061 6674 6572 2074 6865 2053 6573 7369   after the Sessi
-00007df0: 6f6e 2069 7320 636c 6f73 6564 2e0a 0a20  on is closed... 
-00007e00: 2020 2020 2020 202e 2e20 6e6f 7465 3a3a         .. note::
-00007e10: 0a20 2020 2020 2020 2020 2020 2044 6174  .            Dat
-00007e20: 6120 6973 2069 6e6c 696e 6564 2069 6e20  a is inlined in 
-00007e30: 7468 6520 7175 6572 7920 5351 4c20 6966  the query SQL if
-00007e40: 2069 7420 6973 2073 6d61 6c6c 2065 6e6f   it is small eno
-00007e50: 7567 6820 2872 6f75 6768 6c79 2035 4d42  ugh (roughly 5MB
-00007e60: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-00007e70: 6c65 7373 2069 6e20 6d65 6d6f 7279 292e  less in memory).
-00007e80: 204c 6172 6765 7220 7369 7a65 2064 6174   Larger size dat
-00007e90: 6120 6973 206c 6f61 6465 6420 746f 2061  a is loaded to a
-00007ea0: 2042 6967 5175 6572 7920 7461 626c 650a   BigQuery table.
-00007eb0: 2020 2020 2020 2020 2020 2020 696e 7374              inst
-00007ec0: 6561 642e 0a0a 2020 2020 2020 2020 2a2a  ead...        **
-00007ed0: 4578 616d 706c 6573 3a2a 2a0a 0a20 2020  Examples:**..   
-00007ee0: 2020 2020 2020 2020 203e 3e3e 2069 6d70           >>> imp
-00007ef0: 6f72 7420 6269 6766 7261 6d65 732e 7061  ort bigframes.pa
-00007f00: 6e64 6173 2061 7320 6270 640a 2020 2020  ndas as bpd.    
-00007f10: 2020 2020 2020 2020 3e3e 3e20 696d 706f          >>> impo
-00007f20: 7274 2070 616e 6461 7320 6173 2070 640a  rt pandas as pd.
-00007f30: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
-00007f40: 6270 642e 6f70 7469 6f6e 732e 6469 7370  bpd.options.disp
-00007f50: 6c61 792e 7072 6f67 7265 7373 5f62 6172  lay.progress_bar
-00007f60: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
-00007f70: 2020 2020 203e 3e3e 2064 203d 207b 2763       >>> d = {'c
-00007f80: 6f6c 3127 3a20 5b31 2c20 325d 2c20 2763  ol1': [1, 2], 'c
-00007f90: 6f6c 3227 3a20 5b33 2c20 345d 7d0a 2020  ol2': [3, 4]}.  
-00007fa0: 2020 2020 2020 2020 2020 3e3e 3e20 7061            >>> pa
-00007fb0: 6e64 6173 5f64 6620 3d20 7064 2e44 6174  ndas_df = pd.Dat
-00007fc0: 6146 7261 6d65 2864 6174 613d 6429 0a20  aFrame(data=d). 
-00007fd0: 2020 2020 2020 2020 2020 203e 3e3e 2064             >>> d
-00007fe0: 6620 3d20 6270 642e 7265 6164 5f70 616e  f = bpd.read_pan
-00007ff0: 6461 7328 7061 6e64 6173 5f64 6629 0a20  das(pandas_df). 
-00008000: 2020 2020 2020 2020 2020 203e 3e3e 2064             >>> d
-00008010: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
-00008020: 2063 6f6c 3120 2063 6f6c 320a 2020 2020   col1  col2.    
-00008030: 2020 2020 2020 2020 3020 2020 2020 3120          0     1 
-00008040: 2020 2020 330a 2020 2020 2020 2020 2020      3.          
-00008050: 2020 3120 2020 2020 3220 2020 2020 340a    1     2     4.
-00008060: 2020 2020 2020 2020 2020 2020 3c42 4c41              <BLA
-00008070: 4e4b 4c49 4e45 3e0a 2020 2020 2020 2020  NKLINE>.        
-00008080: 2020 2020 5b32 2072 6f77 7320 7820 3220      [2 rows x 2 
-00008090: 636f 6c75 6d6e 735d 0a0a 2020 2020 2020  columns]..      
-000080a0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-000080b0: 2020 2020 7061 6e64 6173 5f64 6174 6166      pandas_dataf
-000080c0: 7261 6d65 2028 7061 6e64 6173 2e44 6174  rame (pandas.Dat
-000080d0: 6146 7261 6d65 2c20 7061 6e64 6173 2e53  aFrame, pandas.S
-000080e0: 6572 6965 732c 206f 7220 7061 6e64 6173  eries, or pandas
-000080f0: 2e49 6e64 6578 293a 0a20 2020 2020 2020  .Index):.       
-00008100: 2020 2020 2020 2020 2061 2070 616e 6461           a panda
-00008110: 7320 4461 7461 4672 616d 652f 5365 7269  s DataFrame/Seri
-00008120: 6573 2f49 6e64 6578 206f 626a 6563 7420  es/Index object 
-00008130: 746f 2062 6520 6c6f 6164 6564 2e0a 0a20  to be loaded... 
-00008140: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
-00008150: 2020 2020 2020 2020 2020 2020 416e 2065              An e
-00008160: 7175 6976 616c 656e 7420 6269 6766 7261  quivalent bigfra
-00008170: 6d65 732e 7061 6e64 6173 2e28 4461 7461  mes.pandas.(Data
-00008180: 4672 616d 652f 5365 7269 6573 2f49 6e64  Frame/Series/Ind
-00008190: 6578 2920 6f62 6a65 6374 0a20 2020 2020  ex) object.     
-000081a0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-000081b0: 6d70 6f72 7420 6269 6766 7261 6d65 732e  mport bigframes.
-000081c0: 7365 7269 6573 2061 7320 7365 7269 6573  series as series
-000081d0: 0a0a 2020 2020 2020 2020 2320 5472 7920  ..        # Try 
-000081e0: 746f 2068 616e 646c 6520 6e6f 6e2d 6461  to handle non-da
-000081f0: 7461 6672 616d 6520 7061 6e64 6173 206f  taframe pandas o
-00008200: 626a 6563 7473 2061 7320 7765 6c6c 0a20  bjects as well. 
-00008210: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00008220: 616e 6365 2870 616e 6461 735f 6461 7461  ance(pandas_data
-00008230: 6672 616d 652c 2070 616e 6461 732e 5365  frame, pandas.Se
-00008240: 7269 6573 293a 0a20 2020 2020 2020 2020  ries):.         
-00008250: 2020 2062 665f 6466 203d 2073 656c 662e     bf_df = self.
-00008260: 5f72 6561 645f 7061 6e64 6173 2870 616e  _read_pandas(pan
-00008270: 6461 732e 4461 7461 4672 616d 6528 7061  das.DataFrame(pa
-00008280: 6e64 6173 5f64 6174 6166 7261 6d65 292c  ndas_dataframe),
-00008290: 2022 7265 6164 5f70 616e 6461 7322 290a   "read_pandas").
-000082a0: 2020 2020 2020 2020 2020 2020 6266 5f73              bf_s
-000082b0: 6572 6965 7320 3d20 7479 7069 6e67 2e63  eries = typing.c
-000082c0: 6173 7428 7365 7269 6573 2e53 6572 6965  ast(series.Serie
-000082d0: 732c 2062 665f 6466 5b62 665f 6466 2e63  s, bf_df[bf_df.c
-000082e0: 6f6c 756d 6e73 5b30 5d5d 290a 2020 2020  olumns[0]]).    
-000082f0: 2020 2020 2020 2020 2320 7772 6170 7069          # wrappi
-00008300: 6e67 2069 6e74 6f20 6466 2063 616e 2073  ng into df can s
-00008310: 6574 206e 616d 6520 746f 2030 2073 6f20  et name to 0 so 
-00008320: 7265 7365 7420 746f 206f 7269 6769 6e61  reset to origina
-00008330: 6c20 6f62 6a65 6374 206e 616d 650a 2020  l object name.  
-00008340: 2020 2020 2020 2020 2020 6266 5f73 6572            bf_ser
-00008350: 6965 732e 6e61 6d65 203d 2070 616e 6461  ies.name = panda
-00008360: 735f 6461 7461 6672 616d 652e 6e61 6d65  s_dataframe.name
-00008370: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00008380: 7572 6e20 6266 5f73 6572 6965 730a 2020  urn bf_series.  
-00008390: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-000083a0: 6e63 6528 7061 6e64 6173 5f64 6174 6166  nce(pandas_dataf
-000083b0: 7261 6d65 2c20 7061 6e64 6173 2e49 6e64  rame, pandas.Ind
-000083c0: 6578 293a 0a20 2020 2020 2020 2020 2020  ex):.           
-000083d0: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-000083e0: 6164 5f70 616e 6461 7328 0a20 2020 2020  ad_pandas(.     
-000083f0: 2020 2020 2020 2020 2020 2070 616e 6461             panda
-00008400: 732e 4461 7461 4672 616d 6528 696e 6465  s.DataFrame(inde
-00008410: 783d 7061 6e64 6173 5f64 6174 6166 7261  x=pandas_datafra
-00008420: 6d65 292c 2022 7265 6164 5f70 616e 6461  me), "read_panda
-00008430: 7322 0a20 2020 2020 2020 2020 2020 2029  s".            )
-00008440: 2e69 6e64 6578 0a20 2020 2020 2020 2069  .index.        i
-00008450: 6620 6973 696e 7374 616e 6365 2870 616e  f isinstance(pan
-00008460: 6461 735f 6461 7461 6672 616d 652c 2070  das_dataframe, p
-00008470: 616e 6461 732e 4461 7461 4672 616d 6529  andas.DataFrame)
-00008480: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00008490: 7475 726e 2073 656c 662e 5f72 6561 645f  turn self._read_
-000084a0: 7061 6e64 6173 2870 616e 6461 735f 6461  pandas(pandas_da
-000084b0: 7461 6672 616d 652c 2022 7265 6164 5f70  taframe, "read_p
-000084c0: 616e 6461 7322 290a 2020 2020 2020 2020  andas").        
-000084d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000084e0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000084f0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00008500: 2020 2020 6622 7265 6164 5f70 616e 6461      f"read_panda
-00008510: 7328 2920 6578 7065 6374 7320 6120 7061  s() expects a pa
-00008520: 6e64 6173 2e44 6174 6146 7261 6d65 2c20  ndas.DataFrame, 
-00008530: 6275 7420 676f 7420 6120 7b74 7970 6528  but got a {type(
-00008540: 7061 6e64 6173 5f64 6174 6166 7261 6d65  pandas_dataframe
-00008550: 297d 220a 2020 2020 2020 2020 2020 2020  )}".            
-00008560: 290a 0a20 2020 2064 6566 205f 7265 6164  )..    def _read
-00008570: 5f70 616e 6461 7328 0a20 2020 2020 2020  _pandas(.       
-00008580: 2073 656c 662c 2070 616e 6461 735f 6461   self, pandas_da
-00008590: 7461 6672 616d 653a 2070 616e 6461 732e  taframe: pandas.
-000085a0: 4461 7461 4672 616d 652c 2061 7069 5f6e  DataFrame, api_n
-000085b0: 616d 653a 2073 7472 0a20 2020 2029 202d  ame: str.    ) -
-000085c0: 3e20 6461 7461 6672 616d 652e 4461 7461  > dataframe.Data
-000085d0: 4672 616d 653a 0a20 2020 2020 2020 2069  Frame:.        i
-000085e0: 6d70 6f72 7420 6269 6766 7261 6d65 732e  mport bigframes.
-000085f0: 6461 7461 6672 616d 6520 6173 2064 6174  dataframe as dat
-00008600: 6166 7261 6d65 0a0a 2020 2020 2020 2020  aframe..        
-00008610: 6966 2069 7369 6e73 7461 6e63 6528 7061  if isinstance(pa
-00008620: 6e64 6173 5f64 6174 6166 7261 6d65 2c20  ndas_dataframe, 
-00008630: 6461 7461 6672 616d 652e 4461 7461 4672  dataframe.DataFr
-00008640: 616d 6529 3a0a 2020 2020 2020 2020 2020  ame):.          
-00008650: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00008660: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00008670: 2020 2020 2272 6561 645f 7061 6e64 6173      "read_pandas
-00008680: 2829 2065 7870 6563 7473 2061 2070 616e  () expects a pan
-00008690: 6461 732e 4461 7461 4672 616d 652c 2062  das.DataFrame, b
-000086a0: 7574 2067 6f74 2061 2022 0a20 2020 2020  ut got a ".     
-000086b0: 2020 2020 2020 2020 2020 2022 6269 6766             "bigf
-000086c0: 7261 6d65 732e 7061 6e64 6173 2e44 6174  rames.pandas.Dat
-000086d0: 6146 7261 6d65 2e22 0a20 2020 2020 2020  aFrame.".       
-000086e0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-000086f0: 696e 6c69 6e65 5f64 6620 3d20 7365 6c66  inline_df = self
-00008700: 2e5f 7265 6164 5f70 616e 6461 735f 696e  ._read_pandas_in
-00008710: 6c69 6e65 2870 616e 6461 735f 6461 7461  line(pandas_data
-00008720: 6672 616d 6529 0a20 2020 2020 2020 2069  frame).        i
-00008730: 6620 696e 6c69 6e65 5f64 6620 6973 206e  f inline_df is n
-00008740: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00008750: 2020 2020 2072 6574 7572 6e20 696e 6c69       return inli
-00008760: 6e65 5f64 660a 2020 2020 2020 2020 7472  ne_df.        tr
-00008770: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-00008780: 6574 7572 6e20 7365 6c66 2e5f 7265 6164  eturn self._read
-00008790: 5f70 616e 6461 735f 6c6f 6164 5f6a 6f62  _pandas_load_job
-000087a0: 2870 616e 6461 735f 6461 7461 6672 616d  (pandas_datafram
-000087b0: 652c 2061 7069 5f6e 616d 6529 0a20 2020  e, api_name).   
-000087c0: 2020 2020 2065 7863 6570 7420 7061 2e41       except pa.A
-000087d0: 7272 6f77 496e 7661 6c69 6420 6173 2065  rrowInvalid as e
-000087e0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000087f0: 6973 6520 7061 2e41 7272 6f77 496e 7661  ise pa.ArrowInva
-00008800: 6c69 6428 0a20 2020 2020 2020 2020 2020  lid(.           
-00008810: 2020 2020 2066 2243 6f75 6c64 206e 6f74       f"Could not
-00008820: 2063 6f6e 7665 7274 2077 6974 6820 6120   convert with a 
-00008830: 4269 6751 7565 7279 2074 7970 653a 2060  BigQuery type: `
-00008840: 7b65 7d60 2e20 220a 2020 2020 2020 2020  {e}`. ".        
-00008850: 2020 2020 2920 6672 6f6d 2065 0a0a 2020      ) from e..  
-00008860: 2020 6465 6620 5f72 6561 645f 7061 6e64    def _read_pand
-00008870: 6173 5f69 6e6c 696e 6528 0a20 2020 2020  as_inline(.     
-00008880: 2020 2073 656c 662c 2070 616e 6461 735f     self, pandas_
-00008890: 6461 7461 6672 616d 653a 2070 616e 6461  dataframe: panda
-000088a0: 732e 4461 7461 4672 616d 650a 2020 2020  s.DataFrame.    
-000088b0: 2920 2d3e 204f 7074 696f 6e61 6c5b 6461  ) -> Optional[da
-000088c0: 7461 6672 616d 652e 4461 7461 4672 616d  taframe.DataFram
-000088d0: 655d 3a0a 2020 2020 2020 2020 696d 706f  e]:.        impo
-000088e0: 7274 2062 6967 6672 616d 6573 2e64 6174  rt bigframes.dat
-000088f0: 6166 7261 6d65 2061 7320 6461 7461 6672  aframe as datafr
-00008900: 616d 650a 0a20 2020 2020 2020 2069 6620  ame..        if 
-00008910: 7061 6e64 6173 5f64 6174 6166 7261 6d65  pandas_dataframe
-00008920: 2e6d 656d 6f72 795f 7573 6167 6528 6465  .memory_usage(de
-00008930: 6570 3d54 7275 6529 2e73 756d 2829 203e  ep=True).sum() >
-00008940: 204d 4158 5f49 4e4c 494e 455f 4446 5f42   MAX_INLINE_DF_B
-00008950: 5954 4553 3a0a 2020 2020 2020 2020 2020  YTES:.          
-00008960: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-00008970: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00008980: 2020 2020 2020 2020 696e 6c69 6e65 5f64          inline_d
-00008990: 6620 3d20 6461 7461 6672 616d 652e 4461  f = dataframe.Da
-000089a0: 7461 4672 616d 6528 0a20 2020 2020 2020  taFrame(.       
-000089b0: 2020 2020 2020 2020 2062 6c6f 636b 732e           blocks.
-000089c0: 426c 6f63 6b2e 6672 6f6d 5f6c 6f63 616c  Block.from_local
-000089d0: 2870 616e 6461 735f 6461 7461 6672 616d  (pandas_datafram
-000089e0: 652c 2073 656c 6629 0a20 2020 2020 2020  e, self).       
-000089f0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-00008a00: 7863 6570 7420 7061 2e41 7272 6f77 496e  xcept pa.ArrowIn
-00008a10: 7661 6c69 6420 6173 2065 3a0a 2020 2020  valid as e:.    
-00008a20: 2020 2020 2020 2020 7261 6973 6520 7061          raise pa
-00008a30: 2e41 7272 6f77 496e 7661 6c69 6428 0a20  .ArrowInvalid(. 
-00008a40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00008a50: 2243 6f75 6c64 206e 6f74 2063 6f6e 7665  "Could not conve
-00008a60: 7274 2077 6974 6820 6120 4269 6751 7565  rt with a BigQue
-00008a70: 7279 2074 7970 653a 2060 7b65 7d60 2e20  ry type: `{e}`. 
-00008a80: 220a 2020 2020 2020 2020 2020 2020 2920  ".            ) 
-00008a90: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-00008aa0: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
-00008ab0: 3a20 2023 2054 6872 6f77 6e20 6279 2069  :  # Thrown by i
-00008ac0: 6269 7320 666f 7220 736f 6d65 2075 6e68  bis for some unh
-00008ad0: 616e 646c 6564 2074 7970 6573 0a20 2020  andled types.   
-00008ae0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00008af0: 4e6f 6e65 0a20 2020 2020 2020 2065 7863  None.        exc
-00008b00: 6570 7420 7061 2e41 7272 6f77 5479 7065  ept pa.ArrowType
-00008b10: 4572 726f 723a 2020 2320 5468 726f 776e  Error:  # Thrown
-00008b20: 2062 7920 6172 726f 7720 666f 7220 7479   by arrow for ty
-00008b30: 7065 7320 7769 7468 6f75 7420 6d61 7070  pes without mapp
-00008b40: 696e 6720 2867 656f 292e 0a20 2020 2020  ing (geo)..     
-00008b50: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00008b60: 6e65 0a0a 2020 2020 2020 2020 696e 6c69  ne..        inli
-00008b70: 6e65 5f74 7970 6573 203d 2069 6e6c 696e  ne_types = inlin
-00008b80: 655f 6466 2e5f 626c 6f63 6b2e 6578 7072  e_df._block.expr
-00008b90: 2e73 6368 656d 612e 6474 7970 6573 0a20  .schema.dtypes. 
-00008ba0: 2020 2020 2020 2023 2049 6269 7320 6861         # Ibis ha
-00008bb0: 7320 7072 6f62 6c65 6d73 2065 7363 6170  s problems escap
-00008bc0: 696e 6720 6279 7465 7320 6c69 7465 7261  ing bytes litera
-00008bd0: 6c73 2c20 7768 6963 6820 7769 6c6c 2063  ls, which will c
-00008be0: 6175 7365 2073 796e 7461 7820 6572 726f  ause syntax erro
-00008bf0: 7273 2073 6572 7665 722d 7369 6465 2e0a  rs server-side..
-00008c00: 2020 2020 2020 2020 6966 2061 6c6c 2864          if all(d
-00008c10: 7479 7065 2069 6e20 494e 4c49 4e41 424c  type in INLINABL
-00008c20: 455f 4454 5950 4553 2066 6f72 2064 7479  E_DTYPES for dty
-00008c30: 7065 2069 6e20 696e 6c69 6e65 5f74 7970  pe in inline_typ
-00008c40: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
-00008c50: 2072 6574 7572 6e20 696e 6c69 6e65 5f64   return inline_d
-00008c60: 660a 2020 2020 2020 2020 7265 7475 726e  f.        return
-00008c70: 204e 6f6e 650a 0a20 2020 2064 6566 205f   None..    def _
-00008c80: 7265 6164 5f70 616e 6461 735f 6c6f 6164  read_pandas_load
-00008c90: 5f6a 6f62 280a 2020 2020 2020 2020 7365  _job(.        se
-00008ca0: 6c66 2c20 7061 6e64 6173 5f64 6174 6166  lf, pandas_dataf
-00008cb0: 7261 6d65 3a20 7061 6e64 6173 2e44 6174  rame: pandas.Dat
-00008cc0: 6146 7261 6d65 2c20 6170 695f 6e61 6d65  aFrame, api_name
-00008cd0: 3a20 7374 720a 2020 2020 2920 2d3e 2064  : str.    ) -> d
-00008ce0: 6174 6166 7261 6d65 2e44 6174 6146 7261  ataframe.DataFra
-00008cf0: 6d65 3a0a 2020 2020 2020 2020 696d 706f  me:.        impo
-00008d00: 7274 2062 6967 6672 616d 6573 2e64 6174  rt bigframes.dat
-00008d10: 6166 7261 6d65 2061 7320 6461 7461 6672  aframe as datafr
-00008d20: 616d 650a 0a20 2020 2020 2020 2063 6f6c  ame..        col
-00008d30: 5f69 6e64 6578 203d 2070 616e 6461 735f  _index = pandas_
-00008d40: 6461 7461 6672 616d 652e 636f 6c75 6d6e  dataframe.column
-00008d50: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
-00008d60: 2063 6f6c 5f6c 6162 656c 732c 2069 6478   col_labels, idx
-00008d70: 5f6c 6162 656c 7320 3d20 280a 2020 2020  _labels = (.    
-00008d80: 2020 2020 2020 2020 636f 6c5f 696e 6465          col_inde
-00008d90: 782e 746f 5f6c 6973 7428 292c 0a20 2020  x.to_list(),.   
-00008da0: 2020 2020 2020 2020 2070 616e 6461 735f           pandas_
-00008db0: 6461 7461 6672 616d 652e 696e 6465 782e  dataframe.index.
-00008dc0: 6e61 6d65 732c 0a20 2020 2020 2020 2029  names,.        )
-00008dd0: 0a20 2020 2020 2020 206e 6577 5f63 6f6c  .        new_col
-00008de0: 5f69 6473 2c20 6e65 775f 6964 785f 6964  _ids, new_idx_id
-00008df0: 7320 3d20 7574 696c 732e 6765 745f 7374  s = utils.get_st
-00008e00: 616e 6461 7264 697a 6564 5f69 6473 280a  andardized_ids(.
-00008e10: 2020 2020 2020 2020 2020 2020 636f 6c5f              col_
-00008e20: 6c61 6265 6c73 2c0a 2020 2020 2020 2020  labels,.        
-00008e30: 2020 2020 6964 785f 6c61 6265 6c73 2c0a      idx_labels,.
-00008e40: 2020 2020 2020 2020 2020 2020 2320 4c6f              # Lo
-00008e50: 6164 696e 6720 7061 7271 7565 7420 6669  ading parquet fi
-00008e60: 6c65 7320 696e 746f 2042 6967 5175 6572  les into BigQuer
-00008e70: 7920 7769 7468 2073 7065 6369 616c 2063  y with special c
-00008e80: 6f6c 756d 6e20 6e61 6d65 730a 2020 2020  olumn names.    
-00008e90: 2020 2020 2020 2020 2320 6973 206f 6e6c          # is onl
-00008ea0: 7920 7375 7070 6f72 7465 6420 756e 6465  y supported unde
-00008eb0: 7220 616e 2061 6c6c 6f77 6c69 7374 2e0a  r an allowlist..
-00008ec0: 2020 2020 2020 2020 2020 2020 7374 7269              stri
-00008ed0: 6374 3d54 7275 652c 0a20 2020 2020 2020  ct=True,.       
-00008ee0: 2029 0a0a 2020 2020 2020 2020 2320 4164   )..        # Ad
-00008ef0: 6420 6f72 6465 7220 636f 6c75 6d6e 2074  d order column t
-00008f00: 6f20 7061 6e64 6173 2044 6174 6146 7261  o pandas DataFra
-00008f10: 6d65 2074 6f20 7072 6573 6572 7665 206f  me to preserve o
-00008f20: 7264 6572 2069 6e20 4269 6751 7565 7279  rder in BigQuery
-00008f30: 0a20 2020 2020 2020 206f 7264 6572 696e  .        orderin
-00008f40: 675f 636f 6c20 3d20 2272 6f77 6964 220a  g_col = "rowid".
-00008f50: 2020 2020 2020 2020 636f 6c75 6d6e 7320          columns 
-00008f60: 3d20 6672 6f7a 656e 7365 7428 636f 6c5f  = frozenset(col_
-00008f70: 6c61 6265 6c73 202b 2069 6478 5f6c 6162  labels + idx_lab
-00008f80: 656c 7329 0a20 2020 2020 2020 2073 7566  els).        suf
-00008f90: 6669 7820 3d20 320a 2020 2020 2020 2020  fix = 2.        
-00008fa0: 7768 696c 6520 6f72 6465 7269 6e67 5f63  while ordering_c
-00008fb0: 6f6c 2069 6e20 636f 6c75 6d6e 733a 0a20  ol in columns:. 
-00008fc0: 2020 2020 2020 2020 2020 206f 7264 6572             order
-00008fd0: 696e 675f 636f 6c20 3d20 6622 726f 7769  ing_col = f"rowi
-00008fe0: 645f 7b73 7566 6669 787d 220a 2020 2020  d_{suffix}".    
-00008ff0: 2020 2020 2020 2020 7375 6666 6978 202b          suffix +
-00009000: 3d20 310a 0a20 2020 2020 2020 2070 616e  = 1..        pan
-00009010: 6461 735f 6461 7461 6672 616d 655f 636f  das_dataframe_co
-00009020: 7079 203d 2070 616e 6461 735f 6461 7461  py = pandas_data
-00009030: 6672 616d 652e 636f 7079 2829 0a20 2020  frame.copy().   
-00009040: 2020 2020 2070 616e 6461 735f 6461 7461       pandas_data
-00009050: 6672 616d 655f 636f 7079 2e69 6e64 6578  frame_copy.index
-00009060: 2e6e 616d 6573 203d 206e 6577 5f69 6478  .names = new_idx
-00009070: 5f69 6473 0a20 2020 2020 2020 2070 616e  _ids.        pan
-00009080: 6461 735f 6461 7461 6672 616d 655f 636f  das_dataframe_co
-00009090: 7079 2e63 6f6c 756d 6e73 203d 2070 616e  py.columns = pan
-000090a0: 6461 732e 496e 6465 7828 6e65 775f 636f  das.Index(new_co
-000090b0: 6c5f 6964 7329 0a20 2020 2020 2020 2070  l_ids).        p
-000090c0: 616e 6461 735f 6461 7461 6672 616d 655f  andas_dataframe_
-000090d0: 636f 7079 5b6f 7264 6572 696e 675f 636f  copy[ordering_co
-000090e0: 6c5d 203d 206e 702e 6172 616e 6765 2870  l] = np.arange(p
-000090f0: 616e 6461 735f 6461 7461 6672 616d 655f  andas_dataframe_
-00009100: 636f 7079 2e73 6861 7065 5b30 5d29 0a0a  copy.shape[0])..
-00009110: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
-00009120: 6967 203d 2073 656c 662e 5f70 7265 7061  ig = self._prepa
-00009130: 7265 5f6c 6f61 645f 6a6f 625f 636f 6e66  re_load_job_conf
-00009140: 6967 2829 0a0a 2020 2020 2020 2020 2320  ig()..        # 
-00009150: 5370 6563 6966 7920 7468 6520 6461 7465  Specify the date
-00009160: 7469 6d65 2064 7479 7065 732c 2077 6869  time dtypes, whi
-00009170: 6368 2069 7320 6175 746f 2d64 6574 6563  ch is auto-detec
-00009180: 7465 6420 6173 2074 696d 6573 7461 6d70  ted as timestamp
-00009190: 2074 7970 6573 2e0a 2020 2020 2020 2020   types..        
-000091a0: 7363 6865 6d61 3a20 6c69 7374 5b62 6967  schema: list[big
-000091b0: 7175 6572 792e 5363 6865 6d61 4669 656c  query.SchemaFiel
-000091c0: 645d 203d 205b 5d0a 2020 2020 2020 2020  d] = [].        
-000091d0: 666f 7220 636f 6c75 6d6e 2c20 6474 7970  for column, dtyp
-000091e0: 6520 696e 207a 6970 286e 6577 5f63 6f6c  e in zip(new_col
-000091f0: 5f69 6473 2c20 7061 6e64 6173 5f64 6174  _ids, pandas_dat
-00009200: 6166 7261 6d65 2e64 7479 7065 7329 3a0a  aframe.dtypes):.
-00009210: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00009220: 7479 7065 203d 3d20 2274 696d 6573 7461  type == "timesta
-00009230: 6d70 5b75 735d 5b70 7961 7272 6f77 5d22  mp[us][pyarrow]"
-00009240: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009250: 2020 7363 6865 6d61 2e61 7070 656e 6428    schema.append(
-00009260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009270: 2020 2020 2062 6967 7175 6572 792e 5363       bigquery.Sc
-00009280: 6865 6d61 4669 656c 6428 636f 6c75 6d6e  hemaField(column
-00009290: 2c20 6269 6771 7565 7279 2e65 6e75 6d73  , bigquery.enums
-000092a0: 2e53 716c 5479 7065 4e61 6d65 732e 4441  .SqlTypeNames.DA
-000092b0: 5445 5449 4d45 290a 2020 2020 2020 2020  TETIME).        
-000092c0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000092d0: 2020 6a6f 625f 636f 6e66 6967 2e73 6368    job_config.sch
-000092e0: 656d 6120 3d20 7363 6865 6d61 0a0a 2020  ema = schema..  
-000092f0: 2020 2020 2020 2320 436c 7573 7465 7269        # Clusteri
-00009300: 6e67 2070 726f 6261 626c 7920 6e6f 7420  ng probably not 
-00009310: 6e65 6564 6564 2061 6e79 7761 7973 2061  needed anyways a
-00009320: 7320 7061 6e64 6173 2074 6162 6c65 7320  s pandas tables 
-00009330: 6172 6520 736d 616c 6c0a 2020 2020 2020  are small.      
-00009340: 2020 636c 7573 7465 725f 636f 6c73 203d    cluster_cols =
-00009350: 205b 6f72 6465 7269 6e67 5f63 6f6c 5d0a   [ordering_col].
-00009360: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
-00009370: 6967 2e63 6c75 7374 6572 696e 675f 6669  ig.clustering_fi
-00009380: 656c 6473 203d 2063 6c75 7374 6572 5f63  elds = cluster_c
-00009390: 6f6c 730a 0a20 2020 2020 2020 206a 6f62  ols..        job
-000093a0: 5f63 6f6e 6669 672e 6c61 6265 6c73 203d  _config.labels =
-000093b0: 207b 2262 6967 6672 616d 6573 2d61 7069   {"bigframes-api
-000093c0: 223a 2061 7069 5f6e 616d 657d 0a0a 2020  ": api_name}..  
-000093d0: 2020 2020 2020 6c6f 6164 5f74 6162 6c65        load_table
-000093e0: 5f64 6573 7469 6e61 7469 6f6e 203d 2073  _destination = s
-000093f0: 656c 662e 5f72 616e 646f 6d5f 7461 626c  elf._random_tabl
-00009400: 6528 290a 2020 2020 2020 2020 6c6f 6164  e().        load
-00009410: 5f6a 6f62 203d 2073 656c 662e 6271 636c  _job = self.bqcl
-00009420: 6965 6e74 2e6c 6f61 645f 7461 626c 655f  ient.load_table_
-00009430: 6672 6f6d 5f64 6174 6166 7261 6d65 280a  from_dataframe(.
-00009440: 2020 2020 2020 2020 2020 2020 7061 6e64              pand
-00009450: 6173 5f64 6174 6166 7261 6d65 5f63 6f70  as_dataframe_cop
-00009460: 792c 0a20 2020 2020 2020 2020 2020 206c  y,.            l
-00009470: 6f61 645f 7461 626c 655f 6465 7374 696e  oad_table_destin
-00009480: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
-00009490: 2020 206a 6f62 5f63 6f6e 6669 673d 6a6f     job_config=jo
-000094a0: 625f 636f 6e66 6967 2c0a 2020 2020 2020  b_config,.      
-000094b0: 2020 290a 2020 2020 2020 2020 7365 6c66    ).        self
-000094c0: 2e5f 7374 6172 745f 6765 6e65 7269 635f  ._start_generic_
-000094d0: 6a6f 6228 6c6f 6164 5f6a 6f62 290a 0a20  job(load_job).. 
-000094e0: 2020 2020 2020 206f 7264 6572 696e 6720         ordering 
-000094f0: 3d20 6f72 6465 722e 4578 7072 6573 7369  = order.Expressi
-00009500: 6f6e 4f72 6465 7269 6e67 280a 2020 2020  onOrdering(.    
-00009510: 2020 2020 2020 2020 6f72 6465 7269 6e67          ordering
-00009520: 5f76 616c 7565 5f63 6f6c 756d 6e73 3d74  _value_columns=t
-00009530: 7570 6c65 285b 6f72 6465 722e 6173 6365  uple([order.asce
-00009540: 6e64 696e 675f 6f76 6572 286f 7264 6572  nding_over(order
-00009550: 696e 675f 636f 6c29 5d29 2c0a 2020 2020  ing_col)]),.    
-00009560: 2020 2020 2020 2020 746f 7461 6c5f 6f72          total_or
-00009570: 6465 7269 6e67 5f63 6f6c 756d 6e73 3d66  dering_columns=f
-00009580: 726f 7a65 6e73 6574 285b 6f72 6465 7269  rozenset([orderi
-00009590: 6e67 5f63 6f6c 5d29 2c0a 2020 2020 2020  ng_col]),.      
-000095a0: 2020 2020 2020 696e 7465 6765 725f 656e        integer_en
-000095b0: 636f 6469 6e67 3d49 6e74 6567 6572 456e  coding=IntegerEn
-000095c0: 636f 6469 6e67 2854 7275 652c 2069 735f  coding(True, is_
-000095d0: 7365 7175 656e 7469 616c 3d54 7275 6529  sequential=True)
-000095e0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-000095f0: 2020 2020 7461 626c 655f 6578 7072 6573      table_expres
-00009600: 7369 6f6e 203d 2073 656c 662e 6962 6973  sion = self.ibis
-00009610: 5f63 6c69 656e 742e 7461 626c 6528 2020  _client.table(  
-00009620: 2320 7479 7065 3a20 6967 6e6f 7265 0a20  # type: ignore. 
-00009630: 2020 2020 2020 2020 2020 206c 6f61 645f             load_
-00009640: 7461 626c 655f 6465 7374 696e 6174 696f  table_destinatio
-00009650: 6e2e 7461 626c 655f 6964 2c0a 2020 2020  n.table_id,.    
-00009660: 2020 2020 2020 2020 7363 6865 6d61 3d6c          schema=l
-00009670: 6f61 645f 7461 626c 655f 6465 7374 696e  oad_table_destin
-00009680: 6174 696f 6e2e 6461 7461 7365 745f 6964  ation.dataset_id
-00009690: 2c0a 2020 2020 2020 2020 2020 2020 6461  ,.            da
-000096a0: 7461 6261 7365 3d6c 6f61 645f 7461 626c  tabase=load_tabl
-000096b0: 655f 6465 7374 696e 6174 696f 6e2e 7072  e_destination.pr
-000096c0: 6f6a 6563 742c 0a20 2020 2020 2020 2029  oject,.        )
-000096d0: 0a0a 2020 2020 2020 2020 2320 622f 3239  ..        # b/29
-000096e0: 3735 3930 3137 3820 506f 7465 6e74 6961  7590178 Potentia
-000096f0: 6c6c 7920 6120 6275 6720 696e 2062 7163  lly a bug in bqc
-00009700: 6c69 656e 742e 6c6f 6164 5f74 6162 6c65  lient.load_table
-00009710: 5f66 726f 6d5f 6461 7461 6672 616d 6528  _from_dataframe(
-00009720: 292c 2074 6861 7420 6f6e 6c79 2077 6865  ), that only whe
-00009730: 6e20 7468 6520 4446 2069 7320 656d 7074  n the DF is empt
-00009740: 792c 2074 6865 2069 6e64 6578 2063 6f6c  y, the index col
-00009750: 756d 6e73 2064 6973 6170 7065 6172 2069  umns disappear i
-00009760: 6e20 7461 626c 655f 6578 7072 6573 7369  n table_expressi
-00009770: 6f6e 2e0a 2020 2020 2020 2020 6966 2061  on..        if a
-00009780: 6e79 280a 2020 2020 2020 2020 2020 2020  ny(.            
-00009790: 5b6e 6577 5f69 6478 5f69 6420 6e6f 7420  [new_idx_id not 
-000097a0: 696e 2074 6162 6c65 5f65 7870 7265 7373  in table_express
-000097b0: 696f 6e2e 636f 6c75 6d6e 7320 666f 7220  ion.columns for 
-000097c0: 6e65 775f 6964 785f 6964 2069 6e20 6e65  new_idx_id in ne
-000097d0: 775f 6964 785f 6964 735d 0a20 2020 2020  w_idx_ids].     
-000097e0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-000097f0: 2020 6e65 775f 6964 785f 6964 732c 2069    new_idx_ids, i
-00009800: 6478 5f6c 6162 656c 7320 3d20 5b5d 2c20  dx_labels = [], 
-00009810: 5b5d 0a0a 2020 2020 2020 2020 636f 6c75  []..        colu
-00009820: 6d6e 5f76 616c 7565 7320 3d20 5b0a 2020  mn_values = [.  
-00009830: 2020 2020 2020 2020 2020 7461 626c 655f            table_
-00009840: 6578 7072 6573 7369 6f6e 5b63 6f6c 5d0a  expression[col].
-00009850: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00009860: 636f 6c20 696e 2074 6162 6c65 5f65 7870  col in table_exp
-00009870: 7265 7373 696f 6e2e 636f 6c75 6d6e 730a  ression.columns.
-00009880: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00009890: 6f6c 2021 3d20 6f72 6465 7269 6e67 5f63  ol != ordering_c
-000098a0: 6f6c 0a20 2020 2020 2020 205d 0a20 2020  ol.        ].   
-000098b0: 2020 2020 2061 7272 6179 5f76 616c 7565       array_value
-000098c0: 203d 2063 6f72 652e 4172 7261 7956 616c   = core.ArrayVal
-000098d0: 7565 2e66 726f 6d5f 6962 6973 280a 2020  ue.from_ibis(.  
-000098e0: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
-000098f0: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-00009900: 655f 6578 7072 6573 7369 6f6e 2c0a 2020  e_expression,.  
-00009910: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00009920: 733d 636f 6c75 6d6e 5f76 616c 7565 732c  s=column_values,
-00009930: 0a20 2020 2020 2020 2020 2020 2068 6964  .            hid
-00009940: 6465 6e5f 6f72 6465 7269 6e67 5f63 6f6c  den_ordering_col
-00009950: 756d 6e73 3d5b 7461 626c 655f 6578 7072  umns=[table_expr
-00009960: 6573 7369 6f6e 5b6f 7264 6572 696e 675f  ession[ordering_
-00009970: 636f 6c5d 5d2c 0a20 2020 2020 2020 2020  col]],.         
-00009980: 2020 206f 7264 6572 696e 673d 6f72 6465     ordering=orde
-00009990: 7269 6e67 2c0a 2020 2020 2020 2020 290a  ring,.        ).
-000099a0: 0a20 2020 2020 2020 2062 6c6f 636b 203d  .        block =
-000099b0: 2062 6c6f 636b 732e 426c 6f63 6b28 0a20   blocks.Block(. 
-000099c0: 2020 2020 2020 2020 2020 2061 7272 6179             array
-000099d0: 5f76 616c 7565 2c0a 2020 2020 2020 2020  _value,.        
-000099e0: 2020 2020 696e 6465 785f 636f 6c75 6d6e      index_column
-000099f0: 733d 6e65 775f 6964 785f 6964 732c 0a20  s=new_idx_ids,. 
-00009a00: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-00009a10: 6e5f 6c61 6265 6c73 3d63 6f6c 5f69 6e64  n_labels=col_ind
-00009a20: 6578 2c0a 2020 2020 2020 2020 2020 2020  ex,.            
-00009a30: 696e 6465 785f 6c61 6265 6c73 3d69 6478  index_labels=idx
-00009a40: 5f6c 6162 656c 732c 0a20 2020 2020 2020  _labels,.       
-00009a50: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-00009a60: 6e20 6461 7461 6672 616d 652e 4461 7461  n dataframe.Data
-00009a70: 4672 616d 6528 626c 6f63 6b29 0a0a 2020  Frame(block)..  
-00009a80: 2020 6465 6620 7265 6164 5f63 7376 280a    def read_csv(.
-00009a90: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00009aa0: 2020 2020 2020 6669 6c65 7061 7468 5f6f        filepath_o
-00009ab0: 725f 6275 6666 6572 3a20 7374 7220 7c20  r_buffer: str | 
-00009ac0: 494f 5b22 6279 7465 7322 5d2c 0a20 2020  IO["bytes"],.   
-00009ad0: 2020 2020 202a 2c0a 2020 2020 2020 2020       *,.        
-00009ae0: 7365 703a 204f 7074 696f 6e61 6c5b 7374  sep: Optional[st
-00009af0: 725d 203d 2022 2c22 2c0a 2020 2020 2020  r] = ",",.      
-00009b00: 2020 6865 6164 6572 3a20 4f70 7469 6f6e    header: Option
-00009b10: 616c 5b69 6e74 5d20 3d20 302c 0a20 2020  al[int] = 0,.   
-00009b20: 2020 2020 206e 616d 6573 3a20 4f70 7469       names: Opti
-00009b30: 6f6e 616c 5b0a 2020 2020 2020 2020 2020  onal[.          
-00009b40: 2020 556e 696f 6e5b 4d75 7461 626c 6553    Union[MutableS
-00009b50: 6571 7565 6e63 655b 416e 795d 2c20 6e70  equence[Any], np
-00009b60: 2e6e 6461 7272 6179 5b41 6e79 2c20 416e  .ndarray[Any, An
-00009b70: 795d 2c20 5475 706c 655b 416e 792c 202e  y], Tuple[Any, .
-00009b80: 2e2e 5d2c 2072 616e 6765 5d0a 2020 2020  ..], range].    
-00009b90: 2020 2020 5d20 3d20 4e6f 6e65 2c0a 2020      ] = None,.  
-00009ba0: 2020 2020 2020 696e 6465 785f 636f 6c3a        index_col:
-00009bb0: 204f 7074 696f 6e61 6c5b 0a20 2020 2020   Optional[.     
-00009bc0: 2020 2020 2020 2055 6e69 6f6e 5b0a 2020         Union[.  
-00009bd0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00009be0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00009bf0: 2020 2073 7472 2c0a 2020 2020 2020 2020     str,.        
-00009c00: 2020 2020 2020 2020 5365 7175 656e 6365          Sequence
-00009c10: 5b55 6e69 6f6e 5b73 7472 2c20 696e 745d  [Union[str, int]
-00009c20: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00009c30: 2020 2062 6967 6672 616d 6573 2e65 6e75     bigframes.enu
-00009c40: 6d73 2e44 6566 6175 6c74 496e 6465 784b  ms.DefaultIndexK
-00009c50: 696e 642c 0a20 2020 2020 2020 2020 2020  ind,.           
-00009c60: 2020 2020 204c 6974 6572 616c 5b46 616c       Literal[Fal
-00009c70: 7365 5d2c 0a20 2020 2020 2020 2020 2020  se],.           
-00009c80: 205d 0a20 2020 2020 2020 205d 203d 204e   ].        ] = N
-00009c90: 6f6e 652c 0a20 2020 2020 2020 2075 7365  one,.        use
-00009ca0: 636f 6c73 3a20 4f70 7469 6f6e 616c 5b0a  cols: Optional[.
-00009cb0: 2020 2020 2020 2020 2020 2020 556e 696f              Unio
-00009cc0: 6e5b 0a20 2020 2020 2020 2020 2020 2020  n[.             
-00009cd0: 2020 204d 7574 6162 6c65 5365 7175 656e     MutableSequen
-00009ce0: 6365 5b73 7472 5d2c 0a20 2020 2020 2020  ce[str],.       
-00009cf0: 2020 2020 2020 2020 2054 7570 6c65 5b73           Tuple[s
-00009d00: 7472 2c20 2e2e 2e5d 2c0a 2020 2020 2020  tr, ...],.      
-00009d10: 2020 2020 2020 2020 2020 5365 7175 656e            Sequen
-00009d20: 6365 5b69 6e74 5d2c 0a20 2020 2020 2020  ce[int],.       
-00009d30: 2020 2020 2020 2020 2070 616e 6461 732e           pandas.
-00009d40: 5365 7269 6573 2c0a 2020 2020 2020 2020  Series,.        
-00009d50: 2020 2020 2020 2020 7061 6e64 6173 2e49          pandas.I
-00009d60: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
-00009d70: 2020 2020 2020 6e70 2e6e 6461 7272 6179        np.ndarray
-00009d80: 5b41 6e79 2c20 416e 795d 2c0a 2020 2020  [Any, Any],.    
-00009d90: 2020 2020 2020 2020 2020 2020 4361 6c6c              Call
-00009da0: 6162 6c65 5b5b 416e 795d 2c20 626f 6f6c  able[[Any], bool
-00009db0: 5d2c 0a20 2020 2020 2020 2020 2020 205d  ],.            ]
-00009dc0: 0a20 2020 2020 2020 205d 203d 204e 6f6e  .        ] = Non
-00009dd0: 652c 0a20 2020 2020 2020 2064 7479 7065  e,.        dtype
-00009de0: 3a20 4f70 7469 6f6e 616c 5b44 6963 745d  : Optional[Dict]
-00009df0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00009e00: 2065 6e67 696e 653a 204f 7074 696f 6e61   engine: Optiona
-00009e10: 6c5b 0a20 2020 2020 2020 2020 2020 204c  l[.            L
-00009e20: 6974 6572 616c 5b22 6322 2c20 2270 7974  iteral["c", "pyt
-00009e30: 686f 6e22 2c20 2270 7961 7272 6f77 222c  hon", "pyarrow",
-00009e40: 2022 7079 7468 6f6e 2d66 7766 222c 2022   "python-fwf", "
-00009e50: 6269 6771 7565 7279 225d 0a20 2020 2020  bigquery"].     
-00009e60: 2020 205d 203d 204e 6f6e 652c 0a20 2020     ] = None,.   
-00009e70: 2020 2020 2065 6e63 6f64 696e 673a 204f       encoding: O
-00009e80: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-00009e90: 6f6e 652c 0a20 2020 2020 2020 202a 2a6b  one,.        **k
-00009ea0: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
-00009eb0: 6461 7461 6672 616d 652e 4461 7461 4672  dataframe.DataFr
-00009ec0: 616d 653a 0a20 2020 2020 2020 2074 6162  ame:.        tab
-00009ed0: 6c65 203d 2073 656c 662e 5f72 616e 646f  le = self._rando
-00009ee0: 6d5f 7461 626c 6528 290a 0a20 2020 2020  m_table()..     
-00009ef0: 2020 2069 6620 656e 6769 6e65 2069 7320     if engine is 
-00009f00: 6e6f 7420 4e6f 6e65 2061 6e64 2065 6e67  not None and eng
-00009f10: 696e 6520 3d3d 2022 6269 6771 7565 7279  ine == "bigquery
-00009f20: 223a 0a20 2020 2020 2020 2020 2020 2069  ":.            i
-00009f30: 6620 616e 7928 7061 7261 6d20 6973 206e  f any(param is n
-00009f40: 6f74 204e 6f6e 6520 666f 7220 7061 7261  ot None for para
-00009f50: 6d20 696e 2028 6474 7970 652c 206e 616d  m in (dtype, nam
-00009f60: 6573 2929 3a0a 2020 2020 2020 2020 2020  es)):.          
-00009f70: 2020 2020 2020 6e6f 745f 7375 7070 6f72        not_suppor
-00009f80: 7465 6420 3d20 2822 6474 7970 6522 2c20  ted = ("dtype", 
-00009f90: 226e 616d 6573 2229 0a20 2020 2020 2020  "names").       
-00009fa0: 2020 2020 2020 2020 2072 6169 7365 204e           raise N
-00009fb0: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-00009fc0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00009fd0: 2020 2020 2020 2020 6622 4269 6751 7565          f"BigQue
-00009fe0: 7279 2065 6e67 696e 6520 646f 6573 206e  ry engine does n
-00009ff0: 6f74 2073 7570 706f 7274 2074 6865 7365  ot support these
-0000a000: 2061 7267 756d 656e 7473 3a20 7b6e 6f74   arguments: {not
-0000a010: 5f73 7570 706f 7274 6564 7d2e 2022 0a20  _supported}. ". 
-0000a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a030: 2020 2066 227b 636f 6e73 7461 6e74 732e     f"{constants.
-0000a040: 4645 4544 4241 434b 5f4c 494e 4b7d 220a  FEEDBACK_LINK}".
-0000a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a060: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0000a070: 2054 4f44 4f28 622f 3333 3830 3839 3635   TODO(b/33808965
-0000a080: 3929 3a20 4c6f 6f6b 7320 6c69 6b65 2077  9): Looks like w
-0000a090: 6520 6361 6e20 7265 6c61 7820 7468 6973  e can relax this
-0000a0a0: 2031 2063 6f6c 756d 6e0a 2020 2020 2020   1 column.      
-0000a0b0: 2020 2020 2020 2320 7265 7374 7269 6374        # restrict
-0000a0c0: 696f 6e20 6966 2077 6520 6368 6563 6b20  ion if we check 
-0000a0d0: 7468 6520 636f 6e74 656e 7473 206f 6620  the contents of 
-0000a0e0: 616e 2069 7465 7261 626c 6520 6172 6520  an iterable are 
-0000a0f0: 7374 7269 6e67 730a 2020 2020 2020 2020  strings.        
-0000a100: 2020 2020 2320 6e6f 7420 696e 7465 6765      # not intege
-0000a110: 7273 2e0a 2020 2020 2020 2020 2020 2020  rs..            
-0000a120: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-0000a130: 2020 2020 2023 2045 6d70 7479 2074 7570       # Empty tup
-0000a140: 6c65 732c 204e 6f6e 652c 2061 6e64 2046  les, None, and F
-0000a150: 616c 7365 2061 7265 2061 6c6c 6f77 6564  alse are allowed
-0000a160: 2061 6e64 2066 616c 7365 792e 0a20 2020   and falsey..   
-0000a170: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-0000a180: 6578 5f63 6f6c 0a20 2020 2020 2020 2020  ex_col.         
-0000a190: 2020 2020 2020 2061 6e64 206e 6f74 2069         and not i
-0000a1a0: 7369 6e73 7461 6e63 6528 696e 6465 785f  sinstance(index_
-0000a1b0: 636f 6c2c 2062 6967 6672 616d 6573 2e65  col, bigframes.e
-0000a1c0: 6e75 6d73 2e44 6566 6175 6c74 496e 6465  nums.DefaultInde
-0000a1d0: 784b 696e 6429 0a20 2020 2020 2020 2020  xKind).         
-0000a1e0: 2020 2020 2020 2061 6e64 206e 6f74 2069         and not i
-0000a1f0: 7369 6e73 7461 6e63 6528 696e 6465 785f  sinstance(index_
-0000a200: 636f 6c2c 2073 7472 290a 2020 2020 2020  col, str).      
-0000a210: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-0000a220: 2020 2020 2020 2020 2072 6169 7365 204e           raise N
-0000a230: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-0000a240: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000a250: 2020 2020 2020 2020 2242 6967 5175 6572          "BigQuer
-0000a260: 7920 656e 6769 6e65 206f 6e6c 7920 7375  y engine only su
-0000a270: 7070 6f72 7473 2061 2073 696e 676c 6520  pports a single 
-0000a280: 636f 6c75 6d6e 206e 616d 6520 666f 7220  column name for 
-0000a290: 6069 6e64 6578 5f63 6f6c 602c 2022 0a20  `index_col`, ". 
-0000a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2b0: 2020 2066 2267 6f74 3a20 7b72 6570 7228     f"got: {repr(
-0000a2c0: 696e 6465 785f 636f 6c29 7d2e 207b 636f  index_col)}. {co
-0000a2d0: 6e73 7461 6e74 732e 4645 4544 4241 434b  nstants.FEEDBACK
-0000a2e0: 5f4c 494e 4b7d 220a 2020 2020 2020 2020  _LINK}".        
-0000a2f0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0000a300: 2020 2020 2020 2023 204e 6f6e 6520 616e         # None an
-0000a310: 6420 4661 6c73 6520 6361 6e6e 6f74 2062  d False cannot b
-0000a320: 6520 7061 7373 6564 2074 6f20 7265 6164  e passed to read
-0000a330: 5f67 6271 2e0a 2020 2020 2020 2020 2020  _gbq..          
-0000a340: 2020 2320 544f 444f 2862 2f33 3338 3430    # TODO(b/33840
-0000a350: 3031 3333 293a 2057 6865 6e20 696e 6465  0133): When inde
-0000a360: 785f 636f 6c20 6973 204e 6f6e 652c 2077  x_col is None, w
-0000a370: 6520 7368 6f75 6c64 2062 6520 7573 696e  e should be usin
-0000a380: 6720 7468 650a 2020 2020 2020 2020 2020  g the.          
-0000a390: 2020 2320 6669 7273 7420 636f 6c75 6d6e    # first column
-0000a3a0: 206f 6620 7468 6520 4353 5620 6173 2074   of the CSV as t
-0000a3b0: 6865 2069 6e64 6578 2074 6f20 6265 2063  he index to be c
-0000a3c0: 6f6d 7061 7469 626c 6520 7769 7468 2074  ompatible with t
-0000a3d0: 6865 0a20 2020 2020 2020 2020 2020 2023  he.            #
-0000a3e0: 2070 616e 6461 7320 656e 6769 6e65 2e20   pandas engine. 
-0000a3f0: 4163 636f 7264 696e 6720 746f 2074 6865  According to the
-0000a400: 2070 616e 6461 7320 646f 6373 2c20 6f6e   pandas docs, on
-0000a410: 6c79 2022 4661 6c73 6522 0a20 2020 2020  ly "False".     
-0000a420: 2020 2020 2020 2023 2069 6e64 6963 6174         # indicat
-0000a430: 6573 2061 2064 6566 6175 6c74 2073 6571  es a default seq
-0000a440: 7565 6e74 6961 6c20 696e 6465 782e 0a20  uential index.. 
-0000a450: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000a460: 7420 696e 6465 785f 636f 6c3a 0a20 2020  t index_col:.   
-0000a470: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-0000a480: 6578 5f63 6f6c 203d 2028 290a 0a20 2020  ex_col = ()..   
-0000a490: 2020 2020 2020 2020 2069 6e64 6578 5f63           index_c
-0000a4a0: 6f6c 203d 2074 7970 696e 672e 6361 7374  ol = typing.cast
-0000a4b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000a4c0: 2020 556e 696f 6e5b 0a20 2020 2020 2020    Union[.       
-0000a4d0: 2020 2020 2020 2020 2020 2020 2053 6571               Seq
-0000a4e0: 7565 6e63 655b 7374 725d 2c20 2023 2046  uence[str],  # F
-0000a4f0: 616c 7365 7920 7661 6c75 6573 0a20 2020  alsey values.   
-0000a500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a510: 2062 6967 6672 616d 6573 2e65 6e75 6d73   bigframes.enums
-0000a520: 2e44 6566 6175 6c74 496e 6465 784b 696e  .DefaultIndexKin
-0000a530: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-0000a540: 2020 2020 2020 2073 7472 2c0a 2020 2020         str,.    
-0000a550: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
-0000a560: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000a570: 6e64 6578 5f63 6f6c 2c0a 2020 2020 2020  ndex_col,.      
-0000a580: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000a590: 2020 2020 2023 2075 7365 636f 6c73 2073       # usecols s
-0000a5a0: 686f 756c 6420 6f6e 6c79 2062 6520 616e  hould only be an
-0000a5b0: 2069 7465 7261 626c 6520 6f66 2073 7472   iterable of str
-0000a5c0: 696e 6773 2028 636f 6c75 6d6e 206e 616d  ings (column nam
-0000a5d0: 6573 2920 666f 7220 7573 6520 6173 2063  es) for use as c
-0000a5e0: 6f6c 756d 6e73 2069 6e20 7265 6164 5f67  olumns in read_g
-0000a5f0: 6271 2e0a 2020 2020 2020 2020 2020 2020  bq..            
-0000a600: 636f 6c75 6d6e 733a 2054 7570 6c65 5b41  columns: Tuple[A
-0000a610: 6e79 2c20 2e2e 2e5d 203d 2074 7570 6c65  ny, ...] = tuple
-0000a620: 2829 0a20 2020 2020 2020 2020 2020 2069  ().            i
-0000a630: 6620 7573 6563 6f6c 7320 6973 206e 6f74  f usecols is not
-0000a640: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000a650: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0000a660: 616e 6365 2875 7365 636f 6c73 2c20 4974  ance(usecols, It
-0000a670: 6572 6162 6c65 2920 616e 6420 616c 6c28  erable) and all(
-0000a680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a690: 2020 2020 2069 7369 6e73 7461 6e63 6528       isinstance(
-0000a6a0: 636f 6c2c 2073 7472 2920 666f 7220 636f  col, str) for co
-0000a6b0: 6c20 696e 2075 7365 636f 6c73 0a20 2020  l in usecols.   
-0000a6c0: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-0000a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6e0: 2020 2020 636f 6c75 6d6e 7320 3d20 7475      columns = tu
-0000a6f0: 706c 6528 636f 6c20 666f 7220 636f 6c20  ple(col for col 
-0000a700: 696e 2075 7365 636f 6c73 290a 2020 2020  in usecols).    
-0000a710: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000a720: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a730: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
-0000a740: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
-0000a750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a760: 2020 2020 2020 2020 2022 4269 6751 7565           "BigQue
-0000a770: 7279 2065 6e67 696e 6520 6f6e 6c79 2073  ry engine only s
-0000a780: 7570 706f 7274 7320 616e 2069 7465 7261  upports an itera
-0000a790: 626c 6520 6f66 2073 7472 696e 6773 2066  ble of strings f
-0000a7a0: 6f72 2060 7573 6563 6f6c 7360 2e20 220a  or `usecols`. ".
-0000a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7c0: 2020 2020 2020 2020 6622 7b63 6f6e 7374          f"{const
-0000a7d0: 616e 7473 2e46 4545 4442 4143 4b5f 4c49  ants.FEEDBACK_LI
-0000a7e0: 4e4b 7d22 0a20 2020 2020 2020 2020 2020  NK}".           
-0000a7f0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0000a800: 2020 2020 2020 2020 6966 2065 6e63 6f64          if encod
-0000a810: 696e 6720 6973 206e 6f74 204e 6f6e 6520  ing is not None 
-0000a820: 616e 6420 656e 636f 6469 6e67 206e 6f74  and encoding not
-0000a830: 2069 6e20 5f56 414c 4944 5f45 4e43 4f44   in _VALID_ENCOD
-0000a840: 494e 4753 3a0a 2020 2020 2020 2020 2020  INGS:.          
-0000a850: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
-0000a860: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
-0000a870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a880: 2020 2020 2066 2242 6967 5175 6572 7920       f"BigQuery 
-0000a890: 656e 6769 6e65 206f 6e6c 7920 7375 7070  engine only supp
-0000a8a0: 6f72 7473 2074 6865 2066 6f6c 6c6f 7769  orts the followi
-0000a8b0: 6e67 2065 6e63 6f64 696e 6773 3a20 7b5f  ng encodings: {_
-0000a8c0: 5641 4c49 445f 454e 434f 4449 4e47 537d  VALID_ENCODINGS}
-0000a8d0: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
-0000a8e0: 2020 2020 2020 2020 6622 7b63 6f6e 7374          f"{const
-0000a8f0: 616e 7473 2e46 4545 4442 4143 4b5f 4c49  ants.FEEDBACK_LI
-0000a900: 4e4b 7d22 0a20 2020 2020 2020 2020 2020  NK}".           
-0000a910: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0000a920: 2020 2020 6a6f 625f 636f 6e66 6967 203d      job_config =
-0000a930: 2073 656c 662e 5f70 7265 7061 7265 5f6c   self._prepare_l
-0000a940: 6f61 645f 6a6f 625f 636f 6e66 6967 2829  oad_job_config()
-0000a950: 0a20 2020 2020 2020 2020 2020 206a 6f62  .            job
-0000a960: 5f63 6f6e 6669 672e 6372 6561 7465 5f64  _config.create_d
-0000a970: 6973 706f 7369 7469 6f6e 203d 2062 6967  isposition = big
-0000a980: 7175 6572 792e 4372 6561 7465 4469 7370  query.CreateDisp
-0000a990: 6f73 6974 696f 6e2e 4352 4541 5445 5f49  osition.CREATE_I
-0000a9a0: 465f 4e45 4544 4544 0a20 2020 2020 2020  F_NEEDED.       
-0000a9b0: 2020 2020 206a 6f62 5f63 6f6e 6669 672e       job_config.
-0000a9c0: 736f 7572 6365 5f66 6f72 6d61 7420 3d20  source_format = 
-0000a9d0: 6269 6771 7565 7279 2e53 6f75 7263 6546  bigquery.SourceF
-0000a9e0: 6f72 6d61 742e 4353 560a 2020 2020 2020  ormat.CSV.      
-0000a9f0: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
-0000aa00: 2e77 7269 7465 5f64 6973 706f 7369 7469  .write_dispositi
-0000aa10: 6f6e 203d 2062 6967 7175 6572 792e 5772  on = bigquery.Wr
-0000aa20: 6974 6544 6973 706f 7369 7469 6f6e 2e57  iteDisposition.W
-0000aa30: 5249 5445 5f45 4d50 5459 0a20 2020 2020  RITE_EMPTY.     
-0000aa40: 2020 2020 2020 206a 6f62 5f63 6f6e 6669         job_confi
-0000aa50: 672e 6175 746f 6465 7465 6374 203d 2054  g.autodetect = T
-0000aa60: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0000aa70: 6a6f 625f 636f 6e66 6967 2e66 6965 6c64  job_config.field
-0000aa80: 5f64 656c 696d 6974 6572 203d 2073 6570  _delimiter = sep
-0000aa90: 0a20 2020 2020 2020 2020 2020 206a 6f62  .            job
-0000aaa0: 5f63 6f6e 6669 672e 656e 636f 6469 6e67  _config.encoding
-0000aab0: 203d 2065 6e63 6f64 696e 670a 2020 2020   = encoding.    
-0000aac0: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
-0000aad0: 6967 2e6c 6162 656c 7320 3d20 7b22 6269  ig.labels = {"bi
-0000aae0: 6766 7261 6d65 732d 6170 6922 3a20 2272  gframes-api": "r
-0000aaf0: 6561 645f 6373 7622 7d0a 0a20 2020 2020  ead_csv"}..     
-0000ab00: 2020 2020 2020 2023 2057 6520 7761 6e74         # We want
-0000ab10: 2074 6f20 6d61 7463 6820 7061 6e64 6173   to match pandas
-0000ab20: 2062 6568 6176 696f 722e 2049 6620 6865   behavior. If he
-0000ab30: 6164 6572 2069 7320 302c 206e 6f20 726f  ader is 0, no ro
-0000ab40: 7773 2073 686f 756c 6420 6265 2073 6b69  ws should be ski
-0000ab50: 7070 6564 2c20 736f 2077 650a 2020 2020  pped, so we.    
-0000ab60: 2020 2020 2020 2020 2320 646f 206e 6f74          # do not
-0000ab70: 206e 6565 6420 746f 2073 6574 2060 736b   need to set `sk
-0000ab80: 6970 5f6c 6561 6469 6e67 5f72 6f77 7360  ip_leading_rows`
-0000ab90: 2e20 4966 2068 6561 6465 7220 6973 204e  . If header is N
-0000aba0: 6f6e 652c 2074 6865 6e20 7468 6572 6520  one, then there 
-0000abb0: 6973 206e 6f20 6865 6164 6572 2e0a 2020  is no header..  
-0000abc0: 2020 2020 2020 2020 2020 2320 5365 7474            # Sett
-0000abd0: 696e 6720 736b 6970 5f6c 6561 6469 6e67  ing skip_leading
-0000abe0: 5f72 6f77 7320 746f 2030 2064 6f65 7320  _rows to 0 does 
-0000abf0: 7468 6174 2e20 4966 2068 6561 6465 723d  that. If header=
-0000ac00: 4e20 616e 6420 4e3e 302c 2077 6520 7761  N and N>0, we wa
-0000ac10: 6e74 2074 6f20 736b 6970 204e 2072 6f77  nt to skip N row
-0000ac20: 732e 0a20 2020 2020 2020 2020 2020 2069  s..            i
-0000ac30: 6620 6865 6164 6572 2069 7320 4e6f 6e65  f header is None
-0000ac40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ac50: 2020 6a6f 625f 636f 6e66 6967 2e73 6b69    job_config.ski
-0000ac60: 705f 6c65 6164 696e 675f 726f 7773 203d  p_leading_rows =
-0000ac70: 2030 0a20 2020 2020 2020 2020 2020 2065   0.            e
-0000ac80: 6c69 6620 6865 6164 6572 203e 2030 3a0a  lif header > 0:.
-0000ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aca0: 6a6f 625f 636f 6e66 6967 2e73 6b69 705f  job_config.skip_
-0000acb0: 6c65 6164 696e 675f 726f 7773 203d 2068  leading_rows = h
-0000acc0: 6561 6465 720a 0a20 2020 2020 2020 2020  eader..         
-0000acd0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0000ace0: 7265 6164 5f62 6967 7175 6572 795f 6c6f  read_bigquery_lo
-0000acf0: 6164 5f6a 6f62 280a 2020 2020 2020 2020  ad_job(.        
-0000ad00: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
-0000ad10: 5f6f 725f 6275 6666 6572 2c0a 2020 2020  _or_buffer,.    
-0000ad20: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-0000ad30: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000ad40: 2020 206a 6f62 5f63 6f6e 6669 673d 6a6f     job_config=jo
-0000ad50: 625f 636f 6e66 6967 2c0a 2020 2020 2020  b_config,.      
-0000ad60: 2020 2020 2020 2020 2020 696e 6465 785f            index_
-0000ad70: 636f 6c3d 696e 6465 785f 636f 6c2c 0a20  col=index_col,. 
-0000ad80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000ad90: 6f6c 756d 6e73 3d63 6f6c 756d 6e73 2c0a  olumns=columns,.
-0000ada0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000adb0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000adc0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0000add0: 7461 6e63 6528 696e 6465 785f 636f 6c2c  tance(index_col,
-0000ade0: 2062 6967 6672 616d 6573 2e65 6e75 6d73   bigframes.enums
-0000adf0: 2e44 6566 6175 6c74 496e 6465 784b 696e  .DefaultIndexKin
-0000ae00: 6429 3a0a 2020 2020 2020 2020 2020 2020  d):.            
-0000ae10: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
-0000ae20: 6c65 6d65 6e74 6564 4572 726f 7228 0a20  lementedError(. 
-0000ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae40: 2020 2066 2257 6974 6820 696e 6465 785f     f"With index_
-0000ae50: 636f 6c3d 7b72 6570 7228 696e 6465 785f  col={repr(index_
-0000ae60: 636f 6c29 7d2c 206f 6e6c 7920 656e 6769  col)}, only engi
-0000ae70: 6e65 3d27 6269 6771 7565 7279 2720 6973  ne='bigquery' is
-0000ae80: 2073 7570 706f 7274 6564 2e20 220a 2020   supported. ".  
+00000320: 2020 4861 7368 6162 6c65 2c0a 2020 2020    Hashable,.    
+00000330: 494f 2c0a 2020 2020 4974 6572 6162 6c65  IO,.    Iterable
+00000340: 2c0a 2020 2020 4c69 7374 2c0a 2020 2020  ,.    List,.    
+00000350: 4c69 7465 7261 6c2c 0a20 2020 204d 6170  Literal,.    Map
+00000360: 7069 6e67 2c0a 2020 2020 4d75 7461 626c  ping,.    Mutabl
+00000370: 6553 6571 7565 6e63 652c 0a20 2020 204f  eSequence,.    O
+00000380: 7074 696f 6e61 6c2c 0a20 2020 2053 6571  ptional,.    Seq
+00000390: 7565 6e63 652c 0a20 2020 2054 7570 6c65  uence,.    Tuple
+000003a0: 2c0a 2020 2020 556e 696f 6e2c 0a29 0a69  ,.    Union,.).i
+000003b0: 6d70 6f72 7420 7575 6964 0a69 6d70 6f72  mport uuid.impor
+000003c0: 7420 7761 726e 696e 6773 0a0a 2320 4576  t warnings..# Ev
+000003d0: 656e 2074 686f 7567 6820 7468 6520 6962  en though the ib
+000003e0: 6973 2e62 6163 6b65 6e64 732e 6269 6771  is.backends.bigq
+000003f0: 7565 7279 2069 6d70 6f72 7420 6973 2075  uery import is u
+00000400: 6e75 7365 642c 2069 7427 7320 6e65 6564  nused, it's need
+00000410: 6564 0a23 2074 6f20 7265 6769 7374 6572  ed.# to register
+00000420: 206e 6577 2061 6e64 2072 6570 6c61 6365   new and replace
+00000430: 6d65 6e74 206f 7073 2077 6974 6820 7468  ment ops with th
+00000440: 6520 4962 6973 2042 6967 5175 6572 7920  e Ibis BigQuery 
+00000450: 6261 636b 656e 642e 0a69 6d70 6f72 7420  backend..import 
+00000460: 6269 6766 7261 6d65 735f 7665 6e64 6f72  bigframes_vendor
+00000470: 6564 2e69 6269 732e 6261 636b 656e 6473  ed.ibis.backends
+00000480: 2e62 6967 7175 6572 7920 2023 206e 6f71  .bigquery  # noq
+00000490: 610a 696d 706f 7274 2062 6967 6672 616d  a.import bigfram
+000004a0: 6573 5f76 656e 646f 7265 642e 7061 6e64  es_vendored.pand
+000004b0: 6173 2e69 6f2e 6762 7120 6173 2074 6869  as.io.gbq as thi
+000004c0: 7264 5f70 6172 7479 5f70 616e 6461 735f  rd_party_pandas_
+000004d0: 6762 710a 696d 706f 7274 2062 6967 6672  gbq.import bigfr
+000004e0: 616d 6573 5f76 656e 646f 7265 642e 7061  ames_vendored.pa
+000004f0: 6e64 6173 2e69 6f2e 7061 7271 7565 7420  ndas.io.parquet 
+00000500: 6173 2074 6869 7264 5f70 6172 7479 5f70  as third_party_p
+00000510: 616e 6461 735f 7061 7271 7565 740a 696d  andas_parquet.im
+00000520: 706f 7274 2062 6967 6672 616d 6573 5f76  port bigframes_v
+00000530: 656e 646f 7265 642e 7061 6e64 6173 2e69  endored.pandas.i
+00000540: 6f2e 7061 7273 6572 732e 7265 6164 6572  o.parsers.reader
+00000550: 7320 6173 2074 6869 7264 5f70 6172 7479  s as third_party
+00000560: 5f70 616e 6461 735f 7265 6164 6572 730a  _pandas_readers.
+00000570: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
+00000580: 5f76 656e 646f 7265 642e 7061 6e64 6173  _vendored.pandas
+00000590: 2e69 6f2e 7069 636b 6c65 2061 7320 7468  .io.pickle as th
+000005a0: 6972 645f 7061 7274 795f 7061 6e64 6173  ird_party_pandas
+000005b0: 5f70 6963 6b6c 650a 696d 706f 7274 2067  _pickle.import g
+000005c0: 6f6f 676c 652e 6170 695f 636f 7265 2e63  oogle.api_core.c
+000005d0: 6c69 656e 745f 696e 666f 0a69 6d70 6f72  lient_info.impor
+000005e0: 7420 676f 6f67 6c65 2e61 7069 5f63 6f72  t google.api_cor
+000005f0: 652e 636c 6965 6e74 5f6f 7074 696f 6e73  e.client_options
+00000600: 0a69 6d70 6f72 7420 676f 6f67 6c65 2e61  .import google.a
+00000610: 7069 5f63 6f72 652e 6578 6365 7074 696f  pi_core.exceptio
+00000620: 6e73 0a69 6d70 6f72 7420 676f 6f67 6c65  ns.import google
+00000630: 2e61 7069 5f63 6f72 652e 6761 7069 635f  .api_core.gapic_
+00000640: 7631 2e63 6c69 656e 745f 696e 666f 0a69  v1.client_info.i
+00000650: 6d70 6f72 7420 676f 6f67 6c65 2e61 7574  mport google.aut
+00000660: 682e 6372 6564 656e 7469 616c 730a 696d  h.credentials.im
+00000670: 706f 7274 2067 6f6f 676c 652e 636c 6f75  port google.clou
+00000680: 642e 6269 6771 7565 7279 2061 7320 6269  d.bigquery as bi
+00000690: 6771 7565 7279 0a69 6d70 6f72 7420 676f  gquery.import go
+000006a0: 6f67 6c65 2e63 6c6f 7564 2e62 6967 7175  ogle.cloud.bigqu
+000006b0: 6572 792e 7461 626c 650a 696d 706f 7274  ery.table.import
+000006c0: 2067 6f6f 676c 652e 636c 6f75 642e 6269   google.cloud.bi
+000006d0: 6771 7565 7279 5f63 6f6e 6e65 6374 696f  gquery_connectio
+000006e0: 6e5f 7631 0a69 6d70 6f72 7420 676f 6f67  n_v1.import goog
+000006f0: 6c65 2e63 6c6f 7564 2e62 6967 7175 6572  le.cloud.bigquer
+00000700: 795f 7374 6f72 6167 655f 7631 0a69 6d70  y_storage_v1.imp
+00000710: 6f72 7420 676f 6f67 6c65 2e63 6c6f 7564  ort google.cloud
+00000720: 2e66 756e 6374 696f 6e73 5f76 320a 696d  .functions_v2.im
+00000730: 706f 7274 2067 6f6f 676c 652e 636c 6f75  port google.clou
+00000740: 642e 7265 736f 7572 6365 6d61 6e61 6765  d.resourcemanage
+00000750: 725f 7633 0a69 6d70 6f72 7420 676f 6f67  r_v3.import goog
+00000760: 6c65 2e63 6c6f 7564 2e73 746f 7261 6765  le.cloud.storage
+00000770: 2061 7320 7374 6f72 6167 6520 2023 2074   as storage  # t
+00000780: 7970 653a 2069 676e 6f72 650a 696d 706f  ype: ignore.impo
+00000790: 7274 2069 6269 730a 696d 706f 7274 2069  rt ibis.import i
+000007a0: 6269 732e 6261 636b 656e 6473 2e62 6967  bis.backends.big
+000007b0: 7175 6572 7920 6173 2069 6269 735f 6269  query as ibis_bi
+000007c0: 6771 7565 7279 0a69 6d70 6f72 7420 6962  gquery.import ib
+000007d0: 6973 2e65 7870 722e 7479 7065 7320 6173  is.expr.types as
+000007e0: 2069 6269 735f 7479 7065 730a 696d 706f   ibis_types.impo
+000007f0: 7274 206a 656c 6c79 6669 7368 0a69 6d70  rt jellyfish.imp
+00000800: 6f72 7420 6e75 6d70 7920 6173 206e 700a  ort numpy as np.
+00000810: 696d 706f 7274 2070 616e 6461 730a 6672  import pandas.fr
+00000820: 6f6d 2070 616e 6461 732e 5f74 7970 696e  om pandas._typin
+00000830: 6720 696d 706f 7274 2028 0a20 2020 2043  g import (.    C
+00000840: 6f6d 7072 6573 7369 6f6e 4f70 7469 6f6e  ompressionOption
+00000850: 732c 0a20 2020 2046 696c 6550 6174 682c  s,.    FilePath,
+00000860: 0a20 2020 2052 6561 6450 6963 6b6c 6542  .    ReadPickleB
+00000870: 7566 6665 722c 0a20 2020 2053 746f 7261  uffer,.    Stora
+00000880: 6765 4f70 7469 6f6e 732c 0a29 0a69 6d70  geOptions,.).imp
+00000890: 6f72 7420 7079 6172 726f 7720 6173 2070  ort pyarrow as p
+000008a0: 610a 0a69 6d70 6f72 7420 6269 6766 7261  a..import bigfra
+000008b0: 6d65 732e 5f63 6f6e 6669 672e 6269 6771  mes._config.bigq
+000008c0: 7565 7279 5f6f 7074 696f 6e73 2061 7320  uery_options as 
+000008d0: 6269 6771 7565 7279 5f6f 7074 696f 6e73  bigquery_options
+000008e0: 0a69 6d70 6f72 7420 6269 6766 7261 6d65  .import bigframe
+000008f0: 732e 636c 6965 6e74 730a 696d 706f 7274  s.clients.import
+00000900: 2062 6967 6672 616d 6573 2e63 6f6e 7374   bigframes.const
+00000910: 616e 7473 2061 7320 636f 6e73 7461 6e74  ants as constant
+00000920: 730a 696d 706f 7274 2062 6967 6672 616d  s.import bigfram
+00000930: 6573 2e63 6f72 6520 6173 2063 6f72 650a  es.core as core.
+00000940: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
+00000950: 2e63 6f72 652e 626c 6f63 6b73 2061 7320  .core.blocks as 
+00000960: 626c 6f63 6b73 0a69 6d70 6f72 7420 6269  blocks.import bi
+00000970: 6766 7261 6d65 732e 636f 7265 2e63 6f6d  gframes.core.com
+00000980: 7069 6c65 0a69 6d70 6f72 7420 6269 6766  pile.import bigf
+00000990: 7261 6d65 732e 636f 7265 2e67 7569 640a  rames.core.guid.
+000009a0: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
+000009b0: 2e63 6f72 652e 6e6f 6465 7320 6173 206e  .core.nodes as n
+000009c0: 6f64 6573 0a66 726f 6d20 6269 6766 7261  odes.from bigfra
+000009d0: 6d65 732e 636f 7265 2e6f 7264 6572 696e  mes.core.orderin
+000009e0: 6720 696d 706f 7274 2049 6e74 6567 6572  g import Integer
+000009f0: 456e 636f 6469 6e67 0a69 6d70 6f72 7420  Encoding.import 
+00000a00: 6269 6766 7261 6d65 732e 636f 7265 2e6f  bigframes.core.o
+00000a10: 7264 6572 696e 6720 6173 206f 7264 6572  rdering as order
+00000a20: 0a69 6d70 6f72 7420 6269 6766 7261 6d65  .import bigframe
+00000a30: 732e 636f 7265 2e74 7265 655f 7072 6f70  s.core.tree_prop
+00000a40: 6572 7469 6573 2061 7320 7472 6176 6572  erties as traver
+00000a50: 7361 6c73 0a69 6d70 6f72 7420 6269 6766  sals.import bigf
+00000a60: 7261 6d65 732e 636f 7265 2e74 7265 655f  rames.core.tree_
+00000a70: 7072 6f70 6572 7469 6573 2061 7320 7472  properties as tr
+00000a80: 6565 5f70 726f 7065 7274 6965 730a 696d  ee_properties.im
+00000a90: 706f 7274 2062 6967 6672 616d 6573 2e63  port bigframes.c
+00000aa0: 6f72 652e 7574 696c 7320 6173 2075 7469  ore.utils as uti
+00000ab0: 6c73 0a69 6d70 6f72 7420 6269 6766 7261  ls.import bigfra
+00000ac0: 6d65 732e 6474 7970 6573 0a69 6d70 6f72  mes.dtypes.impor
+00000ad0: 7420 6269 6766 7261 6d65 732e 6578 6365  t bigframes.exce
+00000ae0: 7074 696f 6e73 0a69 6d70 6f72 7420 6269  ptions.import bi
+00000af0: 6766 7261 6d65 732e 666f 726d 6174 7469  gframes.formatti
+00000b00: 6e67 5f68 656c 7065 7273 2061 7320 666f  ng_helpers as fo
+00000b10: 726d 6174 7469 6e67 5f68 656c 7065 7273  rmatting_helpers
+00000b20: 0a66 726f 6d20 6269 6766 7261 6d65 732e  .from bigframes.
+00000b30: 6675 6e63 7469 6f6e 732e 7265 6d6f 7465  functions.remote
+00000b40: 5f66 756e 6374 696f 6e20 696d 706f 7274  _function import
+00000b50: 2072 6561 645f 6762 715f 6675 6e63 7469   read_gbq_functi
+00000b60: 6f6e 2061 7320 6269 6766 7261 6d65 735f  on as bigframes_
+00000b70: 7267 660a 6672 6f6d 2062 6967 6672 616d  rgf.from bigfram
+00000b80: 6573 2e66 756e 6374 696f 6e73 2e72 656d  es.functions.rem
+00000b90: 6f74 655f 6675 6e63 7469 6f6e 2069 6d70  ote_function imp
+00000ba0: 6f72 7420 7265 6d6f 7465 5f66 756e 6374  ort remote_funct
+00000bb0: 696f 6e20 6173 2062 6967 6672 616d 6573  ion as bigframes
+00000bc0: 5f72 660a 696d 706f 7274 2062 6967 6672  _rf.import bigfr
+00000bd0: 616d 6573 2e73 6573 7369 6f6e 2e5f 696f  ames.session._io
+00000be0: 2e62 6967 7175 6572 7920 6173 2062 665f  .bigquery as bf_
+00000bf0: 696f 5f62 6967 7175 6572 790a 696d 706f  io_bigquery.impo
+00000c00: 7274 2062 6967 6672 616d 6573 2e73 6573  rt bigframes.ses
+00000c10: 7369 6f6e 2e5f 696f 2e62 6967 7175 6572  sion._io.bigquer
+00000c20: 792e 7265 6164 5f67 6271 5f74 6162 6c65  y.read_gbq_table
+00000c30: 2061 7320 6266 5f72 6561 645f 6762 715f   as bf_read_gbq_
+00000c40: 7461 626c 650a 696d 706f 7274 2062 6967  table.import big
+00000c50: 6672 616d 6573 2e73 6573 7369 6f6e 2e63  frames.session.c
+00000c60: 6c69 656e 7473 0a69 6d70 6f72 7420 6269  lients.import bi
+00000c70: 6766 7261 6d65 732e 7665 7273 696f 6e0a  gframes.version.
+00000c80: 0a23 2041 766f 6964 2063 6972 6375 6c61  .# Avoid circula
+00000c90: 7220 696d 706f 7274 732e 0a69 6620 7479  r imports..if ty
+00000ca0: 7069 6e67 2e54 5950 455f 4348 4543 4b49  ping.TYPE_CHECKI
+00000cb0: 4e47 3a0a 2020 2020 696d 706f 7274 2062  NG:.    import b
+00000cc0: 6967 6672 616d 6573 2e63 6f72 652e 696e  igframes.core.in
+00000cd0: 6465 7865 730a 2020 2020 696d 706f 7274  dexes.    import
+00000ce0: 2062 6967 6672 616d 6573 2e64 6174 6166   bigframes.dataf
+00000cf0: 7261 6d65 2061 7320 6461 7461 6672 616d  rame as datafram
+00000d00: 650a 2020 2020 696d 706f 7274 2062 6967  e.    import big
+00000d10: 6672 616d 6573 2e73 6572 6965 730a 0a5f  frames.series.._
+00000d20: 4249 4746 5241 4d45 535f 4445 4641 554c  BIGFRAMES_DEFAUL
+00000d30: 545f 434f 4e4e 4543 5449 4f4e 5f49 4420  T_CONNECTION_ID 
+00000d40: 3d20 2262 6967 6672 616d 6573 2d64 6566  = "bigframes-def
+00000d50: 6175 6c74 2d63 6f6e 6e65 6374 696f 6e22  ault-connection"
+00000d60: 0a0a 5f54 454d 505f 5441 424c 455f 4944  .._TEMP_TABLE_ID
+00000d70: 5f46 4f52 4d41 5420 3d20 2262 7164 667b  _FORMAT = "bqdf{
+00000d80: 6461 7465 7d5f 7b73 6573 7369 6f6e 5f69  date}_{session_i
+00000d90: 647d 5f7b 7261 6e64 6f6d 5f69 647d 220a  d}_{random_id}".
+00000da0: 0a5f 4d41 585f 434c 5553 5445 525f 434f  ._MAX_CLUSTER_CO
+00000db0: 4c55 4d4e 5320 3d20 340a 0a23 2054 4f44  LUMNS = 4..# TOD
+00000dc0: 4f28 7377 6173 7429 3a20 4e65 6564 2074  O(swast): Need t
+00000dd0: 6f20 636f 6e6e 6563 7420 746f 2072 6567  o connect to reg
+00000de0: 696f 6e61 6c20 656e 6470 6f69 6e74 7320  ional endpoints 
+00000df0: 7768 656e 2070 6572 666f 726d 696e 6720  when performing 
+00000e00: 7265 6d6f 7465 0a23 2066 756e 6374 696f  remote.# functio
+00000e10: 6e73 206f 7065 7261 7469 6f6e 7320 2842  ns operations (B
+00000e20: 5120 436f 6e6e 6563 7469 6f6e 2049 414d  Q Connection IAM
+00000e30: 2c20 436c 6f75 6420 5275 6e20 2f20 436c  , Cloud Run / Cl
+00000e40: 6f75 6420 4675 6e63 7469 6f6e 7329 2e0a  oud Functions)..
+00000e50: 2320 416c 736f 2073 6565 2069 6620 7265  # Also see if re
+00000e60: 736f 7572 6365 206d 616e 6167 6572 2063  source manager c
+00000e70: 6c69 656e 7420 6c69 6272 6172 7920 7375  lient library su
+00000e80: 7070 6f72 7473 2072 6567 696f 6e61 6c20  pports regional 
+00000e90: 656e 6470 6f69 6e74 732e 0a0a 5f56 414c  endpoints..._VAL
+00000ea0: 4944 5f45 4e43 4f44 494e 4753 203d 207b  ID_ENCODINGS = {
+00000eb0: 0a20 2020 2022 5554 462d 3822 2c0a 2020  .    "UTF-8",.  
+00000ec0: 2020 2249 534f 2d38 3835 392d 3122 2c0a    "ISO-8859-1",.
+00000ed0: 2020 2020 2255 5446 2d31 3642 4522 2c0a      "UTF-16BE",.
+00000ee0: 2020 2020 2255 5446 2d31 364c 4522 2c0a      "UTF-16LE",.
+00000ef0: 2020 2020 2255 5446 2d33 3242 4522 2c0a      "UTF-32BE",.
+00000f00: 2020 2020 2255 5446 2d33 324c 4522 2c0a      "UTF-32LE",.
+00000f10: 7d0a 0a23 2042 6967 5175 6572 7920 6861  }..# BigQuery ha
+00000f20: 7320 3120 4d42 2071 7565 7279 2073 697a  s 1 MB query siz
+00000f30: 6520 6c69 6d69 742e 2044 6f6e 2774 2077  e limit. Don't w
+00000f40: 616e 7420 746f 2074 616b 6520 7570 206d  ant to take up m
+00000f50: 6f72 6520 7468 616e 2061 2066 6577 2025  ore than a few %
+00000f60: 206f 6620 7468 6174 2069 6e6c 696e 696e   of that inlinin
+00000f70: 6720 6120 7461 626c 652e 0a23 2041 6c73  g a table..# Als
+00000f80: 6f20 6d75 7374 2061 7373 756d 6520 7468  o must assume th
+00000f90: 6174 2074 6578 7420 656e 636f 6469 6e67  at text encoding
+00000fa0: 2061 7320 6c69 7465 7261 6c73 2069 7320   as literals is 
+00000fb0: 6d75 6368 206c 6573 7320 6566 6669 6369  much less effici
+00000fc0: 656e 7420 7468 616e 2069 6e2d 6d65 6d6f  ent than in-memo
+00000fd0: 7279 2072 6570 7265 7365 6e74 6174 696f  ry representatio
+00000fe0: 6e2e 0a4d 4158 5f49 4e4c 494e 455f 4446  n..MAX_INLINE_DF
+00000ff0: 5f42 5954 4553 203d 2035 3030 300a 0a23  _BYTES = 5000..#
+00001000: 204d 6178 2063 6f6d 706c 6578 6974 7920   Max complexity 
+00001010: 7468 6174 2073 686f 756c 6420 6265 2065  that should be e
+00001020: 7865 6375 7465 6420 6173 2061 2073 696e  xecuted as a sin
+00001030: 676c 6520 7175 6572 790a 5155 4552 595f  gle query.QUERY_
+00001040: 434f 4d50 4c45 5849 5459 5f4c 494d 4954  COMPLEXITY_LIMIT
+00001050: 203d 2031 6537 0a23 204e 756d 6265 7220   = 1e7.# Number 
+00001060: 6f66 2074 696d 6573 2074 6f20 6661 6374  of times to fact
+00001070: 6f72 206f 7574 2073 7562 7175 6572 6965  or out subquerie
+00001080: 7320 6265 666f 7265 2067 6976 696e 6720  s before giving 
+00001090: 7570 2e0a 4d41 585f 5355 4254 5245 455f  up..MAX_SUBTREE_
+000010a0: 4641 4354 4f52 494e 4753 203d 2035 0a0a  FACTORINGS = 5..
+000010b0: 6c6f 6767 6572 203d 206c 6f67 6769 6e67  logger = logging
+000010c0: 2e67 6574 4c6f 6767 6572 285f 5f6e 616d  .getLogger(__nam
+000010d0: 655f 5f29 0a0a 2320 4578 636c 7564 6573  e__)..# Excludes
+000010e0: 2067 656f 6772 6170 6879 2c20 6279 7465   geography, byte
+000010f0: 732c 2061 6e64 206e 6573 7465 6420 2861  s, and nested (a
+00001100: 7272 6179 2c20 7374 7275 6374 2920 6461  rray, struct) da
+00001110: 7461 7479 7065 730a 494e 4c49 4e41 424c  tatypes.INLINABL
+00001120: 455f 4454 5950 4553 3a20 5365 7175 656e  E_DTYPES: Sequen
+00001130: 6365 5b62 6967 6672 616d 6573 2e64 7479  ce[bigframes.dty
+00001140: 7065 732e 4474 7970 655d 203d 2028 0a20  pes.Dtype] = (. 
+00001150: 2020 2070 616e 6461 732e 426f 6f6c 6561     pandas.Boolea
+00001160: 6e44 7479 7065 2829 2c0a 2020 2020 7061  nDtype(),.    pa
+00001170: 6e64 6173 2e46 6c6f 6174 3634 4474 7970  ndas.Float64Dtyp
+00001180: 6528 292c 0a20 2020 2070 616e 6461 732e  e(),.    pandas.
+00001190: 496e 7436 3444 7479 7065 2829 2c0a 2020  Int64Dtype(),.  
+000011a0: 2020 7061 6e64 6173 2e53 7472 696e 6744    pandas.StringD
+000011b0: 7479 7065 2873 746f 7261 6765 3d22 7079  type(storage="py
+000011c0: 6172 726f 7722 292c 0a20 2020 2070 616e  arrow"),.    pan
+000011d0: 6461 732e 4172 726f 7744 7479 7065 2870  das.ArrowDtype(p
+000011e0: 612e 6461 7465 3332 2829 292c 0a20 2020  a.date32()),.   
+000011f0: 2070 616e 6461 732e 4172 726f 7744 7479   pandas.ArrowDty
+00001200: 7065 2870 612e 7469 6d65 3634 2822 7573  pe(pa.time64("us
+00001210: 2229 292c 0a20 2020 2070 616e 6461 732e  ")),.    pandas.
+00001220: 4172 726f 7744 7479 7065 2870 612e 7469  ArrowDtype(pa.ti
+00001230: 6d65 7374 616d 7028 2275 7322 2929 2c0a  mestamp("us")),.
+00001240: 2020 2020 7061 6e64 6173 2e41 7272 6f77      pandas.Arrow
+00001250: 4474 7970 6528 7061 2e74 696d 6573 7461  Dtype(pa.timesta
+00001260: 6d70 2822 7573 222c 2074 7a3d 2255 5443  mp("us", tz="UTC
+00001270: 2229 292c 0a20 2020 2070 616e 6461 732e  ")),.    pandas.
+00001280: 4172 726f 7744 7479 7065 2870 612e 6465  ArrowDtype(pa.de
+00001290: 6369 6d61 6c31 3238 2833 382c 2039 2929  cimal128(38, 9))
+000012a0: 2c0a 2020 2020 7061 6e64 6173 2e41 7272  ,.    pandas.Arr
+000012b0: 6f77 4474 7970 6528 7061 2e64 6563 696d  owDtype(pa.decim
+000012c0: 616c 3235 3628 3736 2c20 3338 2929 2c0a  al256(76, 38)),.
+000012d0: 290a 0a0a 6465 6620 5f74 6f5f 696e 6465  )...def _to_inde
+000012e0: 785f 636f 6c73 280a 2020 2020 696e 6465  x_cols(.    inde
+000012f0: 785f 636f 6c3a 2049 7465 7261 626c 655b  x_col: Iterable[
+00001300: 7374 725d 207c 2073 7472 207c 2062 6967  str] | str | big
+00001310: 6672 616d 6573 2e65 6e75 6d73 2e44 6566  frames.enums.Def
+00001320: 6175 6c74 496e 6465 784b 696e 6420 3d20  aultIndexKind = 
+00001330: 2829 2c0a 2920 2d3e 204c 6973 745b 7374  (),.) -> List[st
+00001340: 725d 3a0a 2020 2020 2222 2243 6f6e 7665  r]:.    """Conve
+00001350: 7274 2069 6e64 6578 5f63 6f6c 2069 6e74  rt index_col int
+00001360: 6f20 6120 6c69 7374 206f 6620 636f 6c75  o a list of colu
+00001370: 6d6e 206e 616d 6573 2e22 2222 0a20 2020  mn names.""".   
+00001380: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
+00001390: 6e64 6578 5f63 6f6c 2c20 6269 6766 7261  ndex_col, bigfra
+000013a0: 6d65 732e 656e 756d 732e 4465 6661 756c  mes.enums.Defaul
+000013b0: 7449 6e64 6578 4b69 6e64 293a 0a20 2020  tIndexKind):.   
+000013c0: 2020 2020 2069 6e64 6578 5f63 6f6c 733a       index_cols:
+000013d0: 204c 6973 745b 7374 725d 203d 205b 5d0a   List[str] = [].
+000013e0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+000013f0: 6e63 6528 696e 6465 785f 636f 6c2c 2073  nce(index_col, s
+00001400: 7472 293a 0a20 2020 2020 2020 2069 6e64  tr):.        ind
+00001410: 6578 5f63 6f6c 7320 3d20 5b69 6e64 6578  ex_cols = [index
+00001420: 5f63 6f6c 5d0a 2020 2020 656c 7365 3a0a  _col].    else:.
+00001430: 2020 2020 2020 2020 696e 6465 785f 636f          index_co
+00001440: 6c73 203d 206c 6973 7428 696e 6465 785f  ls = list(index_
+00001450: 636f 6c29 0a0a 2020 2020 7265 7475 726e  col)..    return
+00001460: 2069 6e64 6578 5f63 6f6c 730a 0a0a 636c   index_cols...cl
+00001470: 6173 7320 5365 7373 696f 6e28 0a20 2020  ass Session(.   
+00001480: 2074 6869 7264 5f70 6172 7479 5f70 616e   third_party_pan
+00001490: 6461 735f 6762 712e 4742 5149 4f4d 6978  das_gbq.GBQIOMix
+000014a0: 696e 2c0a 2020 2020 7468 6972 645f 7061  in,.    third_pa
+000014b0: 7274 795f 7061 6e64 6173 5f70 6172 7175  rty_pandas_parqu
+000014c0: 6574 2e50 6172 7175 6574 494f 4d69 7869  et.ParquetIOMixi
+000014d0: 6e2c 0a20 2020 2074 6869 7264 5f70 6172  n,.    third_par
+000014e0: 7479 5f70 616e 6461 735f 7069 636b 6c65  ty_pandas_pickle
+000014f0: 2e50 6963 6b6c 6549 4f4d 6978 696e 2c0a  .PickleIOMixin,.
+00001500: 2020 2020 7468 6972 645f 7061 7274 795f      third_party_
+00001510: 7061 6e64 6173 5f72 6561 6465 7273 2e52  pandas_readers.R
+00001520: 6561 6465 7249 4f4d 6978 696e 2c0a 293a  eaderIOMixin,.):
+00001530: 0a20 2020 2022 2222 4573 7461 626c 6973  .    """Establis
+00001540: 6865 7320 6120 4269 6751 7565 7279 2063  hes a BigQuery c
+00001550: 6f6e 6e65 6374 696f 6e20 746f 2063 6170  onnection to cap
+00001560: 7475 7265 2061 2067 726f 7570 206f 6620  ture a group of 
+00001570: 6a6f 6220 6163 7469 7669 7469 6573 2072  job activities r
+00001580: 656c 6174 6564 2074 6f0a 2020 2020 4461  elated to.    Da
+00001590: 7461 4672 616d 6573 2e0a 0a20 2020 2041  taFrames...    A
+000015a0: 7267 733a 0a20 2020 2020 2020 2063 6f6e  rgs:.        con
+000015b0: 7465 7874 2028 6269 6766 7261 6d65 732e  text (bigframes.
+000015c0: 5f63 6f6e 6669 672e 6269 6771 7565 7279  _config.bigquery
+000015d0: 5f6f 7074 696f 6e73 2e42 6967 5175 6572  _options.BigQuer
+000015e0: 794f 7074 696f 6e73 293a 0a20 2020 2020  yOptions):.     
+000015f0: 2020 2020 2020 2043 6f6e 6669 6775 7261         Configura
+00001600: 7469 6f6e 2061 646a 7573 7469 6e67 2068  tion adjusting h
+00001610: 6f77 2074 6f20 636f 6e6e 6563 7420 746f  ow to connect to
+00001620: 2042 6967 5175 6572 7920 616e 6420 7265   BigQuery and re
+00001630: 6c61 7465 640a 2020 2020 2020 2020 2020  lated.          
+00001640: 2020 4150 4973 2e20 4e6f 7465 2074 6861    APIs. Note tha
+00001650: 7420 736f 6d65 206f 7074 696f 6e73 2061  t some options a
+00001660: 7265 2069 676e 6f72 6564 2069 6620 6060  re ignored if ``
+00001670: 636c 6965 6e74 735f 7072 6f76 6964 6572  clients_provider
+00001680: 6060 2069 730a 2020 2020 2020 2020 2020  `` is.          
+00001690: 2020 7365 742e 0a20 2020 2020 2020 2063    set..        c
+000016a0: 6c69 656e 7473 5f70 726f 7669 6465 7220  lients_provider 
+000016b0: 2862 6967 6672 616d 6573 2e73 6573 7369  (bigframes.sessi
+000016c0: 6f6e 2e63 6c69 656e 7473 2e43 6c69 656e  on.clients.Clien
+000016d0: 7473 5072 6f76 6964 6572 293a 0a20 2020  tsProvider):.   
+000016e0: 2020 2020 2020 2020 2041 6e20 6f62 6a65           An obje
+000016f0: 6374 2070 726f 7669 6469 6e67 2063 6c69  ct providing cli
+00001700: 656e 7420 6c69 6272 6172 7920 6f62 6a65  ent library obje
+00001710: 6374 732e 0a20 2020 2022 2222 0a0a 2020  cts..    """..  
+00001720: 2020 6465 6620 5f5f 696e 6974 5f5f 280a    def __init__(.
+00001730: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00001740: 2020 2020 2020 636f 6e74 6578 743a 204f        context: O
+00001750: 7074 696f 6e61 6c5b 6269 6771 7565 7279  ptional[bigquery
+00001760: 5f6f 7074 696f 6e73 2e42 6967 5175 6572  _options.BigQuer
+00001770: 794f 7074 696f 6e73 5d20 3d20 4e6f 6e65  yOptions] = None
+00001780: 2c0a 2020 2020 2020 2020 636c 6965 6e74  ,.        client
+00001790: 735f 7072 6f76 6964 6572 3a20 4f70 7469  s_provider: Opti
+000017a0: 6f6e 616c 5b62 6967 6672 616d 6573 2e73  onal[bigframes.s
+000017b0: 6573 7369 6f6e 2e63 6c69 656e 7473 2e43  ession.clients.C
+000017c0: 6c69 656e 7473 5072 6f76 6964 6572 5d20  lientsProvider] 
+000017d0: 3d20 4e6f 6e65 2c0a 2020 2020 293a 0a20  = None,.    ):. 
+000017e0: 2020 2020 2020 2069 6620 636f 6e74 6578         if contex
+000017f0: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
+00001800: 2020 2020 2020 2063 6f6e 7465 7874 203d         context =
+00001810: 2062 6967 7175 6572 795f 6f70 7469 6f6e   bigquery_option
+00001820: 732e 4269 6751 7565 7279 4f70 7469 6f6e  s.BigQueryOption
+00001830: 7328 290a 0a20 2020 2020 2020 2069 6620  s()..        if 
+00001840: 636f 6e74 6578 742e 6c6f 6361 7469 6f6e  context.location
+00001850: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00001860: 2020 2020 2020 7365 6c66 2e5f 6c6f 6361        self._loca
+00001870: 7469 6f6e 203d 2022 5553 220a 2020 2020  tion = "US".    
+00001880: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+00001890: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
+000018a0: 2020 2020 2020 2066 224e 6f20 6578 706c         f"No expl
+000018b0: 6963 6974 206c 6f63 6174 696f 6e20 6973  icit location is
+000018c0: 2073 6574 2c20 736f 2075 7369 6e67 206c   set, so using l
+000018d0: 6f63 6174 696f 6e20 7b73 656c 662e 5f6c  ocation {self._l
+000018e0: 6f63 6174 696f 6e7d 2066 6f72 2074 6865  ocation} for the
+000018f0: 2073 6573 7369 6f6e 2e22 2c0a 2020 2020   session.",.    
+00001900: 2020 2020 2020 2020 2020 2020 2320 5573              # Us
+00001910: 6572 2773 2063 6f64 650a 2020 2020 2020  er's code.      
+00001920: 2020 2020 2020 2020 2020 2320 2d3e 2067            # -> g
+00001930: 6574 5f67 6c6f 6261 6c5f 7365 7373 696f  et_global_sessio
+00001940: 6e28 290a 2020 2020 2020 2020 2020 2020  n().            
+00001950: 2020 2020 2320 2d3e 2063 6f6e 6e65 6374      # -> connect
+00001960: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00001970: 2020 2023 202d 3e20 5365 7373 696f 6e28     # -> Session(
+00001980: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00001990: 2020 230a 2020 2020 2020 2020 2020 2020    #.            
+000019a0: 2020 2020 2320 4e6f 7465 3a20 5765 2063      # Note: We c
+000019b0: 6f75 6c64 2061 6c73 6f20 6861 7665 3a0a  ould also have:.
+000019c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000019d0: 2320 5573 6572 2773 2063 6f64 650a 2020  # User's code.  
+000019e0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000019f0: 2d3e 2072 6561 645f 6762 7128 290a 2020  -> read_gbq().  
+00001a00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00001a10: 2d3e 2077 6974 685f 6465 6661 756c 745f  -> with_default_
+00001a20: 7365 7373 696f 6e28 290a 2020 2020 2020  session().      
+00001a30: 2020 2020 2020 2020 2020 2320 2d3e 2067            # -> g
+00001a40: 6574 5f67 6c6f 6261 6c5f 7365 7373 696f  et_global_sessio
+00001a50: 6e28 290a 2020 2020 2020 2020 2020 2020  n().            
+00001a60: 2020 2020 2320 2d3e 2063 6f6e 6e65 6374      # -> connect
+00001a70: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00001a80: 2020 2023 202d 3e20 5365 7373 696f 6e28     # -> Session(
+00001a90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00001aa0: 2020 2320 6275 7420 7765 2063 7572 7265    # but we curre
+00001ab0: 6e74 6c79 2068 6176 6520 6e6f 2077 6179  ntly have no way
+00001ac0: 2074 6f20 6469 7361 6d62 6967 7561 7465   to disambiguate
+00001ad0: 2074 6865 7365 0a20 2020 2020 2020 2020   these.         
+00001ae0: 2020 2020 2020 2023 2073 6974 7561 7469         # situati
+00001af0: 6f6e 732e 0a20 2020 2020 2020 2020 2020  ons..           
+00001b00: 2020 2020 2073 7461 636b 6c65 7665 6c3d       stacklevel=
+00001b10: 342c 0a20 2020 2020 2020 2020 2020 2020  4,.             
+00001b20: 2020 2063 6174 6567 6f72 793d 6269 6766     category=bigf
+00001b30: 7261 6d65 732e 6578 6365 7074 696f 6e73  rames.exceptions
+00001b40: 2e44 6566 6175 6c74 4c6f 6361 7469 6f6e  .DefaultLocation
+00001b50: 5761 726e 696e 672c 0a20 2020 2020 2020  Warning,.       
+00001b60: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+00001b70: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00001b80: 2073 656c 662e 5f6c 6f63 6174 696f 6e20   self._location 
+00001b90: 3d20 636f 6e74 6578 742e 6c6f 6361 7469  = context.locati
+00001ba0: 6f6e 0a0a 2020 2020 2020 2020 7365 6c66  on..        self
+00001bb0: 2e5f 6271 5f6b 6d73 5f6b 6579 5f6e 616d  ._bq_kms_key_nam
+00001bc0: 6520 3d20 636f 6e74 6578 742e 6b6d 735f  e = context.kms_
+00001bd0: 6b65 795f 6e61 6d65 0a0a 2020 2020 2020  key_name..      
+00001be0: 2020 2320 496e 7374 616e 7469 6174 6520    # Instantiate 
+00001bf0: 6120 636c 6965 6e74 7320 7072 6f76 6964  a clients provid
+00001c00: 6572 2074 6f20 6865 6c70 2077 6974 6820  er to help with 
+00001c10: 636c 6f75 6420 636c 6965 6e74 7320 7468  cloud clients th
+00001c20: 6174 2077 696c 6c20 6265 0a20 2020 2020  at will be.     
+00001c30: 2020 2023 2075 7365 6420 696e 2074 6865     # used in the
+00001c40: 2066 7574 7572 6520 6f70 6572 6174 696f   future operatio
+00001c50: 6e73 2069 6e20 7468 6520 7365 7373 696f  ns in the sessio
+00001c60: 6e0a 2020 2020 2020 2020 6966 2063 6c69  n.        if cli
+00001c70: 656e 7473 5f70 726f 7669 6465 723a 0a20  ents_provider:. 
+00001c80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00001c90: 5f63 6c69 656e 7473 5f70 726f 7669 6465  _clients_provide
+00001ca0: 7220 3d20 636c 6965 6e74 735f 7072 6f76  r = clients_prov
+00001cb0: 6964 6572 0a20 2020 2020 2020 2065 6c73  ider.        els
+00001cc0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00001cd0: 656c 662e 5f63 6c69 656e 7473 5f70 726f  elf._clients_pro
+00001ce0: 7669 6465 7220 3d20 6269 6766 7261 6d65  vider = bigframe
+00001cf0: 732e 7365 7373 696f 6e2e 636c 6965 6e74  s.session.client
+00001d00: 732e 436c 6965 6e74 7350 726f 7669 6465  s.ClientsProvide
+00001d10: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00001d20: 2020 2070 726f 6a65 6374 3d63 6f6e 7465     project=conte
+00001d30: 7874 2e70 726f 6a65 6374 2c0a 2020 2020  xt.project,.    
+00001d40: 2020 2020 2020 2020 2020 2020 6c6f 6361              loca
+00001d50: 7469 6f6e 3d73 656c 662e 5f6c 6f63 6174  tion=self._locat
+00001d60: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00001d70: 2020 2020 2075 7365 5f72 6567 696f 6e61       use_regiona
+00001d80: 6c5f 656e 6470 6f69 6e74 733d 636f 6e74  l_endpoints=cont
+00001d90: 6578 742e 7573 655f 7265 6769 6f6e 616c  ext.use_regional
+00001da0: 5f65 6e64 706f 696e 7473 2c0a 2020 2020  _endpoints,.    
+00001db0: 2020 2020 2020 2020 2020 2020 6372 6564              cred
+00001dc0: 656e 7469 616c 733d 636f 6e74 6578 742e  entials=context.
+00001dd0: 6372 6564 656e 7469 616c 732c 0a20 2020  credentials,.   
+00001de0: 2020 2020 2020 2020 2020 2020 2061 7070               app
+00001df0: 6c69 6361 7469 6f6e 5f6e 616d 653d 636f  lication_name=co
+00001e00: 6e74 6578 742e 6170 706c 6963 6174 696f  ntext.applicatio
+00001e10: 6e5f 6e61 6d65 2c0a 2020 2020 2020 2020  n_name,.        
+00001e20: 2020 2020 2020 2020 6271 5f6b 6d73 5f6b          bq_kms_k
+00001e30: 6579 5f6e 616d 653d 7365 6c66 2e5f 6271  ey_name=self._bq
+00001e40: 5f6b 6d73 5f6b 6579 5f6e 616d 652c 0a20  _kms_key_name,. 
+00001e50: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00001e60: 2020 2020 2020 7365 6c66 2e5f 616e 6f6e        self._anon
+00001e70: 796d 6f75 735f 6461 7461 7365 7420 3d20  ymous_dataset = 
+00001e80: 280a 2020 2020 2020 2020 2020 2020 6269  (.            bi
+00001e90: 6766 7261 6d65 732e 7365 7373 696f 6e2e  gframes.session.
+00001ea0: 5f69 6f2e 6269 6771 7565 7279 2e63 7265  _io.bigquery.cre
+00001eb0: 6174 655f 6271 5f64 6174 6173 6574 5f72  ate_bq_dataset_r
+00001ec0: 6566 6572 656e 6365 280a 2020 2020 2020  eference(.      
+00001ed0: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
+00001ee0: 7163 6c69 656e 742c 206c 6f63 6174 696f  qclient, locatio
+00001ef0: 6e3d 7365 6c66 2e5f 6c6f 6361 7469 6f6e  n=self._location
+00001f00: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00001f10: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00001f20: 2020 2320 544f 444f 2873 686f 6273 293a    # TODO(shobs):
+00001f30: 2052 656d 6f76 6520 7468 6973 206c 6f67   Remove this log
+00001f40: 6963 2061 6674 6572 2068 7474 7073 3a2f  ic after https:/
+00001f50: 2f67 6974 6875 622e 636f 6d2f 6962 6973  /github.com/ibis
+00001f60: 2d70 726f 6a65 6374 2f69 6269 732f 6973  -project/ibis/is
+00001f70: 7375 6573 2f38 3439 340a 2020 2020 2020  sues/8494.      
+00001f80: 2020 2320 6861 7320 6265 656e 2066 6978    # has been fix
+00001f90: 6564 2e20 5468 6520 6962 6973 2063 6c69  ed. The ibis cli
+00001fa0: 656e 7420 6368 616e 6765 7320 7468 6520  ent changes the 
+00001fb0: 6465 6661 756c 7420 7175 6572 7920 6a6f  default query jo
+00001fc0: 6220 636f 6e66 6967 0a20 2020 2020 2020  b config.       
+00001fd0: 2023 2073 6f20 7765 2061 7265 2067 6f69   # so we are goi
+00001fe0: 6e67 2074 6f20 7265 6d65 6d62 6572 2074  ng to remember t
+00001ff0: 6865 2063 7572 7265 6e74 2063 6f6e 6669  he current confi
+00002000: 6720 616e 6420 7265 7374 6f72 6520 6974  g and restore it
+00002010: 2061 6674 6572 0a20 2020 2020 2020 2023   after.        #
+00002020: 2074 6865 2069 6269 7320 636c 6965 6e74   the ibis client
+00002030: 2068 6173 2062 6565 6e20 6372 6561 7465   has been create
+00002040: 640a 2020 2020 2020 2020 6f72 6967 696e  d.        origin
+00002050: 616c 5f64 6566 6175 6c74 5f71 7565 7279  al_default_query
+00002060: 5f6a 6f62 5f63 6f6e 6669 6720 3d20 7365  _job_config = se
+00002070: 6c66 2e62 7163 6c69 656e 742e 6465 6661  lf.bqclient.defa
+00002080: 756c 745f 7175 6572 795f 6a6f 625f 636f  ult_query_job_co
+00002090: 6e66 6967 0a0a 2020 2020 2020 2020 7365  nfig..        se
+000020a0: 6c66 2e69 6269 735f 636c 6965 6e74 203d  lf.ibis_client =
+000020b0: 2074 7970 696e 672e 6361 7374 280a 2020   typing.cast(.  
+000020c0: 2020 2020 2020 2020 2020 6962 6973 5f62            ibis_b
+000020d0: 6967 7175 6572 792e 4261 636b 656e 642c  igquery.Backend,
+000020e0: 0a20 2020 2020 2020 2020 2020 2069 6269  .            ibi
+000020f0: 732e 6269 6771 7565 7279 2e63 6f6e 6e65  s.bigquery.conne
+00002100: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
+00002110: 2020 2020 7072 6f6a 6563 745f 6964 3d63      project_id=c
+00002120: 6f6e 7465 7874 2e70 726f 6a65 6374 2c0a  ontext.project,.
+00002130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002140: 636c 6965 6e74 3d73 656c 662e 6271 636c  client=self.bqcl
+00002150: 6965 6e74 2c0a 2020 2020 2020 2020 2020  ient,.          
+00002160: 2020 2020 2020 7374 6f72 6167 655f 636c        storage_cl
+00002170: 6965 6e74 3d73 656c 662e 6271 7374 6f72  ient=self.bqstor
+00002180: 6167 6572 6561 6463 6c69 656e 742c 0a20  agereadclient,. 
+00002190: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+000021a0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000021b0: 2073 656c 662e 6271 636c 6965 6e74 2e64   self.bqclient.d
+000021c0: 6566 6175 6c74 5f71 7565 7279 5f6a 6f62  efault_query_job
+000021d0: 5f63 6f6e 6669 6720 3d20 6f72 6967 696e  _config = origin
+000021e0: 616c 5f64 6566 6175 6c74 5f71 7565 7279  al_default_query
+000021f0: 5f6a 6f62 5f63 6f6e 6669 670a 0a20 2020  _job_config..   
+00002200: 2020 2020 2023 2052 6573 6f6c 7665 2074       # Resolve t
+00002210: 6865 2042 5120 636f 6e6e 6563 7469 6f6e  he BQ connection
+00002220: 2066 6f72 2072 656d 6f74 6520 6675 6e63   for remote func
+00002230: 7469 6f6e 2061 6e64 2056 6572 7465 7820  tion and Vertex 
+00002240: 4149 2069 6e74 6567 7261 7469 6f6e 0a20  AI integration. 
+00002250: 2020 2020 2020 2073 656c 662e 5f62 715f         self._bq_
+00002260: 636f 6e6e 6563 7469 6f6e 203d 2063 6f6e  connection = con
+00002270: 7465 7874 2e62 715f 636f 6e6e 6563 7469  text.bq_connecti
+00002280: 6f6e 206f 7220 5f42 4947 4652 414d 4553  on or _BIGFRAMES
+00002290: 5f44 4546 4155 4c54 5f43 4f4e 4e45 4354  _DEFAULT_CONNECT
+000022a0: 494f 4e5f 4944 0a20 2020 2020 2020 2073  ION_ID.        s
+000022b0: 656c 662e 5f73 6b69 705f 6271 5f63 6f6e  elf._skip_bq_con
+000022c0: 6e65 6374 696f 6e5f 6368 6563 6b20 3d20  nection_check = 
+000022d0: 636f 6e74 6578 742e 5f73 6b69 705f 6271  context._skip_bq
+000022e0: 5f63 6f6e 6e65 6374 696f 6e5f 6368 6563  _connection_chec
+000022f0: 6b0a 0a20 2020 2020 2020 2023 204e 6f77  k..        # Now
+00002300: 2074 6861 7420 7765 2772 6520 7374 6172   that we're star
+00002310: 7469 6e67 2074 6865 2073 6573 7369 6f6e  ting the session
+00002320: 2c20 646f 6e27 7420 616c 6c6f 7720 7468  , don't allow th
+00002330: 6520 6f70 7469 6f6e 7320 746f 2062 650a  e options to be.
+00002340: 2020 2020 2020 2020 2320 6368 616e 6765          # change
+00002350: 642e 0a20 2020 2020 2020 2063 6f6e 7465  d..        conte
+00002360: 7874 2e5f 7365 7373 696f 6e5f 7374 6172  xt._session_star
+00002370: 7465 6420 3d20 5472 7565 0a20 2020 2020  ted = True.     
+00002380: 2020 2073 656c 662e 5f64 665f 736e 6170     self._df_snap
+00002390: 7368 6f74 3a20 4469 6374 5b0a 2020 2020  shot: Dict[.    
+000023a0: 2020 2020 2020 2020 6269 6771 7565 7279          bigquery
+000023b0: 2e54 6162 6c65 5265 6665 7265 6e63 652c  .TableReference,
+000023c0: 2054 7570 6c65 5b64 6174 6574 696d 652e   Tuple[datetime.
+000023d0: 6461 7465 7469 6d65 2c20 6269 6771 7565  datetime, bigque
+000023e0: 7279 2e54 6162 6c65 5d0a 2020 2020 2020  ry.Table].      
+000023f0: 2020 5d20 3d20 7b7d 0a0a 2020 2020 2020    ] = {}..      
+00002400: 2020 2320 756e 6971 7565 2073 6573 7369    # unique sessi
+00002410: 6f6e 2069 6465 6e74 6966 6965 722c 2073  on identifier, s
+00002420: 686f 7274 2065 6e6f 7567 6820 746f 2062  hort enough to b
+00002430: 6520 6875 6d61 6e20 7265 6164 6162 6c65  e human readable
+00002440: 0a20 2020 2020 2020 2023 206f 6e6c 7920  .        # only 
+00002450: 6e65 6564 7320 746f 2062 6520 756e 6971  needs to be uniq
+00002460: 7565 2061 6d6f 6e67 2073 6573 7369 6f6e  ue among session
+00002470: 7320 6372 6561 7465 6420 6279 2074 6865  s created by the
+00002480: 2073 616d 6520 7573 6572 0a20 2020 2020   same user.     
+00002490: 2020 2023 2061 7420 7468 6520 7361 6d65     # at the same
+000024a0: 2074 696d 6520 696e 2074 6865 2073 616d   time in the sam
+000024b0: 6520 7265 6769 6f6e 0a20 2020 2020 2020  e region.       
+000024c0: 2073 656c 662e 5f73 6573 7369 6f6e 5f69   self._session_i
+000024d0: 643a 2073 7472 203d 2022 7365 7373 696f  d: str = "sessio
+000024e0: 6e22 202b 2073 6563 7265 7473 2e74 6f6b  n" + secrets.tok
+000024f0: 656e 5f68 6578 2833 290a 2020 2020 2020  en_hex(3).      
+00002500: 2020 7365 6c66 2e5f 7461 626c 655f 6964    self._table_id
+00002510: 733a 204c 6973 745b 7374 725d 203d 205b  s: List[str] = [
+00002520: 5d0a 2020 2020 2020 2020 2320 7374 6f72  ].        # stor
+00002530: 6520 7461 626c 6520 6964 7320 616e 6420  e table ids and 
+00002540: 6465 6c65 7465 2074 6865 6d20 7768 656e  delete them when
+00002550: 2074 6865 2073 6573 7369 6f6e 2069 7320   the session is 
+00002560: 636c 6f73 6564 0a0a 2020 2020 4070 726f  closed..    @pro
+00002570: 7065 7274 790a 2020 2020 6465 6620 6271  perty.    def bq
+00002580: 636c 6965 6e74 2873 656c 6629 3a0a 2020  client(self):.  
+00002590: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000025a0: 662e 5f63 6c69 656e 7473 5f70 726f 7669  f._clients_provi
+000025b0: 6465 722e 6271 636c 6965 6e74 0a0a 2020  der.bqclient..  
+000025c0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+000025d0: 6465 6620 6271 636f 6e6e 6563 7469 6f6e  def bqconnection
+000025e0: 636c 6965 6e74 2873 656c 6629 3a0a 2020  client(self):.  
+000025f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00002600: 662e 5f63 6c69 656e 7473 5f70 726f 7669  f._clients_provi
+00002610: 6465 722e 6271 636f 6e6e 6563 7469 6f6e  der.bqconnection
+00002620: 636c 6965 6e74 0a0a 2020 2020 4070 726f  client..    @pro
+00002630: 7065 7274 790a 2020 2020 6465 6620 6271  perty.    def bq
+00002640: 7374 6f72 6167 6572 6561 6463 6c69 656e  storagereadclien
+00002650: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
+00002660: 2072 6574 7572 6e20 7365 6c66 2e5f 636c   return self._cl
+00002670: 6965 6e74 735f 7072 6f76 6964 6572 2e62  ients_provider.b
+00002680: 7173 746f 7261 6765 7265 6164 636c 6965  qstoragereadclie
+00002690: 6e74 0a0a 2020 2020 4070 726f 7065 7274  nt..    @propert
+000026a0: 790a 2020 2020 6465 6620 636c 6f75 6466  y.    def cloudf
+000026b0: 756e 6374 696f 6e73 636c 6965 6e74 2873  unctionsclient(s
+000026c0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+000026d0: 7475 726e 2073 656c 662e 5f63 6c69 656e  turn self._clien
+000026e0: 7473 5f70 726f 7669 6465 722e 636c 6f75  ts_provider.clou
+000026f0: 6466 756e 6374 696f 6e73 636c 6965 6e74  dfunctionsclient
+00002700: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+00002710: 2020 2020 6465 6620 7265 736f 7572 6365      def resource
+00002720: 6d61 6e61 6765 7263 6c69 656e 7428 7365  managerclient(se
+00002730: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+00002740: 7572 6e20 7365 6c66 2e5f 636c 6965 6e74  urn self._client
+00002750: 735f 7072 6f76 6964 6572 2e72 6573 6f75  s_provider.resou
+00002760: 7263 656d 616e 6167 6572 636c 6965 6e74  rcemanagerclient
+00002770: 0a0a 2020 2020 5f62 715f 636f 6e6e 6563  ..    _bq_connec
+00002780: 7469 6f6e 5f6d 616e 6167 6572 3a20 4f70  tion_manager: Op
+00002790: 7469 6f6e 616c 5b62 6967 6672 616d 6573  tional[bigframes
+000027a0: 2e63 6c69 656e 7473 2e42 7143 6f6e 6e65  .clients.BqConne
+000027b0: 6374 696f 6e4d 616e 6167 6572 5d20 3d20  ctionManager] = 
+000027c0: 4e6f 6e65 0a0a 2020 2020 4070 726f 7065  None..    @prope
+000027d0: 7274 790a 2020 2020 6465 6620 6271 636f  rty.    def bqco
+000027e0: 6e6e 6563 7469 6f6e 6d61 6e61 6765 7228  nnectionmanager(
+000027f0: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
+00002800: 6620 6e6f 7420 7365 6c66 2e5f 736b 6970  f not self._skip
+00002810: 5f62 715f 636f 6e6e 6563 7469 6f6e 5f63  _bq_connection_c
+00002820: 6865 636b 2061 6e64 206e 6f74 2073 656c  heck and not sel
+00002830: 662e 5f62 715f 636f 6e6e 6563 7469 6f6e  f._bq_connection
+00002840: 5f6d 616e 6167 6572 3a0a 2020 2020 2020  _manager:.      
+00002850: 2020 2020 2020 7365 6c66 2e5f 6271 5f63        self._bq_c
+00002860: 6f6e 6e65 6374 696f 6e5f 6d61 6e61 6765  onnection_manage
+00002870: 7220 3d20 6269 6766 7261 6d65 732e 636c  r = bigframes.cl
+00002880: 6965 6e74 732e 4271 436f 6e6e 6563 7469  ients.BqConnecti
+00002890: 6f6e 4d61 6e61 6765 7228 0a20 2020 2020  onManager(.     
+000028a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000028b0: 6271 636f 6e6e 6563 7469 6f6e 636c 6965  bqconnectionclie
+000028c0: 6e74 2c20 7365 6c66 2e72 6573 6f75 7263  nt, self.resourc
+000028d0: 656d 616e 6167 6572 636c 6965 6e74 0a20  emanagerclient. 
+000028e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000028f0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00002900: 2e5f 6271 5f63 6f6e 6e65 6374 696f 6e5f  ._bq_connection_
+00002910: 6d61 6e61 6765 720a 0a20 2020 2040 7072  manager..    @pr
+00002920: 6f70 6572 7479 0a20 2020 2064 6566 2073  operty.    def s
+00002930: 6573 7369 6f6e 5f69 6428 7365 6c66 293a  ession_id(self):
+00002940: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00002950: 7365 6c66 2e5f 7365 7373 696f 6e5f 6964  self._session_id
+00002960: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+00002970: 2020 2020 6465 6620 5f70 726f 6a65 6374      def _project
+00002980: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00002990: 7265 7475 726e 2073 656c 662e 6271 636c  return self.bqcl
+000029a0: 6965 6e74 2e70 726f 6a65 6374 0a0a 2020  ient.project..  
+000029b0: 2020 6465 6620 5f5f 6861 7368 5f5f 2873    def __hash__(s
+000029c0: 656c 6629 3a0a 2020 2020 2020 2020 2320  elf):.        # 
+000029d0: 5374 6162 6c65 2068 6173 6820 6e65 6564  Stable hash need
+000029e0: 6564 2074 6f20 7573 6520 696e 2065 7870  ed to use in exp
+000029f0: 7265 7373 696f 6e20 7472 6565 0a20 2020  ression tree.   
+00002a00: 2020 2020 2072 6574 7572 6e20 6861 7368       return hash
+00002a10: 2873 7472 2873 656c 662e 5f61 6e6f 6e79  (str(self._anony
+00002a20: 6d6f 7573 5f64 6174 6173 6574 2929 0a0a  mous_dataset))..
+00002a30: 2020 2020 6465 6620 636c 6f73 6528 7365      def close(se
+00002a40: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00002a50: 4465 6c65 7465 2074 6162 6c65 7320 7468  Delete tables th
+00002a60: 6174 2077 6572 6520 6372 6561 7465 6420  at were created 
+00002a70: 7769 7468 2074 6869 7320 7365 7373 696f  with this sessio
+00002a80: 6e27 7320 7365 7373 696f 6e5f 6964 2e22  n's session_id."
+00002a90: 2222 0a20 2020 2020 2020 2063 6c69 656e  "".        clien
+00002aa0: 7420 3d20 7365 6c66 2e62 7163 6c69 656e  t = self.bqclien
+00002ab0: 740a 2020 2020 2020 2020 7072 6f6a 6563  t.        projec
+00002ac0: 745f 6964 203d 2073 656c 662e 5f61 6e6f  t_id = self._ano
+00002ad0: 6e79 6d6f 7573 5f64 6174 6173 6574 2e70  nymous_dataset.p
+00002ae0: 726f 6a65 6374 0a20 2020 2020 2020 2064  roject.        d
+00002af0: 6174 6173 6574 5f69 6420 3d20 7365 6c66  ataset_id = self
+00002b00: 2e5f 616e 6f6e 796d 6f75 735f 6461 7461  ._anonymous_data
+00002b10: 7365 742e 6461 7461 7365 745f 6964 0a0a  set.dataset_id..
+00002b20: 2020 2020 2020 2020 666f 7220 7461 626c          for tabl
+00002b30: 655f 6964 2069 6e20 7365 6c66 2e5f 7461  e_id in self._ta
+00002b40: 626c 655f 6964 733a 0a20 2020 2020 2020  ble_ids:.       
+00002b50: 2020 2020 2066 756c 6c5f 6964 203d 2022       full_id = "
+00002b60: 2e22 2e6a 6f69 6e28 5b70 726f 6a65 6374  .".join([project
+00002b70: 5f69 642c 2064 6174 6173 6574 5f69 642c  _id, dataset_id,
+00002b80: 2074 6162 6c65 5f69 645d 290a 2020 2020   table_id]).    
+00002b90: 2020 2020 2020 2020 636c 6965 6e74 2e64          client.d
+00002ba0: 656c 6574 655f 7461 626c 6528 6675 6c6c  elete_table(full
+00002bb0: 5f69 642c 206e 6f74 5f66 6f75 6e64 5f6f  _id, not_found_o
+00002bc0: 6b3d 5472 7565 290a 0a20 2020 2064 6566  k=True)..    def
+00002bd0: 2072 6561 645f 6762 7128 0a20 2020 2020   read_gbq(.     
+00002be0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00002bf0: 2071 7565 7279 5f6f 725f 7461 626c 653a   query_or_table:
+00002c00: 2073 7472 2c0a 2020 2020 2020 2020 2a2c   str,.        *,
+00002c10: 0a20 2020 2020 2020 2069 6e64 6578 5f63  .        index_c
+00002c20: 6f6c 3a20 4974 6572 6162 6c65 5b73 7472  ol: Iterable[str
+00002c30: 5d20 7c20 7374 7220 7c20 6269 6766 7261  ] | str | bigfra
+00002c40: 6d65 732e 656e 756d 732e 4465 6661 756c  mes.enums.Defaul
+00002c50: 7449 6e64 6578 4b69 6e64 203d 2028 292c  tIndexKind = (),
+00002c60: 0a20 2020 2020 2020 2063 6f6c 756d 6e73  .        columns
+00002c70: 3a20 4974 6572 6162 6c65 5b73 7472 5d20  : Iterable[str] 
+00002c80: 3d20 2829 2c0a 2020 2020 2020 2020 636f  = (),.        co
+00002c90: 6e66 6967 7572 6174 696f 6e3a 204f 7074  nfiguration: Opt
+00002ca0: 696f 6e61 6c5b 4469 6374 5d20 3d20 4e6f  ional[Dict] = No
+00002cb0: 6e65 2c0a 2020 2020 2020 2020 6d61 785f  ne,.        max_
+00002cc0: 7265 7375 6c74 733a 204f 7074 696f 6e61  results: Optiona
+00002cd0: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
+00002ce0: 2020 2020 2020 2066 696c 7465 7273 3a20         filters: 
+00002cf0: 7468 6972 645f 7061 7274 795f 7061 6e64  third_party_pand
+00002d00: 6173 5f67 6271 2e46 696c 7465 7273 5479  as_gbq.FiltersTy
+00002d10: 7065 203d 2028 292c 0a20 2020 2020 2020  pe = (),.       
+00002d20: 2075 7365 5f63 6163 6865 3a20 4f70 7469   use_cache: Opti
+00002d30: 6f6e 616c 5b62 6f6f 6c5d 203d 204e 6f6e  onal[bool] = Non
+00002d40: 652c 0a20 2020 2020 2020 2063 6f6c 5f6f  e,.        col_o
+00002d50: 7264 6572 3a20 4974 6572 6162 6c65 5b73  rder: Iterable[s
+00002d60: 7472 5d20 3d20 2829 2c0a 2020 2020 2020  tr] = (),.      
+00002d70: 2020 2320 4164 6420 6120 7665 7269 6679    # Add a verify
+00002d80: 2069 6e64 6578 2061 7267 756d 656e 7420   index argument 
+00002d90: 7468 6174 2066 6169 6c73 2069 6620 7468  that fails if th
+00002da0: 6520 696e 6465 7820 6973 206e 6f74 2075  e index is not u
+00002db0: 6e69 7175 652e 0a20 2020 2029 202d 3e20  nique..    ) -> 
+00002dc0: 6461 7461 6672 616d 652e 4461 7461 4672  dataframe.DataFr
+00002dd0: 616d 653a 0a20 2020 2020 2020 2023 2054  ame:.        # T
+00002de0: 4f44 4f28 622f 3238 3135 3731 3231 3429  ODO(b/281571214)
+00002df0: 3a20 4765 6e65 7261 7465 2070 726f 6d70  : Generate promp
+00002e00: 7420 746f 2073 686f 7720 7468 6520 7072  t to show the pr
+00002e10: 6f67 7265 7373 206f 6620 7265 6164 5f67  ogress of read_g
+00002e20: 6271 2e0a 2020 2020 2020 2020 6966 2063  bq..        if c
+00002e30: 6f6c 756d 6e73 2061 6e64 2063 6f6c 5f6f  olumns and col_o
+00002e40: 7264 6572 3a0a 2020 2020 2020 2020 2020  rder:.          
+00002e50: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00002e60: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00002e70: 2020 2020 224d 7573 7420 7370 6563 6966      "Must specif
+00002e80: 7920 6569 7468 6572 2063 6f6c 756d 6e73  y either columns
+00002e90: 2028 7072 6566 6572 7265 6429 206f 7220   (preferred) or 
+00002ea0: 636f 6c5f 6f72 6465 722c 206e 6f74 2062  col_order, not b
+00002eb0: 6f74 6822 0a20 2020 2020 2020 2020 2020  oth".           
+00002ec0: 2029 0a20 2020 2020 2020 2065 6c69 6620   ).        elif 
+00002ed0: 636f 6c5f 6f72 6465 723a 0a20 2020 2020  col_order:.     
+00002ee0: 2020 2020 2020 2063 6f6c 756d 6e73 203d         columns =
+00002ef0: 2063 6f6c 5f6f 7264 6572 0a0a 2020 2020   col_order..    
+00002f00: 2020 2020 6966 2062 665f 696f 5f62 6967      if bf_io_big
+00002f10: 7175 6572 792e 6973 5f71 7565 7279 2871  query.is_query(q
+00002f20: 7565 7279 5f6f 725f 7461 626c 6529 3a0a  uery_or_table):.
+00002f30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00002f40: 726e 2073 656c 662e 5f72 6561 645f 6762  rn self._read_gb
+00002f50: 715f 7175 6572 7928 0a20 2020 2020 2020  q_query(.       
+00002f60: 2020 2020 2020 2020 2071 7565 7279 5f6f           query_o
+00002f70: 725f 7461 626c 652c 0a20 2020 2020 2020  r_table,.       
+00002f80: 2020 2020 2020 2020 2069 6e64 6578 5f63           index_c
+00002f90: 6f6c 3d69 6e64 6578 5f63 6f6c 2c0a 2020  ol=index_col,.  
+00002fa0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00002fb0: 6c75 6d6e 733d 636f 6c75 6d6e 732c 0a20  lumns=columns,. 
+00002fc0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00002fd0: 6f6e 6669 6775 7261 7469 6f6e 3d63 6f6e  onfiguration=con
+00002fe0: 6669 6775 7261 7469 6f6e 2c0a 2020 2020  figuration,.    
+00002ff0: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+00003000: 7265 7375 6c74 733d 6d61 785f 7265 7375  results=max_resu
+00003010: 6c74 732c 0a20 2020 2020 2020 2020 2020  lts,.           
+00003020: 2020 2020 2061 7069 5f6e 616d 653d 2272       api_name="r
+00003030: 6561 645f 6762 7122 2c0a 2020 2020 2020  ead_gbq",.      
+00003040: 2020 2020 2020 2020 2020 7573 655f 6361            use_ca
+00003050: 6368 653d 7573 655f 6361 6368 652c 0a20  che=use_cache,. 
+00003060: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00003070: 696c 7465 7273 3d66 696c 7465 7273 2c0a  ilters=filters,.
+00003080: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00003090: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000030a0: 2020 2020 2020 2020 6966 2063 6f6e 6669          if confi
+000030b0: 6775 7261 7469 6f6e 2069 7320 6e6f 7420  guration is not 
+000030c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000030d0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+000030e0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+000030f0: 2020 2020 2020 2020 2020 2020 2254 6865              "The
+00003100: 2027 636f 6e66 6967 7572 6174 696f 6e27   'configuration'
+00003110: 2061 7267 756d 656e 7420 6973 206e 6f74   argument is not
+00003120: 2061 6c6c 6f77 6564 2077 6865 6e20 220a   allowed when ".
+00003130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003140: 2020 2020 2264 6972 6563 746c 7920 7265      "directly re
+00003150: 6164 696e 6720 6672 6f6d 2061 2074 6162  ading from a tab
+00003160: 6c65 2e20 506c 6561 7365 2072 656d 6f76  le. Please remov
+00003170: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+00003180: 2020 2020 2020 2020 2227 636f 6e66 6967          "'config
+00003190: 7572 6174 696f 6e27 206f 7220 7573 6520  uration' or use 
+000031a0: 6120 7175 6572 792e 220a 2020 2020 2020  a query.".      
+000031b0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+000031c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000031d0: 7365 6c66 2e5f 7265 6164 5f67 6271 5f74  self._read_gbq_t
+000031e0: 6162 6c65 280a 2020 2020 2020 2020 2020  able(.          
+000031f0: 2020 2020 2020 7175 6572 795f 6f72 5f74        query_or_t
+00003200: 6162 6c65 2c0a 2020 2020 2020 2020 2020  able,.          
+00003210: 2020 2020 2020 696e 6465 785f 636f 6c3d        index_col=
+00003220: 696e 6465 785f 636f 6c2c 0a20 2020 2020  index_col,.     
+00003230: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+00003240: 6e73 3d63 6f6c 756d 6e73 2c0a 2020 2020  ns=columns,.    
+00003250: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+00003260: 7265 7375 6c74 733d 6d61 785f 7265 7375  results=max_resu
+00003270: 6c74 732c 0a20 2020 2020 2020 2020 2020  lts,.           
+00003280: 2020 2020 2061 7069 5f6e 616d 653d 2272       api_name="r
+00003290: 6561 645f 6762 7122 2c0a 2020 2020 2020  ead_gbq",.      
+000032a0: 2020 2020 2020 2020 2020 7573 655f 6361            use_ca
+000032b0: 6368 653d 7573 655f 6361 6368 6520 6966  che=use_cache if
+000032c0: 2075 7365 5f63 6163 6865 2069 7320 6e6f   use_cache is no
+000032d0: 7420 4e6f 6e65 2065 6c73 6520 5472 7565  t None else True
+000032e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000032f0: 2020 6669 6c74 6572 733d 6669 6c74 6572    filters=filter
+00003300: 732c 0a20 2020 2020 2020 2020 2020 2029  s,.            )
+00003310: 0a0a 2020 2020 6465 6620 5f71 7565 7279  ..    def _query
+00003320: 5f74 6f5f 6465 7374 696e 6174 696f 6e28  _to_destination(
+00003330: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00003340: 2020 2020 2020 2071 7565 7279 3a20 7374         query: st
+00003350: 722c 0a20 2020 2020 2020 2069 6e64 6578  r,.        index
+00003360: 5f63 6f6c 733a 204c 6973 745b 7374 725d  _cols: List[str]
+00003370: 2c0a 2020 2020 2020 2020 6170 695f 6e61  ,.        api_na
+00003380: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
+00003390: 2063 6f6e 6669 6775 7261 7469 6f6e 3a20   configuration: 
+000033a0: 6469 6374 203d 207b 2271 7565 7279 223a  dict = {"query":
+000033b0: 207b 2275 7365 5175 6572 7943 6163 6865   {"useQueryCache
+000033c0: 223a 2054 7275 657d 7d2c 0a20 2020 2020  ": True}},.     
+000033d0: 2020 2064 6f5f 636c 7573 7465 7269 6e67     do_clustering
+000033e0: 3d54 7275 652c 0a20 2020 2029 202d 3e20  =True,.    ) -> 
+000033f0: 5475 706c 655b 4f70 7469 6f6e 616c 5b62  Tuple[Optional[b
+00003400: 6967 7175 6572 792e 5461 626c 6552 6566  igquery.TableRef
+00003410: 6572 656e 6365 5d2c 2062 6967 7175 6572  erence], bigquer
+00003420: 792e 5175 6572 794a 6f62 5d3a 0a20 2020  y.QueryJob]:.   
+00003430: 2020 2020 2023 2049 6620 6120 6472 795f       # If a dry_
+00003440: 7275 6e20 696e 6469 6361 7465 7320 7468  run indicates th
+00003450: 6973 2069 7320 6e6f 7420 6120 7175 6572  is is not a quer
+00003460: 7920 7479 7065 206a 6f62 2c20 7468 656e  y type job, then
+00003470: 2064 6f6e 2774 0a20 2020 2020 2020 2023   don't.        #
+00003480: 2062 6f74 6865 7220 7472 7969 6e67 2074   bother trying t
+00003490: 6f20 646f 2061 2043 5245 4154 4520 5445  o do a CREATE TE
+000034a0: 4d50 2054 4142 4c45 202e 2e2e 2041 5320  MP TABLE ... AS 
+000034b0: 5345 4c45 4354 202e 2e2e 2073 7461 7465  SELECT ... state
+000034c0: 6d65 6e74 2e0a 2020 2020 2020 2020 6472  ment..        dr
+000034d0: 795f 7275 6e5f 636f 6e66 6967 203d 2062  y_run_config = b
+000034e0: 6967 7175 6572 792e 5175 6572 794a 6f62  igquery.QueryJob
+000034f0: 436f 6e66 6967 2829 0a20 2020 2020 2020  Config().       
+00003500: 2064 7279 5f72 756e 5f63 6f6e 6669 672e   dry_run_config.
+00003510: 6472 795f 7275 6e20 3d20 5472 7565 0a20  dry_run = True. 
+00003520: 2020 2020 2020 205f 2c20 6472 795f 7275         _, dry_ru
+00003530: 6e5f 6a6f 6220 3d20 7365 6c66 2e5f 7374  n_job = self._st
+00003540: 6172 745f 7175 6572 7928 7175 6572 792c  art_query(query,
+00003550: 206a 6f62 5f63 6f6e 6669 673d 6472 795f   job_config=dry_
+00003560: 7275 6e5f 636f 6e66 6967 290a 2020 2020  run_config).    
+00003570: 2020 2020 6966 2064 7279 5f72 756e 5f6a      if dry_run_j
+00003580: 6f62 2e73 7461 7465 6d65 6e74 5f74 7970  ob.statement_typ
+00003590: 6520 213d 2022 5345 4c45 4354 223a 0a20  e != "SELECT":. 
+000035a0: 2020 2020 2020 2020 2020 205f 2c20 7175             _, qu
+000035b0: 6572 795f 6a6f 6220 3d20 7365 6c66 2e5f  ery_job = self._
+000035c0: 7374 6172 745f 7175 6572 7928 7175 6572  start_query(quer
+000035d0: 7929 0a20 2020 2020 2020 2020 2020 2072  y).            r
+000035e0: 6574 7572 6e20 7175 6572 795f 6a6f 622e  eturn query_job.
+000035f0: 6465 7374 696e 6174 696f 6e2c 2071 7565  destination, que
+00003600: 7279 5f6a 6f62 0a0a 2020 2020 2020 2020  ry_job..        
+00003610: 2320 4372 6561 7465 2061 2074 6162 6c65  # Create a table
+00003620: 2074 6f20 776f 726b 6172 6f75 6e64 2042   to workaround B
+00003630: 6967 5175 6572 7920 3130 2047 4220 7175  igQuery 10 GB qu
+00003640: 6572 7920 7265 7375 6c74 7320 6c69 6d69  ery results limi
+00003650: 742e 2053 6565 3a0a 2020 2020 2020 2020  t. See:.        
+00003660: 2320 696e 7465 726e 616c 2069 7373 7565  # internal issue
+00003670: 2033 3033 3035 3733 3336 2e0a 2020 2020   303057336..    
+00003680: 2020 2020 2320 5369 6e63 6520 7765 2068      # Since we h
+00003690: 6176 6520 6120 6073 7461 7465 6d65 6e74  ave a `statement
+000036a0: 5f74 7970 6520 3d3d 2027 5345 4c45 4354  _type == 'SELECT
+000036b0: 2760 2c20 7363 6865 6d61 2073 686f 756c  '`, schema shoul
+000036c0: 6420 6265 2070 6f70 756c 6174 6564 2e0a  d be populated..
+000036d0: 2020 2020 2020 2020 7363 6865 6d61 203d          schema =
+000036e0: 2074 7970 696e 672e 6361 7374 2849 7465   typing.cast(Ite
+000036f0: 7261 626c 655b 6269 6771 7565 7279 2e53  rable[bigquery.S
+00003700: 6368 656d 6146 6965 6c64 5d2c 2064 7279  chemaField], dry
+00003710: 5f72 756e 5f6a 6f62 2e73 6368 656d 6129  _run_job.schema)
+00003720: 0a20 2020 2020 2020 2069 6620 646f 5f63  .        if do_c
+00003730: 6c75 7374 6572 696e 673a 0a20 2020 2020  lustering:.     
+00003740: 2020 2020 2020 2063 6c75 7374 6572 5f63         cluster_c
+00003750: 6f6c 7320 3d20 5b0a 2020 2020 2020 2020  ols = [.        
+00003760: 2020 2020 2020 2020 6974 656d 2e6e 616d          item.nam
+00003770: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00003780: 2020 666f 7220 6974 656d 2069 6e20 7363    for item in sc
+00003790: 6865 6d61 0a20 2020 2020 2020 2020 2020  hema.           
+000037a0: 2020 2020 2069 6620 2869 7465 6d2e 6e61       if (item.na
+000037b0: 6d65 2069 6e20 696e 6465 785f 636f 6c73  me in index_cols
+000037c0: 2920 616e 6420 5f63 616e 5f63 6c75 7374  ) and _can_clust
+000037d0: 6572 5f62 7128 6974 656d 290a 2020 2020  er_bq(item).    
+000037e0: 2020 2020 2020 2020 5d5b 3a5f 4d41 585f          ][:_MAX_
+000037f0: 434c 5553 5445 525f 434f 4c55 4d4e 535d  CLUSTER_COLUMNS]
+00003800: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00003810: 2020 2020 2020 2020 2020 2063 6c75 7374             clust
+00003820: 6572 5f63 6f6c 7320 3d20 5b5d 0a20 2020  er_cols = [].   
+00003830: 2020 2020 2074 656d 705f 7461 626c 6520       temp_table 
+00003840: 3d20 7365 6c66 2e5f 6372 6561 7465 5f65  = self._create_e
+00003850: 6d70 7479 5f74 656d 705f 7461 626c 6528  mpty_temp_table(
+00003860: 7363 6865 6d61 2c20 636c 7573 7465 725f  schema, cluster_
+00003870: 636f 6c73 290a 0a20 2020 2020 2020 2074  cols)..        t
+00003880: 696d 656f 7574 5f6d 7320 3d20 636f 6e66  imeout_ms = conf
+00003890: 6967 7572 6174 696f 6e2e 6765 7428 226a  iguration.get("j
+000038a0: 6f62 5469 6d65 6f75 744d 7322 2920 6f72  obTimeoutMs") or
+000038b0: 2063 6f6e 6669 6775 7261 7469 6f6e 5b22   configuration["
+000038c0: 7175 6572 7922 5d2e 6765 7428 0a20 2020  query"].get(.   
+000038d0: 2020 2020 2020 2020 2022 7469 6d65 6f75           "timeou
+000038e0: 744d 7322 0a20 2020 2020 2020 2029 0a0a  tMs".        )..
+000038f0: 2020 2020 2020 2020 2320 436f 6e76 6572          # Conver
+00003900: 7420 7469 6d65 6f75 745f 6d73 2074 6f20  t timeout_ms to 
+00003910: 7365 636f 6e64 732c 2065 6e73 7572 696e  seconds, ensurin
+00003920: 6720 6120 6d69 6e69 6d75 6d20 6f66 2030  g a minimum of 0
+00003930: 2e31 2073 6563 6f6e 6473 2074 6f20 6176  .1 seconds to av
+00003940: 6f69 640a 2020 2020 2020 2020 2320 7468  oid.        # th
+00003950: 6520 7072 6f67 7261 6d20 6765 7474 696e  e program gettin
+00003960: 6720 7374 7563 6b20 6f6e 2074 6f6f 2d73  g stuck on too-s
+00003970: 686f 7274 2074 696d 656f 7574 732e 0a20  hort timeouts.. 
+00003980: 2020 2020 2020 2074 696d 656f 7574 203d         timeout =
+00003990: 206d 6178 2869 6e74 2874 696d 656f 7574   max(int(timeout
+000039a0: 5f6d 7329 202a 2031 652d 332c 2030 2e31  _ms) * 1e-3, 0.1
+000039b0: 2920 6966 2074 696d 656f 7574 5f6d 7320  ) if timeout_ms 
+000039c0: 656c 7365 204e 6f6e 650a 0a20 2020 2020  else None..     
+000039d0: 2020 206a 6f62 5f63 6f6e 6669 6720 3d20     job_config = 
+000039e0: 7479 7069 6e67 2e63 6173 7428 0a20 2020  typing.cast(.   
+000039f0: 2020 2020 2020 2020 2062 6967 7175 6572           bigquer
+00003a00: 792e 5175 6572 794a 6f62 436f 6e66 6967  y.QueryJobConfig
+00003a10: 2c0a 2020 2020 2020 2020 2020 2020 6269  ,.            bi
+00003a20: 6771 7565 7279 2e51 7565 7279 4a6f 6243  gquery.QueryJobC
+00003a30: 6f6e 6669 672e 6672 6f6d 5f61 7069 5f72  onfig.from_api_r
+00003a40: 6570 7228 636f 6e66 6967 7572 6174 696f  epr(configuratio
+00003a50: 6e29 2c0a 2020 2020 2020 2020 290a 2020  n),.        ).  
+00003a60: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
+00003a70: 2e6c 6162 656c 735b 2262 6967 6672 616d  .labels["bigfram
+00003a80: 6573 2d61 7069 225d 203d 2061 7069 5f6e  es-api"] = api_n
+00003a90: 616d 650a 2020 2020 2020 2020 6a6f 625f  ame.        job_
+00003aa0: 636f 6e66 6967 2e64 6573 7469 6e61 7469  config.destinati
+00003ab0: 6f6e 203d 2074 656d 705f 7461 626c 650a  on = temp_table.
+00003ac0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00003ad0: 2020 2020 2020 2020 2020 2320 5772 6974            # Writ
+00003ae0: 6520 746f 2074 656d 7020 7461 626c 6520  e to temp table 
+00003af0: 746f 2077 6f72 6b61 726f 756e 6420 4269  to workaround Bi
+00003b00: 6751 7565 7279 2031 3020 4742 2071 7565  gQuery 10 GB que
+00003b10: 7279 2072 6573 756c 7473 0a20 2020 2020  ry results.     
+00003b20: 2020 2020 2020 2023 206c 696d 6974 2e20         # limit. 
+00003b30: 5365 653a 2069 6e74 6572 6e61 6c20 6973  See: internal is
+00003b40: 7375 6520 3330 3330 3537 3333 362e 0a20  sue 303057336.. 
+00003b50: 2020 2020 2020 2020 2020 206a 6f62 5f63             job_c
+00003b60: 6f6e 6669 672e 6c61 6265 6c73 5b22 6572  onfig.labels["er
+00003b70: 726f 725f 6361 7567 6874 225d 203d 2022  ror_caught"] = "
+00003b80: 7472 7565 220a 2020 2020 2020 2020 2020  true".          
+00003b90: 2020 5f2c 2071 7565 7279 5f6a 6f62 203d    _, query_job =
+00003ba0: 2073 656c 662e 5f73 7461 7274 5f71 7565   self._start_que
+00003bb0: 7279 280a 2020 2020 2020 2020 2020 2020  ry(.            
+00003bc0: 2020 2020 7175 6572 792c 206a 6f62 5f63      query, job_c
+00003bd0: 6f6e 6669 673d 6a6f 625f 636f 6e66 6967  onfig=job_config
+00003be0: 2c20 7469 6d65 6f75 743d 7469 6d65 6f75  , timeout=timeou
+00003bf0: 740a 2020 2020 2020 2020 2020 2020 290a  t.            ).
+00003c00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00003c10: 726e 2071 7565 7279 5f6a 6f62 2e64 6573  rn query_job.des
+00003c20: 7469 6e61 7469 6f6e 2c20 7175 6572 795f  tination, query_
+00003c30: 6a6f 620a 2020 2020 2020 2020 6578 6365  job.        exce
+00003c40: 7074 2067 6f6f 676c 652e 6170 695f 636f  pt google.api_co
+00003c50: 7265 2e65 7863 6570 7469 6f6e 732e 4261  re.exceptions.Ba
+00003c60: 6452 6571 7565 7374 3a0a 2020 2020 2020  dRequest:.      
+00003c70: 2020 2020 2020 2320 536f 6d65 2053 454c        # Some SEL
+00003c80: 4543 5420 7374 6174 656d 656e 7473 2073  ECT statements s
+00003c90: 7469 6c6c 2061 7265 6e27 7420 636f 6d70  till aren't comp
+00003ca0: 6174 6962 6c65 2077 6974 6820 636c 7573  atible with clus
+00003cb0: 7465 720a 2020 2020 2020 2020 2020 2020  ter.            
+00003cc0: 2320 7461 626c 6573 2061 7320 7468 6520  # tables as the 
+00003cd0: 6465 7374 696e 6174 696f 6e2e 2046 6f72  destination. For
+00003ce0: 2065 7861 6d70 6c65 2c20 6966 2074 6865   example, if the
+00003cf0: 2071 7565 7279 2068 6173 2061 0a20 2020   query has a.   
+00003d00: 2020 2020 2020 2020 2023 2074 6f70 2d6c           # top-l
+00003d10: 6576 656c 204f 5244 4552 2042 592c 2074  evel ORDER BY, t
+00003d20: 6869 7320 636f 6e66 6c69 6374 7320 7769  his conflicts wi
+00003d30: 7468 206f 7572 2061 6269 6c69 7479 2074  th our ability t
+00003d40: 6f20 636c 7573 7465 720a 2020 2020 2020  o cluster.      
+00003d50: 2020 2020 2020 2320 7468 6520 7461 626c        # the tabl
+00003d60: 6520 6279 2074 6865 2069 6e64 6578 2063  e by the index c
+00003d70: 6f6c 756d 6e28 7329 2e0a 2020 2020 2020  olumn(s)..      
+00003d80: 2020 2020 2020 5f2c 2071 7565 7279 5f6a        _, query_j
+00003d90: 6f62 203d 2073 656c 662e 5f73 7461 7274  ob = self._start
+00003da0: 5f71 7565 7279 2871 7565 7279 2c20 7469  _query(query, ti
+00003db0: 6d65 6f75 743d 7469 6d65 6f75 7429 0a20  meout=timeout). 
+00003dc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00003dd0: 6e20 7175 6572 795f 6a6f 622e 6465 7374  n query_job.dest
+00003de0: 696e 6174 696f 6e2c 2071 7565 7279 5f6a  ination, query_j
+00003df0: 6f62 0a0a 2020 2020 6465 6620 7265 6164  ob..    def read
+00003e00: 5f67 6271 5f71 7565 7279 280a 2020 2020  _gbq_query(.    
+00003e10: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00003e20: 2020 7175 6572 793a 2073 7472 2c0a 2020    query: str,.  
+00003e30: 2020 2020 2020 2a2c 0a20 2020 2020 2020        *,.       
+00003e40: 2069 6e64 6578 5f63 6f6c 3a20 4974 6572   index_col: Iter
+00003e50: 6162 6c65 5b73 7472 5d20 7c20 7374 7220  able[str] | str 
+00003e60: 7c20 6269 6766 7261 6d65 732e 656e 756d  | bigframes.enum
+00003e70: 732e 4465 6661 756c 7449 6e64 6578 4b69  s.DefaultIndexKi
+00003e80: 6e64 203d 2028 292c 0a20 2020 2020 2020  nd = (),.       
+00003e90: 2063 6f6c 756d 6e73 3a20 4974 6572 6162   columns: Iterab
+00003ea0: 6c65 5b73 7472 5d20 3d20 2829 2c0a 2020  le[str] = (),.  
+00003eb0: 2020 2020 2020 636f 6e66 6967 7572 6174        configurat
+00003ec0: 696f 6e3a 204f 7074 696f 6e61 6c5b 4469  ion: Optional[Di
+00003ed0: 6374 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ct] = None,.    
+00003ee0: 2020 2020 6d61 785f 7265 7375 6c74 733a      max_results:
+00003ef0: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
+00003f00: 204e 6f6e 652c 0a20 2020 2020 2020 2075   None,.        u
+00003f10: 7365 5f63 6163 6865 3a20 4f70 7469 6f6e  se_cache: Option
+00003f20: 616c 5b62 6f6f 6c5d 203d 204e 6f6e 652c  al[bool] = None,
+00003f30: 0a20 2020 2020 2020 2063 6f6c 5f6f 7264  .        col_ord
+00003f40: 6572 3a20 4974 6572 6162 6c65 5b73 7472  er: Iterable[str
+00003f50: 5d20 3d20 2829 2c0a 2020 2020 2020 2020  ] = (),.        
+00003f60: 6669 6c74 6572 733a 2074 6869 7264 5f70  filters: third_p
+00003f70: 6172 7479 5f70 616e 6461 735f 6762 712e  arty_pandas_gbq.
+00003f80: 4669 6c74 6572 7354 7970 6520 3d20 2829  FiltersType = ()
+00003f90: 2c0a 2020 2020 2920 2d3e 2064 6174 6166  ,.    ) -> dataf
+00003fa0: 7261 6d65 2e44 6174 6146 7261 6d65 3a0a  rame.DataFrame:.
+00003fb0: 2020 2020 2020 2020 2222 2254 7572 6e20          """Turn 
+00003fc0: 6120 5351 4c20 7175 6572 7920 696e 746f  a SQL query into
+00003fd0: 2061 2044 6174 6146 7261 6d65 2e0a 0a20   a DataFrame... 
+00003fe0: 2020 2020 2020 204e 6f74 653a 2042 6563         Note: Bec
+00003ff0: 6175 7365 2074 6865 2072 6573 756c 7473  ause the results
+00004000: 2061 7265 2077 7269 7474 656e 2074 6f20   are written to 
+00004010: 6120 7465 6d70 6f72 6172 7920 7461 626c  a temporary tabl
+00004020: 652c 206f 7264 6572 696e 6720 6279 0a20  e, ordering by. 
+00004030: 2020 2020 2020 2060 604f 5244 4552 2042         ``ORDER B
+00004040: 5960 6020 6973 206e 6f74 2070 7265 7365  Y`` is not prese
+00004050: 7276 6564 2e20 4120 756e 6971 7565 2060  rved. A unique `
+00004060: 696e 6465 785f 636f 6c60 2069 7320 7265  index_col` is re
+00004070: 636f 6d6d 656e 6465 642e 2055 7365 0a20  commended. Use. 
+00004080: 2020 2020 2020 2060 6072 6f77 5f6e 756d         ``row_num
+00004090: 6265 7228 2920 6f76 6572 2028 2960 6020  ber() over ()`` 
+000040a0: 6966 2074 6865 7265 2069 7320 6e6f 206e  if there is no n
+000040b0: 6174 7572 616c 2075 6e69 7175 6520 696e  atural unique in
+000040c0: 6465 7820 6f72 2079 6f75 0a20 2020 2020  dex or you.     
+000040d0: 2020 2077 616e 7420 746f 2070 7265 7365     want to prese
+000040e0: 7276 6520 6f72 6465 7269 6e67 2e0a 0a20  rve ordering... 
+000040f0: 2020 2020 2020 202a 2a45 7861 6d70 6c65         **Example
+00004100: 733a 2a2a 0a0a 2020 2020 2020 2020 2020  s:**..          
+00004110: 2020 3e3e 3e20 696d 706f 7274 2062 6967    >>> import big
+00004120: 6672 616d 6573 2e70 616e 6461 7320 6173  frames.pandas as
+00004130: 2062 7064 0a20 2020 2020 2020 2020 2020   bpd.           
+00004140: 203e 3e3e 2062 7064 2e6f 7074 696f 6e73   >>> bpd.options
+00004150: 2e64 6973 706c 6179 2e70 726f 6772 6573  .display.progres
+00004160: 735f 6261 7220 3d20 4e6f 6e65 0a0a 2020  s_bar = None..  
+00004170: 2020 2020 2020 5369 6d70 6c65 2071 7565        Simple que
+00004180: 7279 2069 6e70 7574 3a0a 0a20 2020 2020  ry input:..     
+00004190: 2020 2020 2020 203e 3e3e 2064 6620 3d20         >>> df = 
+000041a0: 6270 642e 7265 6164 5f67 6271 5f71 7565  bpd.read_gbq_que
+000041b0: 7279 2827 2727 0a20 2020 2020 2020 2020  ry('''.         
+000041c0: 2020 202e 2e2e 2020 2020 5345 4c45 4354     ...    SELECT
+000041d0: 0a20 2020 2020 2020 2020 2020 202e 2e2e  .            ...
+000041e0: 2020 2020 2020 2070 6974 6368 6572 4669         pitcherFi
+000041f0: 7273 744e 616d 652c 0a20 2020 2020 2020  rstName,.       
+00004200: 2020 2020 202e 2e2e 2020 2020 2020 2070       ...       p
+00004210: 6974 6368 6572 4c61 7374 4e61 6d65 2c0a  itcherLastName,.
+00004220: 2020 2020 2020 2020 2020 2020 2e2e 2e20              ... 
+00004230: 2020 2020 2020 7069 7463 6853 7065 6564        pitchSpeed
+00004240: 2c0a 2020 2020 2020 2020 2020 2020 2e2e  ,.            ..
+00004250: 2e20 2020 2046 524f 4d20 6062 6967 7175  .    FROM `bigqu
+00004260: 6572 792d 7075 626c 6963 2d64 6174 612e  ery-public-data.
+00004270: 6261 7365 6261 6c6c 2e67 616d 6573 5f77  baseball.games_w
+00004280: 6964 6560 0a20 2020 2020 2020 2020 2020  ide`.           
+00004290: 202e 2e2e 2027 2727 290a 0a20 2020 2020   ... ''')..     
+000042a0: 2020 2050 7265 7365 7276 6520 6f72 6465     Preserve orde
+000042b0: 7269 6e67 2069 6e20 6120 7175 6572 7920  ring in a query 
+000042c0: 696e 7075 742e 0a0a 2020 2020 2020 2020  input...        
+000042d0: 2020 2020 3e3e 3e20 6466 203d 2062 7064      >>> df = bpd
+000042e0: 2e72 6561 645f 6762 715f 7175 6572 7928  .read_gbq_query(
+000042f0: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
+00004300: 2e2e 2e20 2020 2053 454c 4543 540a 2020  ...    SELECT.  
+00004310: 2020 2020 2020 2020 2020 2e2e 2e20 2020            ...   
+00004320: 2020 2020 2d2d 2049 6e73 7465 6164 206f      -- Instead o
+00004330: 6620 616e 204f 5244 4552 2042 5920 636c  f an ORDER BY cl
+00004340: 6175 7365 206f 6e20 7468 6520 7175 6572  ause on the quer
+00004350: 792c 2075 7365 0a20 2020 2020 2020 2020  y, use.         
+00004360: 2020 202e 2e2e 2020 2020 2020 202d 2d20     ...       -- 
+00004370: 524f 575f 4e55 4d42 4552 2829 2074 6f20  ROW_NUMBER() to 
+00004380: 6372 6561 7465 2061 6e20 6f72 6465 7265  create an ordere
+00004390: 6420 4461 7461 4672 616d 652e 0a20 2020  d DataFrame..   
+000043a0: 2020 2020 2020 2020 202e 2e2e 2020 2020           ...    
+000043b0: 2020 2052 4f57 5f4e 554d 4245 5228 2920     ROW_NUMBER() 
+000043c0: 4f56 4552 2028 4f52 4445 5220 4259 2041  OVER (ORDER BY A
+000043d0: 5647 2870 6974 6368 5370 6565 6429 2044  VG(pitchSpeed) D
+000043e0: 4553 4329 0a20 2020 2020 2020 2020 2020  ESC).           
+000043f0: 202e 2e2e 2020 2020 2020 2020 2041 5320   ...         AS 
+00004400: 726f 7769 6e64 6578 2c0a 2020 2020 2020  rowindex,.      
+00004410: 2020 2020 2020 2e2e 2e0a 2020 2020 2020        ....      
+00004420: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
+00004430: 7069 7463 6865 7246 6972 7374 4e61 6d65  pitcherFirstName
+00004440: 2c0a 2020 2020 2020 2020 2020 2020 2e2e  ,.            ..
+00004450: 2e20 2020 2020 2020 7069 7463 6865 724c  .       pitcherL
+00004460: 6173 744e 616d 652c 0a20 2020 2020 2020  astName,.       
+00004470: 2020 2020 202e 2e2e 2020 2020 2020 2041       ...       A
+00004480: 5647 2870 6974 6368 5370 6565 6429 2041  VG(pitchSpeed) A
+00004490: 5320 6176 6572 6167 6550 6974 6368 5370  S averagePitchSp
+000044a0: 6565 640a 2020 2020 2020 2020 2020 2020  eed.            
+000044b0: 2e2e 2e20 2020 2020 4652 4f4d 2060 6269  ...     FROM `bi
+000044c0: 6771 7565 7279 2d70 7562 6c69 632d 6461  gquery-public-da
+000044d0: 7461 2e62 6173 6562 616c 6c2e 6761 6d65  ta.baseball.game
+000044e0: 735f 7769 6465 600a 2020 2020 2020 2020  s_wide`.        
+000044f0: 2020 2020 2e2e 2e20 2020 2020 5748 4552      ...     WHER
+00004500: 4520 7965 6172 203d 2032 3031 360a 2020  E year = 2016.  
+00004510: 2020 2020 2020 2020 2020 2e2e 2e20 2020            ...   
+00004520: 2020 4752 4f55 5020 4259 2070 6974 6368    GROUP BY pitch
+00004530: 6572 4669 7273 744e 616d 652c 2070 6974  erFirstName, pit
+00004540: 6368 6572 4c61 7374 4e61 6d65 0a20 2020  cherLastName.   
+00004550: 2020 2020 2020 2020 202e 2e2e 2027 2727           ... '''
+00004560: 2c20 696e 6465 785f 636f 6c3d 2272 6f77  , index_col="row
+00004570: 696e 6465 7822 290a 2020 2020 2020 2020  index").        
+00004580: 2020 2020 3e3e 3e20 6466 2e68 6561 6428      >>> df.head(
+00004590: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
+000045a0: 2020 2020 2020 2020 7069 7463 6865 7246          pitcherF
+000045b0: 6972 7374 4e61 6d65 2070 6974 6368 6572  irstName pitcher
+000045c0: 4c61 7374 4e61 6d65 2020 6176 6572 6167  LastName  averag
+000045d0: 6550 6974 6368 5370 6565 640a 2020 2020  ePitchSpeed.    
+000045e0: 2020 2020 2020 2020 726f 7769 6e64 6578          rowindex
+000045f0: 0a20 2020 2020 2020 2020 2020 2031 2020  .            1  
+00004600: 2020 2020 2020 2020 2020 2020 2020 416c                Al
+00004610: 6265 7274 696e 2020 2020 2020 2020 2043  bertin         C
+00004620: 6861 706d 616e 2020 2020 2020 2020 2020  hapman          
+00004630: 3936 2e35 3134 3131 330a 2020 2020 2020  96.514113.      
+00004640: 2020 2020 2020 3220 2020 2020 2020 2020        2         
+00004650: 2020 2020 2020 2020 5a61 6368 6172 7920          Zachary 
+00004660: 2020 2020 2020 2020 4272 6974 746f 6e20          Britton 
+00004670: 2020 2020 2020 2020 2039 342e 3539 3130           94.5910
+00004680: 3339 0a20 2020 2020 2020 2020 2020 203c  39.            <
+00004690: 424c 414e 4b4c 494e 453e 0a20 2020 2020  BLANKLINE>.     
+000046a0: 2020 2020 2020 205b 3220 726f 7773 2078         [2 rows x
+000046b0: 2033 2063 6f6c 756d 6e73 5d0a 0a20 2020   3 columns]..   
+000046c0: 2020 2020 2053 6565 2061 6c73 6f3a 203a       See also: :
+000046d0: 6d65 7468 3a60 5365 7373 696f 6e2e 7265  meth:`Session.re
+000046e0: 6164 5f67 6271 602e 0a20 2020 2020 2020  ad_gbq`..       
+000046f0: 2022 2222 0a20 2020 2020 2020 2023 204e   """.        # N
+00004700: 4f54 453a 2054 6869 7320 6d65 7468 6f64  OTE: This method
+00004710: 2064 6f65 736e 2774 2028 7965 7429 2065   doesn't (yet) e
+00004720: 7869 7374 2069 6e20 7061 6e64 6173 206f  xist in pandas o
+00004730: 7220 7061 6e64 6173 2d67 6271 2c20 736f  r pandas-gbq, so
+00004740: 0a20 2020 2020 2020 2023 2074 6865 7365  .        # these
+00004750: 2064 6f63 7374 7269 6e67 7320 6172 6520   docstrings are 
+00004760: 696e 6c69 6e65 2e0a 2020 2020 2020 2020  inline..        
+00004770: 6966 2063 6f6c 756d 6e73 2061 6e64 2063  if columns and c
+00004780: 6f6c 5f6f 7264 6572 3a0a 2020 2020 2020  ol_order:.      
+00004790: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+000047a0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+000047b0: 2020 2020 2020 2020 224d 7573 7420 7370          "Must sp
+000047c0: 6563 6966 7920 6569 7468 6572 2063 6f6c  ecify either col
+000047d0: 756d 6e73 2028 7072 6566 6572 7265 6429  umns (preferred)
+000047e0: 206f 7220 636f 6c5f 6f72 6465 722c 206e   or col_order, n
+000047f0: 6f74 2062 6f74 6822 0a20 2020 2020 2020  ot both".       
+00004800: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+00004810: 6c69 6620 636f 6c5f 6f72 6465 723a 0a20  lif col_order:. 
+00004820: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+00004830: 6e73 203d 2063 6f6c 5f6f 7264 6572 0a0a  ns = col_order..
+00004840: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00004850: 656c 662e 5f72 6561 645f 6762 715f 7175  elf._read_gbq_qu
+00004860: 6572 7928 0a20 2020 2020 2020 2020 2020  ery(.           
+00004870: 2071 7565 7279 3d71 7565 7279 2c0a 2020   query=query,.  
+00004880: 2020 2020 2020 2020 2020 696e 6465 785f            index_
+00004890: 636f 6c3d 696e 6465 785f 636f 6c2c 0a20  col=index_col,. 
+000048a0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+000048b0: 6e73 3d63 6f6c 756d 6e73 2c0a 2020 2020  ns=columns,.    
+000048c0: 2020 2020 2020 2020 636f 6e66 6967 7572          configur
+000048d0: 6174 696f 6e3d 636f 6e66 6967 7572 6174  ation=configurat
+000048e0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+000048f0: 206d 6178 5f72 6573 756c 7473 3d6d 6178   max_results=max
+00004900: 5f72 6573 756c 7473 2c0a 2020 2020 2020  _results,.      
+00004910: 2020 2020 2020 6170 695f 6e61 6d65 3d22        api_name="
+00004920: 7265 6164 5f67 6271 5f71 7565 7279 222c  read_gbq_query",
+00004930: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
+00004940: 5f63 6163 6865 3d75 7365 5f63 6163 6865  _cache=use_cache
+00004950: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
+00004960: 6c74 6572 733d 6669 6c74 6572 732c 0a20  lters=filters,. 
+00004970: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00004980: 6620 5f72 6561 645f 6762 715f 7175 6572  f _read_gbq_quer
+00004990: 7928 0a20 2020 2020 2020 2073 656c 662c  y(.        self,
+000049a0: 0a20 2020 2020 2020 2071 7565 7279 3a20  .        query: 
+000049b0: 7374 722c 0a20 2020 2020 2020 202a 2c0a  str,.        *,.
+000049c0: 2020 2020 2020 2020 696e 6465 785f 636f          index_co
+000049d0: 6c3a 2049 7465 7261 626c 655b 7374 725d  l: Iterable[str]
+000049e0: 207c 2073 7472 207c 2062 6967 6672 616d   | str | bigfram
+000049f0: 6573 2e65 6e75 6d73 2e44 6566 6175 6c74  es.enums.Default
+00004a00: 496e 6465 784b 696e 6420 3d20 2829 2c0a  IndexKind = (),.
+00004a10: 2020 2020 2020 2020 636f 6c75 6d6e 733a          columns:
+00004a20: 2049 7465 7261 626c 655b 7374 725d 203d   Iterable[str] =
+00004a30: 2028 292c 0a20 2020 2020 2020 2063 6f6e   (),.        con
+00004a40: 6669 6775 7261 7469 6f6e 3a20 4f70 7469  figuration: Opti
+00004a50: 6f6e 616c 5b44 6963 745d 203d 204e 6f6e  onal[Dict] = Non
+00004a60: 652c 0a20 2020 2020 2020 206d 6178 5f72  e,.        max_r
+00004a70: 6573 756c 7473 3a20 4f70 7469 6f6e 616c  esults: Optional
+00004a80: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
+00004a90: 2020 2020 2020 6170 695f 6e61 6d65 3a20        api_name: 
+00004aa0: 7374 7220 3d20 2272 6561 645f 6762 715f  str = "read_gbq_
+00004ab0: 7175 6572 7922 2c0a 2020 2020 2020 2020  query",.        
+00004ac0: 7573 655f 6361 6368 653a 204f 7074 696f  use_cache: Optio
+00004ad0: 6e61 6c5b 626f 6f6c 5d20 3d20 4e6f 6e65  nal[bool] = None
+00004ae0: 2c0a 2020 2020 2020 2020 6669 6c74 6572  ,.        filter
+00004af0: 733a 2074 6869 7264 5f70 6172 7479 5f70  s: third_party_p
+00004b00: 616e 6461 735f 6762 712e 4669 6c74 6572  andas_gbq.Filter
+00004b10: 7354 7970 6520 3d20 2829 2c0a 2020 2020  sType = (),.    
+00004b20: 2920 2d3e 2064 6174 6166 7261 6d65 2e44  ) -> dataframe.D
+00004b30: 6174 6146 7261 6d65 3a0a 2020 2020 2020  ataFrame:.      
+00004b40: 2020 696d 706f 7274 2062 6967 6672 616d    import bigfram
+00004b50: 6573 2e64 6174 6166 7261 6d65 2061 7320  es.dataframe as 
+00004b60: 6461 7461 6672 616d 650a 0a20 2020 2020  dataframe..     
+00004b70: 2020 2063 6f6e 6669 6775 7261 7469 6f6e     configuration
+00004b80: 203d 205f 7472 616e 7366 6f72 6d5f 7265   = _transform_re
+00004b90: 6164 5f67 6271 5f63 6f6e 6669 6775 7261  ad_gbq_configura
+00004ba0: 7469 6f6e 2863 6f6e 6669 6775 7261 7469  tion(configurati
+00004bb0: 6f6e 290a 0a20 2020 2020 2020 2069 6620  on)..        if 
+00004bc0: 2271 7565 7279 2220 6e6f 7420 696e 2063  "query" not in c
+00004bd0: 6f6e 6669 6775 7261 7469 6f6e 3a0a 2020  onfiguration:.  
+00004be0: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00004bf0: 7572 6174 696f 6e5b 2271 7565 7279 225d  uration["query"]
+00004c00: 203d 207b 7d0a 0a20 2020 2020 2020 2069   = {}..        i
+00004c10: 6620 2271 7565 7279 2220 696e 2063 6f6e  f "query" in con
+00004c20: 6669 6775 7261 7469 6f6e 5b22 7175 6572  figuration["quer
+00004c30: 7922 5d3a 0a20 2020 2020 2020 2020 2020  y"]:.           
+00004c40: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00004c50: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00004c60: 2020 2022 5468 6520 7175 6572 7920 7374     "The query st
+00004c70: 6174 656d 656e 7420 6d75 7374 206e 6f74  atement must not
+00004c80: 2062 6520 696e 636c 7564 6564 2069 6e20   be included in 
+00004c90: 7468 6520 222c 0a20 2020 2020 2020 2020  the ",.         
+00004ca0: 2020 2020 2020 2022 2763 6f6e 6669 6775         "'configu
+00004cb0: 7261 7469 6f6e 2720 6265 6361 7573 6520  ration' because 
+00004cc0: 6974 2069 7320 616c 7265 6164 7920 7072  it is already pr
+00004cd0: 6f76 6964 6564 2061 7322 2c0a 2020 2020  ovided as",.    
+00004ce0: 2020 2020 2020 2020 2020 2020 2220 6120              " a 
+00004cf0: 7365 7061 7261 7465 2070 6172 616d 6574  separate paramet
+00004d00: 6572 2e22 2c0a 2020 2020 2020 2020 2020  er.",.          
+00004d10: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+00004d20: 2275 7365 5175 6572 7943 6163 6865 2220  "useQueryCache" 
+00004d30: 696e 2063 6f6e 6669 6775 7261 7469 6f6e  in configuration
+00004d40: 5b22 7175 6572 7922 5d3a 0a20 2020 2020  ["query"]:.     
+00004d50: 2020 2020 2020 2069 6620 7573 655f 6361         if use_ca
+00004d60: 6368 6520 6973 206e 6f74 204e 6f6e 653a  che is not None:
+00004d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004d80: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00004d90: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00004da0: 2020 2020 2020 2022 2775 7365 5175 6572         "'useQuer
+00004db0: 7943 6163 6865 2720 696e 2027 636f 6e66  yCache' in 'conf
+00004dc0: 6967 7572 6174 696f 6e27 2063 6f6e 666c  iguration' confl
+00004dd0: 6963 7473 2077 6974 6822 0a20 2020 2020  icts with".     
+00004de0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00004df0: 2027 7573 655f 6361 6368 6527 2070 6172   'use_cache' par
+00004e00: 616d 6574 6572 2e20 506c 6561 7365 2073  ameter. Please s
+00004e10: 7065 6369 6679 206f 6e6c 7920 6f6e 652e  pecify only one.
+00004e20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00004e30: 2020 290a 2020 2020 2020 2020 656c 7365    ).        else
+00004e40: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+00004e50: 6e66 6967 7572 6174 696f 6e5b 2271 7565  nfiguration["que
+00004e60: 7279 225d 5b22 7573 6551 7565 7279 4361  ry"]["useQueryCa
+00004e70: 6368 6522 5d20 3d20 280a 2020 2020 2020  che"] = (.      
+00004e80: 2020 2020 2020 2020 2020 5472 7565 2069            True i
+00004e90: 6620 7573 655f 6361 6368 6520 6973 204e  f use_cache is N
+00004ea0: 6f6e 6520 656c 7365 2075 7365 5f63 6163  one else use_cac
+00004eb0: 6865 0a20 2020 2020 2020 2020 2020 2029  he.            )
+00004ec0: 0a0a 2020 2020 2020 2020 696e 6465 785f  ..        index_
+00004ed0: 636f 6c73 203d 205f 746f 5f69 6e64 6578  cols = _to_index
+00004ee0: 5f63 6f6c 7328 696e 6465 785f 636f 6c29  _cols(index_col)
+00004ef0: 0a0a 2020 2020 2020 2020 6669 6c74 6572  ..        filter
+00004f00: 7320 3d20 6c69 7374 2866 696c 7465 7273  s = list(filters
+00004f10: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+00004f20: 2866 696c 7465 7273 2920 213d 2030 206f  (filters) != 0 o
+00004f30: 7220 6d61 785f 7265 7375 6c74 7320 6973  r max_results is
+00004f40: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00004f50: 2020 2020 2020 2023 2054 4f44 4f28 622f         # TODO(b/
+00004f60: 3333 3831 3131 3334 3429 3a20 4966 2077  338111344): If w
+00004f70: 6520 6172 6520 7275 6e6e 696e 6720 6120  e are running a 
+00004f80: 7175 6572 7920 616e 7977 6179 2c20 7765  query anyway, we
+00004f90: 206d 6967 6874 2061 730a 2020 2020 2020   might as.      
+00004fa0: 2020 2020 2020 2320 7765 6c6c 2067 656e        # well gen
+00004fb0: 6572 6174 6520 524f 575f 4e55 4d42 4552  erate ROW_NUMBER
+00004fc0: 2829 2061 7420 7468 6520 7361 6d65 2074  () at the same t
+00004fd0: 696d 652e 0a20 2020 2020 2020 2020 2020  ime..           
+00004fe0: 2071 7565 7279 203d 2062 665f 696f 5f62   query = bf_io_b
+00004ff0: 6967 7175 6572 792e 746f 5f71 7565 7279  igquery.to_query
+00005000: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00005010: 2020 7175 6572 792c 0a20 2020 2020 2020    query,.       
+00005020: 2020 2020 2020 2020 2069 6e64 6578 5f63           index_c
+00005030: 6f6c 732c 0a20 2020 2020 2020 2020 2020  ols,.           
+00005040: 2020 2020 2063 6f6c 756d 6e73 2c0a 2020       columns,.  
+00005050: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00005060: 6c74 6572 732c 0a20 2020 2020 2020 2020  lters,.         
+00005070: 2020 2020 2020 206d 6178 5f72 6573 756c         max_resul
+00005080: 7473 3d6d 6178 5f72 6573 756c 7473 2c0a  ts=max_results,.
+00005090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000050a0: 2320 5765 2772 6520 6578 6563 7574 696e  # We're executin
+000050b0: 6720 7468 6520 7175 6572 792c 2073 6f20  g the query, so 
+000050c0: 7765 2064 6f6e 2774 206e 6565 6420 7469  we don't need ti
+000050d0: 6d65 2074 7261 7665 6c20 666f 720a 2020  me travel for.  
+000050e0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000050f0: 6465 7465 726d 696e 6973 6d2e 0a20 2020  determinism..   
+00005100: 2020 2020 2020 2020 2020 2020 2074 696d               tim
+00005110: 655f 7472 6176 656c 5f74 696d 6573 7461  e_travel_timesta
+00005120: 6d70 3d4e 6f6e 652c 0a20 2020 2020 2020  mp=None,.       
+00005130: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00005140: 6465 7374 696e 6174 696f 6e2c 2071 7565  destination, que
+00005150: 7279 5f6a 6f62 203d 2073 656c 662e 5f71  ry_job = self._q
+00005160: 7565 7279 5f74 6f5f 6465 7374 696e 6174  uery_to_destinat
+00005170: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+00005180: 2071 7565 7279 2c0a 2020 2020 2020 2020   query,.        
+00005190: 2020 2020 696e 6465 785f 636f 6c73 2c0a      index_cols,.
+000051a0: 2020 2020 2020 2020 2020 2020 6170 695f              api_
+000051b0: 6e61 6d65 3d61 7069 5f6e 616d 652c 0a20  name=api_name,. 
+000051c0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+000051d0: 6775 7261 7469 6f6e 3d63 6f6e 6669 6775  guration=configu
+000051e0: 7261 7469 6f6e 2c0a 2020 2020 2020 2020  ration,.        
+000051f0: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
+00005200: 7468 6572 6520 7761 7320 6e6f 2064 6573  there was no des
+00005210: 7469 6e61 7469 6f6e 2074 6162 6c65 2c20  tination table, 
+00005220: 7468 6174 206d 6561 6e73 2074 6865 2071  that means the q
+00005230: 7565 7279 206d 7573 7420 6861 7665 0a20  uery must have. 
+00005240: 2020 2020 2020 2023 2062 6565 6e20 4444         # been DD
+00005250: 4c20 6f72 2044 4d4c 2e20 5265 7475 726e  L or DML. Return
+00005260: 2073 6f6d 6520 6a6f 6220 6d65 7461 6461   some job metada
+00005270: 7461 2c20 696e 7374 6561 642e 0a20 2020  ta, instead..   
+00005280: 2020 2020 2069 6620 6e6f 7420 6465 7374       if not dest
+00005290: 696e 6174 696f 6e3a 0a20 2020 2020 2020  ination:.       
+000052a0: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
+000052b0: 6672 616d 652e 4461 7461 4672 616d 6528  frame.DataFrame(
+000052c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000052d0: 2064 6174 613d 7061 6e64 6173 2e44 6174   data=pandas.Dat
+000052e0: 6146 7261 6d65 280a 2020 2020 2020 2020  aFrame(.        
+000052f0: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
+00005300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005310: 2020 2020 2020 2273 7461 7465 6d65 6e74        "statement
+00005320: 5f74 7970 6522 3a20 5b0a 2020 2020 2020  _type": [.      
+00005330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005340: 2020 2020 2020 7175 6572 795f 6a6f 622e        query_job.
+00005350: 7374 6174 656d 656e 745f 7479 7065 2069  statement_type i
+00005360: 6620 7175 6572 795f 6a6f 6220 656c 7365  f query_job else
+00005370: 2022 756e 6b6e 6f77 6e22 0a20 2020 2020   "unknown".     
+00005380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005390: 2020 205d 2c0a 2020 2020 2020 2020 2020     ],.          
+000053a0: 2020 2020 2020 2020 2020 2020 2020 226a                "j
+000053b0: 6f62 5f69 6422 3a20 5b71 7565 7279 5f6a  ob_id": [query_j
+000053c0: 6f62 2e6a 6f62 5f69 6420 6966 2071 7565  ob.job_id if que
+000053d0: 7279 5f6a 6f62 2065 6c73 6520 2275 6e6b  ry_job else "unk
+000053e0: 6e6f 776e 225d 2c0a 2020 2020 2020 2020  nown"],.        
+000053f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005400: 226c 6f63 6174 696f 6e22 3a20 5b71 7565  "location": [que
+00005410: 7279 5f6a 6f62 2e6c 6f63 6174 696f 6e20  ry_job.location 
+00005420: 6966 2071 7565 7279 5f6a 6f62 2065 6c73  if query_job els
+00005430: 6520 2275 6e6b 6e6f 776e 225d 2c0a 2020  e "unknown"],.  
+00005440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005450: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+00005460: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+00005470: 2020 2020 2020 2073 6573 7369 6f6e 3d73         session=s
+00005480: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+00005490: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
+000054a0: 726e 2073 656c 662e 5f72 6561 645f 6762  rn self._read_gb
+000054b0: 715f 7461 626c 6528 0a20 2020 2020 2020  q_table(.       
+000054c0: 2020 2020 2066 227b 6465 7374 696e 6174       f"{destinat
+000054d0: 696f 6e2e 7072 6f6a 6563 747d 2e7b 6465  ion.project}.{de
+000054e0: 7374 696e 6174 696f 6e2e 6461 7461 7365  stination.datase
+000054f0: 745f 6964 7d2e 7b64 6573 7469 6e61 7469  t_id}.{destinati
+00005500: 6f6e 2e74 6162 6c65 5f69 647d 222c 0a20  on.table_id}",. 
+00005510: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+00005520: 5f63 6f6c 3d69 6e64 6578 5f63 6f6c 2c0a  _col=index_col,.
+00005530: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+00005540: 6d6e 733d 636f 6c75 6d6e 732c 0a20 2020  mns=columns,.   
+00005550: 2020 2020 2020 2020 2075 7365 5f63 6163           use_cac
+00005560: 6865 3d63 6f6e 6669 6775 7261 7469 6f6e  he=configuration
+00005570: 5b22 7175 6572 7922 5d5b 2275 7365 5175  ["query"]["useQu
+00005580: 6572 7943 6163 6865 225d 2c0a 2020 2020  eryCache"],.    
+00005590: 2020 2020 2020 2020 6170 695f 6e61 6d65          api_name
+000055a0: 3d61 7069 5f6e 616d 652c 0a20 2020 2020  =api_name,.     
+000055b0: 2020 2020 2020 2023 206d 6178 5f72 6573         # max_res
+000055c0: 756c 7473 2061 6e64 2066 696c 7465 7273  ults and filters
+000055d0: 2061 7265 206f 6d69 7474 6564 2062 6563   are omitted bec
+000055e0: 6175 7365 2074 6865 7920 6172 6520 616c  ause they are al
+000055f0: 7265 6164 790a 2020 2020 2020 2020 2020  ready.          
+00005600: 2020 2320 6861 6e64 6c65 6420 6279 2074    # handled by t
+00005610: 6f5f 7175 6572 7928 292c 2061 626f 7665  o_query(), above
+00005620: 2e0a 2020 2020 2020 2020 290a 0a20 2020  ..        )..   
+00005630: 2064 6566 2072 6561 645f 6762 715f 7461   def read_gbq_ta
+00005640: 626c 6528 0a20 2020 2020 2020 2073 656c  ble(.        sel
+00005650: 662c 0a20 2020 2020 2020 2071 7565 7279  f,.        query
+00005660: 3a20 7374 722c 0a20 2020 2020 2020 202a  : str,.        *
+00005670: 2c0a 2020 2020 2020 2020 696e 6465 785f  ,.        index_
+00005680: 636f 6c3a 2049 7465 7261 626c 655b 7374  col: Iterable[st
+00005690: 725d 207c 2073 7472 207c 2062 6967 6672  r] | str | bigfr
+000056a0: 616d 6573 2e65 6e75 6d73 2e44 6566 6175  ames.enums.Defau
+000056b0: 6c74 496e 6465 784b 696e 6420 3d20 2829  ltIndexKind = ()
+000056c0: 2c0a 2020 2020 2020 2020 636f 6c75 6d6e  ,.        column
+000056d0: 733a 2049 7465 7261 626c 655b 7374 725d  s: Iterable[str]
+000056e0: 203d 2028 292c 0a20 2020 2020 2020 206d   = (),.        m
+000056f0: 6178 5f72 6573 756c 7473 3a20 4f70 7469  ax_results: Opti
+00005700: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
+00005710: 2c0a 2020 2020 2020 2020 6669 6c74 6572  ,.        filter
+00005720: 733a 2074 6869 7264 5f70 6172 7479 5f70  s: third_party_p
+00005730: 616e 6461 735f 6762 712e 4669 6c74 6572  andas_gbq.Filter
+00005740: 7354 7970 6520 3d20 2829 2c0a 2020 2020  sType = (),.    
+00005750: 2020 2020 7573 655f 6361 6368 653a 2062      use_cache: b
+00005760: 6f6f 6c20 3d20 5472 7565 2c0a 2020 2020  ool = True,.    
+00005770: 2020 2020 636f 6c5f 6f72 6465 723a 2049      col_order: I
+00005780: 7465 7261 626c 655b 7374 725d 203d 2028  terable[str] = (
+00005790: 292c 0a20 2020 2029 202d 3e20 6461 7461  ),.    ) -> data
+000057a0: 6672 616d 652e 4461 7461 4672 616d 653a  frame.DataFrame:
+000057b0: 0a20 2020 2020 2020 2022 2222 5475 726e  .        """Turn
+000057c0: 2061 2042 6967 5175 6572 7920 7461 626c   a BigQuery tabl
+000057d0: 6520 696e 746f 2061 2044 6174 6146 7261  e into a DataFra
+000057e0: 6d65 2e0a 0a20 2020 2020 2020 202a 2a45  me...        **E
+000057f0: 7861 6d70 6c65 733a 2a2a 0a0a 2020 2020  xamples:**..    
+00005800: 2020 2020 2020 2020 3e3e 3e20 696d 706f          >>> impo
+00005810: 7274 2062 6967 6672 616d 6573 2e70 616e  rt bigframes.pan
+00005820: 6461 7320 6173 2062 7064 0a20 2020 2020  das as bpd.     
+00005830: 2020 2020 2020 203e 3e3e 2062 7064 2e6f         >>> bpd.o
+00005840: 7074 696f 6e73 2e64 6973 706c 6179 2e70  ptions.display.p
+00005850: 726f 6772 6573 735f 6261 7220 3d20 4e6f  rogress_bar = No
+00005860: 6e65 0a0a 2020 2020 2020 2020 5265 6164  ne..        Read
+00005870: 2061 2077 686f 6c65 2074 6162 6c65 2c20   a whole table, 
+00005880: 7769 7468 2061 7262 6974 7261 7279 206f  with arbitrary o
+00005890: 7264 6572 696e 6720 6f72 206f 7264 6572  rdering or order
+000058a0: 696e 6720 636f 7272 6573 706f 6e64 696e  ing correspondin
+000058b0: 6720 746f 2074 6865 2070 7269 6d61 7279  g to the primary
+000058c0: 206b 6579 2873 292e 0a0a 2020 2020 2020   key(s)...      
+000058d0: 2020 2020 2020 3e3e 3e20 6466 203d 2062        >>> df = b
+000058e0: 7064 2e72 6561 645f 6762 715f 7461 626c  pd.read_gbq_tabl
+000058f0: 6528 2262 6967 7175 6572 792d 7075 626c  e("bigquery-publ
+00005900: 6963 2d64 6174 612e 6d6c 5f64 6174 6173  ic-data.ml_datas
+00005910: 6574 732e 7065 6e67 7569 6e73 2229 0a0a  ets.penguins")..
+00005920: 2020 2020 2020 2020 5365 6520 616c 736f          See also
+00005930: 3a20 3a6d 6574 683a 6053 6573 7369 6f6e  : :meth:`Session
+00005940: 2e72 6561 645f 6762 7160 2e0a 2020 2020  .read_gbq`..    
+00005950: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00005960: 2320 4e4f 5445 3a20 5468 6973 206d 6574  # NOTE: This met
+00005970: 686f 6420 646f 6573 6e27 7420 2879 6574  hod doesn't (yet
+00005980: 2920 6578 6973 7420 696e 2070 616e 6461  ) exist in panda
+00005990: 7320 6f72 2070 616e 6461 732d 6762 712c  s or pandas-gbq,
+000059a0: 2073 6f0a 2020 2020 2020 2020 2320 7468   so.        # th
+000059b0: 6573 6520 646f 6373 7472 696e 6773 2061  ese docstrings a
+000059c0: 7265 2069 6e6c 696e 652e 0a20 2020 2020  re inline..     
+000059d0: 2020 2069 6620 636f 6c75 6d6e 7320 616e     if columns an
+000059e0: 6420 636f 6c5f 6f72 6465 723a 0a20 2020  d col_order:.   
+000059f0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00005a00: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00005a10: 2020 2020 2020 2020 2020 2022 4d75 7374             "Must
+00005a20: 2073 7065 6369 6679 2065 6974 6865 7220   specify either 
+00005a30: 636f 6c75 6d6e 7320 2870 7265 6665 7272  columns (preferr
+00005a40: 6564 2920 6f72 2063 6f6c 5f6f 7264 6572  ed) or col_order
+00005a50: 2c20 6e6f 7420 626f 7468 220a 2020 2020  , not both".    
+00005a60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00005a70: 2020 656c 6966 2063 6f6c 5f6f 7264 6572    elif col_order
+00005a80: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+00005a90: 6c75 6d6e 7320 3d20 636f 6c5f 6f72 6465  lumns = col_orde
+00005aa0: 720a 0a20 2020 2020 2020 2072 6574 7572  r..        retur
+00005ab0: 6e20 7365 6c66 2e5f 7265 6164 5f67 6271  n self._read_gbq
+00005ac0: 5f74 6162 6c65 280a 2020 2020 2020 2020  _table(.        
+00005ad0: 2020 2020 7175 6572 793d 7175 6572 792c      query=query,
+00005ae0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+00005af0: 6578 5f63 6f6c 3d69 6e64 6578 5f63 6f6c  ex_col=index_col
+00005b00: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+00005b10: 6c75 6d6e 733d 636f 6c75 6d6e 732c 0a20  lumns=columns,. 
+00005b20: 2020 2020 2020 2020 2020 206d 6178 5f72             max_r
+00005b30: 6573 756c 7473 3d6d 6178 5f72 6573 756c  esults=max_resul
+00005b40: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00005b50: 6170 695f 6e61 6d65 3d22 7265 6164 5f67  api_name="read_g
+00005b60: 6271 5f74 6162 6c65 222c 0a20 2020 2020  bq_table",.     
+00005b70: 2020 2020 2020 2075 7365 5f63 6163 6865         use_cache
+00005b80: 3d75 7365 5f63 6163 6865 2c0a 2020 2020  =use_cache,.    
+00005b90: 2020 2020 2020 2020 6669 6c74 6572 733d          filters=
+00005ba0: 6669 6c74 6572 732c 0a20 2020 2020 2020  filters,.       
+00005bb0: 2029 0a0a 2020 2020 6465 6620 5f72 6561   )..    def _rea
+00005bc0: 645f 6762 715f 7461 626c 6528 0a20 2020  d_gbq_table(.   
+00005bd0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00005be0: 2020 2071 7565 7279 3a20 7374 722c 0a20     query: str,. 
+00005bf0: 2020 2020 2020 202a 2c0a 2020 2020 2020         *,.      
+00005c00: 2020 696e 6465 785f 636f 6c3a 2049 7465    index_col: Ite
+00005c10: 7261 626c 655b 7374 725d 207c 2073 7472  rable[str] | str
+00005c20: 207c 2062 6967 6672 616d 6573 2e65 6e75   | bigframes.enu
+00005c30: 6d73 2e44 6566 6175 6c74 496e 6465 784b  ms.DefaultIndexK
+00005c40: 696e 6420 3d20 2829 2c0a 2020 2020 2020  ind = (),.      
+00005c50: 2020 636f 6c75 6d6e 733a 2049 7465 7261    columns: Itera
+00005c60: 626c 655b 7374 725d 203d 2028 292c 0a20  ble[str] = (),. 
+00005c70: 2020 2020 2020 206d 6178 5f72 6573 756c         max_resul
+00005c80: 7473 3a20 4f70 7469 6f6e 616c 5b69 6e74  ts: Optional[int
+00005c90: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00005ca0: 2020 6170 695f 6e61 6d65 3a20 7374 722c    api_name: str,
+00005cb0: 0a20 2020 2020 2020 2075 7365 5f63 6163  .        use_cac
+00005cc0: 6865 3a20 626f 6f6c 203d 2054 7275 652c  he: bool = True,
+00005cd0: 0a20 2020 2020 2020 2066 696c 7465 7273  .        filters
+00005ce0: 3a20 7468 6972 645f 7061 7274 795f 7061  : third_party_pa
+00005cf0: 6e64 6173 5f67 6271 2e46 696c 7465 7273  ndas_gbq.Filters
+00005d00: 5479 7065 203d 2028 292c 0a20 2020 2029  Type = (),.    )
+00005d10: 202d 3e20 6461 7461 6672 616d 652e 4461   -> dataframe.Da
+00005d20: 7461 4672 616d 653a 0a20 2020 2020 2020  taFrame:.       
+00005d30: 2069 6d70 6f72 7420 6269 6766 7261 6d65   import bigframe
+00005d40: 732e 6461 7461 6672 616d 6520 6173 2064  s.dataframe as d
+00005d50: 6174 6166 7261 6d65 0a0a 2020 2020 2020  ataframe..      
+00005d60: 2020 2320 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d    # ------------
+00005d70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00005d80: 2d2d 2d2d 2d0a 2020 2020 2020 2020 2320  -----.        # 
+00005d90: 5661 6c69 6461 7465 2061 6e64 2074 7261  Validate and tra
+00005da0: 6e73 666f 726d 2070 6172 616d 6574 6572  nsform parameter
+00005db0: 730a 2020 2020 2020 2020 2320 2d2d 2d2d  s.        # ----
+00005dc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00005dd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 0a20  -------------.. 
+00005de0: 2020 2020 2020 2069 6620 6d61 785f 7265         if max_re
+00005df0: 7375 6c74 7320 616e 6420 6d61 785f 7265  sults and max_re
+00005e00: 7375 6c74 7320 3c3d 2030 3a0a 2020 2020  sults <= 0:.    
+00005e10: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00005e20: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00005e30: 2020 2020 2020 2020 2020 6622 606d 6178            f"`max
+00005e40: 5f72 6573 756c 7473 6020 7368 6f75 6c64  _results` should
+00005e50: 2062 6520 6120 706f 7369 7469 7665 206e   be a positive n
+00005e60: 756d 6265 722c 2067 6f74 207b 6d61 785f  umber, got {max_
+00005e70: 7265 7375 6c74 737d 2e22 0a20 2020 2020  results}.".     
+00005e80: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00005e90: 2020 7461 626c 655f 7265 6620 3d20 6269    table_ref = bi
+00005ea0: 6771 7565 7279 2e74 6162 6c65 2e54 6162  gquery.table.Tab
+00005eb0: 6c65 5265 6665 7265 6e63 652e 6672 6f6d  leReference.from
+00005ec0: 5f73 7472 696e 6728 0a20 2020 2020 2020  _string(.       
+00005ed0: 2020 2020 2071 7565 7279 2c20 6465 6661       query, defa
+00005ee0: 756c 745f 7072 6f6a 6563 743d 7365 6c66  ult_project=self
+00005ef0: 2e62 7163 6c69 656e 742e 7072 6f6a 6563  .bqclient.projec
+00005f00: 740a 2020 2020 2020 2020 290a 0a20 2020  t.        )..   
+00005f10: 2020 2020 2063 6f6c 756d 6e73 203d 206c       columns = l
+00005f20: 6973 7428 636f 6c75 6d6e 7329 0a20 2020  ist(columns).   
+00005f30: 2020 2020 2066 696c 7465 7273 203d 206c       filters = l
+00005f40: 6973 7428 6669 6c74 6572 7329 0a0a 2020  ist(filters)..  
+00005f50: 2020 2020 2020 2320 2d2d 2d2d 2d2d 2d2d        # --------
+00005f60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00005f70: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00005f80: 2020 2320 4665 7463 6820 7461 626c 6520    # Fetch table 
+00005f90: 6d65 7461 6461 7461 2061 6e64 2076 616c  metadata and val
+00005fa0: 6964 6174 650a 2020 2020 2020 2020 2320  idate.        # 
+00005fb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00005fc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00005fd0: 2d0a 0a20 2020 2020 2020 2028 7469 6d65  -..        (time
+00005fe0: 5f74 7261 7665 6c5f 7469 6d65 7374 616d  _travel_timestam
+00005ff0: 702c 2074 6162 6c65 2c29 203d 2062 665f  p, table,) = bf_
+00006000: 7265 6164 5f67 6271 5f74 6162 6c65 2e67  read_gbq_table.g
+00006010: 6574 5f74 6162 6c65 5f6d 6574 6164 6174  et_table_metadat
+00006020: 6128 0a20 2020 2020 2020 2020 2020 2073  a(.            s
+00006030: 656c 662e 6271 636c 6965 6e74 2c0a 2020  elf.bqclient,.  
+00006040: 2020 2020 2020 2020 2020 7461 626c 655f            table_
+00006050: 7265 663d 7461 626c 655f 7265 662c 0a20  ref=table_ref,. 
+00006060: 2020 2020 2020 2020 2020 2061 7069 5f6e             api_n
+00006070: 616d 653d 6170 695f 6e61 6d65 2c0a 2020  ame=api_name,.  
+00006080: 2020 2020 2020 2020 2020 6361 6368 653d            cache=
+00006090: 7365 6c66 2e5f 6466 5f73 6e61 7073 686f  self._df_snapsho
+000060a0: 742c 0a20 2020 2020 2020 2020 2020 2075  t,.            u
+000060b0: 7365 5f63 6163 6865 3d75 7365 5f63 6163  se_cache=use_cac
+000060c0: 6865 2c0a 2020 2020 2020 2020 290a 2020  he,.        ).  
+000060d0: 2020 2020 2020 7461 626c 655f 636f 6c75        table_colu
+000060e0: 6d6e 5f6e 616d 6573 203d 207b 6669 656c  mn_names = {fiel
+000060f0: 642e 6e61 6d65 2066 6f72 2066 6965 6c64  d.name for field
+00006100: 2069 6e20 7461 626c 652e 7363 6865 6d61   in table.schema
+00006110: 7d0a 0a20 2020 2020 2020 2069 6620 7461  }..        if ta
+00006120: 626c 652e 6c6f 6361 7469 6f6e 2e63 6173  ble.location.cas
+00006130: 6566 6f6c 6428 2920 213d 2073 656c 662e  efold() != self.
+00006140: 5f6c 6f63 6174 696f 6e2e 6361 7365 666f  _location.casefo
+00006150: 6c64 2829 3a0a 2020 2020 2020 2020 2020  ld():.          
+00006160: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00006170: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00006180: 2020 2020 6622 4375 7272 656e 7420 7365      f"Current se
+00006190: 7373 696f 6e20 6973 2069 6e20 7b73 656c  ssion is in {sel
+000061a0: 662e 5f6c 6f63 6174 696f 6e7d 2062 7574  f._location} but
+000061b0: 2064 6174 6173 6574 2027 7b74 6162 6c65   dataset '{table
+000061c0: 2e70 726f 6a65 6374 7d2e 7b74 6162 6c65  .project}.{table
+000061d0: 2e64 6174 6173 6574 5f69 647d 2720 6973  .dataset_id}' is
+000061e0: 206c 6f63 6174 6564 2069 6e20 7b74 6162   located in {tab
+000061f0: 6c65 2e6c 6f63 6174 696f 6e7d 220a 2020  le.location}".  
+00006200: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00006210: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
+00006220: 636f 6c75 6d6e 733a 0a20 2020 2020 2020  columns:.       
+00006230: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
+00006240: 696e 2074 6162 6c65 5f63 6f6c 756d 6e5f  in table_column_
+00006250: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
+00006260: 2020 2020 2020 2070 6f73 7369 6269 6c69         possibili
+00006270: 7479 203d 206d 696e 280a 2020 2020 2020  ty = min(.      
+00006280: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+00006290: 626c 655f 636f 6c75 6d6e 5f6e 616d 6573  ble_column_names
+000062a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000062b0: 2020 2020 2020 6b65 793d 6c61 6d62 6461        key=lambda
+000062c0: 2069 7465 6d3a 206a 656c 6c79 6669 7368   item: jellyfish
+000062d0: 2e6c 6576 656e 7368 7465 696e 5f64 6973  .levenshtein_dis
+000062e0: 7461 6e63 6528 6b65 792c 2069 7465 6d29  tance(key, item)
+000062f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006300: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00006310: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00006320: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00006330: 2020 2020 2020 2020 2020 6622 436f 6c75            f"Colu
+00006340: 6d6e 2027 7b6b 6579 7d27 206f 6620 6063  mn '{key}' of `c
+00006350: 6f6c 756d 6e73 6020 6e6f 7420 666f 756e  olumns` not foun
+00006360: 6420 696e 2074 6869 7320 7461 626c 652e  d in this table.
+00006370: 2044 6964 2079 6f75 206d 6561 6e20 277b   Did you mean '{
+00006380: 706f 7373 6962 696c 6974 797d 273f 220a  possibility}'?".
+00006390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063a0: 290a 0a20 2020 2020 2020 2023 2043 6f6e  )..        # Con
+000063b0: 7665 7274 696e 6720 696e 6465 785f 636f  verting index_co
+000063c0: 6c20 696e 746f 2061 206c 6973 7420 6f66  l into a list of
+000063d0: 2063 6f6c 756d 6e20 6e61 6d65 7320 7265   column names re
+000063e0: 7175 6972 6573 0a20 2020 2020 2020 2023  quires.        #
+000063f0: 2074 6865 2074 6162 6c65 206d 6574 6164   the table metad
+00006400: 6174 6120 6265 6361 7573 6520 7765 206d  ata because we m
+00006410: 6967 6874 2075 7365 2074 6865 2070 7269  ight use the pri
+00006420: 6d61 7279 206b 6579 730a 2020 2020 2020  mary keys.      
+00006430: 2020 2320 7768 656e 2063 6f6e 7374 7275    # when constru
+00006440: 6374 696e 6720 7468 6520 696e 6465 782e  cting the index.
+00006450: 0a20 2020 2020 2020 2069 6e64 6578 5f63  .        index_c
+00006460: 6f6c 7320 3d20 6266 5f72 6561 645f 6762  ols = bf_read_gb
+00006470: 715f 7461 626c 652e 6765 745f 696e 6465  q_table.get_inde
+00006480: 785f 636f 6c73 280a 2020 2020 2020 2020  x_cols(.        
+00006490: 2020 2020 7461 626c 653d 7461 626c 652c      table=table,
+000064a0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+000064b0: 6578 5f63 6f6c 3d69 6e64 6578 5f63 6f6c  ex_col=index_col
+000064c0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+000064d0: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
+000064e0: 696e 6465 785f 636f 6c73 3a0a 2020 2020  index_cols:.    
+000064f0: 2020 2020 2020 2020 6966 206b 6579 206e          if key n
+00006500: 6f74 2069 6e20 7461 626c 655f 636f 6c75  ot in table_colu
+00006510: 6d6e 5f6e 616d 6573 3a0a 2020 2020 2020  mn_names:.      
+00006520: 2020 2020 2020 2020 2020 706f 7373 6962            possib
+00006530: 696c 6974 7920 3d20 6d69 6e28 0a20 2020  ility = min(.   
+00006540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006550: 2074 6162 6c65 5f63 6f6c 756d 6e5f 6e61   table_column_na
+00006560: 6d65 732c 0a20 2020 2020 2020 2020 2020  mes,.           
+00006570: 2020 2020 2020 2020 206b 6579 3d6c 616d           key=lam
+00006580: 6264 6120 6974 656d 3a20 6a65 6c6c 7966  bda item: jellyf
+00006590: 6973 682e 6c65 7665 6e73 6874 6569 6e5f  ish.levenshtein_
+000065a0: 6469 7374 616e 6365 286b 6579 2c20 6974  distance(key, it
+000065b0: 656d 292c 0a20 2020 2020 2020 2020 2020  em),.           
+000065c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000065d0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+000065e0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+000065f0: 2020 2020 2020 2020 2020 2020 2066 2243               f"C
+00006600: 6f6c 756d 6e20 277b 6b65 797d 2720 6f66  olumn '{key}' of
+00006610: 2060 696e 6465 785f 636f 6c60 206e 6f74   `index_col` not
+00006620: 2066 6f75 6e64 2069 6e20 7468 6973 2074   found in this t
+00006630: 6162 6c65 2e20 4469 6420 796f 7520 6d65  able. Did you me
+00006640: 616e 2027 7b70 6f73 7369 6269 6c69 7479  an '{possibility
+00006650: 7d27 3f22 0a20 2020 2020 2020 2020 2020  }'?".           
+00006660: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00006670: 2320 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  # --------------
+00006680: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
+00006690: 2020 2020 2020 2020 2320 4f70 7469 6f6e          # Option
+000066a0: 616c 6c79 2c20 6578 6563 7574 6520 7468  ally, execute th
+000066b0: 6520 7175 6572 790a 2020 2020 2020 2020  e query.        
+000066c0: 2320 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  # --------------
+000066d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
+000066e0: 0a20 2020 2020 2020 2023 206d 6178 5f72  .        # max_r
+000066f0: 6573 756c 7473 2069 6e74 726f 6475 6365  esults introduce
+00006700: 7320 6e6f 6e2d 6465 7465 726d 696e 6973  s non-determinis
+00006710: 6d20 616e 6420 6c69 6d69 7473 2074 6865  m and limits the
+00006720: 2063 6f73 7420 6f6e 0a20 2020 2020 2020   cost on.       
+00006730: 2023 2063 6c75 7374 6572 6564 2074 6162   # clustered tab
+00006740: 6c65 732c 2073 6f20 6661 6c6c 6261 636b  les, so fallback
+00006750: 2074 6f20 6120 7175 6572 792e 2057 6520   to a query. We 
+00006760: 646f 2074 6869 7320 6865 7265 2073 6f20  do this here so 
+00006770: 7468 6174 0a20 2020 2020 2020 2023 2074  that.        # t
+00006780: 6865 2069 6e64 6578 2069 7320 636f 6e73  he index is cons
+00006790: 6973 7465 6e74 2077 6974 6820 7461 626c  istent with tabl
+000067a0: 6573 2074 6861 7420 6861 7665 2070 7269  es that have pri
+000067b0: 6d61 7279 206b 6579 732c 2065 7665 6e0a  mary keys, even.
+000067c0: 2020 2020 2020 2020 2320 7768 656e 206d          # when m
+000067d0: 6178 5f72 6573 756c 7473 2069 7320 7365  ax_results is se
+000067e0: 742e 0a20 2020 2020 2020 2023 2054 4f44  t..        # TOD
+000067f0: 4f28 622f 3333 3834 3139 3733 3029 3a20  O(b/338419730): 
+00006800: 5765 2064 6f6e 2774 206e 6565 6420 746f  We don't need to
+00006810: 2066 616c 6c62 6163 6b20 746f 2061 2071   fallback to a q
+00006820: 7565 7279 2066 6f72 2077 696c 6463 6172  uery for wildcar
+00006830: 640a 2020 2020 2020 2020 2320 7461 626c  d.        # tabl
+00006840: 6573 2069 6620 7765 2061 6c6c 6f77 2073  es if we allow s
+00006850: 6f6d 6520 6e6f 6e2d 6465 7465 726d 696e  ome non-determin
+00006860: 6973 6d20 7768 656e 2074 696d 6520 7472  ism when time tr
+00006870: 6176 656c 2069 736e 2774 2073 7570 706f  avel isn't suppo
+00006880: 7274 6564 2e0a 2020 2020 2020 2020 6966  rted..        if
+00006890: 206d 6178 5f72 6573 756c 7473 2069 7320   max_results is 
+000068a0: 6e6f 7420 4e6f 6e65 206f 7220 6266 5f69  not None or bf_i
+000068b0: 6f5f 6269 6771 7565 7279 2e69 735f 7461  o_bigquery.is_ta
+000068c0: 626c 655f 7769 7468 5f77 696c 6463 6172  ble_with_wildcar
+000068d0: 645f 7375 6666 6978 280a 2020 2020 2020  d_suffix(.      
+000068e0: 2020 2020 2020 7175 6572 790a 2020 2020        query.    
+000068f0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00006900: 2020 2023 2054 4f44 4f28 622f 3333 3831     # TODO(b/3381
+00006910: 3131 3334 3429 3a20 4966 2077 6520 6172  11344): If we ar
+00006920: 6520 7275 6e6e 696e 6720 6120 7175 6572  e running a quer
+00006930: 7920 616e 7977 6179 2c20 7765 206d 6967  y anyway, we mig
+00006940: 6874 2061 730a 2020 2020 2020 2020 2020  ht as.          
+00006950: 2020 2320 7765 6c6c 2067 656e 6572 6174    # well generat
+00006960: 6520 524f 575f 4e55 4d42 4552 2829 2061  e ROW_NUMBER() a
+00006970: 7420 7468 6520 7361 6d65 2074 696d 652e  t the same time.
+00006980: 0a20 2020 2020 2020 2020 2020 2071 7565  .            que
+00006990: 7279 203d 2062 665f 696f 5f62 6967 7175  ry = bf_io_bigqu
+000069a0: 6572 792e 746f 5f71 7565 7279 280a 2020  ery.to_query(.  
+000069b0: 2020 2020 2020 2020 2020 2020 2020 7175                qu
+000069c0: 6572 792c 0a20 2020 2020 2020 2020 2020  ery,.           
+000069d0: 2020 2020 2069 6e64 6578 5f63 6f6c 733d       index_cols=
+000069e0: 696e 6465 785f 636f 6c73 2c0a 2020 2020  index_cols,.    
+000069f0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+00006a00: 6d6e 733d 636f 6c75 6d6e 732c 0a20 2020  mns=columns,.   
+00006a10: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00006a20: 7465 7273 3d66 696c 7465 7273 2c0a 2020  ters=filters,.  
+00006a30: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00006a40: 785f 7265 7375 6c74 733d 6d61 785f 7265  x_results=max_re
+00006a50: 7375 6c74 732c 0a20 2020 2020 2020 2020  sults,.         
+00006a60: 2020 2020 2020 2023 2057 6527 7265 2065         # We're e
+00006a70: 7865 6375 7469 6e67 2074 6865 2071 7565  xecuting the que
+00006a80: 7279 2c20 736f 2077 6520 646f 6e27 7420  ry, so we don't 
+00006a90: 6e65 6564 2074 696d 6520 7472 6176 656c  need time travel
+00006aa0: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
+00006ab0: 2020 2020 2023 2064 6574 6572 6d69 6e69       # determini
+00006ac0: 736d 2e0a 2020 2020 2020 2020 2020 2020  sm..            
+00006ad0: 2020 2020 7469 6d65 5f74 7261 7665 6c5f      time_travel_
+00006ae0: 7469 6d65 7374 616d 703d 4e6f 6e65 2c0a  timestamp=None,.
+00006af0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00006b00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00006b10: 6e20 7365 6c66 2e5f 7265 6164 5f67 6271  n self._read_gbq
+00006b20: 5f71 7565 7279 280a 2020 2020 2020 2020  _query(.        
+00006b30: 2020 2020 2020 2020 7175 6572 792c 0a20          query,. 
+00006b40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00006b50: 6e64 6578 5f63 6f6c 3d69 6e64 6578 5f63  ndex_col=index_c
+00006b60: 6f6c 732c 0a20 2020 2020 2020 2020 2020  ols,.           
+00006b70: 2020 2020 2063 6f6c 756d 6e73 3d63 6f6c       columns=col
+00006b80: 756d 6e73 2c0a 2020 2020 2020 2020 2020  umns,.          
+00006b90: 2020 2020 2020 6170 695f 6e61 6d65 3d22        api_name="
+00006ba0: 7265 6164 5f67 6271 5f74 6162 6c65 222c  read_gbq_table",
+00006bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006bc0: 2075 7365 5f63 6163 6865 3d75 7365 5f63   use_cache=use_c
+00006bd0: 6163 6865 2c0a 2020 2020 2020 2020 2020  ache,.          
+00006be0: 2020 290a 0a20 2020 2020 2020 2023 202d    )..        # -
+00006bf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00006c00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00006c10: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00006c20: 2023 2043 7265 6174 6520 4962 6973 2074   # Create Ibis t
+00006c30: 6162 6c65 2065 7870 7265 7373 696f 6e20  able expression 
+00006c40: 616e 6420 7661 6c69 6461 7465 0a20 2020  and validate.   
+00006c50: 2020 2020 2023 202d 2d2d 2d2d 2d2d 2d2d       # ---------
+00006c60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00006c70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00006c80: 0a0a 2020 2020 2020 2020 2320 5573 6520  ..        # Use 
+00006c90: 6120 7469 6d65 2074 7261 7665 6c20 746f  a time travel to
+00006ca0: 206d 616b 6520 7375 7265 2074 6865 2044   make sure the D
+00006cb0: 6174 6146 7261 6d65 2069 7320 6465 7465  ataFrame is dete
+00006cc0: 726d 696e 6973 7469 632c 2065 7665 6e0a  rministic, even.
+00006cd0: 2020 2020 2020 2020 2320 6966 2074 6865          # if the
+00006ce0: 2075 6e64 6572 6c79 696e 6720 7461 626c   underlying tabl
+00006cf0: 6520 6368 616e 6765 732e 0a20 2020 2020  e changes..     
+00006d00: 2020 2023 2054 4f44 4f28 622f 3334 3035     # TODO(b/3405
+00006d10: 3430 3939 3129 3a20 4966 2061 2064 7279  40991): If a dry
+00006d20: 2072 756e 2071 7565 7279 2066 6169 6c73   run query fails
+00006d30: 2077 6974 6820 7469 6d65 2074 7261 7665   with time trave
+00006d40: 6c20 6275 740a 2020 2020 2020 2020 2320  l but.        # 
+00006d50: 7375 6363 6565 6473 2077 6974 686f 7574  succeeds without
+00006d60: 2069 742c 206f 6d69 7420 7468 6520 7469   it, omit the ti
+00006d70: 6d65 2074 7261 7665 6c20 636c 6175 7365  me travel clause
+00006d80: 2061 6e64 2072 6169 7365 2061 2077 6172   and raise a war
+00006d90: 6e69 6e67 0a20 2020 2020 2020 2023 2061  ning.        # a
+00006da0: 626f 7574 2070 6f74 656e 7469 616c 206e  bout potential n
+00006db0: 6f6e 2d64 6574 6572 6d69 6e69 736d 2069  on-determinism i
+00006dc0: 6620 7468 6520 756e 6465 726c 7969 6e67  f the underlying
+00006dd0: 2074 6162 6c65 7320 6172 6520 6d6f 6469   tables are modi
+00006de0: 6669 6564 2e0a 2020 2020 2020 2020 7461  fied..        ta
+00006df0: 626c 655f 6578 7072 6573 7369 6f6e 203d  ble_expression =
+00006e00: 2062 665f 7265 6164 5f67 6271 5f74 6162   bf_read_gbq_tab
+00006e10: 6c65 2e67 6574 5f69 6269 735f 7469 6d65  le.get_ibis_time
+00006e20: 5f74 7261 7665 6c5f 7461 626c 6528 0a20  _travel_table(. 
+00006e30: 2020 2020 2020 2020 2020 2069 6269 735f             ibis_
+00006e40: 636c 6965 6e74 3d73 656c 662e 6962 6973  client=self.ibis
+00006e50: 5f63 6c69 656e 742c 0a20 2020 2020 2020  _client,.       
+00006e60: 2020 2020 2074 6162 6c65 5f72 6566 3d74       table_ref=t
+00006e70: 6162 6c65 5f72 6566 2c0a 2020 2020 2020  able_ref,.      
+00006e80: 2020 2020 2020 696e 6465 785f 636f 6c73        index_cols
+00006e90: 3d69 6e64 6578 5f63 6f6c 732c 0a20 2020  =index_cols,.   
+00006ea0: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
+00006eb0: 3d63 6f6c 756d 6e73 2c0a 2020 2020 2020  =columns,.      
+00006ec0: 2020 2020 2020 6669 6c74 6572 733d 6669        filters=fi
+00006ed0: 6c74 6572 732c 0a20 2020 2020 2020 2020  lters,.         
+00006ee0: 2020 2074 696d 655f 7472 6176 656c 5f74     time_travel_t
+00006ef0: 696d 6573 7461 6d70 3d74 696d 655f 7472  imestamp=time_tr
+00006f00: 6176 656c 5f74 696d 6573 7461 6d70 2c0a  avel_timestamp,.
+00006f10: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00006f20: 2020 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d     # -----------
+00006f30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00006f40: 2d0a 2020 2020 2020 2020 2320 4372 6561  -.        # Crea
+00006f50: 7465 206f 7264 6572 696e 6720 616e 6420  te ordering and 
+00006f60: 7661 6c69 6461 7465 0a20 2020 2020 2020  validate.       
+00006f70: 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   # -------------
+00006f80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
+00006f90: 0a20 2020 2020 2020 2023 2054 4f44 4f28  .        # TODO(
+00006fa0: 622f 3333 3739 3235 3134 3229 3a20 4765  b/337925142): Ge
+00006fb0: 6e65 7261 7465 2061 206e 6577 2073 7562  nerate a new sub
+00006fc0: 7175 6572 7920 7769 7468 206a 7573 7420  query with just 
+00006fd0: 7468 6520 696e 6465 785f 636f 6c73 0a20  the index_cols. 
+00006fe0: 2020 2020 2020 2023 2069 6e20 7468 6520         # in the 
+00006ff0: 4962 6973 2074 6162 6c65 2065 7870 7265  Ibis table expre
+00007000: 7373 696f 6e20 736f 2077 6520 646f 6e27  ssion so we don'
+00007010: 7420 6861 7665 2061 2022 5345 4c45 4354  t have a "SELECT
+00007020: 202a 2220 7375 6271 7565 7279 0a20 2020   *" subquery.   
+00007030: 2020 2020 2023 2069 6e20 7468 6520 7175       # in the qu
+00007040: 6572 7920 7468 6174 2063 6865 636b 7320  ery that checks 
+00007050: 666f 7220 696e 6465 7820 756e 6971 7565  for index unique
+00007060: 6e65 7373 2e0a 2020 2020 2020 2020 2320  ness..        # 
+00007070: 544f 444f 2862 2f33 3338 3036 3536 3031  TODO(b/338065601
+00007080: 293a 2050 726f 7669 6465 2061 2077 6179  ): Provide a way
+00007090: 2074 6f20 6173 7375 6d65 2075 6e69 7175   to assume uniqu
+000070a0: 656e 6573 7320 616e 6420 6176 6f69 6420  eness and avoid 
+000070b0: 7468 6973 0a20 2020 2020 2020 2023 2063  this.        # c
+000070c0: 6865 636b 2e0a 2020 2020 2020 2020 6973  heck..        is
+000070d0: 5f69 6e64 6578 5f75 6e69 7175 6520 3d20  _index_unique = 
+000070e0: 6266 5f72 6561 645f 6762 715f 7461 626c  bf_read_gbq_tabl
+000070f0: 652e 6172 655f 696e 6465 785f 636f 6c73  e.are_index_cols
+00007100: 5f75 6e69 7175 6528 0a20 2020 2020 2020  _unique(.       
+00007110: 2020 2020 2062 7163 6c69 656e 743d 7365       bqclient=se
+00007120: 6c66 2e62 7163 6c69 656e 742c 0a20 2020  lf.bqclient,.   
+00007130: 2020 2020 2020 2020 2074 6162 6c65 3d74           table=t
+00007140: 6162 6c65 2c0a 2020 2020 2020 2020 2020  able,.          
+00007150: 2020 696e 6465 785f 636f 6c73 3d69 6e64    index_cols=ind
+00007160: 6578 5f63 6f6c 732c 0a20 2020 2020 2020  ex_cols,.       
+00007170: 2020 2020 2061 7069 5f6e 616d 653d 6170       api_name=ap
+00007180: 695f 6e61 6d65 2c0a 2020 2020 2020 2020  i_name,.        
+00007190: 290a 0a20 2020 2020 2020 2069 6620 6973  )..        if is
+000071a0: 5f69 6e64 6578 5f75 6e69 7175 653a 0a20  _index_unique:. 
+000071b0: 2020 2020 2020 2020 2020 2061 7272 6179             array
+000071c0: 5f76 616c 7565 203d 2062 665f 7265 6164  _value = bf_read
+000071d0: 5f67 6271 5f74 6162 6c65 2e74 6f5f 6172  _gbq_table.to_ar
+000071e0: 7261 795f 7661 6c75 655f 7769 7468 5f74  ray_value_with_t
+000071f0: 6f74 616c 5f6f 7264 6572 696e 6728 0a20  otal_ordering(. 
+00007200: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007210: 6573 7369 6f6e 3d73 656c 662c 0a20 2020  ession=self,.   
+00007220: 2020 2020 2020 2020 2020 2020 2074 6162               tab
+00007230: 6c65 5f65 7870 7265 7373 696f 6e3d 7461  le_expression=ta
+00007240: 626c 655f 6578 7072 6573 7369 6f6e 2c0a  ble_expression,.
+00007250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007260: 746f 7461 6c5f 6f72 6465 7269 6e67 5f63  total_ordering_c
+00007270: 6f6c 733d 696e 6465 785f 636f 6c73 2c0a  ols=index_cols,.
+00007280: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00007290: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000072a0: 2020 2020 2020 2020 2320 4e6f 7465 3a20          # Note: 
+000072b0: 4576 656e 2074 686f 7567 6820 7765 2772  Even though we'r
+000072c0: 6520 6164 6469 6e67 2061 2064 6566 6175  e adding a defau
+000072d0: 6c74 206f 7264 6572 696e 6720 6865 7265  lt ordering here
+000072e0: 2c20 7468 6174 2773 0a20 2020 2020 2020  , that's.       
+000072f0: 2020 2020 2023 206a 7573 7420 736f 2077       # just so w
+00007300: 6520 6861 7665 2061 2064 6574 6572 6d69  e have a determi
+00007310: 6e69 7374 6963 2074 6f74 616c 206f 7264  nistic total ord
+00007320: 6572 696e 672e 2049 6620 7468 6520 7573  ering. If the us
+00007330: 6572 0a20 2020 2020 2020 2020 2020 2023  er.            #
+00007340: 2073 7065 6369 6669 6564 2061 206e 6f6e   specified a non
+00007350: 2d75 6e69 7175 6520 696e 6465 782c 2077  -unique index, w
+00007360: 6520 7374 696c 6c20 736f 7274 2062 7920  e still sort by 
+00007370: 7468 6174 206c 6174 6572 2e0a 2020 2020  that later..    
+00007380: 2020 2020 2020 2020 6172 7261 795f 7661          array_va
+00007390: 6c75 6520 3d20 6266 5f72 6561 645f 6762  lue = bf_read_gb
+000073a0: 715f 7461 626c 652e 746f 5f61 7272 6179  q_table.to_array
+000073b0: 5f76 616c 7565 5f77 6974 685f 6465 6661  _value_with_defa
+000073c0: 756c 745f 6f72 6465 7269 6e67 280a 2020  ult_ordering(.  
+000073d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000073e0: 7373 696f 6e3d 7365 6c66 2c20 7461 626c  ssion=self, tabl
+000073f0: 653d 7461 626c 655f 6578 7072 6573 7369  e=table_expressi
+00007400: 6f6e 2c20 7461 626c 655f 726f 7773 3d74  on, table_rows=t
+00007410: 6162 6c65 2e6e 756d 5f72 6f77 730a 2020  able.num_rows.  
+00007420: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00007430: 2020 2020 2023 202d 2d2d 2d2d 2d2d 2d2d       # ---------
+00007440: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00007450: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00007460: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+00007470: 2020 2020 2320 4372 6561 7465 2044 6566      # Create Def
+00007480: 6175 6c74 2053 6571 7565 6e74 6961 6c20  ault Sequential 
+00007490: 496e 6465 7820 6966 2073 7469 6c6c 2068  Index if still h
+000074a0: 6176 6520 6e6f 2069 6e64 6578 0a20 2020  ave no index.   
+000074b0: 2020 2020 2023 202d 2d2d 2d2d 2d2d 2d2d       # ---------
+000074c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000074d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000074e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 0a20 2020  -----------..   
+000074f0: 2020 2020 2023 2049 6620 6e6f 2069 6e64       # If no ind
+00007500: 6578 2063 6f6c 756d 6e73 2070 726f 7669  ex columns provi
+00007510: 6465 6420 6f72 2066 6f75 6e64 2c20 6661  ded or found, fa
+00007520: 6c6c 2062 6163 6b20 746f 2073 6571 7565  ll back to seque
+00007530: 6e74 6961 6c20 696e 6465 780a 2020 2020  ntial index.    
+00007540: 2020 2020 6966 2028 696e 6465 785f 636f      if (index_co
+00007550: 6c20 213d 2062 6967 6672 616d 6573 2e65  l != bigframes.e
+00007560: 6e75 6d73 2e44 6566 6175 6c74 496e 6465  nums.DefaultInde
+00007570: 784b 696e 642e 4e55 4c4c 2920 616e 6420  xKind.NULL) and 
+00007580: 6c65 6e28 0a20 2020 2020 2020 2020 2020  len(.           
+00007590: 2069 6e64 6578 5f63 6f6c 730a 2020 2020   index_cols.    
+000075a0: 2020 2020 2920 3d3d 2030 3a0a 2020 2020      ) == 0:.    
+000075b0: 2020 2020 2020 2020 696e 6465 785f 636f          index_co
+000075c0: 6c20 3d20 6269 6766 7261 6d65 732e 656e  l = bigframes.en
+000075d0: 756d 732e 4465 6661 756c 7449 6e64 6578  ums.DefaultIndex
+000075e0: 4b69 6e64 2e53 4551 5545 4e54 4941 4c5f  Kind.SEQUENTIAL_
+000075f0: 494e 5436 340a 0a20 2020 2020 2020 2069  INT64..        i
+00007600: 6e64 6578 5f6e 616d 6573 3a20 5365 7175  ndex_names: Sequ
+00007610: 656e 6365 5b48 6173 6861 626c 655d 203d  ence[Hashable] =
+00007620: 2069 6e64 6578 5f63 6f6c 730a 2020 2020   index_cols.    
+00007630: 2020 2020 6966 2069 6e64 6578 5f63 6f6c      if index_col
+00007640: 203d 3d20 6269 6766 7261 6d65 732e 656e   == bigframes.en
+00007650: 756d 732e 4465 6661 756c 7449 6e64 6578  ums.DefaultIndex
+00007660: 4b69 6e64 2e53 4551 5545 4e54 4941 4c5f  Kind.SEQUENTIAL_
+00007670: 494e 5436 343a 0a20 2020 2020 2020 2020  INT64:.         
+00007680: 2020 2073 6571 7565 6e74 6961 6c5f 696e     sequential_in
+00007690: 6465 785f 636f 6c20 3d20 6269 6766 7261  dex_col = bigfra
+000076a0: 6d65 732e 636f 7265 2e67 7569 642e 6765  mes.core.guid.ge
+000076b0: 6e65 7261 7465 5f67 7569 6428 2269 6e64  nerate_guid("ind
+000076c0: 6578 5f22 290a 2020 2020 2020 2020 2020  ex_").          
+000076d0: 2020 6172 7261 795f 7661 6c75 6520 3d20    array_value = 
+000076e0: 6172 7261 795f 7661 6c75 652e 7072 6f6d  array_value.prom
+000076f0: 6f74 655f 6f66 6673 6574 7328 7365 7175  ote_offsets(sequ
+00007700: 656e 7469 616c 5f69 6e64 6578 5f63 6f6c  ential_index_col
+00007710: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
+00007720: 6465 785f 636f 6c73 203d 205b 7365 7175  dex_cols = [sequ
+00007730: 656e 7469 616c 5f69 6e64 6578 5f63 6f6c  ential_index_col
+00007740: 5d0a 2020 2020 2020 2020 2020 2020 696e  ].            in
+00007750: 6465 785f 6e61 6d65 7320 3d20 5b4e 6f6e  dex_names = [Non
+00007760: 655d 0a0a 2020 2020 2020 2020 7661 6c75  e]..        valu
+00007770: 655f 636f 6c75 6d6e 7320 3d20 5b63 6f6c  e_columns = [col
+00007780: 2066 6f72 2063 6f6c 2069 6e20 6172 7261   for col in arra
+00007790: 795f 7661 6c75 652e 636f 6c75 6d6e 5f69  y_value.column_i
+000077a0: 6473 2069 6620 636f 6c20 6e6f 7420 696e  ds if col not in
+000077b0: 2069 6e64 6578 5f63 6f6c 735d 0a20 2020   index_cols].   
+000077c0: 2020 2020 2062 6c6f 636b 203d 2062 6c6f       block = blo
+000077d0: 636b 732e 426c 6f63 6b28 0a20 2020 2020  cks.Block(.     
+000077e0: 2020 2020 2020 2061 7272 6179 5f76 616c         array_val
+000077f0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00007800: 696e 6465 785f 636f 6c75 6d6e 733d 696e  index_columns=in
+00007810: 6465 785f 636f 6c73 2c0a 2020 2020 2020  dex_cols,.      
+00007820: 2020 2020 2020 636f 6c75 6d6e 5f6c 6162        column_lab
+00007830: 656c 733d 7661 6c75 655f 636f 6c75 6d6e  els=value_column
+00007840: 732c 0a20 2020 2020 2020 2020 2020 2069  s,.            i
+00007850: 6e64 6578 5f6c 6162 656c 733d 696e 6465  ndex_labels=inde
+00007860: 785f 6e61 6d65 732c 0a20 2020 2020 2020  x_names,.       
+00007870: 2029 0a20 2020 2020 2020 2069 6620 6d61   ).        if ma
+00007880: 785f 7265 7375 6c74 733a 0a20 2020 2020  x_results:.     
+00007890: 2020 2020 2020 2062 6c6f 636b 203d 2062         block = b
+000078a0: 6c6f 636b 2e73 6c69 6365 2873 746f 703d  lock.slice(stop=
+000078b0: 6d61 785f 7265 7375 6c74 7329 0a20 2020  max_results).   
+000078c0: 2020 2020 2064 6620 3d20 6461 7461 6672       df = datafr
+000078d0: 616d 652e 4461 7461 4672 616d 6528 626c  ame.DataFrame(bl
+000078e0: 6f63 6b29 0a0a 2020 2020 2020 2020 2320  ock)..        # 
+000078f0: 4966 2075 7365 7220 7072 6f76 6964 6564  If user provided
+00007900: 2069 6e64 6578 2063 6f6c 756d 6e73 2c20   index columns, 
+00007910: 7368 6f75 6c64 2073 6f72 7420 6f76 6572  should sort over
+00007920: 2069 740a 2020 2020 2020 2020 6966 206c   it.        if l
+00007930: 656e 2869 6e64 6578 5f63 6f6c 7329 203e  en(index_cols) >
+00007940: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00007950: 6466 2e73 6f72 745f 696e 6465 7828 290a  df.sort_index().
+00007960: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00007970: 660a 0a20 2020 2064 6566 205f 7265 6164  f..    def _read
+00007980: 5f62 6967 7175 6572 795f 6c6f 6164 5f6a  _bigquery_load_j
+00007990: 6f62 280a 2020 2020 2020 2020 7365 6c66  ob(.        self
+000079a0: 2c0a 2020 2020 2020 2020 6669 6c65 7061  ,.        filepa
+000079b0: 7468 5f6f 725f 6275 6666 6572 3a20 7374  th_or_buffer: st
+000079c0: 7220 7c20 494f 5b22 6279 7465 7322 5d2c  r | IO["bytes"],
+000079d0: 0a20 2020 2020 2020 2074 6162 6c65 3a20  .        table: 
+000079e0: 556e 696f 6e5b 6269 6771 7565 7279 2e54  Union[bigquery.T
+000079f0: 6162 6c65 2c20 6269 6771 7565 7279 2e54  able, bigquery.T
+00007a00: 6162 6c65 5265 6665 7265 6e63 655d 2c0a  ableReference],.
+00007a10: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
+00007a20: 2020 206a 6f62 5f63 6f6e 6669 673a 2062     job_config: b
+00007a30: 6967 7175 6572 792e 4c6f 6164 4a6f 6243  igquery.LoadJobC
+00007a40: 6f6e 6669 672c 0a20 2020 2020 2020 2069  onfig,.        i
+00007a50: 6e64 6578 5f63 6f6c 3a20 4974 6572 6162  ndex_col: Iterab
+00007a60: 6c65 5b73 7472 5d20 7c20 7374 7220 7c20  le[str] | str | 
+00007a70: 6269 6766 7261 6d65 732e 656e 756d 732e  bigframes.enums.
+00007a80: 4465 6661 756c 7449 6e64 6578 4b69 6e64  DefaultIndexKind
+00007a90: 203d 2028 292c 0a20 2020 2020 2020 2063   = (),.        c
+00007aa0: 6f6c 756d 6e73 3a20 4974 6572 6162 6c65  olumns: Iterable
+00007ab0: 5b73 7472 5d20 3d20 2829 2c0a 2020 2020  [str] = (),.    
+00007ac0: 2920 2d3e 2064 6174 6166 7261 6d65 2e44  ) -> dataframe.D
+00007ad0: 6174 6146 7261 6d65 3a0a 2020 2020 2020  ataFrame:.      
+00007ae0: 2020 696e 6465 785f 636f 6c73 203d 205f    index_cols = _
+00007af0: 746f 5f69 6e64 6578 5f63 6f6c 7328 696e  to_index_cols(in
+00007b00: 6465 785f 636f 6c29 0a0a 2020 2020 2020  dex_col)..      
+00007b10: 2020 6966 206e 6f74 206a 6f62 5f63 6f6e    if not job_con
+00007b20: 6669 672e 636c 7573 7465 7269 6e67 5f66  fig.clustering_f
+00007b30: 6965 6c64 7320 616e 6420 696e 6465 785f  ields and index_
+00007b40: 636f 6c73 3a0a 2020 2020 2020 2020 2020  cols:.          
+00007b50: 2020 6a6f 625f 636f 6e66 6967 2e63 6c75    job_config.clu
+00007b60: 7374 6572 696e 675f 6669 656c 6473 203d  stering_fields =
+00007b70: 2069 6e64 6578 5f63 6f6c 735b 3a5f 4d41   index_cols[:_MA
+00007b80: 585f 434c 5553 5445 525f 434f 4c55 4d4e  X_CLUSTER_COLUMN
+00007b90: 535d 0a0a 2020 2020 2020 2020 6966 2069  S]..        if i
+00007ba0: 7369 6e73 7461 6e63 6528 6669 6c65 7061  sinstance(filepa
+00007bb0: 7468 5f6f 725f 6275 6666 6572 2c20 7374  th_or_buffer, st
+00007bc0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00007bd0: 6966 2066 696c 6570 6174 685f 6f72 5f62  if filepath_or_b
+00007be0: 7566 6665 722e 7374 6172 7473 7769 7468  uffer.startswith
+00007bf0: 2822 6773 3a2f 2f22 293a 0a20 2020 2020  ("gs://"):.     
+00007c00: 2020 2020 2020 2020 2020 206c 6f61 645f             load_
+00007c10: 6a6f 6220 3d20 7365 6c66 2e62 7163 6c69  job = self.bqcli
+00007c20: 656e 742e 6c6f 6164 5f74 6162 6c65 5f66  ent.load_table_f
+00007c30: 726f 6d5f 7572 6928 0a20 2020 2020 2020  rom_uri(.       
+00007c40: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00007c50: 6570 6174 685f 6f72 5f62 7566 6665 722c  epath_or_buffer,
+00007c60: 2074 6162 6c65 2c20 6a6f 625f 636f 6e66   table, job_conf
+00007c70: 6967 3d6a 6f62 5f63 6f6e 6669 670a 2020  ig=job_config.  
+00007c80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00007c90: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00007ca0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007cb0: 2020 7769 7468 206f 7065 6e28 6669 6c65    with open(file
+00007cc0: 7061 7468 5f6f 725f 6275 6666 6572 2c20  path_or_buffer, 
+00007cd0: 2272 6222 2920 6173 2073 6f75 7263 655f  "rb") as source_
+00007ce0: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+00007cf0: 2020 2020 2020 2020 2020 6c6f 6164 5f6a            load_j
+00007d00: 6f62 203d 2073 656c 662e 6271 636c 6965  ob = self.bqclie
+00007d10: 6e74 2e6c 6f61 645f 7461 626c 655f 6672  nt.load_table_fr
+00007d20: 6f6d 5f66 696c 6528 0a20 2020 2020 2020  om_file(.       
+00007d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007d40: 2073 6f75 7263 655f 6669 6c65 2c20 7461   source_file, ta
+00007d50: 626c 652c 206a 6f62 5f63 6f6e 6669 673d  ble, job_config=
+00007d60: 6a6f 625f 636f 6e66 6967 0a20 2020 2020  job_config.     
+00007d70: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00007d80: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00007d90: 2020 2020 2020 2020 2020 206c 6f61 645f             load_
+00007da0: 6a6f 6220 3d20 7365 6c66 2e62 7163 6c69  job = self.bqcli
+00007db0: 656e 742e 6c6f 6164 5f74 6162 6c65 5f66  ent.load_table_f
+00007dc0: 726f 6d5f 6669 6c65 280a 2020 2020 2020  rom_file(.      
+00007dd0: 2020 2020 2020 2020 2020 6669 6c65 7061            filepa
+00007de0: 7468 5f6f 725f 6275 6666 6572 2c20 7461  th_or_buffer, ta
+00007df0: 626c 652c 206a 6f62 5f63 6f6e 6669 673d  ble, job_config=
+00007e00: 6a6f 625f 636f 6e66 6967 0a20 2020 2020  job_config.     
+00007e10: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00007e20: 2020 7365 6c66 2e5f 7374 6172 745f 6765    self._start_ge
+00007e30: 6e65 7269 635f 6a6f 6228 6c6f 6164 5f6a  neric_job(load_j
+00007e40: 6f62 290a 2020 2020 2020 2020 7461 626c  ob).        tabl
+00007e50: 655f 6964 203d 2066 227b 7461 626c 652e  e_id = f"{table.
+00007e60: 7072 6f6a 6563 747d 2e7b 7461 626c 652e  project}.{table.
+00007e70: 6461 7461 7365 745f 6964 7d2e 7b74 6162  dataset_id}.{tab
+00007e80: 6c65 2e74 6162 6c65 5f69 647d 220a 0a20  le.table_id}".. 
+00007e90: 2020 2020 2020 2023 2055 7064 6174 6520         # Update 
+00007ea0: 7468 6520 7461 626c 6520 6578 7069 7261  the table expira
+00007eb0: 7469 6f6e 2073 6f20 7765 2061 7265 6e27  tion so we aren'
+00007ec0: 7420 6c69 6d69 7465 6420 746f 2074 6865  t limited to the
+00007ed0: 2064 6566 6175 6c74 2032 340a 2020 2020   default 24.    
+00007ee0: 2020 2020 2320 686f 7572 7320 6f66 2074      # hours of t
+00007ef0: 6865 2061 6e6f 6e79 6d6f 7573 2064 6174  he anonymous dat
+00007f00: 6173 6574 2e0a 2020 2020 2020 2020 7461  aset..        ta
+00007f10: 626c 655f 6578 7069 7261 7469 6f6e 203d  ble_expiration =
+00007f20: 2062 6967 7175 6572 792e 5461 626c 6528   bigquery.Table(
+00007f30: 7461 626c 655f 6964 290a 2020 2020 2020  table_id).      
+00007f40: 2020 7461 626c 655f 6578 7069 7261 7469    table_expirati
+00007f50: 6f6e 2e65 7870 6972 6573 203d 2028 0a20  on.expires = (. 
+00007f60: 2020 2020 2020 2020 2020 2064 6174 6574             datet
+00007f70: 696d 652e 6461 7465 7469 6d65 2e6e 6f77  ime.datetime.now
+00007f80: 2864 6174 6574 696d 652e 7469 6d65 7a6f  (datetime.timezo
+00007f90: 6e65 2e75 7463 2920 2b20 636f 6e73 7461  ne.utc) + consta
+00007fa0: 6e74 732e 4445 4641 554c 545f 4558 5049  nts.DEFAULT_EXPI
+00007fb0: 5241 5449 4f4e 0a20 2020 2020 2020 2029  RATION.        )
+00007fc0: 0a20 2020 2020 2020 2073 656c 662e 6271  .        self.bq
+00007fd0: 636c 6965 6e74 2e75 7064 6174 655f 7461  client.update_ta
+00007fe0: 626c 6528 7461 626c 655f 6578 7069 7261  ble(table_expira
+00007ff0: 7469 6f6e 2c20 5b22 6578 7069 7265 7322  tion, ["expires"
+00008000: 5d29 0a0a 2020 2020 2020 2020 2320 5468  ])..        # Th
+00008010: 6520 4269 6751 7565 7279 2052 4553 5420  e BigQuery REST 
+00008020: 4150 4920 666f 7220 7461 626c 6573 2e67  API for tables.g
+00008030: 6574 2064 6f65 736e 2774 2074 616b 6520  et doesn't take 
+00008040: 6120 7365 7373 696f 6e20 4944 2c20 736f  a session ID, so
+00008050: 2077 650a 2020 2020 2020 2020 2320 6361   we.        # ca
+00008060: 6e27 7420 6765 7420 7468 6520 7363 6865  n't get the sche
+00008070: 6d61 2066 6f72 2061 2074 656d 7020 7461  ma for a temp ta
+00008080: 626c 6520 7468 6174 2077 6179 2e0a 2020  ble that way..  
+00008090: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000080a0: 662e 7265 6164 5f67 6271 5f74 6162 6c65  f.read_gbq_table
+000080b0: 280a 2020 2020 2020 2020 2020 2020 7461  (.            ta
+000080c0: 626c 655f 6964 2c0a 2020 2020 2020 2020  ble_id,.        
+000080d0: 2020 2020 696e 6465 785f 636f 6c3d 696e      index_col=in
+000080e0: 6465 785f 636f 6c2c 0a20 2020 2020 2020  dex_col,.       
+000080f0: 2020 2020 2063 6f6c 756d 6e73 3d63 6f6c       columns=col
+00008100: 756d 6e73 2c0a 2020 2020 2020 2020 290a  umns,.        ).
+00008110: 0a20 2020 2064 6566 2072 6561 645f 6762  .    def read_gb
+00008120: 715f 6d6f 6465 6c28 7365 6c66 2c20 6d6f  q_model(self, mo
+00008130: 6465 6c5f 6e61 6d65 3a20 7374 7229 3a0a  del_name: str):.
+00008140: 2020 2020 2020 2020 2222 224c 6f61 6473          """Loads
+00008150: 2061 2042 6967 5175 6572 7920 4d4c 206d   a BigQuery ML m
+00008160: 6f64 656c 2066 726f 6d20 4269 6751 7565  odel from BigQue
+00008170: 7279 2e0a 0a20 2020 2020 2020 202a 2a45  ry...        **E
+00008180: 7861 6d70 6c65 733a 2a2a 0a0a 2020 2020  xamples:**..    
+00008190: 2020 2020 2020 2020 3e3e 3e20 696d 706f          >>> impo
+000081a0: 7274 2062 6967 6672 616d 6573 2e70 616e  rt bigframes.pan
+000081b0: 6461 7320 6173 2062 7064 0a20 2020 2020  das as bpd.     
+000081c0: 2020 2020 2020 203e 3e3e 2062 7064 2e6f         >>> bpd.o
+000081d0: 7074 696f 6e73 2e64 6973 706c 6179 2e70  ptions.display.p
+000081e0: 726f 6772 6573 735f 6261 7220 3d20 4e6f  rogress_bar = No
+000081f0: 6e65 0a0a 2020 2020 2020 2020 5265 6164  ne..        Read
+00008200: 2061 6e20 6578 6973 7469 6e67 2042 6967   an existing Big
+00008210: 5175 6572 7920 4d4c 206d 6f64 656c 2e0a  Query ML model..
+00008220: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
+00008230: 206d 6f64 656c 5f6e 616d 6520 3d20 2262   model_name = "b
+00008240: 6967 6672 616d 6573 2d64 6576 2e62 716d  igframes-dev.bqm
+00008250: 6c5f 7475 746f 7269 616c 2e70 656e 6775  l_tutorial.pengu
+00008260: 696e 735f 6d6f 6465 6c22 0a20 2020 2020  ins_model".     
+00008270: 2020 2020 2020 203e 3e3e 206d 6f64 656c         >>> model
+00008280: 203d 2062 7064 2e72 6561 645f 6762 715f   = bpd.read_gbq_
+00008290: 6d6f 6465 6c28 6d6f 6465 6c5f 6e61 6d65  model(model_name
+000082a0: 290a 0a20 2020 2020 2020 2041 7267 733a  )..        Args:
+000082b0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
+000082c0: 656c 5f6e 616d 6520 2873 7472 293a 0a20  el_name (str):. 
+000082d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000082e0: 6865 206d 6f64 656c 2773 206e 616d 6520  he model's name 
+000082f0: 696e 2042 6967 5175 6572 7920 696e 2074  in BigQuery in t
+00008300: 6865 2066 6f72 6d61 740a 2020 2020 2020  he format.      
+00008310: 2020 2020 2020 2020 2020 6070 726f 6a65            `proje
+00008320: 6374 5f69 642e 6461 7461 7365 745f 6964  ct_id.dataset_id
+00008330: 2e6d 6f64 656c 5f69 6460 2c20 6f72 206a  .model_id`, or j
+00008340: 7573 7420 6064 6174 6173 6574 5f69 642e  ust `dataset_id.
+00008350: 6d6f 6465 6c5f 6964 600a 2020 2020 2020  model_id`.      
+00008360: 2020 2020 2020 2020 2020 746f 206c 6f61            to loa
+00008370: 6420 6672 6f6d 2074 6865 2064 6566 6175  d from the defau
+00008380: 6c74 2070 726f 6a65 6374 2e0a 0a20 2020  lt project...   
+00008390: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
+000083a0: 2020 2020 2020 2020 2020 4120 6269 6766            A bigf
+000083b0: 7261 6d65 732e 6d6c 204d 6f64 656c 2c20  rames.ml Model, 
+000083c0: 5472 616e 7366 6f72 6d65 7220 6f72 2050  Transformer or P
+000083d0: 6970 656c 696e 6520 7772 6170 7069 6e67  ipeline wrapping
+000083e0: 2074 6865 206d 6f64 656c 2e0a 2020 2020   the model..    
+000083f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00008400: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
+00008410: 2e6d 6c2e 6c6f 6164 6572 0a0a 2020 2020  .ml.loader..    
+00008420: 2020 2020 6d6f 6465 6c5f 7265 6620 3d20      model_ref = 
+00008430: 6269 6771 7565 7279 2e4d 6f64 656c 5265  bigquery.ModelRe
+00008440: 6665 7265 6e63 652e 6672 6f6d 5f73 7472  ference.from_str
+00008450: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
+00008460: 206d 6f64 656c 5f6e 616d 652c 2064 6566   model_name, def
+00008470: 6175 6c74 5f70 726f 6a65 6374 3d73 656c  ault_project=sel
+00008480: 662e 6271 636c 6965 6e74 2e70 726f 6a65  f.bqclient.proje
+00008490: 6374 0a20 2020 2020 2020 2029 0a20 2020  ct.        ).   
+000084a0: 2020 2020 206d 6f64 656c 203d 2073 656c       model = sel
+000084b0: 662e 6271 636c 6965 6e74 2e67 6574 5f6d  f.bqclient.get_m
+000084c0: 6f64 656c 286d 6f64 656c 5f72 6566 290a  odel(model_ref).
+000084d0: 2020 2020 2020 2020 7265 7475 726e 2062          return b
+000084e0: 6967 6672 616d 6573 2e6d 6c2e 6c6f 6164  igframes.ml.load
+000084f0: 6572 2e66 726f 6d5f 6271 2873 656c 662c  er.from_bq(self,
+00008500: 206d 6f64 656c 290a 0a20 2020 2040 7479   model)..    @ty
+00008510: 7069 6e67 2e6f 7665 726c 6f61 640a 2020  ping.overload.  
+00008520: 2020 6465 6620 7265 6164 5f70 616e 6461    def read_panda
+00008530: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+00008540: 2070 616e 6461 735f 6461 7461 6672 616d   pandas_datafram
+00008550: 653a 2070 616e 6461 732e 496e 6465 780a  e: pandas.Index.
+00008560: 2020 2020 2920 2d3e 2062 6967 6672 616d      ) -> bigfram
+00008570: 6573 2e63 6f72 652e 696e 6465 7865 732e  es.core.indexes.
+00008580: 496e 6465 783a 0a20 2020 2020 2020 202e  Index:.        .
+00008590: 2e2e 0a0a 2020 2020 4074 7970 696e 672e  ....    @typing.
+000085a0: 6f76 6572 6c6f 6164 0a20 2020 2064 6566  overload.    def
+000085b0: 2072 6561 645f 7061 6e64 6173 2873 656c   read_pandas(sel
+000085c0: 662c 2070 616e 6461 735f 6461 7461 6672  f, pandas_datafr
+000085d0: 616d 653a 2070 616e 6461 732e 5365 7269  ame: pandas.Seri
+000085e0: 6573 2920 2d3e 2062 6967 6672 616d 6573  es) -> bigframes
+000085f0: 2e73 6572 6965 732e 5365 7269 6573 3a0a  .series.Series:.
+00008600: 2020 2020 2020 2020 2e2e 2e0a 0a20 2020          .....   
+00008610: 2040 7479 7069 6e67 2e6f 7665 726c 6f61   @typing.overloa
+00008620: 640a 2020 2020 6465 6620 7265 6164 5f70  d.    def read_p
+00008630: 616e 6461 7328 7365 6c66 2c20 7061 6e64  andas(self, pand
+00008640: 6173 5f64 6174 6166 7261 6d65 3a20 7061  as_dataframe: pa
+00008650: 6e64 6173 2e44 6174 6146 7261 6d65 2920  ndas.DataFrame) 
+00008660: 2d3e 2064 6174 6166 7261 6d65 2e44 6174  -> dataframe.Dat
+00008670: 6146 7261 6d65 3a0a 2020 2020 2020 2020  aFrame:.        
+00008680: 2e2e 2e0a 0a20 2020 2064 6566 2072 6561  .....    def rea
+00008690: 645f 7061 6e64 6173 280a 2020 2020 2020  d_pandas(.      
+000086a0: 2020 7365 6c66 2c20 7061 6e64 6173 5f64    self, pandas_d
+000086b0: 6174 6166 7261 6d65 3a20 556e 696f 6e5b  ataframe: Union[
+000086c0: 7061 6e64 6173 2e44 6174 6146 7261 6d65  pandas.DataFrame
+000086d0: 2c20 7061 6e64 6173 2e53 6572 6965 732c  , pandas.Series,
+000086e0: 2070 616e 6461 732e 496e 6465 785d 0a20   pandas.Index]. 
+000086f0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+00008700: 224c 6f61 6473 2044 6174 6146 7261 6d65  "Loads DataFrame
+00008710: 2066 726f 6d20 6120 7061 6e64 6173 2044   from a pandas D
+00008720: 6174 6146 7261 6d65 2e0a 0a20 2020 2020  ataFrame...     
+00008730: 2020 2054 6865 2070 616e 6461 7320 4461     The pandas Da
+00008740: 7461 4672 616d 6520 7769 6c6c 2062 6520  taFrame will be 
+00008750: 7065 7273 6973 7465 6420 6173 2061 2074  persisted as a t
+00008760: 656d 706f 7261 7279 2042 6967 5175 6572  emporary BigQuer
+00008770: 7920 7461 626c 652c 2077 6869 6368 2063  y table, which c
+00008780: 616e 2062 650a 2020 2020 2020 2020 6175  an be.        au
+00008790: 746f 6d61 7469 6361 6c6c 7920 7265 6379  tomatically recy
+000087a0: 636c 6564 2061 6674 6572 2074 6865 2053  cled after the S
+000087b0: 6573 7369 6f6e 2069 7320 636c 6f73 6564  ession is closed
+000087c0: 2e0a 0a20 2020 2020 2020 202e 2e20 6e6f  ...        .. no
+000087d0: 7465 3a3a 0a20 2020 2020 2020 2020 2020  te::.           
+000087e0: 2044 6174 6120 6973 2069 6e6c 696e 6564   Data is inlined
+000087f0: 2069 6e20 7468 6520 7175 6572 7920 5351   in the query SQ
+00008800: 4c20 6966 2069 7420 6973 2073 6d61 6c6c  L if it is small
+00008810: 2065 6e6f 7567 6820 2872 6f75 6768 6c79   enough (roughly
+00008820: 2035 4d42 0a20 2020 2020 2020 2020 2020   5MB.           
+00008830: 206f 7220 6c65 7373 2069 6e20 6d65 6d6f   or less in memo
+00008840: 7279 292e 204c 6172 6765 7220 7369 7a65  ry). Larger size
+00008850: 2064 6174 6120 6973 206c 6f61 6465 6420   data is loaded 
+00008860: 746f 2061 2042 6967 5175 6572 7920 7461  to a BigQuery ta
+00008870: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
+00008880: 696e 7374 6561 642e 0a0a 2020 2020 2020  instead...      
+00008890: 2020 2a2a 4578 616d 706c 6573 3a2a 2a0a    **Examples:**.
+000088a0: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
+000088b0: 2069 6d70 6f72 7420 6269 6766 7261 6d65   import bigframe
+000088c0: 732e 7061 6e64 6173 2061 7320 6270 640a  s.pandas as bpd.
+000088d0: 2020 2020 2020 2020 2020 2020 3e3e 3e20              >>> 
+000088e0: 696d 706f 7274 2070 616e 6461 7320 6173  import pandas as
+000088f0: 2070 640a 2020 2020 2020 2020 2020 2020   pd.            
+00008900: 3e3e 3e20 6270 642e 6f70 7469 6f6e 732e  >>> bpd.options.
+00008910: 6469 7370 6c61 792e 7072 6f67 7265 7373  display.progress
+00008920: 5f62 6172 203d 204e 6f6e 650a 0a20 2020  _bar = None..   
+00008930: 2020 2020 2020 2020 203e 3e3e 2064 203d           >>> d =
+00008940: 207b 2763 6f6c 3127 3a20 5b31 2c20 325d   {'col1': [1, 2]
+00008950: 2c20 2763 6f6c 3227 3a20 5b33 2c20 345d  , 'col2': [3, 4]
+00008960: 7d0a 2020 2020 2020 2020 2020 2020 3e3e  }.            >>
+00008970: 3e20 7061 6e64 6173 5f64 6620 3d20 7064  > pandas_df = pd
+00008980: 2e44 6174 6146 7261 6d65 2864 6174 613d  .DataFrame(data=
+00008990: 6429 0a20 2020 2020 2020 2020 2020 203e  d).            >
+000089a0: 3e3e 2064 6620 3d20 6270 642e 7265 6164  >> df = bpd.read
+000089b0: 5f70 616e 6461 7328 7061 6e64 6173 5f64  _pandas(pandas_d
+000089c0: 6629 0a20 2020 2020 2020 2020 2020 203e  f).            >
+000089d0: 3e3e 2064 660a 2020 2020 2020 2020 2020  >> df.          
+000089e0: 2020 2020 2063 6f6c 3120 2063 6f6c 320a       col1  col2.
+000089f0: 2020 2020 2020 2020 2020 2020 3020 2020              0   
+00008a00: 2020 3120 2020 2020 330a 2020 2020 2020    1     3.      
+00008a10: 2020 2020 2020 3120 2020 2020 3220 2020        1     2   
+00008a20: 2020 340a 2020 2020 2020 2020 2020 2020    4.            
+00008a30: 3c42 4c41 4e4b 4c49 4e45 3e0a 2020 2020  <BLANKLINE>.    
+00008a40: 2020 2020 2020 2020 5b32 2072 6f77 7320          [2 rows 
+00008a50: 7820 3220 636f 6c75 6d6e 735d 0a0a 2020  x 2 columns]..  
+00008a60: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+00008a70: 2020 2020 2020 2020 7061 6e64 6173 5f64          pandas_d
+00008a80: 6174 6166 7261 6d65 2028 7061 6e64 6173  ataframe (pandas
+00008a90: 2e44 6174 6146 7261 6d65 2c20 7061 6e64  .DataFrame, pand
+00008aa0: 6173 2e53 6572 6965 732c 206f 7220 7061  as.Series, or pa
+00008ab0: 6e64 6173 2e49 6e64 6578 293a 0a20 2020  ndas.Index):.   
+00008ac0: 2020 2020 2020 2020 2020 2020 2061 2070               a p
+00008ad0: 616e 6461 7320 4461 7461 4672 616d 652f  andas DataFrame/
+00008ae0: 5365 7269 6573 2f49 6e64 6578 206f 626a  Series/Index obj
+00008af0: 6563 7420 746f 2062 6520 6c6f 6164 6564  ect to be loaded
+00008b00: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00008b10: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00008b20: 416e 2065 7175 6976 616c 656e 7420 6269  An equivalent bi
+00008b30: 6766 7261 6d65 732e 7061 6e64 6173 2e28  gframes.pandas.(
+00008b40: 4461 7461 4672 616d 652f 5365 7269 6573  DataFrame/Series
+00008b50: 2f49 6e64 6578 2920 6f62 6a65 6374 0a20  /Index) object. 
+00008b60: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00008b70: 2020 2069 6d70 6f72 7420 6269 6766 7261     import bigfra
+00008b80: 6d65 732e 7365 7269 6573 2061 7320 7365  mes.series as se
+00008b90: 7269 6573 0a0a 2020 2020 2020 2020 2320  ries..        # 
+00008ba0: 5472 7920 746f 2068 616e 646c 6520 6e6f  Try to handle no
+00008bb0: 6e2d 6461 7461 6672 616d 6520 7061 6e64  n-dataframe pand
+00008bc0: 6173 206f 626a 6563 7473 2061 7320 7765  as objects as we
+00008bd0: 6c6c 0a20 2020 2020 2020 2069 6620 6973  ll.        if is
+00008be0: 696e 7374 616e 6365 2870 616e 6461 735f  instance(pandas_
+00008bf0: 6461 7461 6672 616d 652c 2070 616e 6461  dataframe, panda
+00008c00: 732e 5365 7269 6573 293a 0a20 2020 2020  s.Series):.     
+00008c10: 2020 2020 2020 2062 665f 6466 203d 2073         bf_df = s
+00008c20: 656c 662e 5f72 6561 645f 7061 6e64 6173  elf._read_pandas
+00008c30: 2870 616e 6461 732e 4461 7461 4672 616d  (pandas.DataFram
+00008c40: 6528 7061 6e64 6173 5f64 6174 6166 7261  e(pandas_datafra
+00008c50: 6d65 292c 2022 7265 6164 5f70 616e 6461  me), "read_panda
+00008c60: 7322 290a 2020 2020 2020 2020 2020 2020  s").            
+00008c70: 6266 5f73 6572 6965 7320 3d20 7479 7069  bf_series = typi
+00008c80: 6e67 2e63 6173 7428 7365 7269 6573 2e53  ng.cast(series.S
+00008c90: 6572 6965 732c 2062 665f 6466 5b62 665f  eries, bf_df[bf_
+00008ca0: 6466 2e63 6f6c 756d 6e73 5b30 5d5d 290a  df.columns[0]]).
+00008cb0: 2020 2020 2020 2020 2020 2020 2320 7772              # wr
+00008cc0: 6170 7069 6e67 2069 6e74 6f20 6466 2063  apping into df c
+00008cd0: 616e 2073 6574 206e 616d 6520 746f 2030  an set name to 0
+00008ce0: 2073 6f20 7265 7365 7420 746f 206f 7269   so reset to ori
+00008cf0: 6769 6e61 6c20 6f62 6a65 6374 206e 616d  ginal object nam
+00008d00: 650a 2020 2020 2020 2020 2020 2020 6266  e.            bf
+00008d10: 5f73 6572 6965 732e 6e61 6d65 203d 2070  _series.name = p
+00008d20: 616e 6461 735f 6461 7461 6672 616d 652e  andas_dataframe.
+00008d30: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+00008d40: 2072 6574 7572 6e20 6266 5f73 6572 6965   return bf_serie
+00008d50: 730a 2020 2020 2020 2020 6966 2069 7369  s.        if isi
+00008d60: 6e73 7461 6e63 6528 7061 6e64 6173 5f64  nstance(pandas_d
+00008d70: 6174 6166 7261 6d65 2c20 7061 6e64 6173  ataframe, pandas
+00008d80: 2e49 6e64 6578 293a 0a20 2020 2020 2020  .Index):.       
+00008d90: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00008da0: 2e5f 7265 6164 5f70 616e 6461 7328 0a20  ._read_pandas(. 
+00008db0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00008dc0: 616e 6461 732e 4461 7461 4672 616d 6528  andas.DataFrame(
+00008dd0: 696e 6465 783d 7061 6e64 6173 5f64 6174  index=pandas_dat
+00008de0: 6166 7261 6d65 292c 2022 7265 6164 5f70  aframe), "read_p
+00008df0: 616e 6461 7322 0a20 2020 2020 2020 2020  andas".         
+00008e00: 2020 2029 2e69 6e64 6578 0a20 2020 2020     ).index.     
+00008e10: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00008e20: 2870 616e 6461 735f 6461 7461 6672 616d  (pandas_datafram
+00008e30: 652c 2070 616e 6461 732e 4461 7461 4672  e, pandas.DataFr
+00008e40: 616d 6529 3a0a 2020 2020 2020 2020 2020  ame):.          
+00008e50: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+00008e60: 6561 645f 7061 6e64 6173 2870 616e 6461  ead_pandas(panda
+00008e70: 735f 6461 7461 6672 616d 652c 2022 7265  s_dataframe, "re
+00008e80: 6164 5f70 616e 6461 7322 290a 2020 2020  ad_pandas").    
+00008e90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00008ea0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00008eb0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00008ec0: 2020 2020 2020 2020 6622 7265 6164 5f70          f"read_p
+00008ed0: 616e 6461 7328 2920 6578 7065 6374 7320  andas() expects 
+00008ee0: 6120 7061 6e64 6173 2e44 6174 6146 7261  a pandas.DataFra
+00008ef0: 6d65 2c20 6275 7420 676f 7420 6120 7b74  me, but got a {t
+00008f00: 7970 6528 7061 6e64 6173 5f64 6174 6166  ype(pandas_dataf
+00008f10: 7261 6d65 297d 220a 2020 2020 2020 2020  rame)}".        
+00008f20: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
+00008f30: 7265 6164 5f70 616e 6461 7328 0a20 2020  read_pandas(.   
+00008f40: 2020 2020 2073 656c 662c 2070 616e 6461       self, panda
+00008f50: 735f 6461 7461 6672 616d 653a 2070 616e  s_dataframe: pan
+00008f60: 6461 732e 4461 7461 4672 616d 652c 2061  das.DataFrame, a
+00008f70: 7069 5f6e 616d 653a 2073 7472 0a20 2020  pi_name: str.   
+00008f80: 2029 202d 3e20 6461 7461 6672 616d 652e   ) -> dataframe.
+00008f90: 4461 7461 4672 616d 653a 0a20 2020 2020  DataFrame:.     
+00008fa0: 2020 2069 6d70 6f72 7420 6269 6766 7261     import bigfra
+00008fb0: 6d65 732e 6461 7461 6672 616d 6520 6173  mes.dataframe as
+00008fc0: 2064 6174 6166 7261 6d65 0a0a 2020 2020   dataframe..    
+00008fd0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00008fe0: 6528 7061 6e64 6173 5f64 6174 6166 7261  e(pandas_datafra
+00008ff0: 6d65 2c20 6461 7461 6672 616d 652e 4461  me, dataframe.Da
+00009000: 7461 4672 616d 6529 3a0a 2020 2020 2020  taFrame):.      
+00009010: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00009020: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00009030: 2020 2020 2020 2020 2272 6561 645f 7061          "read_pa
+00009040: 6e64 6173 2829 2065 7870 6563 7473 2061  ndas() expects a
+00009050: 2070 616e 6461 732e 4461 7461 4672 616d   pandas.DataFram
+00009060: 652c 2062 7574 2067 6f74 2061 2022 0a20  e, but got a ". 
+00009070: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00009080: 6269 6766 7261 6d65 732e 7061 6e64 6173  bigframes.pandas
+00009090: 2e44 6174 6146 7261 6d65 2e22 0a20 2020  .DataFrame.".   
+000090a0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+000090b0: 2020 2020 696e 6c69 6e65 5f64 6620 3d20      inline_df = 
+000090c0: 7365 6c66 2e5f 7265 6164 5f70 616e 6461  self._read_panda
+000090d0: 735f 696e 6c69 6e65 2870 616e 6461 735f  s_inline(pandas_
+000090e0: 6461 7461 6672 616d 6529 0a20 2020 2020  dataframe).     
+000090f0: 2020 2069 6620 696e 6c69 6e65 5f64 6620     if inline_df 
+00009100: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00009110: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00009120: 696e 6c69 6e65 5f64 660a 2020 2020 2020  inline_df.      
+00009130: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00009140: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00009150: 7265 6164 5f70 616e 6461 735f 6c6f 6164  read_pandas_load
+00009160: 5f6a 6f62 2870 616e 6461 735f 6461 7461  _job(pandas_data
+00009170: 6672 616d 652c 2061 7069 5f6e 616d 6529  frame, api_name)
+00009180: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00009190: 7061 2e41 7272 6f77 496e 7661 6c69 6420  pa.ArrowInvalid 
+000091a0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+000091b0: 2020 7261 6973 6520 7061 2e41 7272 6f77    raise pa.Arrow
+000091c0: 496e 7661 6c69 6428 0a20 2020 2020 2020  Invalid(.       
+000091d0: 2020 2020 2020 2020 2066 2243 6f75 6c64           f"Could
+000091e0: 206e 6f74 2063 6f6e 7665 7274 2077 6974   not convert wit
+000091f0: 6820 6120 4269 6751 7565 7279 2074 7970  h a BigQuery typ
+00009200: 653a 2060 7b65 7d60 2e20 220a 2020 2020  e: `{e}`. ".    
+00009210: 2020 2020 2020 2020 2920 6672 6f6d 2065          ) from e
+00009220: 0a0a 2020 2020 6465 6620 5f72 6561 645f  ..    def _read_
+00009230: 7061 6e64 6173 5f69 6e6c 696e 6528 0a20  pandas_inline(. 
+00009240: 2020 2020 2020 2073 656c 662c 2070 616e         self, pan
+00009250: 6461 735f 6461 7461 6672 616d 653a 2070  das_dataframe: p
+00009260: 616e 6461 732e 4461 7461 4672 616d 650a  andas.DataFrame.
+00009270: 2020 2020 2920 2d3e 204f 7074 696f 6e61      ) -> Optiona
+00009280: 6c5b 6461 7461 6672 616d 652e 4461 7461  l[dataframe.Data
+00009290: 4672 616d 655d 3a0a 2020 2020 2020 2020  Frame]:.        
+000092a0: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
+000092b0: 2e64 6174 6166 7261 6d65 2061 7320 6461  .dataframe as da
+000092c0: 7461 6672 616d 650a 0a20 2020 2020 2020  taframe..       
+000092d0: 2069 6620 7061 6e64 6173 5f64 6174 6166   if pandas_dataf
+000092e0: 7261 6d65 2e6d 656d 6f72 795f 7573 6167  rame.memory_usag
+000092f0: 6528 6465 6570 3d54 7275 6529 2e73 756d  e(deep=True).sum
+00009300: 2829 203e 204d 4158 5f49 4e4c 494e 455f  () > MAX_INLINE_
+00009310: 4446 5f42 5954 4553 3a0a 2020 2020 2020  DF_BYTES:.      
+00009320: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00009330: 650a 0a20 2020 2020 2020 2074 7279 3a0a  e..        try:.
+00009340: 2020 2020 2020 2020 2020 2020 696e 6c69              inli
+00009350: 6e65 5f64 6620 3d20 6461 7461 6672 616d  ne_df = datafram
+00009360: 652e 4461 7461 4672 616d 6528 0a20 2020  e.DataFrame(.   
+00009370: 2020 2020 2020 2020 2020 2020 2062 6c6f               blo
+00009380: 636b 732e 426c 6f63 6b2e 6672 6f6d 5f6c  cks.Block.from_l
+00009390: 6f63 616c 2870 616e 6461 735f 6461 7461  ocal(pandas_data
+000093a0: 6672 616d 652c 2073 656c 6629 0a20 2020  frame, self).   
+000093b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000093c0: 2020 2065 7863 6570 7420 7061 2e41 7272     except pa.Arr
+000093d0: 6f77 496e 7661 6c69 6420 6173 2065 3a0a  owInvalid as e:.
+000093e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000093f0: 6520 7061 2e41 7272 6f77 496e 7661 6c69  e pa.ArrowInvali
+00009400: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
+00009410: 2020 2066 2243 6f75 6c64 206e 6f74 2063     f"Could not c
+00009420: 6f6e 7665 7274 2077 6974 6820 6120 4269  onvert with a Bi
+00009430: 6751 7565 7279 2074 7970 653a 2060 7b65  gQuery type: `{e
+00009440: 7d60 2e20 220a 2020 2020 2020 2020 2020  }`. ".          
+00009450: 2020 2920 6672 6f6d 2065 0a20 2020 2020    ) from e.     
+00009460: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
+00009470: 7272 6f72 3a20 2023 2054 6872 6f77 6e20  rror:  # Thrown 
+00009480: 6279 2069 6269 7320 666f 7220 736f 6d65  by ibis for some
+00009490: 2075 6e68 616e 646c 6564 2074 7970 6573   unhandled types
+000094a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000094b0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+000094c0: 2065 7863 6570 7420 7061 2e41 7272 6f77   except pa.Arrow
+000094d0: 5479 7065 4572 726f 723a 2020 2320 5468  TypeError:  # Th
+000094e0: 726f 776e 2062 7920 6172 726f 7720 666f  rown by arrow fo
+000094f0: 7220 7479 7065 7320 7769 7468 6f75 7420  r types without 
+00009500: 6d61 7070 696e 6720 2867 656f 292e 0a20  mapping (geo).. 
+00009510: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00009520: 6e20 4e6f 6e65 0a0a 2020 2020 2020 2020  n None..        
+00009530: 696e 6c69 6e65 5f74 7970 6573 203d 2069  inline_types = i
+00009540: 6e6c 696e 655f 6466 2e5f 626c 6f63 6b2e  nline_df._block.
+00009550: 6578 7072 2e73 6368 656d 612e 6474 7970  expr.schema.dtyp
+00009560: 6573 0a20 2020 2020 2020 2023 2049 6269  es.        # Ibi
+00009570: 7320 6861 7320 7072 6f62 6c65 6d73 2065  s has problems e
+00009580: 7363 6170 696e 6720 6279 7465 7320 6c69  scaping bytes li
+00009590: 7465 7261 6c73 2c20 7768 6963 6820 7769  terals, which wi
+000095a0: 6c6c 2063 6175 7365 2073 796e 7461 7820  ll cause syntax 
+000095b0: 6572 726f 7273 2073 6572 7665 722d 7369  errors server-si
+000095c0: 6465 2e0a 2020 2020 2020 2020 6966 2061  de..        if a
+000095d0: 6c6c 2864 7479 7065 2069 6e20 494e 4c49  ll(dtype in INLI
+000095e0: 4e41 424c 455f 4454 5950 4553 2066 6f72  NABLE_DTYPES for
+000095f0: 2064 7479 7065 2069 6e20 696e 6c69 6e65   dtype in inline
+00009600: 5f74 7970 6573 293a 0a20 2020 2020 2020  _types):.       
+00009610: 2020 2020 2072 6574 7572 6e20 696e 6c69       return inli
+00009620: 6e65 5f64 660a 2020 2020 2020 2020 7265  ne_df.        re
+00009630: 7475 726e 204e 6f6e 650a 0a20 2020 2064  turn None..    d
+00009640: 6566 205f 7265 6164 5f70 616e 6461 735f  ef _read_pandas_
+00009650: 6c6f 6164 5f6a 6f62 280a 2020 2020 2020  load_job(.      
+00009660: 2020 7365 6c66 2c20 7061 6e64 6173 5f64    self, pandas_d
+00009670: 6174 6166 7261 6d65 3a20 7061 6e64 6173  ataframe: pandas
+00009680: 2e44 6174 6146 7261 6d65 2c20 6170 695f  .DataFrame, api_
+00009690: 6e61 6d65 3a20 7374 720a 2020 2020 2920  name: str.    ) 
+000096a0: 2d3e 2064 6174 6166 7261 6d65 2e44 6174  -> dataframe.Dat
+000096b0: 6146 7261 6d65 3a0a 2020 2020 2020 2020  aFrame:.        
+000096c0: 696d 706f 7274 2062 6967 6672 616d 6573  import bigframes
+000096d0: 2e64 6174 6166 7261 6d65 2061 7320 6461  .dataframe as da
+000096e0: 7461 6672 616d 650a 0a20 2020 2020 2020  taframe..       
+000096f0: 2063 6f6c 5f69 6e64 6578 203d 2070 616e   col_index = pan
+00009700: 6461 735f 6461 7461 6672 616d 652e 636f  das_dataframe.co
+00009710: 6c75 6d6e 732e 636f 7079 2829 0a20 2020  lumns.copy().   
+00009720: 2020 2020 2063 6f6c 5f6c 6162 656c 732c       col_labels,
+00009730: 2069 6478 5f6c 6162 656c 7320 3d20 280a   idx_labels = (.
+00009740: 2020 2020 2020 2020 2020 2020 636f 6c5f              col_
+00009750: 696e 6465 782e 746f 5f6c 6973 7428 292c  index.to_list(),
+00009760: 0a20 2020 2020 2020 2020 2020 2070 616e  .            pan
+00009770: 6461 735f 6461 7461 6672 616d 652e 696e  das_dataframe.in
+00009780: 6465 782e 6e61 6d65 732c 0a20 2020 2020  dex.names,.     
+00009790: 2020 2029 0a20 2020 2020 2020 206e 6577     ).        new
+000097a0: 5f63 6f6c 5f69 6473 2c20 6e65 775f 6964  _col_ids, new_id
+000097b0: 785f 6964 7320 3d20 7574 696c 732e 6765  x_ids = utils.ge
+000097c0: 745f 7374 616e 6461 7264 697a 6564 5f69  t_standardized_i
+000097d0: 6473 280a 2020 2020 2020 2020 2020 2020  ds(.            
+000097e0: 636f 6c5f 6c61 6265 6c73 2c0a 2020 2020  col_labels,.    
+000097f0: 2020 2020 2020 2020 6964 785f 6c61 6265          idx_labe
+00009800: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
+00009810: 2320 4c6f 6164 696e 6720 7061 7271 7565  # Loading parque
+00009820: 7420 6669 6c65 7320 696e 746f 2042 6967  t files into Big
+00009830: 5175 6572 7920 7769 7468 2073 7065 6369  Query with speci
+00009840: 616c 2063 6f6c 756d 6e20 6e61 6d65 730a  al column names.
+00009850: 2020 2020 2020 2020 2020 2020 2320 6973              # is
+00009860: 206f 6e6c 7920 7375 7070 6f72 7465 6420   only supported 
+00009870: 756e 6465 7220 616e 2061 6c6c 6f77 6c69  under an allowli
+00009880: 7374 2e0a 2020 2020 2020 2020 2020 2020  st..            
+00009890: 7374 7269 6374 3d54 7275 652c 0a20 2020  strict=True,.   
+000098a0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+000098b0: 2320 4164 6420 6f72 6465 7220 636f 6c75  # Add order colu
+000098c0: 6d6e 2074 6f20 7061 6e64 6173 2044 6174  mn to pandas Dat
+000098d0: 6146 7261 6d65 2074 6f20 7072 6573 6572  aFrame to preser
+000098e0: 7665 206f 7264 6572 2069 6e20 4269 6751  ve order in BigQ
+000098f0: 7565 7279 0a20 2020 2020 2020 206f 7264  uery.        ord
+00009900: 6572 696e 675f 636f 6c20 3d20 2272 6f77  ering_col = "row
+00009910: 6964 220a 2020 2020 2020 2020 636f 6c75  id".        colu
+00009920: 6d6e 7320 3d20 6672 6f7a 656e 7365 7428  mns = frozenset(
+00009930: 636f 6c5f 6c61 6265 6c73 202b 2069 6478  col_labels + idx
+00009940: 5f6c 6162 656c 7329 0a20 2020 2020 2020  _labels).       
+00009950: 2073 7566 6669 7820 3d20 320a 2020 2020   suffix = 2.    
+00009960: 2020 2020 7768 696c 6520 6f72 6465 7269      while orderi
+00009970: 6e67 5f63 6f6c 2069 6e20 636f 6c75 6d6e  ng_col in column
+00009980: 733a 0a20 2020 2020 2020 2020 2020 206f  s:.            o
+00009990: 7264 6572 696e 675f 636f 6c20 3d20 6622  rdering_col = f"
+000099a0: 726f 7769 645f 7b73 7566 6669 787d 220a  rowid_{suffix}".
+000099b0: 2020 2020 2020 2020 2020 2020 7375 6666              suff
+000099c0: 6978 202b 3d20 310a 0a20 2020 2020 2020  ix += 1..       
+000099d0: 2070 616e 6461 735f 6461 7461 6672 616d   pandas_datafram
+000099e0: 655f 636f 7079 203d 2070 616e 6461 735f  e_copy = pandas_
+000099f0: 6461 7461 6672 616d 652e 636f 7079 2829  dataframe.copy()
+00009a00: 0a20 2020 2020 2020 2070 616e 6461 735f  .        pandas_
+00009a10: 6461 7461 6672 616d 655f 636f 7079 2e69  dataframe_copy.i
+00009a20: 6e64 6578 2e6e 616d 6573 203d 206e 6577  ndex.names = new
+00009a30: 5f69 6478 5f69 6473 0a20 2020 2020 2020  _idx_ids.       
+00009a40: 2070 616e 6461 735f 6461 7461 6672 616d   pandas_datafram
+00009a50: 655f 636f 7079 2e63 6f6c 756d 6e73 203d  e_copy.columns =
+00009a60: 2070 616e 6461 732e 496e 6465 7828 6e65   pandas.Index(ne
+00009a70: 775f 636f 6c5f 6964 7329 0a20 2020 2020  w_col_ids).     
+00009a80: 2020 2070 616e 6461 735f 6461 7461 6672     pandas_datafr
+00009a90: 616d 655f 636f 7079 5b6f 7264 6572 696e  ame_copy[orderin
+00009aa0: 675f 636f 6c5d 203d 206e 702e 6172 616e  g_col] = np.aran
+00009ab0: 6765 2870 616e 6461 735f 6461 7461 6672  ge(pandas_datafr
+00009ac0: 616d 655f 636f 7079 2e73 6861 7065 5b30  ame_copy.shape[0
+00009ad0: 5d29 0a0a 2020 2020 2020 2020 6a6f 625f  ])..        job_
+00009ae0: 636f 6e66 6967 203d 2073 656c 662e 5f70  config = self._p
+00009af0: 7265 7061 7265 5f6c 6f61 645f 6a6f 625f  repare_load_job_
+00009b00: 636f 6e66 6967 2829 0a0a 2020 2020 2020  config()..      
+00009b10: 2020 2320 5370 6563 6966 7920 7468 6520    # Specify the 
+00009b20: 6461 7465 7469 6d65 2064 7479 7065 732c  datetime dtypes,
+00009b30: 2077 6869 6368 2069 7320 6175 746f 2d64   which is auto-d
+00009b40: 6574 6563 7465 6420 6173 2074 696d 6573  etected as times
+00009b50: 7461 6d70 2074 7970 6573 2e0a 2020 2020  tamp types..    
+00009b60: 2020 2020 7363 6865 6d61 3a20 6c69 7374      schema: list
+00009b70: 5b62 6967 7175 6572 792e 5363 6865 6d61  [bigquery.Schema
+00009b80: 4669 656c 645d 203d 205b 5d0a 2020 2020  Field] = [].    
+00009b90: 2020 2020 666f 7220 636f 6c75 6d6e 2c20      for column, 
+00009ba0: 6474 7970 6520 696e 207a 6970 286e 6577  dtype in zip(new
+00009bb0: 5f63 6f6c 5f69 6473 2c20 7061 6e64 6173  _col_ids, pandas
+00009bc0: 5f64 6174 6166 7261 6d65 2e64 7479 7065  _dataframe.dtype
+00009bd0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00009be0: 6966 2064 7479 7065 203d 3d20 2274 696d  if dtype == "tim
+00009bf0: 6573 7461 6d70 5b75 735d 5b70 7961 7272  estamp[us][pyarr
+00009c00: 6f77 5d22 3a0a 2020 2020 2020 2020 2020  ow]":.          
+00009c10: 2020 2020 2020 7363 6865 6d61 2e61 7070        schema.app
+00009c20: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+00009c30: 2020 2020 2020 2020 2062 6967 7175 6572           bigquer
+00009c40: 792e 5363 6865 6d61 4669 656c 6428 636f  y.SchemaField(co
+00009c50: 6c75 6d6e 2c20 6269 6771 7565 7279 2e65  lumn, bigquery.e
+00009c60: 6e75 6d73 2e53 716c 5479 7065 4e61 6d65  nums.SqlTypeName
+00009c70: 732e 4441 5445 5449 4d45 290a 2020 2020  s.DATETIME).    
+00009c80: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00009c90: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
+00009ca0: 2e73 6368 656d 6120 3d20 7363 6865 6d61  .schema = schema
+00009cb0: 0a0a 2020 2020 2020 2020 2320 436c 7573  ..        # Clus
+00009cc0: 7465 7269 6e67 2070 726f 6261 626c 7920  tering probably 
+00009cd0: 6e6f 7420 6e65 6564 6564 2061 6e79 7761  not needed anywa
+00009ce0: 7973 2061 7320 7061 6e64 6173 2074 6162  ys as pandas tab
+00009cf0: 6c65 7320 6172 6520 736d 616c 6c0a 2020  les are small.  
+00009d00: 2020 2020 2020 636c 7573 7465 725f 636f        cluster_co
+00009d10: 6c73 203d 205b 6f72 6465 7269 6e67 5f63  ls = [ordering_c
+00009d20: 6f6c 5d0a 2020 2020 2020 2020 6a6f 625f  ol].        job_
+00009d30: 636f 6e66 6967 2e63 6c75 7374 6572 696e  config.clusterin
+00009d40: 675f 6669 656c 6473 203d 2063 6c75 7374  g_fields = clust
+00009d50: 6572 5f63 6f6c 730a 0a20 2020 2020 2020  er_cols..       
+00009d60: 206a 6f62 5f63 6f6e 6669 672e 6c61 6265   job_config.labe
+00009d70: 6c73 203d 207b 2262 6967 6672 616d 6573  ls = {"bigframes
+00009d80: 2d61 7069 223a 2061 7069 5f6e 616d 657d  -api": api_name}
+00009d90: 0a0a 2020 2020 2020 2020 6c6f 6164 5f74  ..        load_t
+00009da0: 6162 6c65 5f64 6573 7469 6e61 7469 6f6e  able_destination
+00009db0: 203d 2073 656c 662e 5f72 616e 646f 6d5f   = self._random_
+00009dc0: 7461 626c 6528 290a 2020 2020 2020 2020  table().        
+00009dd0: 6c6f 6164 5f6a 6f62 203d 2073 656c 662e  load_job = self.
+00009de0: 6271 636c 6965 6e74 2e6c 6f61 645f 7461  bqclient.load_ta
+00009df0: 626c 655f 6672 6f6d 5f64 6174 6166 7261  ble_from_datafra
+00009e00: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
+00009e10: 7061 6e64 6173 5f64 6174 6166 7261 6d65  pandas_dataframe
+00009e20: 5f63 6f70 792c 0a20 2020 2020 2020 2020  _copy,.         
+00009e30: 2020 206c 6f61 645f 7461 626c 655f 6465     load_table_de
+00009e40: 7374 696e 6174 696f 6e2c 0a20 2020 2020  stination,.     
+00009e50: 2020 2020 2020 206a 6f62 5f63 6f6e 6669         job_confi
+00009e60: 673d 6a6f 625f 636f 6e66 6967 2c0a 2020  g=job_config,.  
+00009e70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00009e80: 7365 6c66 2e5f 7374 6172 745f 6765 6e65  self._start_gene
+00009e90: 7269 635f 6a6f 6228 6c6f 6164 5f6a 6f62  ric_job(load_job
+00009ea0: 290a 0a20 2020 2020 2020 206f 7264 6572  )..        order
+00009eb0: 696e 6720 3d20 6f72 6465 722e 4578 7072  ing = order.Expr
+00009ec0: 6573 7369 6f6e 4f72 6465 7269 6e67 280a  essionOrdering(.
+00009ed0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+00009ee0: 7269 6e67 5f76 616c 7565 5f63 6f6c 756d  ring_value_colum
+00009ef0: 6e73 3d74 7570 6c65 285b 6f72 6465 722e  ns=tuple([order.
+00009f00: 6173 6365 6e64 696e 675f 6f76 6572 286f  ascending_over(o
+00009f10: 7264 6572 696e 675f 636f 6c29 5d29 2c0a  rdering_col)]),.
+00009f20: 2020 2020 2020 2020 2020 2020 746f 7461              tota
+00009f30: 6c5f 6f72 6465 7269 6e67 5f63 6f6c 756d  l_ordering_colum
+00009f40: 6e73 3d66 726f 7a65 6e73 6574 285b 6f72  ns=frozenset([or
+00009f50: 6465 7269 6e67 5f63 6f6c 5d29 2c0a 2020  dering_col]),.  
+00009f60: 2020 2020 2020 2020 2020 696e 7465 6765            intege
+00009f70: 725f 656e 636f 6469 6e67 3d49 6e74 6567  r_encoding=Integ
+00009f80: 6572 456e 636f 6469 6e67 2854 7275 652c  erEncoding(True,
+00009f90: 2069 735f 7365 7175 656e 7469 616c 3d54   is_sequential=T
+00009fa0: 7275 6529 2c0a 2020 2020 2020 2020 290a  rue),.        ).
+00009fb0: 2020 2020 2020 2020 7461 626c 655f 6578          table_ex
+00009fc0: 7072 6573 7369 6f6e 203d 2073 656c 662e  pression = self.
+00009fd0: 6962 6973 5f63 6c69 656e 742e 7461 626c  ibis_client.tabl
+00009fe0: 6528 2020 2320 7479 7065 3a20 6967 6e6f  e(  # type: igno
+00009ff0: 7265 0a20 2020 2020 2020 2020 2020 206c  re.            l
+0000a000: 6f61 645f 7461 626c 655f 6465 7374 696e  oad_table_destin
+0000a010: 6174 696f 6e2e 7461 626c 655f 6964 2c0a  ation.table_id,.
+0000a020: 2020 2020 2020 2020 2020 2020 7363 6865              sche
+0000a030: 6d61 3d6c 6f61 645f 7461 626c 655f 6465  ma=load_table_de
+0000a040: 7374 696e 6174 696f 6e2e 6461 7461 7365  stination.datase
+0000a050: 745f 6964 2c0a 2020 2020 2020 2020 2020  t_id,.          
+0000a060: 2020 6461 7461 6261 7365 3d6c 6f61 645f    database=load_
+0000a070: 7461 626c 655f 6465 7374 696e 6174 696f  table_destinatio
+0000a080: 6e2e 7072 6f6a 6563 742c 0a20 2020 2020  n.project,.     
+0000a090: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+0000a0a0: 622f 3239 3735 3930 3137 3820 506f 7465  b/297590178 Pote
+0000a0b0: 6e74 6961 6c6c 7920 6120 6275 6720 696e  ntially a bug in
+0000a0c0: 2062 7163 6c69 656e 742e 6c6f 6164 5f74   bqclient.load_t
+0000a0d0: 6162 6c65 5f66 726f 6d5f 6461 7461 6672  able_from_datafr
+0000a0e0: 616d 6528 292c 2074 6861 7420 6f6e 6c79  ame(), that only
+0000a0f0: 2077 6865 6e20 7468 6520 4446 2069 7320   when the DF is 
+0000a100: 656d 7074 792c 2074 6865 2069 6e64 6578  empty, the index
+0000a110: 2063 6f6c 756d 6e73 2064 6973 6170 7065   columns disappe
+0000a120: 6172 2069 6e20 7461 626c 655f 6578 7072  ar in table_expr
+0000a130: 6573 7369 6f6e 2e0a 2020 2020 2020 2020  ession..        
+0000a140: 6966 2061 6e79 280a 2020 2020 2020 2020  if any(.        
+0000a150: 2020 2020 5b6e 6577 5f69 6478 5f69 6420      [new_idx_id 
+0000a160: 6e6f 7420 696e 2074 6162 6c65 5f65 7870  not in table_exp
+0000a170: 7265 7373 696f 6e2e 636f 6c75 6d6e 7320  ression.columns 
+0000a180: 666f 7220 6e65 775f 6964 785f 6964 2069  for new_idx_id i
+0000a190: 6e20 6e65 775f 6964 785f 6964 735d 0a20  n new_idx_ids]. 
+0000a1a0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+0000a1b0: 2020 2020 2020 6e65 775f 6964 785f 6964        new_idx_id
+0000a1c0: 732c 2069 6478 5f6c 6162 656c 7320 3d20  s, idx_labels = 
+0000a1d0: 5b5d 2c20 5b5d 0a0a 2020 2020 2020 2020  [], []..        
+0000a1e0: 636f 6c75 6d6e 5f76 616c 7565 7320 3d20  column_values = 
+0000a1f0: 5b0a 2020 2020 2020 2020 2020 2020 7461  [.            ta
+0000a200: 626c 655f 6578 7072 6573 7369 6f6e 5b63  ble_expression[c
+0000a210: 6f6c 5d0a 2020 2020 2020 2020 2020 2020  ol].            
+0000a220: 666f 7220 636f 6c20 696e 2074 6162 6c65  for col in table
+0000a230: 5f65 7870 7265 7373 696f 6e2e 636f 6c75  _expression.colu
+0000a240: 6d6e 730a 2020 2020 2020 2020 2020 2020  mns.            
+0000a250: 6966 2063 6f6c 2021 3d20 6f72 6465 7269  if col != orderi
+0000a260: 6e67 5f63 6f6c 0a20 2020 2020 2020 205d  ng_col.        ]
+0000a270: 0a20 2020 2020 2020 2061 7272 6179 5f76  .        array_v
+0000a280: 616c 7565 203d 2063 6f72 652e 4172 7261  alue = core.Arra
+0000a290: 7956 616c 7565 2e66 726f 6d5f 6962 6973  yValue.from_ibis
+0000a2a0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0000a2b0: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+0000a2c0: 7461 626c 655f 6578 7072 6573 7369 6f6e  table_expression
+0000a2d0: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+0000a2e0: 6c75 6d6e 733d 636f 6c75 6d6e 5f76 616c  lumns=column_val
+0000a2f0: 7565 732c 0a20 2020 2020 2020 2020 2020  ues,.           
+0000a300: 2068 6964 6465 6e5f 6f72 6465 7269 6e67   hidden_ordering
+0000a310: 5f63 6f6c 756d 6e73 3d5b 7461 626c 655f  _columns=[table_
+0000a320: 6578 7072 6573 7369 6f6e 5b6f 7264 6572  expression[order
+0000a330: 696e 675f 636f 6c5d 5d2c 0a20 2020 2020  ing_col]],.     
+0000a340: 2020 2020 2020 206f 7264 6572 696e 673d         ordering=
+0000a350: 6f72 6465 7269 6e67 2c0a 2020 2020 2020  ordering,.      
+0000a360: 2020 290a 0a20 2020 2020 2020 2062 6c6f    )..        blo
+0000a370: 636b 203d 2062 6c6f 636b 732e 426c 6f63  ck = blocks.Bloc
+0000a380: 6b28 0a20 2020 2020 2020 2020 2020 2061  k(.            a
+0000a390: 7272 6179 5f76 616c 7565 2c0a 2020 2020  rray_value,.    
+0000a3a0: 2020 2020 2020 2020 696e 6465 785f 636f          index_co
+0000a3b0: 6c75 6d6e 733d 6e65 775f 6964 785f 6964  lumns=new_idx_id
+0000a3c0: 732c 0a20 2020 2020 2020 2020 2020 2063  s,.            c
+0000a3d0: 6f6c 756d 6e5f 6c61 6265 6c73 3d63 6f6c  olumn_labels=col
+0000a3e0: 5f69 6e64 6578 2c0a 2020 2020 2020 2020  _index,.        
+0000a3f0: 2020 2020 696e 6465 785f 6c61 6265 6c73      index_labels
+0000a400: 3d69 6478 5f6c 6162 656c 732c 0a20 2020  =idx_labels,.   
+0000a410: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+0000a420: 6574 7572 6e20 6461 7461 6672 616d 652e  eturn dataframe.
+0000a430: 4461 7461 4672 616d 6528 626c 6f63 6b29  DataFrame(block)
+0000a440: 0a0a 2020 2020 6465 6620 7265 6164 5f63  ..    def read_c
+0000a450: 7376 280a 2020 2020 2020 2020 7365 6c66  sv(.        self
+0000a460: 2c0a 2020 2020 2020 2020 6669 6c65 7061  ,.        filepa
+0000a470: 7468 5f6f 725f 6275 6666 6572 3a20 7374  th_or_buffer: st
+0000a480: 7220 7c20 494f 5b22 6279 7465 7322 5d2c  r | IO["bytes"],
+0000a490: 0a20 2020 2020 2020 202a 2c0a 2020 2020  .        *,.    
+0000a4a0: 2020 2020 7365 703a 204f 7074 696f 6e61      sep: Optiona
+0000a4b0: 6c5b 7374 725d 203d 2022 2c22 2c0a 2020  l[str] = ",",.  
+0000a4c0: 2020 2020 2020 6865 6164 6572 3a20 4f70        header: Op
+0000a4d0: 7469 6f6e 616c 5b69 6e74 5d20 3d20 302c  tional[int] = 0,
+0000a4e0: 0a20 2020 2020 2020 206e 616d 6573 3a20  .        names: 
+0000a4f0: 4f70 7469 6f6e 616c 5b0a 2020 2020 2020  Optional[.      
+0000a500: 2020 2020 2020 556e 696f 6e5b 4d75 7461        Union[Muta
+0000a510: 626c 6553 6571 7565 6e63 655b 416e 795d  bleSequence[Any]
+0000a520: 2c20 6e70 2e6e 6461 7272 6179 5b41 6e79  , np.ndarray[Any
+0000a530: 2c20 416e 795d 2c20 5475 706c 655b 416e  , Any], Tuple[An
+0000a540: 792c 202e 2e2e 5d2c 2072 616e 6765 5d0a  y, ...], range].
+0000a550: 2020 2020 2020 2020 5d20 3d20 4e6f 6e65          ] = None
+0000a560: 2c0a 2020 2020 2020 2020 696e 6465 785f  ,.        index_
+0000a570: 636f 6c3a 204f 7074 696f 6e61 6c5b 0a20  col: Optional[. 
+0000a580: 2020 2020 2020 2020 2020 2055 6e69 6f6e             Union
+0000a590: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+0000a5a0: 2020 696e 742c 0a20 2020 2020 2020 2020    int,.         
+0000a5b0: 2020 2020 2020 2073 7472 2c0a 2020 2020         str,.    
+0000a5c0: 2020 2020 2020 2020 2020 2020 5365 7175              Sequ
+0000a5d0: 656e 6365 5b55 6e69 6f6e 5b73 7472 2c20  ence[Union[str, 
+0000a5e0: 696e 745d 5d2c 0a20 2020 2020 2020 2020  int]],.         
+0000a5f0: 2020 2020 2020 2062 6967 6672 616d 6573         bigframes
+0000a600: 2e65 6e75 6d73 2e44 6566 6175 6c74 496e  .enums.DefaultIn
+0000a610: 6465 784b 696e 642c 0a20 2020 2020 2020  dexKind,.       
+0000a620: 2020 2020 2020 2020 204c 6974 6572 616c           Literal
+0000a630: 5b46 616c 7365 5d2c 0a20 2020 2020 2020  [False],.       
+0000a640: 2020 2020 205d 0a20 2020 2020 2020 205d       ].        ]
+0000a650: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0000a660: 2075 7365 636f 6c73 3a20 4f70 7469 6f6e   usecols: Option
+0000a670: 616c 5b0a 2020 2020 2020 2020 2020 2020  al[.            
+0000a680: 556e 696f 6e5b 0a20 2020 2020 2020 2020  Union[.         
+0000a690: 2020 2020 2020 204d 7574 6162 6c65 5365         MutableSe
+0000a6a0: 7175 656e 6365 5b73 7472 5d2c 0a20 2020  quence[str],.   
+0000a6b0: 2020 2020 2020 2020 2020 2020 2054 7570               Tup
+0000a6c0: 6c65 5b73 7472 2c20 2e2e 2e5d 2c0a 2020  le[str, ...],.  
+0000a6d0: 2020 2020 2020 2020 2020 2020 2020 5365                Se
+0000a6e0: 7175 656e 6365 5b69 6e74 5d2c 0a20 2020  quence[int],.   
+0000a6f0: 2020 2020 2020 2020 2020 2020 2070 616e               pan
+0000a700: 6461 732e 5365 7269 6573 2c0a 2020 2020  das.Series,.    
+0000a710: 2020 2020 2020 2020 2020 2020 7061 6e64              pand
+0000a720: 6173 2e49 6e64 6578 2c0a 2020 2020 2020  as.Index,.      
+0000a730: 2020 2020 2020 2020 2020 6e70 2e6e 6461            np.nda
+0000a740: 7272 6179 5b41 6e79 2c20 416e 795d 2c0a  rray[Any, Any],.
+0000a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a760: 4361 6c6c 6162 6c65 5b5b 416e 795d 2c20  Callable[[Any], 
+0000a770: 626f 6f6c 5d2c 0a20 2020 2020 2020 2020  bool],.         
+0000a780: 2020 205d 0a20 2020 2020 2020 205d 203d     ].        ] =
+0000a790: 204e 6f6e 652c 0a20 2020 2020 2020 2064   None,.        d
+0000a7a0: 7479 7065 3a20 4f70 7469 6f6e 616c 5b44  type: Optional[D
+0000a7b0: 6963 745d 203d 204e 6f6e 652c 0a20 2020  ict] = None,.   
+0000a7c0: 2020 2020 2065 6e67 696e 653a 204f 7074       engine: Opt
+0000a7d0: 696f 6e61 6c5b 0a20 2020 2020 2020 2020  ional[.         
+0000a7e0: 2020 204c 6974 6572 616c 5b22 6322 2c20     Literal["c", 
+0000a7f0: 2270 7974 686f 6e22 2c20 2270 7961 7272  "python", "pyarr
+0000a800: 6f77 222c 2022 7079 7468 6f6e 2d66 7766  ow", "python-fwf
+0000a810: 222c 2022 6269 6771 7565 7279 225d 0a20  ", "bigquery"]. 
+0000a820: 2020 2020 2020 205d 203d 204e 6f6e 652c         ] = None,
+0000a830: 0a20 2020 2020 2020 2065 6e63 6f64 696e  .        encodin
+0000a840: 673a 204f 7074 696f 6e61 6c5b 7374 725d  g: Optional[str]
+0000a850: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0000a860: 202a 2a6b 7761 7267 732c 0a20 2020 2029   **kwargs,.    )
+0000a870: 202d 3e20 6461 7461 6672 616d 652e 4461   -> dataframe.Da
+0000a880: 7461 4672 616d 653a 0a20 2020 2020 2020  taFrame:.       
+0000a890: 2074 6162 6c65 203d 2073 656c 662e 5f72   table = self._r
+0000a8a0: 616e 646f 6d5f 7461 626c 6528 290a 0a20  andom_table().. 
+0000a8b0: 2020 2020 2020 2069 6620 656e 6769 6e65         if engine
+0000a8c0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0000a8d0: 2065 6e67 696e 6520 3d3d 2022 6269 6771   engine == "bigq
+0000a8e0: 7565 7279 223a 0a20 2020 2020 2020 2020  uery":.         
+0000a8f0: 2020 2069 6620 616e 7928 7061 7261 6d20     if any(param 
+0000a900: 6973 206e 6f74 204e 6f6e 6520 666f 7220  is not None for 
+0000a910: 7061 7261 6d20 696e 2028 6474 7970 652c  param in (dtype,
+0000a920: 206e 616d 6573 2929 3a0a 2020 2020 2020   names)):.      
+0000a930: 2020 2020 2020 2020 2020 6e6f 745f 7375            not_su
+0000a940: 7070 6f72 7465 6420 3d20 2822 6474 7970  pported = ("dtyp
+0000a950: 6522 2c20 226e 616d 6573 2229 0a20 2020  e", "names").   
+0000a960: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000a970: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
+0000a980: 6445 7272 6f72 280a 2020 2020 2020 2020  dError(.        
+0000a990: 2020 2020 2020 2020 2020 2020 6622 4269              f"Bi
+0000a9a0: 6751 7565 7279 2065 6e67 696e 6520 646f  gQuery engine do
+0000a9b0: 6573 206e 6f74 2073 7570 706f 7274 2074  es not support t
+0000a9c0: 6865 7365 2061 7267 756d 656e 7473 3a20  hese arguments: 
+0000a9d0: 7b6e 6f74 5f73 7570 706f 7274 6564 7d2e  {not_supported}.
+0000a9e0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0000a9f0: 2020 2020 2020 2066 227b 636f 6e73 7461         f"{consta
+0000aa00: 6e74 732e 4645 4544 4241 434b 5f4c 494e  nts.FEEDBACK_LIN
+0000aa10: 4b7d 220a 2020 2020 2020 2020 2020 2020  K}".            
+0000aa20: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+0000aa30: 2020 2023 2054 4f44 4f28 622f 3333 3830     # TODO(b/3380
+0000aa40: 3839 3635 3929 3a20 4c6f 6f6b 7320 6c69  89659): Looks li
+0000aa50: 6b65 2077 6520 6361 6e20 7265 6c61 7820  ke we can relax 
+0000aa60: 7468 6973 2031 2063 6f6c 756d 6e0a 2020  this 1 column.  
+0000aa70: 2020 2020 2020 2020 2020 2320 7265 7374            # rest
+0000aa80: 7269 6374 696f 6e20 6966 2077 6520 6368  riction if we ch
+0000aa90: 6563 6b20 7468 6520 636f 6e74 656e 7473  eck the contents
+0000aaa0: 206f 6620 616e 2069 7465 7261 626c 6520   of an iterable 
+0000aab0: 6172 6520 7374 7269 6e67 730a 2020 2020  are strings.    
+0000aac0: 2020 2020 2020 2020 2320 6e6f 7420 696e          # not in
+0000aad0: 7465 6765 7273 2e0a 2020 2020 2020 2020  tegers..        
+0000aae0: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+0000aaf0: 2020 2020 2020 2020 2023 2045 6d70 7479           # Empty
+0000ab00: 2074 7570 6c65 732c 204e 6f6e 652c 2061   tuples, None, a
+0000ab10: 6e64 2046 616c 7365 2061 7265 2061 6c6c  nd False are all
+0000ab20: 6f77 6564 2061 6e64 2066 616c 7365 792e  owed and falsey.
+0000ab30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ab40: 2069 6e64 6578 5f63 6f6c 0a20 2020 2020   index_col.     
+0000ab50: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
+0000ab60: 6f74 2069 7369 6e73 7461 6e63 6528 696e  ot isinstance(in
+0000ab70: 6465 785f 636f 6c2c 2062 6967 6672 616d  dex_col, bigfram
+0000ab80: 6573 2e65 6e75 6d73 2e44 6566 6175 6c74  es.enums.Default
+0000ab90: 496e 6465 784b 696e 6429 0a20 2020 2020  IndexKind).     
+0000aba0: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
+0000abb0: 6f74 2069 7369 6e73 7461 6e63 6528 696e  ot isinstance(in
+0000abc0: 6465 785f 636f 6c2c 2073 7472 290a 2020  dex_col, str).  
+0000abd0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+0000abe0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000abf0: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
+0000ac00: 6445 7272 6f72 280a 2020 2020 2020 2020  dError(.        
+0000ac10: 2020 2020 2020 2020 2020 2020 2242 6967              "Big
+0000ac20: 5175 6572 7920 656e 6769 6e65 206f 6e6c  Query engine onl
+0000ac30: 7920 7375 7070 6f72 7473 2061 2073 696e  y supports a sin
+0000ac40: 676c 6520 636f 6c75 6d6e 206e 616d 6520  gle column name 
+0000ac50: 666f 7220 6069 6e64 6578 5f63 6f6c 602c  for `index_col`,
+0000ac60: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0000ac70: 2020 2020 2020 2066 2267 6f74 3a20 7b72         f"got: {r
+0000ac80: 6570 7228 696e 6465 785f 636f 6c29 7d2e  epr(index_col)}.
+0000ac90: 207b 636f 6e73 7461 6e74 732e 4645 4544   {constants.FEED
+0000aca0: 4241 434b 5f4c 494e 4b7d 220a 2020 2020  BACK_LINK}".    
+0000acb0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0000acc0: 2020 2020 2020 2020 2020 2023 204e 6f6e             # Non
+0000acd0: 6520 616e 6420 4661 6c73 6520 6361 6e6e  e and False cann
+0000ace0: 6f74 2062 6520 7061 7373 6564 2074 6f20  ot be passed to 
+0000acf0: 7265 6164 5f67 6271 2e0a 2020 2020 2020  read_gbq..      
+0000ad00: 2020 2020 2020 2320 544f 444f 2862 2f33        # TODO(b/3
+0000ad10: 3338 3430 3031 3333 293a 2057 6865 6e20  38400133): When 
+0000ad20: 696e 6465 785f 636f 6c20 6973 204e 6f6e  index_col is Non
+0000ad30: 652c 2077 6520 7368 6f75 6c64 2062 6520  e, we should be 
+0000ad40: 7573 696e 6720 7468 650a 2020 2020 2020  using the.      
+0000ad50: 2020 2020 2020 2320 6669 7273 7420 636f        # first co
+0000ad60: 6c75 6d6e 206f 6620 7468 6520 4353 5620  lumn of the CSV 
+0000ad70: 6173 2074 6865 2069 6e64 6578 2074 6f20  as the index to 
+0000ad80: 6265 2063 6f6d 7061 7469 626c 6520 7769  be compatible wi
+0000ad90: 7468 2074 6865 0a20 2020 2020 2020 2020  th the.         
+0000ada0: 2020 2023 2070 616e 6461 7320 656e 6769     # pandas engi
+0000adb0: 6e65 2e20 4163 636f 7264 696e 6720 746f  ne. According to
+0000adc0: 2074 6865 2070 616e 6461 7320 646f 6373   the pandas docs
+0000add0: 2c20 6f6e 6c79 2022 4661 6c73 6522 0a20  , only "False". 
+0000ade0: 2020 2020 2020 2020 2020 2023 2069 6e64             # ind
+0000adf0: 6963 6174 6573 2061 2064 6566 6175 6c74  icates a default
+0000ae00: 2073 6571 7565 6e74 6961 6c20 696e 6465   sequential inde
+0000ae10: 782e 0a20 2020 2020 2020 2020 2020 2069  x..            i
+0000ae20: 6620 6e6f 7420 696e 6465 785f 636f 6c3a  f not index_col:
+0000ae30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ae40: 2069 6e64 6578 5f63 6f6c 203d 2028 290a   index_col = ().
+0000ae50: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+0000ae60: 6578 5f63 6f6c 203d 2074 7970 696e 672e  ex_col = typing.
+0000ae70: 6361 7374 280a 2020 2020 2020 2020 2020  cast(.          
+0000ae80: 2020 2020 2020 556e 696f 6e5b 0a20 2020        Union[.   
 0000ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aea0: 2020 6622 7b63 6f6e 7374 616e 7473 2e46    f"{constants.F
-0000aeb0: 4545 4442 4143 4b5f 4c49 4e4b 7d22 0a20  EEDBACK_LINK}". 
-0000aec0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000aed0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000aee0: 616e 7928 6172 6720 696e 206b 7761 7267  any(arg in kwarg
-0000aef0: 7320 666f 7220 6172 6720 696e 2028 2263  s for arg in ("c
-0000af00: 6875 6e6b 7369 7a65 222c 2022 6974 6572  hunksize", "iter
-0000af10: 6174 6f72 2229 293a 0a20 2020 2020 2020  ator")):.       
-0000af20: 2020 2020 2020 2020 2072 6169 7365 204e           raise N
-0000af30: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-0000af40: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000af50: 2020 2020 2020 2020 2227 6368 756e 6b73          "'chunks
-0000af60: 697a 6527 2061 6e64 2027 6974 6572 6174  ize' and 'iterat
-0000af70: 6f72 2720 6172 6775 6d65 6e74 7320 6172  or' arguments ar
-0000af80: 6520 6e6f 7420 7375 7070 6f72 7465 642e  e not supported.
-0000af90: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0000afa0: 2020 2020 2020 2066 227b 636f 6e73 7461         f"{consta
-0000afb0: 6e74 732e 4645 4544 4241 434b 5f4c 494e  nts.FEEDBACK_LIN
-0000afc0: 4b7d 220a 2020 2020 2020 2020 2020 2020  K}".            
-0000afd0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-0000afe0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000aff0: 2866 696c 6570 6174 685f 6f72 5f62 7566  (filepath_or_buf
-0000b000: 6665 722c 2073 7472 293a 0a20 2020 2020  fer, str):.     
-0000b010: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b020: 5f63 6865 636b 5f66 696c 655f 7369 7a65  _check_file_size
-0000b030: 2866 696c 6570 6174 685f 6f72 5f62 7566  (filepath_or_buf
-0000b040: 6665 7229 0a20 2020 2020 2020 2020 2020  fer).           
-0000b050: 2070 616e 6461 735f 6466 203d 2070 616e   pandas_df = pan
-0000b060: 6461 732e 7265 6164 5f63 7376 280a 2020  das.read_csv(.  
-0000b070: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000b080: 6c65 7061 7468 5f6f 725f 6275 6666 6572  lepath_or_buffer
-0000b090: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000b0a0: 2020 7365 703d 7365 702c 0a20 2020 2020    sep=sep,.     
-0000b0b0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-0000b0c0: 723d 6865 6164 6572 2c0a 2020 2020 2020  r=header,.      
-0000b0d0: 2020 2020 2020 2020 2020 6e61 6d65 733d            names=
-0000b0e0: 6e61 6d65 732c 0a20 2020 2020 2020 2020  names,.         
-0000b0f0: 2020 2020 2020 2069 6e64 6578 5f63 6f6c         index_col
-0000b100: 3d69 6e64 6578 5f63 6f6c 2c0a 2020 2020  =index_col,.    
-0000b110: 2020 2020 2020 2020 2020 2020 7573 6563              usec
-0000b120: 6f6c 733d 7573 6563 6f6c 732c 2020 2320  ols=usecols,  # 
-0000b130: 7479 7065 3a20 6967 6e6f 7265 0a20 2020  type: ignore.   
-0000b140: 2020 2020 2020 2020 2020 2020 2064 7479               dty
-0000b150: 7065 3d64 7479 7065 2c0a 2020 2020 2020  pe=dtype,.      
-0000b160: 2020 2020 2020 2020 2020 656e 6769 6e65            engine
-0000b170: 3d65 6e67 696e 652c 0a20 2020 2020 2020  =engine,.       
-0000b180: 2020 2020 2020 2020 2065 6e63 6f64 696e           encodin
-0000b190: 673d 656e 636f 6469 6e67 2c0a 2020 2020  g=encoding,.    
-0000b1a0: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
-0000b1b0: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
-0000b1c0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000b1d0: 7265 7475 726e 2073 656c 662e 5f72 6561  return self._rea
-0000b1e0: 645f 7061 6e64 6173 2870 616e 6461 735f  d_pandas(pandas_
-0000b1f0: 6466 2c20 2272 6561 645f 6373 7622 2920  df, "read_csv") 
-0000b200: 2023 2074 7970 653a 2069 676e 6f72 650a   # type: ignore.
-0000b210: 0a20 2020 2064 6566 2072 6561 645f 7069  .    def read_pi
-0000b220: 636b 6c65 280a 2020 2020 2020 2020 7365  ckle(.        se
-0000b230: 6c66 2c0a 2020 2020 2020 2020 6669 6c65  lf,.        file
-0000b240: 7061 7468 5f6f 725f 6275 6666 6572 3a20  path_or_buffer: 
-0000b250: 4669 6c65 5061 7468 207c 2052 6561 6450  FilePath | ReadP
-0000b260: 6963 6b6c 6542 7566 6665 722c 0a20 2020  ickleBuffer,.   
-0000b270: 2020 2020 2063 6f6d 7072 6573 7369 6f6e       compression
-0000b280: 3a20 436f 6d70 7265 7373 696f 6e4f 7074  : CompressionOpt
-0000b290: 696f 6e73 203d 2022 696e 6665 7222 2c0a  ions = "infer",.
-0000b2a0: 2020 2020 2020 2020 7374 6f72 6167 655f          storage_
-0000b2b0: 6f70 7469 6f6e 733a 2053 746f 7261 6765  options: Storage
-0000b2c0: 4f70 7469 6f6e 7320 3d20 4e6f 6e65 2c0a  Options = None,.
-0000b2d0: 2020 2020 293a 0a20 2020 2020 2020 2070      ):.        p
-0000b2e0: 616e 6461 735f 6f62 6a20 3d20 7061 6e64  andas_obj = pand
-0000b2f0: 6173 2e72 6561 645f 7069 636b 6c65 280a  as.read_pickle(.
-0000b300: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000b310: 7061 7468 5f6f 725f 6275 6666 6572 2c0a  path_or_buffer,.
-0000b320: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-0000b330: 7265 7373 696f 6e3d 636f 6d70 7265 7373  ression=compress
-0000b340: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-0000b350: 2073 746f 7261 6765 5f6f 7074 696f 6e73   storage_options
-0000b360: 3d73 746f 7261 6765 5f6f 7074 696f 6e73  =storage_options
-0000b370: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000b380: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0000b390: 6365 2870 616e 6461 735f 6f62 6a2c 2070  ce(pandas_obj, p
-0000b3a0: 616e 6461 732e 5365 7269 6573 293a 0a20  andas.Series):. 
-0000b3b0: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
-0000b3c0: 6e64 6173 5f6f 626a 2e6e 616d 6520 6973  ndas_obj.name is
-0000b3d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000b3e0: 2020 2020 2020 2070 616e 6461 735f 6f62         pandas_ob
-0000b3f0: 6a2e 6e61 6d65 203d 2022 3022 0a20 2020  j.name = "0".   
-0000b400: 2020 2020 2020 2020 2062 6967 6672 616d           bigfram
-0000b410: 6573 5f64 6620 3d20 7365 6c66 2e5f 7265  es_df = self._re
-0000b420: 6164 5f70 616e 6461 7328 7061 6e64 6173  ad_pandas(pandas
-0000b430: 5f6f 626a 2e74 6f5f 6672 616d 6528 292c  _obj.to_frame(),
-0000b440: 2022 7265 6164 5f70 6963 6b6c 6522 290a   "read_pickle").
-0000b450: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000b460: 726e 2062 6967 6672 616d 6573 5f64 665b  rn bigframes_df[
-0000b470: 6269 6766 7261 6d65 735f 6466 2e63 6f6c  bigframes_df.col
-0000b480: 756d 6e73 5b30 5d5d 0a20 2020 2020 2020  umns[0]].       
-0000b490: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-0000b4a0: 6164 5f70 616e 6461 7328 7061 6e64 6173  ad_pandas(pandas
-0000b4b0: 5f6f 626a 2c20 2272 6561 645f 7069 636b  _obj, "read_pick
-0000b4c0: 6c65 2229 0a0a 2020 2020 6465 6620 7265  le")..    def re
-0000b4d0: 6164 5f70 6172 7175 6574 280a 2020 2020  ad_parquet(.    
-0000b4e0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0000b4f0: 2020 7061 7468 3a20 7374 7220 7c20 494f    path: str | IO
-0000b500: 5b22 6279 7465 7322 5d2c 0a20 2020 2020  ["bytes"],.     
-0000b510: 2020 202a 2c0a 2020 2020 2020 2020 656e     *,.        en
-0000b520: 6769 6e65 3a20 7374 7220 3d20 2261 7574  gine: str = "aut
-0000b530: 6f22 2c0a 2020 2020 2920 2d3e 2064 6174  o",.    ) -> dat
-0000b540: 6166 7261 6d65 2e44 6174 6146 7261 6d65  aframe.DataFrame
-0000b550: 3a0a 2020 2020 2020 2020 7461 626c 6520  :.        table 
-0000b560: 3d20 7365 6c66 2e5f 7261 6e64 6f6d 5f74  = self._random_t
-0000b570: 6162 6c65 2829 0a0a 2020 2020 2020 2020  able()..        
-0000b580: 6966 2065 6e67 696e 6520 3d3d 2022 6269  if engine == "bi
-0000b590: 6771 7565 7279 223a 0a20 2020 2020 2020  gquery":.       
-0000b5a0: 2020 2020 206a 6f62 5f63 6f6e 6669 6720       job_config 
-0000b5b0: 3d20 7365 6c66 2e5f 7072 6570 6172 655f  = self._prepare_
-0000b5c0: 6c6f 6164 5f6a 6f62 5f63 6f6e 6669 6728  load_job_config(
-0000b5d0: 290a 2020 2020 2020 2020 2020 2020 6a6f  ).            jo
-0000b5e0: 625f 636f 6e66 6967 2e63 7265 6174 655f  b_config.create_
-0000b5f0: 6469 7370 6f73 6974 696f 6e20 3d20 6269  disposition = bi
-0000b600: 6771 7565 7279 2e43 7265 6174 6544 6973  gquery.CreateDis
-0000b610: 706f 7369 7469 6f6e 2e43 5245 4154 455f  position.CREATE_
-0000b620: 4946 5f4e 4545 4445 440a 2020 2020 2020  IF_NEEDED.      
-0000b630: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
-0000b640: 2e73 6f75 7263 655f 666f 726d 6174 203d  .source_format =
-0000b650: 2062 6967 7175 6572 792e 536f 7572 6365   bigquery.Source
-0000b660: 466f 726d 6174 2e50 4152 5155 4554 0a20  Format.PARQUET. 
-0000b670: 2020 2020 2020 2020 2020 206a 6f62 5f63             job_c
-0000b680: 6f6e 6669 672e 7772 6974 655f 6469 7370  onfig.write_disp
-0000b690: 6f73 6974 696f 6e20 3d20 6269 6771 7565  osition = bigque
-0000b6a0: 7279 2e57 7269 7465 4469 7370 6f73 6974  ry.WriteDisposit
-0000b6b0: 696f 6e2e 5752 4954 455f 454d 5054 590a  ion.WRITE_EMPTY.
-0000b6c0: 2020 2020 2020 2020 2020 2020 6a6f 625f              job_
-0000b6d0: 636f 6e66 6967 2e6c 6162 656c 7320 3d20  config.labels = 
-0000b6e0: 7b22 6269 6766 7261 6d65 732d 6170 6922  {"bigframes-api"
-0000b6f0: 3a20 2272 6561 645f 7061 7271 7565 7422  : "read_parquet"
-0000b700: 7d0a 0a20 2020 2020 2020 2020 2020 2072  }..            r
-0000b710: 6574 7572 6e20 7365 6c66 2e5f 7265 6164  eturn self._read
-0000b720: 5f62 6967 7175 6572 795f 6c6f 6164 5f6a  _bigquery_load_j
-0000b730: 6f62 2870 6174 682c 2074 6162 6c65 2c20  ob(path, table, 
-0000b740: 6a6f 625f 636f 6e66 6967 3d6a 6f62 5f63  job_config=job_c
-0000b750: 6f6e 6669 6729 0a20 2020 2020 2020 2065  onfig).        e
-0000b760: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000b770: 2072 6561 645f 7061 7271 7565 745f 6b77   read_parquet_kw
-0000b780: 6172 6773 3a20 4469 6374 5b73 7472 2c20  args: Dict[str, 
-0000b790: 416e 795d 203d 207b 7d0a 2020 2020 2020  Any] = {}.      
-0000b7a0: 2020 2020 2020 6966 2070 616e 6461 732e        if pandas.
-0000b7b0: 5f5f 7665 7273 696f 6e5f 5f2e 7374 6172  __version__.star
-0000b7c0: 7473 7769 7468 2822 312e 2229 3a0a 2020  tswith("1."):.  
-0000b7d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000b7e0: 6164 5f70 6172 7175 6574 5f6b 7761 7267  ad_parquet_kwarg
-0000b7f0: 735b 2275 7365 5f6e 756c 6c61 626c 655f  s["use_nullable_
-0000b800: 6474 7970 6573 225d 203d 2054 7275 650a  dtypes"] = True.
-0000b810: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000b820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b830: 2020 7265 6164 5f70 6172 7175 6574 5f6b    read_parquet_k
-0000b840: 7761 7267 735b 2264 7479 7065 5f62 6163  wargs["dtype_bac
-0000b850: 6b65 6e64 225d 203d 2022 7079 6172 726f  kend"] = "pyarro
-0000b860: 7722 0a0a 2020 2020 2020 2020 2020 2020  w"..            
-0000b870: 7061 6e64 6173 5f6f 626a 203d 2070 616e  pandas_obj = pan
-0000b880: 6461 732e 7265 6164 5f70 6172 7175 6574  das.read_parquet
-0000b890: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000b8a0: 2020 7061 7468 2c0a 2020 2020 2020 2020    path,.        
-0000b8b0: 2020 2020 2020 2020 656e 6769 6e65 3d65          engine=e
-0000b8c0: 6e67 696e 652c 2020 2320 7479 7065 3a20  ngine,  # type: 
-0000b8d0: 6967 6e6f 7265 0a20 2020 2020 2020 2020  ignore.         
-0000b8e0: 2020 2020 2020 202a 2a72 6561 645f 7061         **read_pa
-0000b8f0: 7271 7565 745f 6b77 6172 6773 2c0a 2020  rquet_kwargs,.  
-0000b900: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000b910: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000b920: 656c 662e 5f72 6561 645f 7061 6e64 6173  elf._read_pandas
-0000b930: 2870 616e 6461 735f 6f62 6a2c 2022 7265  (pandas_obj, "re
-0000b940: 6164 5f70 6172 7175 6574 2229 0a0a 2020  ad_parquet")..  
-0000b950: 2020 6465 6620 7265 6164 5f6a 736f 6e28    def read_json(
-0000b960: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0000b970: 2020 2020 2020 2070 6174 685f 6f72 5f62         path_or_b
-0000b980: 7566 3a20 7374 7220 7c20 494f 5b22 6279  uf: str | IO["by
-0000b990: 7465 7322 5d2c 0a20 2020 2020 2020 202a  tes"],.        *
-0000b9a0: 2c0a 2020 2020 2020 2020 6f72 6965 6e74  ,.        orient
-0000b9b0: 3a20 4c69 7465 7261 6c5b 0a20 2020 2020  : Literal[.     
-0000b9c0: 2020 2020 2020 2022 7370 6c69 7422 2c20         "split", 
-0000b9d0: 2272 6563 6f72 6473 222c 2022 696e 6465  "records", "inde
-0000b9e0: 7822 2c20 2263 6f6c 756d 6e73 222c 2022  x", "columns", "
-0000b9f0: 7661 6c75 6573 222c 2022 7461 626c 6522  values", "table"
-0000ba00: 0a20 2020 2020 2020 205d 203d 2022 636f  .        ] = "co
-0000ba10: 6c75 6d6e 7322 2c0a 2020 2020 2020 2020  lumns",.        
-0000ba20: 6474 7970 653a 204f 7074 696f 6e61 6c5b  dtype: Optional[
-0000ba30: 4469 6374 5d20 3d20 4e6f 6e65 2c0a 2020  Dict] = None,.  
-0000ba40: 2020 2020 2020 656e 636f 6469 6e67 3a20        encoding: 
-0000ba50: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-0000ba60: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c69  None,.        li
-0000ba70: 6e65 733a 2062 6f6f 6c20 3d20 4661 6c73  nes: bool = Fals
-0000ba80: 652c 0a20 2020 2020 2020 2065 6e67 696e  e,.        engin
-0000ba90: 653a 204c 6974 6572 616c 5b22 756a 736f  e: Literal["ujso
-0000baa0: 6e22 2c20 2270 7961 7272 6f77 222c 2022  n", "pyarrow", "
-0000bab0: 6269 6771 7565 7279 225d 203d 2022 756a  bigquery"] = "uj
-0000bac0: 736f 6e22 2c0a 2020 2020 2020 2020 2a2a  son",.        **
-0000bad0: 6b77 6172 6773 2c0a 2020 2020 2920 2d3e  kwargs,.    ) ->
-0000bae0: 2064 6174 6166 7261 6d65 2e44 6174 6146   dataframe.DataF
-0000baf0: 7261 6d65 3a0a 2020 2020 2020 2020 7461  rame:.        ta
-0000bb00: 626c 6520 3d20 7365 6c66 2e5f 7261 6e64  ble = self._rand
-0000bb10: 6f6d 5f74 6162 6c65 2829 0a0a 2020 2020  om_table()..    
-0000bb20: 2020 2020 6966 2065 6e67 696e 6520 3d3d      if engine ==
-0000bb30: 2022 6269 6771 7565 7279 223a 0a0a 2020   "bigquery":..  
-0000bb40: 2020 2020 2020 2020 2020 6966 2064 7479            if dty
-0000bb50: 7065 2069 7320 6e6f 7420 4e6f 6e65 3a0a  pe is not None:.
+0000aea0: 2053 6571 7565 6e63 655b 7374 725d 2c20   Sequence[str], 
+0000aeb0: 2023 2046 616c 7365 7920 7661 6c75 6573   # Falsey values
+0000aec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000aed0: 2020 2020 2062 6967 6672 616d 6573 2e65       bigframes.e
+0000aee0: 6e75 6d73 2e44 6566 6175 6c74 496e 6465  nums.DefaultInde
+0000aef0: 784b 696e 642c 0a20 2020 2020 2020 2020  xKind,.         
+0000af00: 2020 2020 2020 2020 2020 2073 7472 2c0a             str,.
+0000af10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af20: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0000af30: 2020 2069 6e64 6578 5f63 6f6c 2c0a 2020     index_col,.  
+0000af40: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0000af50: 2020 2020 2020 2020 2023 2075 7365 636f           # useco
+0000af60: 6c73 2073 686f 756c 6420 6f6e 6c79 2062  ls should only b
+0000af70: 6520 616e 2069 7465 7261 626c 6520 6f66  e an iterable of
+0000af80: 2073 7472 696e 6773 2028 636f 6c75 6d6e   strings (column
+0000af90: 206e 616d 6573 2920 666f 7220 7573 6520   names) for use 
+0000afa0: 6173 2063 6f6c 756d 6e73 2069 6e20 7265  as columns in re
+0000afb0: 6164 5f67 6271 2e0a 2020 2020 2020 2020  ad_gbq..        
+0000afc0: 2020 2020 636f 6c75 6d6e 733a 2054 7570      columns: Tup
+0000afd0: 6c65 5b41 6e79 2c20 2e2e 2e5d 203d 2074  le[Any, ...] = t
+0000afe0: 7570 6c65 2829 0a20 2020 2020 2020 2020  uple().         
+0000aff0: 2020 2069 6620 7573 6563 6f6c 7320 6973     if usecols is
+0000b000: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000b010: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0000b020: 696e 7374 616e 6365 2875 7365 636f 6c73  instance(usecols
+0000b030: 2c20 4974 6572 6162 6c65 2920 616e 6420  , Iterable) and 
+0000b040: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
+0000b050: 2020 2020 2020 2020 2069 7369 6e73 7461           isinsta
+0000b060: 6e63 6528 636f 6c2c 2073 7472 2920 666f  nce(col, str) fo
+0000b070: 7220 636f 6c20 696e 2075 7365 636f 6c73  r col in usecols
+0000b080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b090: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+0000b0a0: 2020 2020 2020 2020 636f 6c75 6d6e 7320          columns 
+0000b0b0: 3d20 7475 706c 6528 636f 6c20 666f 7220  = tuple(col for 
+0000b0c0: 636f 6c20 696e 2075 7365 636f 6c73 290a  col in usecols).
+0000b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000b0f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000b100: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
+0000b110: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000b120: 2020 2020 2020 2020 2020 2020 2022 4269               "Bi
+0000b130: 6751 7565 7279 2065 6e67 696e 6520 6f6e  gQuery engine on
+0000b140: 6c79 2073 7570 706f 7274 7320 616e 2069  ly supports an i
+0000b150: 7465 7261 626c 6520 6f66 2073 7472 696e  terable of strin
+0000b160: 6773 2066 6f72 2060 7573 6563 6f6c 7360  gs for `usecols`
+0000b170: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+0000b180: 2020 2020 2020 2020 2020 2020 6622 7b63              f"{c
+0000b190: 6f6e 7374 616e 7473 2e46 4545 4442 4143  onstants.FEEDBAC
+0000b1a0: 4b5f 4c49 4e4b 7d22 0a20 2020 2020 2020  K_LINK}".       
+0000b1b0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+0000b1c0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+0000b1d0: 6e63 6f64 696e 6720 6973 206e 6f74 204e  ncoding is not N
+0000b1e0: 6f6e 6520 616e 6420 656e 636f 6469 6e67  one and encoding
+0000b1f0: 206e 6f74 2069 6e20 5f56 414c 4944 5f45   not in _VALID_E
+0000b200: 4e43 4f44 494e 4753 3a0a 2020 2020 2020  NCODINGS:.      
+0000b210: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000b220: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
+0000b230: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000b240: 2020 2020 2020 2020 2066 2242 6967 5175           f"BigQu
+0000b250: 6572 7920 656e 6769 6e65 206f 6e6c 7920  ery engine only 
+0000b260: 7375 7070 6f72 7473 2074 6865 2066 6f6c  supports the fol
+0000b270: 6c6f 7769 6e67 2065 6e63 6f64 696e 6773  lowing encodings
+0000b280: 3a20 7b5f 5641 4c49 445f 454e 434f 4449  : {_VALID_ENCODI
+0000b290: 4e47 537d 2e20 220a 2020 2020 2020 2020  NGS}. ".        
+0000b2a0: 2020 2020 2020 2020 2020 2020 6622 7b63              f"{c
+0000b2b0: 6f6e 7374 616e 7473 2e46 4545 4442 4143  onstants.FEEDBAC
+0000b2c0: 4b5f 4c49 4e4b 7d22 0a20 2020 2020 2020  K_LINK}".       
+0000b2d0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000b2e0: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+0000b2f0: 6967 203d 2073 656c 662e 5f70 7265 7061  ig = self._prepa
+0000b300: 7265 5f6c 6f61 645f 6a6f 625f 636f 6e66  re_load_job_conf
+0000b310: 6967 2829 0a20 2020 2020 2020 2020 2020  ig().           
+0000b320: 206a 6f62 5f63 6f6e 6669 672e 6372 6561   job_config.crea
+0000b330: 7465 5f64 6973 706f 7369 7469 6f6e 203d  te_disposition =
+0000b340: 2062 6967 7175 6572 792e 4372 6561 7465   bigquery.Create
+0000b350: 4469 7370 6f73 6974 696f 6e2e 4352 4541  Disposition.CREA
+0000b360: 5445 5f49 465f 4e45 4544 4544 0a20 2020  TE_IF_NEEDED.   
+0000b370: 2020 2020 2020 2020 206a 6f62 5f63 6f6e           job_con
+0000b380: 6669 672e 736f 7572 6365 5f66 6f72 6d61  fig.source_forma
+0000b390: 7420 3d20 6269 6771 7565 7279 2e53 6f75  t = bigquery.Sou
+0000b3a0: 7263 6546 6f72 6d61 742e 4353 560a 2020  rceFormat.CSV.  
+0000b3b0: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
+0000b3c0: 6e66 6967 2e77 7269 7465 5f64 6973 706f  nfig.write_dispo
+0000b3d0: 7369 7469 6f6e 203d 2062 6967 7175 6572  sition = bigquer
+0000b3e0: 792e 5772 6974 6544 6973 706f 7369 7469  y.WriteDispositi
+0000b3f0: 6f6e 2e57 5249 5445 5f45 4d50 5459 0a20  on.WRITE_EMPTY. 
+0000b400: 2020 2020 2020 2020 2020 206a 6f62 5f63             job_c
+0000b410: 6f6e 6669 672e 6175 746f 6465 7465 6374  onfig.autodetect
+0000b420: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0000b430: 2020 2020 6a6f 625f 636f 6e66 6967 2e66      job_config.f
+0000b440: 6965 6c64 5f64 656c 696d 6974 6572 203d  ield_delimiter =
+0000b450: 2073 6570 0a20 2020 2020 2020 2020 2020   sep.           
+0000b460: 206a 6f62 5f63 6f6e 6669 672e 656e 636f   job_config.enco
+0000b470: 6469 6e67 203d 2065 6e63 6f64 696e 670a  ding = encoding.
+0000b480: 2020 2020 2020 2020 2020 2020 6a6f 625f              job_
+0000b490: 636f 6e66 6967 2e6c 6162 656c 7320 3d20  config.labels = 
+0000b4a0: 7b22 6269 6766 7261 6d65 732d 6170 6922  {"bigframes-api"
+0000b4b0: 3a20 2272 6561 645f 6373 7622 7d0a 0a20  : "read_csv"}.. 
+0000b4c0: 2020 2020 2020 2020 2020 2023 2057 6520             # We 
+0000b4d0: 7761 6e74 2074 6f20 6d61 7463 6820 7061  want to match pa
+0000b4e0: 6e64 6173 2062 6568 6176 696f 722e 2049  ndas behavior. I
+0000b4f0: 6620 6865 6164 6572 2069 7320 302c 206e  f header is 0, n
+0000b500: 6f20 726f 7773 2073 686f 756c 6420 6265  o rows should be
+0000b510: 2073 6b69 7070 6564 2c20 736f 2077 650a   skipped, so we.
+0000b520: 2020 2020 2020 2020 2020 2020 2320 646f              # do
+0000b530: 206e 6f74 206e 6565 6420 746f 2073 6574   not need to set
+0000b540: 2060 736b 6970 5f6c 6561 6469 6e67 5f72   `skip_leading_r
+0000b550: 6f77 7360 2e20 4966 2068 6561 6465 7220  ows`. If header 
+0000b560: 6973 204e 6f6e 652c 2074 6865 6e20 7468  is None, then th
+0000b570: 6572 6520 6973 206e 6f20 6865 6164 6572  ere is no header
+0000b580: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000b590: 5365 7474 696e 6720 736b 6970 5f6c 6561  Setting skip_lea
+0000b5a0: 6469 6e67 5f72 6f77 7320 746f 2030 2064  ding_rows to 0 d
+0000b5b0: 6f65 7320 7468 6174 2e20 4966 2068 6561  oes that. If hea
+0000b5c0: 6465 723d 4e20 616e 6420 4e3e 302c 2077  der=N and N>0, w
+0000b5d0: 6520 7761 6e74 2074 6f20 736b 6970 204e  e want to skip N
+0000b5e0: 2072 6f77 732e 0a20 2020 2020 2020 2020   rows..         
+0000b5f0: 2020 2069 6620 6865 6164 6572 2069 7320     if header is 
+0000b600: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000b610: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
+0000b620: 2e73 6b69 705f 6c65 6164 696e 675f 726f  .skip_leading_ro
+0000b630: 7773 203d 2030 0a20 2020 2020 2020 2020  ws = 0.         
+0000b640: 2020 2065 6c69 6620 6865 6164 6572 203e     elif header >
+0000b650: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0000b660: 2020 2020 6a6f 625f 636f 6e66 6967 2e73      job_config.s
+0000b670: 6b69 705f 6c65 6164 696e 675f 726f 7773  kip_leading_rows
+0000b680: 203d 2068 6561 6465 720a 0a20 2020 2020   = header..     
+0000b690: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000b6a0: 6c66 2e5f 7265 6164 5f62 6967 7175 6572  lf._read_bigquer
+0000b6b0: 795f 6c6f 6164 5f6a 6f62 280a 2020 2020  y_load_job(.    
+0000b6c0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000b6d0: 7061 7468 5f6f 725f 6275 6666 6572 2c0a  path_or_buffer,.
+0000b6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6f0: 7461 626c 652c 0a20 2020 2020 2020 2020  table,.         
+0000b700: 2020 2020 2020 206a 6f62 5f63 6f6e 6669         job_confi
+0000b710: 673d 6a6f 625f 636f 6e66 6967 2c0a 2020  g=job_config,.  
+0000b720: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0000b730: 6465 785f 636f 6c3d 696e 6465 785f 636f  dex_col=index_co
+0000b740: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
+0000b750: 2020 2063 6f6c 756d 6e73 3d63 6f6c 756d     columns=colum
+0000b760: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
+0000b770: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0000b780: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000b790: 7369 6e73 7461 6e63 6528 696e 6465 785f  sinstance(index_
+0000b7a0: 636f 6c2c 2062 6967 6672 616d 6573 2e65  col, bigframes.e
+0000b7b0: 6e75 6d73 2e44 6566 6175 6c74 496e 6465  nums.DefaultInde
+0000b7c0: 784b 696e 6429 3a0a 2020 2020 2020 2020  xKind):.        
+0000b7d0: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
+0000b7e0: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
+0000b7f0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000b800: 2020 2020 2020 2066 2257 6974 6820 696e         f"With in
+0000b810: 6465 785f 636f 6c3d 7b72 6570 7228 696e  dex_col={repr(in
+0000b820: 6465 785f 636f 6c29 7d2c 206f 6e6c 7920  dex_col)}, only 
+0000b830: 656e 6769 6e65 3d27 6269 6771 7565 7279  engine='bigquery
+0000b840: 2720 6973 2073 7570 706f 7274 6564 2e20  ' is supported. 
+0000b850: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000b860: 2020 2020 2020 6622 7b63 6f6e 7374 616e        f"{constan
+0000b870: 7473 2e46 4545 4442 4143 4b5f 4c49 4e4b  ts.FEEDBACK_LINK
+0000b880: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+0000b890: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000b8a0: 2069 6620 616e 7928 6172 6720 696e 206b   if any(arg in k
+0000b8b0: 7761 7267 7320 666f 7220 6172 6720 696e  wargs for arg in
+0000b8c0: 2028 2263 6875 6e6b 7369 7a65 222c 2022   ("chunksize", "
+0000b8d0: 6974 6572 6174 6f72 2229 293a 0a20 2020  iterator")):.   
+0000b8e0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000b8f0: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
+0000b900: 6445 7272 6f72 280a 2020 2020 2020 2020  dError(.        
+0000b910: 2020 2020 2020 2020 2020 2020 2227 6368              "'ch
+0000b920: 756e 6b73 697a 6527 2061 6e64 2027 6974  unksize' and 'it
+0000b930: 6572 6174 6f72 2720 6172 6775 6d65 6e74  erator' argument
+0000b940: 7320 6172 6520 6e6f 7420 7375 7070 6f72  s are not suppor
+0000b950: 7465 642e 2022 0a20 2020 2020 2020 2020  ted. ".         
+0000b960: 2020 2020 2020 2020 2020 2066 227b 636f             f"{co
+0000b970: 6e73 7461 6e74 732e 4645 4544 4241 434b  nstants.FEEDBACK
+0000b980: 5f4c 494e 4b7d 220a 2020 2020 2020 2020  _LINK}".        
+0000b990: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000b9a0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000b9b0: 616e 6365 2866 696c 6570 6174 685f 6f72  ance(filepath_or
+0000b9c0: 5f62 7566 6665 722c 2073 7472 293a 0a20  _buffer, str):. 
+0000b9d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b9e0: 656c 662e 5f63 6865 636b 5f66 696c 655f  elf._check_file_
+0000b9f0: 7369 7a65 2866 696c 6570 6174 685f 6f72  size(filepath_or
+0000ba00: 5f62 7566 6665 7229 0a20 2020 2020 2020  _buffer).       
+0000ba10: 2020 2020 2070 616e 6461 735f 6466 203d       pandas_df =
+0000ba20: 2070 616e 6461 732e 7265 6164 5f63 7376   pandas.read_csv
+0000ba30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000ba40: 2020 6669 6c65 7061 7468 5f6f 725f 6275    filepath_or_bu
+0000ba50: 6666 6572 2c0a 2020 2020 2020 2020 2020  ffer,.          
+0000ba60: 2020 2020 2020 7365 703d 7365 702c 0a20        sep=sep,. 
+0000ba70: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0000ba80: 6561 6465 723d 6865 6164 6572 2c0a 2020  eader=header,.  
+0000ba90: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+0000baa0: 6d65 733d 6e61 6d65 732c 0a20 2020 2020  mes=names,.     
+0000bab0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0000bac0: 5f63 6f6c 3d69 6e64 6578 5f63 6f6c 2c0a  _col=index_col,.
+0000bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bae0: 7573 6563 6f6c 733d 7573 6563 6f6c 732c  usecols=usecols,
+0000baf0: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
+0000bb00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bb10: 2064 7479 7065 3d64 7479 7065 2c0a 2020   dtype=dtype,.  
+0000bb20: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0000bb30: 6769 6e65 3d65 6e67 696e 652c 0a20 2020  gine=engine,.   
+0000bb40: 2020 2020 2020 2020 2020 2020 2065 6e63               enc
+0000bb50: 6f64 696e 673d 656e 636f 6469 6e67 2c0a  oding=encoding,.
 0000bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb70: 7261 6973 6520 4e6f 7449 6d70 6c65 6d65  raise NotImpleme
-0000bb80: 6e74 6564 4572 726f 7228 0a20 2020 2020  ntedError(.     
-0000bb90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000bba0: 4269 6751 7565 7279 2065 6e67 696e 6520  BigQuery engine 
-0000bbb0: 646f 6573 206e 6f74 2073 7570 706f 7274  does not support
-0000bbc0: 2074 6865 2064 7479 7065 2061 7267 756d   the dtype argum
-0000bbd0: 656e 7473 2e22 0a20 2020 2020 2020 2020  ents.".         
-0000bbe0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000bbf0: 2020 2020 2020 6966 206e 6f74 206c 696e        if not lin
-0000bc00: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0000bc10: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
-0000bc20: 6c65 6d65 6e74 6564 4572 726f 7228 0a20  lementedError(. 
-0000bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc40: 2020 2022 4f6e 6c79 206e 6577 6c69 6e65     "Only newline
-0000bc50: 2064 656c 696d 6974 6564 204a 534f 4e20   delimited JSON 
-0000bc60: 666f 726d 6174 2069 7320 7375 7070 6f72  format is suppor
-0000bc70: 7465 642e 220a 2020 2020 2020 2020 2020  ted.".          
-0000bc80: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000bc90: 2020 2020 2069 6620 656e 636f 6469 6e67       if encoding
-0000bca0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000bcb0: 2065 6e63 6f64 696e 6720 6e6f 7420 696e   encoding not in
-0000bcc0: 205f 5641 4c49 445f 454e 434f 4449 4e47   _VALID_ENCODING
-0000bcd0: 533a 0a20 2020 2020 2020 2020 2020 2020  S:.             
-0000bce0: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-0000bcf0: 656d 656e 7465 6445 7272 6f72 280a 2020  ementedError(.  
-0000bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd10: 2020 6622 4269 6751 7565 7279 2065 6e67    f"BigQuery eng
-0000bd20: 696e 6520 6f6e 6c79 2073 7570 706f 7274  ine only support
-0000bd30: 7320 7468 6520 666f 6c6c 6f77 696e 6720  s the following 
-0000bd40: 656e 636f 6469 6e67 733a 207b 5f56 414c  encodings: {_VAL
-0000bd50: 4944 5f45 4e43 4f44 494e 4753 7d22 0a20  ID_ENCODINGS}". 
-0000bd60: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000bd70: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000bd80: 206c 696e 6573 2061 6e64 206f 7269 656e   lines and orien
-0000bd90: 7420 213d 2022 7265 636f 7264 7322 3a0a  t != "records":.
-0000bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdb0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000bdc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000bdd0: 2020 2020 2020 2227 6c69 6e65 7327 206b        "'lines' k
-0000bde0: 6579 776f 7264 2069 7320 6f6e 6c79 2076  eyword is only v
-0000bdf0: 616c 6964 2077 6865 6e20 276f 7269 656e  alid when 'orien
-0000be00: 7427 2069 7320 2772 6563 6f72 6473 272e  t' is 'records'.
-0000be10: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000be20: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-0000be30: 206a 6f62 5f63 6f6e 6669 6720 3d20 7365   job_config = se
-0000be40: 6c66 2e5f 7072 6570 6172 655f 6c6f 6164  lf._prepare_load
-0000be50: 5f6a 6f62 5f63 6f6e 6669 6728 290a 2020  _job_config().  
-0000be60: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
-0000be70: 6e66 6967 2e63 7265 6174 655f 6469 7370  nfig.create_disp
-0000be80: 6f73 6974 696f 6e20 3d20 6269 6771 7565  osition = bigque
-0000be90: 7279 2e43 7265 6174 6544 6973 706f 7369  ry.CreateDisposi
-0000bea0: 7469 6f6e 2e43 5245 4154 455f 4946 5f4e  tion.CREATE_IF_N
-0000beb0: 4545 4445 440a 2020 2020 2020 2020 2020  EEDED.          
-0000bec0: 2020 6a6f 625f 636f 6e66 6967 2e73 6f75    job_config.sou
-0000bed0: 7263 655f 666f 726d 6174 203d 2062 6967  rce_format = big
-0000bee0: 7175 6572 792e 536f 7572 6365 466f 726d  query.SourceForm
-0000bef0: 6174 2e4e 4557 4c49 4e45 5f44 454c 494d  at.NEWLINE_DELIM
-0000bf00: 4954 4544 5f4a 534f 4e0a 2020 2020 2020  ITED_JSON.      
-0000bf10: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
-0000bf20: 2e77 7269 7465 5f64 6973 706f 7369 7469  .write_dispositi
-0000bf30: 6f6e 203d 2062 6967 7175 6572 792e 5772  on = bigquery.Wr
-0000bf40: 6974 6544 6973 706f 7369 7469 6f6e 2e57  iteDisposition.W
-0000bf50: 5249 5445 5f45 4d50 5459 0a20 2020 2020  RITE_EMPTY.     
-0000bf60: 2020 2020 2020 206a 6f62 5f63 6f6e 6669         job_confi
-0000bf70: 672e 6175 746f 6465 7465 6374 203d 2054  g.autodetect = T
-0000bf80: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0000bf90: 6a6f 625f 636f 6e66 6967 2e65 6e63 6f64  job_config.encod
-0000bfa0: 696e 6720 3d20 656e 636f 6469 6e67 0a20  ing = encoding. 
-0000bfb0: 2020 2020 2020 2020 2020 206a 6f62 5f63             job_c
-0000bfc0: 6f6e 6669 672e 6c61 6265 6c73 203d 207b  onfig.labels = {
-0000bfd0: 2262 6967 6672 616d 6573 2d61 7069 223a  "bigframes-api":
-0000bfe0: 2022 7265 6164 5f6a 736f 6e22 7d0a 0a20   "read_json"}.. 
-0000bff0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000c000: 6e20 7365 6c66 2e5f 7265 6164 5f62 6967  n self._read_big
-0000c010: 7175 6572 795f 6c6f 6164 5f6a 6f62 280a  query_load_job(.
-0000c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c030: 7061 7468 5f6f 725f 6275 662c 0a20 2020  path_or_buf,.   
-0000c040: 2020 2020 2020 2020 2020 2020 2074 6162               tab
-0000c050: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-0000c060: 2020 2020 6a6f 625f 636f 6e66 6967 3d6a      job_config=j
-0000c070: 6f62 5f63 6f6e 6669 672c 0a20 2020 2020  ob_config,.     
-0000c080: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000c090: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000c0a0: 2020 2069 6620 616e 7928 6172 6720 696e     if any(arg in
-0000c0b0: 206b 7761 7267 7320 666f 7220 6172 6720   kwargs for arg 
-0000c0c0: 696e 2028 2263 6875 6e6b 7369 7a65 222c  in ("chunksize",
-0000c0d0: 2022 6974 6572 6174 6f72 2229 293a 0a20   "iterator")):. 
-0000c0e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000c0f0: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
-0000c100: 7465 6445 7272 6f72 280a 2020 2020 2020  tedError(.      
-0000c110: 2020 2020 2020 2020 2020 2020 2020 2227                "'
-0000c120: 6368 756e 6b73 697a 6527 2061 6e64 2027  chunksize' and '
-0000c130: 6974 6572 6174 6f72 2720 6172 6775 6d65  iterator' argume
-0000c140: 6e74 7320 6172 6520 6e6f 7420 7375 7070  nts are not supp
-0000c150: 6f72 7465 642e 220a 2020 2020 2020 2020  orted.".        
-0000c160: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0000c170: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0000c180: 616e 6365 2870 6174 685f 6f72 5f62 7566  ance(path_or_buf
-0000c190: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-0000c1a0: 2020 2020 2020 2020 7365 6c66 2e5f 6368          self._ch
-0000c1b0: 6563 6b5f 6669 6c65 5f73 697a 6528 7061  eck_file_size(pa
-0000c1c0: 7468 5f6f 725f 6275 6629 0a0a 2020 2020  th_or_buf)..    
-0000c1d0: 2020 2020 2020 2020 6966 2065 6e67 696e          if engin
-0000c1e0: 6520 3d3d 2022 756a 736f 6e22 3a0a 2020  e == "ujson":.  
-0000c1f0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0000c200: 6e64 6173 5f64 6620 3d20 7061 6e64 6173  ndas_df = pandas
-0000c210: 2e72 6561 645f 6a73 6f6e 2820 2023 2074  .read_json(  # t
-0000c220: 7970 653a 2069 676e 6f72 650a 2020 2020  ype: ignore.    
-0000c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c240: 7061 7468 5f6f 725f 6275 662c 0a20 2020  path_or_buf,.   
-0000c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c260: 206f 7269 656e 743d 6f72 6965 6e74 2c0a   orient=orient,.
-0000c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c280: 2020 2020 6474 7970 653d 6474 7970 652c      dtype=dtype,
-0000c290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c2a0: 2020 2020 2065 6e63 6f64 696e 673d 656e       encoding=en
-0000c2b0: 636f 6469 6e67 2c0a 2020 2020 2020 2020  coding,.        
-0000c2c0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-0000c2d0: 733d 6c69 6e65 732c 0a20 2020 2020 2020  s=lines,.       
-0000c2e0: 2020 2020 2020 2020 2020 2020 202a 2a6b               **k
-0000c2f0: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
-0000c300: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000c310: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000c320: 2020 2020 2020 2020 2020 2020 7061 6e64              pand
-0000c330: 6173 5f64 6620 3d20 7061 6e64 6173 2e72  as_df = pandas.r
-0000c340: 6561 645f 6a73 6f6e 2820 2023 2074 7970  ead_json(  # typ
-0000c350: 653a 2069 676e 6f72 650a 2020 2020 2020  e: ignore.      
-0000c360: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0000c370: 7468 5f6f 725f 6275 662c 0a20 2020 2020  th_or_buf,.     
-0000c380: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000c390: 7269 656e 743d 6f72 6965 6e74 2c0a 2020  rient=orient,.  
-0000c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3b0: 2020 6474 7970 653d 6474 7970 652c 0a20    dtype=dtype,. 
-0000c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3d0: 2020 2065 6e63 6f64 696e 673d 656e 636f     encoding=enco
-0000c3e0: 6469 6e67 2c0a 2020 2020 2020 2020 2020  ding,.          
-0000c3f0: 2020 2020 2020 2020 2020 6c69 6e65 733d            lines=
-0000c400: 6c69 6e65 732c 0a20 2020 2020 2020 2020  lines,.         
-0000c410: 2020 2020 2020 2020 2020 2065 6e67 696e             engin
-0000c420: 653d 656e 6769 6e65 2c0a 2020 2020 2020  e=engine,.      
-0000c430: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-0000c440: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
-0000c450: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000c460: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000c470: 662e 5f72 6561 645f 7061 6e64 6173 2870  f._read_pandas(p
-0000c480: 616e 6461 735f 6466 2c20 2272 6561 645f  andas_df, "read_
-0000c490: 6a73 6f6e 2229 0a0a 2020 2020 6465 6620  json")..    def 
-0000c4a0: 5f63 6865 636b 5f66 696c 655f 7369 7a65  _check_file_size
-0000c4b0: 2873 656c 662c 2066 696c 6570 6174 683a  (self, filepath:
-0000c4c0: 2073 7472 293a 0a20 2020 2020 2020 206d   str):.        m
-0000c4d0: 6178 5f73 697a 6520 3d20 3130 3234 202a  ax_size = 1024 *
-0000c4e0: 2031 3032 3420 2a20 3130 3234 2020 2320   1024 * 1024  # 
-0000c4f0: 3120 4742 2069 6e20 6279 7465 730a 2020  1 GB in bytes.  
-0000c500: 2020 2020 2020 6966 2066 696c 6570 6174        if filepat
-0000c510: 682e 7374 6172 7473 7769 7468 2822 6773  h.startswith("gs
-0000c520: 3a2f 2f22 293a 2020 2320 4743 5320 6669  ://"):  # GCS fi
-0000c530: 6c65 2070 6174 680a 2020 2020 2020 2020  le path.        
-0000c540: 2020 2020 636c 6965 6e74 203d 2073 746f      client = sto
-0000c550: 7261 6765 2e43 6c69 656e 7428 290a 2020  rage.Client().  
-0000c560: 2020 2020 2020 2020 2020 6275 636b 6574            bucket
-0000c570: 5f6e 616d 652c 2062 6c6f 625f 6e61 6d65  _name, blob_name
-0000c580: 203d 2066 696c 6570 6174 682e 7370 6c69   = filepath.spli
-0000c590: 7428 222f 222c 2033 295b 323a 5d0a 2020  t("/", 3)[2:].  
-0000c5a0: 2020 2020 2020 2020 2020 6275 636b 6574            bucket
-0000c5b0: 203d 2063 6c69 656e 742e 6275 636b 6574   = client.bucket
-0000c5c0: 2862 7563 6b65 745f 6e61 6d65 290a 2020  (bucket_name).  
-0000c5d0: 2020 2020 2020 2020 2020 626c 6f62 203d            blob =
-0000c5e0: 2062 7563 6b65 742e 626c 6f62 2862 6c6f   bucket.blob(blo
-0000c5f0: 625f 6e61 6d65 290a 2020 2020 2020 2020  b_name).        
-0000c600: 2020 2020 626c 6f62 2e72 656c 6f61 6428      blob.reload(
-0000c610: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
-0000c620: 6c65 5f73 697a 6520 3d20 626c 6f62 2e73  le_size = blob.s
-0000c630: 697a 650a 2020 2020 2020 2020 656c 7365  ize.        else
-0000c640: 3a20 2023 206c 6f63 616c 2066 696c 6520  :  # local file 
-0000c650: 7061 7468 0a20 2020 2020 2020 2020 2020  path.           
-0000c660: 2066 696c 655f 7369 7a65 203d 206f 732e   file_size = os.
-0000c670: 7061 7468 2e67 6574 7369 7a65 2866 696c  path.getsize(fil
-0000c680: 6570 6174 6829 0a0a 2020 2020 2020 2020  epath)..        
-0000c690: 6966 2066 696c 655f 7369 7a65 203e 206d  if file_size > m
-0000c6a0: 6178 5f73 697a 653a 0a20 2020 2020 2020  ax_size:.       
-0000c6b0: 2020 2020 2023 2043 6f6e 7665 7274 2074       # Convert t
-0000c6c0: 6f20 4742 0a20 2020 2020 2020 2020 2020  o GB.           
-0000c6d0: 2066 696c 655f 7369 7a65 203d 2072 6f75   file_size = rou
-0000c6e0: 6e64 2866 696c 655f 7369 7a65 202f 2028  nd(file_size / (
-0000c6f0: 3130 3234 2a2a 3329 2c20 3129 0a20 2020  1024**3), 1).   
-0000c700: 2020 2020 2020 2020 206d 6178 5f73 697a           max_siz
-0000c710: 6520 3d20 696e 7428 6d61 785f 7369 7a65  e = int(max_size
-0000c720: 202f 2031 3032 342a 2a33 290a 2020 2020   / 1024**3).    
-0000c730: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-0000c740: 6172 6e69 6e67 280a 2020 2020 2020 2020  arning(.        
-0000c750: 2020 2020 2020 2020 6622 4669 6c65 2073          f"File s
-0000c760: 697a 6520 7b66 696c 655f 7369 7a65 7d47  ize {file_size}G
-0000c770: 4220 6578 6365 6564 7320 7b6d 6178 5f73  B exceeds {max_s
-0000c780: 697a 657d 4742 2e20 220a 2020 2020 2020  ize}GB. ".      
-0000c790: 2020 2020 2020 2020 2020 2249 7420 6973            "It is
-0000c7a0: 2072 6563 6f6d 6d65 6e64 6564 2074 6f20   recommended to 
-0000c7b0: 7573 6520 656e 6769 6e65 3d27 6269 6771  use engine='bigq
-0000c7c0: 7565 7279 2720 220a 2020 2020 2020 2020  uery' ".        
-0000c7d0: 2020 2020 2020 2020 2266 6f72 206c 6172          "for lar
-0000c7e0: 6765 2066 696c 6573 2074 6f20 6176 6f69  ge files to avoi
-0000c7f0: 6420 6c6f 6164 696e 6720 7468 6520 6669  d loading the fi
-0000c800: 6c65 2069 6e74 6f20 6c6f 6361 6c20 6d65  le into local me
-0000c810: 6d6f 7279 2e22 0a20 2020 2020 2020 2020  mory.".         
-0000c820: 2020 2029 0a0a 2020 2020 6465 6620 5f63     )..    def _c
-0000c830: 7265 6174 655f 656d 7074 795f 7465 6d70  reate_empty_temp
-0000c840: 5f74 6162 6c65 280a 2020 2020 2020 2020  _table(.        
-0000c850: 7365 6c66 2c0a 2020 2020 2020 2020 7363  self,.        sc
-0000c860: 6865 6d61 3a20 4974 6572 6162 6c65 5b62  hema: Iterable[b
-0000c870: 6967 7175 6572 792e 5363 6865 6d61 4669  igquery.SchemaFi
-0000c880: 656c 645d 2c0a 2020 2020 2020 2020 636c  eld],.        cl
-0000c890: 7573 7465 725f 636f 6c73 3a20 4c69 7374  uster_cols: List
-0000c8a0: 5b73 7472 5d2c 0a20 2020 2029 202d 3e20  [str],.    ) -> 
-0000c8b0: 6269 6771 7565 7279 2e54 6162 6c65 5265  bigquery.TableRe
-0000c8c0: 6665 7265 6e63 653a 0a20 2020 2020 2020  ference:.       
-0000c8d0: 2023 2043 616e 2774 2073 6574 2061 2074   # Can't set a t
-0000c8e0: 6162 6c65 2069 6e20 5f53 4553 5349 4f4e  able in _SESSION
-0000c8f0: 2061 7320 6465 7374 696e 6174 696f 6e20   as destination 
-0000c900: 7669 6120 7175 6572 7920 6a6f 6220 4150  via query job AP
-0000c910: 492c 2073 6f20 7765 0a20 2020 2020 2020  I, so we.       
-0000c920: 2023 2072 756e 2044 444c 2c20 696e 7374   # run DDL, inst
-0000c930: 6561 642e 0a20 2020 2020 2020 2065 7870  ead..        exp
-0000c940: 6972 6174 696f 6e20 3d20 280a 2020 2020  iration = (.    
-0000c950: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
-0000c960: 2e64 6174 6574 696d 652e 6e6f 7728 6461  .datetime.now(da
-0000c970: 7465 7469 6d65 2e74 696d 657a 6f6e 652e  tetime.timezone.
-0000c980: 7574 6329 202b 2063 6f6e 7374 616e 7473  utc) + constants
-0000c990: 2e44 4546 4155 4c54 5f45 5850 4952 4154  .DEFAULT_EXPIRAT
-0000c9a0: 494f 4e0a 2020 2020 2020 2020 290a 0a20  ION.        ).. 
-0000c9b0: 2020 2020 2020 2074 6162 6c65 203d 2062         table = b
-0000c9c0: 665f 696f 5f62 6967 7175 6572 792e 6372  f_io_bigquery.cr
-0000c9d0: 6561 7465 5f74 656d 705f 7461 626c 6528  eate_temp_table(
-0000c9e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000c9f0: 662c 0a20 2020 2020 2020 2020 2020 2065  f,.            e
-0000ca00: 7870 6972 6174 696f 6e2c 0a20 2020 2020  xpiration,.     
-0000ca10: 2020 2020 2020 2073 6368 656d 613d 7363         schema=sc
-0000ca20: 6865 6d61 2c0a 2020 2020 2020 2020 2020  hema,.          
-0000ca30: 2020 636c 7573 7465 725f 636f 6c75 6d6e    cluster_column
-0000ca40: 733d 636c 7573 7465 725f 636f 6c73 2c0a  s=cluster_cols,.
-0000ca50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000ca60: 2020 7265 7475 726e 2062 6967 7175 6572    return bigquer
-0000ca70: 792e 5461 626c 6552 6566 6572 656e 6365  y.TableReference
-0000ca80: 2e66 726f 6d5f 7374 7269 6e67 2874 6162  .from_string(tab
-0000ca90: 6c65 290a 0a20 2020 2064 6566 205f 6962  le)..    def _ib
-0000caa0: 6973 5f74 6f5f 7465 6d70 5f74 6162 6c65  is_to_temp_table
-0000cab0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-0000cac0: 2020 2020 2020 2020 7461 626c 653a 2069          table: i
-0000cad0: 6269 735f 7479 7065 732e 5461 626c 652c  bis_types.Table,
-0000cae0: 0a20 2020 2020 2020 2063 6c75 7374 6572  .        cluster
-0000caf0: 5f63 6f6c 733a 2049 7465 7261 626c 655b  _cols: Iterable[
-0000cb00: 7374 725d 2c0a 2020 2020 2020 2020 6170  str],.        ap
-0000cb10: 695f 6e61 6d65 3a20 7374 722c 0a20 2020  i_name: str,.   
-0000cb20: 2029 202d 3e20 6269 6771 7565 7279 2e54   ) -> bigquery.T
-0000cb30: 6162 6c65 5265 6665 7265 6e63 653a 0a20  ableReference:. 
-0000cb40: 2020 2020 2020 2064 6573 7469 6e61 7469         destinati
-0000cb50: 6f6e 2c20 5f20 3d20 7365 6c66 2e5f 7175  on, _ = self._qu
-0000cb60: 6572 795f 746f 5f64 6573 7469 6e61 7469  ery_to_destinati
-0000cb70: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-0000cb80: 7365 6c66 2e69 6269 735f 636c 6965 6e74  self.ibis_client
-0000cb90: 2e63 6f6d 7069 6c65 2874 6162 6c65 292c  .compile(table),
-0000cba0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-0000cbb0: 6578 5f63 6f6c 733d 6c69 7374 2863 6c75  ex_cols=list(clu
-0000cbc0: 7374 6572 5f63 6f6c 7329 2c0a 2020 2020  ster_cols),.    
-0000cbd0: 2020 2020 2020 2020 6170 695f 6e61 6d65          api_name
-0000cbe0: 3d61 7069 5f6e 616d 652c 0a20 2020 2020  =api_name,.     
-0000cbf0: 2020 2029 0a20 2020 2020 2020 2023 2054     ).        # T
-0000cc00: 6865 7265 2073 686f 756c 6420 616c 7761  here should alwa
-0000cc10: 7973 2062 6520 6120 6465 7374 696e 6174  ys be a destinat
-0000cc20: 696f 6e20 7461 626c 6520 666f 7220 7468  ion table for th
-0000cc30: 6973 2071 7565 7279 2074 7970 652e 0a20  is query type.. 
-0000cc40: 2020 2020 2020 2072 6574 7572 6e20 7479         return ty
-0000cc50: 7069 6e67 2e63 6173 7428 6269 6771 7565  ping.cast(bigque
-0000cc60: 7279 2e54 6162 6c65 5265 6665 7265 6e63  ry.TableReferenc
-0000cc70: 652c 2064 6573 7469 6e61 7469 6f6e 290a  e, destination).
-0000cc80: 0a20 2020 2064 6566 2072 656d 6f74 655f  .    def remote_
-0000cc90: 6675 6e63 7469 6f6e 280a 2020 2020 2020  function(.      
-0000cca0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0000ccb0: 696e 7075 745f 7479 7065 733a 2055 6e69  input_types: Uni
-0000ccc0: 6f6e 5b74 7970 652c 2053 6571 7565 6e63  on[type, Sequenc
-0000ccd0: 655b 7479 7065 5d5d 2c0a 2020 2020 2020  e[type]],.      
-0000cce0: 2020 6f75 7470 7574 5f74 7970 653a 2074    output_type: t
-0000ccf0: 7970 652c 0a20 2020 2020 2020 2064 6174  ype,.        dat
-0000cd00: 6173 6574 3a20 4f70 7469 6f6e 616c 5b73  aset: Optional[s
-0000cd10: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-0000cd20: 2020 2020 6269 6771 7565 7279 5f63 6f6e      bigquery_con
-0000cd30: 6e65 6374 696f 6e3a 204f 7074 696f 6e61  nection: Optiona
-0000cd40: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
-0000cd50: 2020 2020 2020 2072 6575 7365 3a20 626f         reuse: bo
-0000cd60: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
-0000cd70: 2020 206e 616d 653a 204f 7074 696f 6e61     name: Optiona
-0000cd80: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
-0000cd90: 2020 2020 2020 2070 6163 6b61 6765 733a         packages:
-0000cda0: 204f 7074 696f 6e61 6c5b 5365 7175 656e   Optional[Sequen
-0000cdb0: 6365 5b73 7472 5d5d 203d 204e 6f6e 652c  ce[str]] = None,
-0000cdc0: 0a20 2020 2020 2020 2063 6c6f 7564 5f66  .        cloud_f
-0000cdd0: 756e 6374 696f 6e5f 7365 7276 6963 655f  unction_service_
-0000cde0: 6163 636f 756e 743a 204f 7074 696f 6e61  account: Optiona
-0000cdf0: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
-0000ce00: 2020 2020 2020 2063 6c6f 7564 5f66 756e         cloud_fun
-0000ce10: 6374 696f 6e5f 6b6d 735f 6b65 795f 6e61  ction_kms_key_na
-0000ce20: 6d65 3a20 4f70 7469 6f6e 616c 5b73 7472  me: Optional[str
-0000ce30: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-0000ce40: 2020 636c 6f75 645f 6675 6e63 7469 6f6e    cloud_function
-0000ce50: 5f64 6f63 6b65 725f 7265 706f 7369 746f  _docker_reposito
-0000ce60: 7279 3a20 4f70 7469 6f6e 616c 5b73 7472  ry: Optional[str
-0000ce70: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-0000ce80: 2020 6d61 785f 6261 7463 6869 6e67 5f72    max_batching_r
-0000ce90: 6f77 733a 204f 7074 696f 6e61 6c5b 696e  ows: Optional[in
-0000cea0: 745d 203d 2031 3030 302c 0a20 2020 2020  t] = 1000,.     
-0000ceb0: 2020 2063 6c6f 7564 5f66 756e 6374 696f     cloud_functio
-0000cec0: 6e5f 7469 6d65 6f75 743a 204f 7074 696f  n_timeout: Optio
-0000ced0: 6e61 6c5b 696e 745d 203d 2036 3030 2c0a  nal[int] = 600,.
-0000cee0: 2020 2020 2020 2020 636c 6f75 645f 6675          cloud_fu
-0000cef0: 6e63 7469 6f6e 5f6d 6178 5f69 6e73 7461  nction_max_insta
-0000cf00: 6e63 6573 3a20 4f70 7469 6f6e 616c 5b69  nces: Optional[i
-0000cf10: 6e74 5d20 3d20 4e6f 6e65 2c0a 2020 2020  nt] = None,.    
-0000cf20: 2020 2020 636c 6f75 645f 6675 6e63 7469      cloud_functi
-0000cf30: 6f6e 5f76 7063 5f63 6f6e 6e65 6374 6f72  on_vpc_connector
-0000cf40: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-0000cf50: 3d20 4e6f 6e65 2c0a 2020 2020 293a 0a20  = None,.    ):. 
-0000cf60: 2020 2020 2020 2022 2222 4465 636f 7261         """Decora
-0000cf70: 746f 7220 746f 2074 7572 6e20 6120 7573  tor to turn a us
-0000cf80: 6572 2064 6566 696e 6564 2066 756e 6374  er defined funct
-0000cf90: 696f 6e20 696e 746f 2061 2042 6967 5175  ion into a BigQu
-0000cfa0: 6572 7920 7265 6d6f 7465 2066 756e 6374  ery remote funct
-0000cfb0: 696f 6e2e 2043 6865 636b 206f 7574 0a20  ion. Check out. 
-0000cfc0: 2020 2020 2020 2074 6865 2063 6f64 6520         the code 
-0000cfd0: 7361 6d70 6c65 7320 6174 3a20 6874 7470  samples at: http
-0000cfe0: 733a 2f2f 636c 6f75 642e 676f 6f67 6c65  s://cloud.google
-0000cff0: 2e63 6f6d 2f62 6967 7175 6572 792f 646f  .com/bigquery/do
-0000d000: 6373 2f72 656d 6f74 652d 6675 6e63 7469  cs/remote-functi
-0000d010: 6f6e 7323 6269 6771 7565 7279 2d64 6174  ons#bigquery-dat
-0000d020: 6166 7261 6d65 732e 0a0a 2020 2020 2020  aframes...      
-0000d030: 2020 2e2e 206e 6f74 653a 3a0a 2020 2020    .. note::.    
-0000d040: 2020 2020 2020 2020 6060 696e 7075 745f          ``input_
-0000d050: 7479 7065 733d 5365 7269 6573 6060 2073  types=Series`` s
-0000d060: 6365 6e61 7269 6f20 6973 2069 6e20 7072  cenario is in pr
-0000d070: 6576 6965 772e 0a0a 2020 2020 2020 2020  eview...        
-0000d080: 2e2e 206e 6f74 653a 3a0a 2020 2020 2020  .. note::.      
-0000d090: 2020 2020 2020 506c 6561 7365 206d 616b        Please mak
-0000d0a0: 6520 7375 7265 2066 6f6c 6c6f 7769 6e67  e sure following
-0000d0b0: 2069 7320 7365 7475 7020 6265 666f 7265   is setup before
-0000d0c0: 2075 7369 6e67 2074 6869 7320 4150 493a   using this API:
-0000d0d0: 0a0a 2020 2020 2020 2020 312e 2048 6176  ..        1. Hav
-0000d0e0: 6520 7468 6520 6265 6c6f 7720 4150 4973  e the below APIs
-0000d0f0: 2065 6e61 626c 6564 2066 6f72 2079 6f75   enabled for you
-0000d100: 7220 7072 6f6a 6563 743a 0a0a 2020 2020  r project:..    
-0000d110: 2020 2020 2020 2020 2a20 4269 6751 7565          * BigQue
-0000d120: 7279 2043 6f6e 6e65 6374 696f 6e20 4150  ry Connection AP
-0000d130: 490a 2020 2020 2020 2020 2020 2020 2a20  I.            * 
-0000d140: 436c 6f75 6420 4675 6e63 7469 6f6e 7320  Cloud Functions 
-0000d150: 4150 490a 2020 2020 2020 2020 2020 2020  API.            
-0000d160: 2a20 436c 6f75 6420 5275 6e20 4150 490a  * Cloud Run API.
-0000d170: 2020 2020 2020 2020 2020 2020 2a20 436c              * Cl
-0000d180: 6f75 6420 4275 696c 6420 4150 490a 2020  oud Build API.  
-0000d190: 2020 2020 2020 2020 2020 2a20 4172 7469            * Arti
-0000d1a0: 6661 6374 2052 6567 6973 7472 7920 4150  fact Registry AP
-0000d1b0: 490a 2020 2020 2020 2020 2020 2020 2a20  I.            * 
-0000d1c0: 436c 6f75 6420 5265 736f 7572 6365 204d  Cloud Resource M
-0000d1d0: 616e 6167 6572 2041 5049 0a0a 2020 2020  anager API..    
-0000d1e0: 2020 2020 2020 2054 6869 7320 6361 6e20         This can 
-0000d1f0: 6265 2064 6f6e 6520 6672 6f6d 2074 6865  be done from the
-0000d200: 2063 6c6f 7564 2063 6f6e 736f 6c65 2028   cloud console (
-0000d210: 6368 616e 6765 2060 5052 4f4a 4543 545f  change `PROJECT_
-0000d220: 4944 6020 746f 2079 6f75 7273 293a 0a20  ID` to yours):. 
-0000d230: 2020 2020 2020 2020 2020 6874 7470 733a            https:
-0000d240: 2f2f 636f 6e73 6f6c 652e 636c 6f75 642e  //console.cloud.
-0000d250: 676f 6f67 6c65 2e63 6f6d 2f61 7069 732f  google.com/apis/
-0000d260: 656e 6162 6c65 666c 6f77 3f61 7069 6964  enableflow?apiid
-0000d270: 3d62 6967 7175 6572 7963 6f6e 6e65 6374  =bigqueryconnect
-0000d280: 696f 6e2e 676f 6f67 6c65 6170 6973 2e63  ion.googleapis.c
-0000d290: 6f6d 2c63 6c6f 7564 6675 6e63 7469 6f6e  om,cloudfunction
-0000d2a0: 732e 676f 6f67 6c65 6170 6973 2e63 6f6d  s.googleapis.com
-0000d2b0: 2c72 756e 2e67 6f6f 676c 6561 7069 732e  ,run.googleapis.
-0000d2c0: 636f 6d2c 636c 6f75 6462 7569 6c64 2e67  com,cloudbuild.g
-0000d2d0: 6f6f 676c 6561 7069 732e 636f 6d2c 6172  oogleapis.com,ar
-0000d2e0: 7469 6661 6374 7265 6769 7374 7279 2e67  tifactregistry.g
-0000d2f0: 6f6f 676c 6561 7069 732e 636f 6d2c 636c  oogleapis.com,cl
-0000d300: 6f75 6472 6573 6f75 7263 656d 616e 6167  oudresourcemanag
-0000d310: 6572 2e67 6f6f 676c 6561 7069 732e 636f  er.googleapis.co
-0000d320: 6d26 7072 6f6a 6563 743d 5052 4f4a 4543  m&project=PROJEC
-0000d330: 545f 4944 0a0a 2020 2020 2020 2020 2020  T_ID..          
-0000d340: 204f 7220 6672 6f6d 2074 6865 2067 636c   Or from the gcl
-0000d350: 6f75 6420 434c 493a 0a0a 2020 2020 2020  oud CLI:..      
-0000d360: 2020 2020 2060 2420 6763 6c6f 7564 2073       `$ gcloud s
-0000d370: 6572 7669 6365 7320 656e 6162 6c65 2062  ervices enable b
-0000d380: 6967 7175 6572 7963 6f6e 6e65 6374 696f  igqueryconnectio
-0000d390: 6e2e 676f 6f67 6c65 6170 6973 2e63 6f6d  n.googleapis.com
-0000d3a0: 2063 6c6f 7564 6675 6e63 7469 6f6e 732e   cloudfunctions.
-0000d3b0: 676f 6f67 6c65 6170 6973 2e63 6f6d 2072  googleapis.com r
-0000d3c0: 756e 2e67 6f6f 676c 6561 7069 732e 636f  un.googleapis.co
-0000d3d0: 6d20 636c 6f75 6462 7569 6c64 2e67 6f6f  m cloudbuild.goo
-0000d3e0: 676c 6561 7069 732e 636f 6d20 6172 7469  gleapis.com arti
-0000d3f0: 6661 6374 7265 6769 7374 7279 2e67 6f6f  factregistry.goo
-0000d400: 676c 6561 7069 732e 636f 6d20 636c 6f75  gleapis.com clou
-0000d410: 6472 6573 6f75 7263 656d 616e 6167 6572  dresourcemanager
-0000d420: 2e67 6f6f 676c 6561 7069 732e 636f 6d60  .googleapis.com`
-0000d430: 0a0a 2020 2020 2020 2020 322e 2048 6176  ..        2. Hav
-0000d440: 6520 666f 6c6c 6f77 696e 6720 4941 4d20  e following IAM 
-0000d450: 726f 6c65 7320 656e 6162 6c65 6420 666f  roles enabled fo
-0000d460: 7220 796f 753a 0a0a 2020 2020 2020 2020  r you:..        
-0000d470: 2020 2020 2a20 4269 6751 7565 7279 2044      * BigQuery D
-0000d480: 6174 6120 4564 6974 6f72 2028 726f 6c65  ata Editor (role
-0000d490: 732f 6269 6771 7565 7279 2e64 6174 6145  s/bigquery.dataE
-0000d4a0: 6469 746f 7229 0a20 2020 2020 2020 2020  ditor).         
-0000d4b0: 2020 202a 2042 6967 5175 6572 7920 436f     * BigQuery Co
-0000d4c0: 6e6e 6563 7469 6f6e 2041 646d 696e 2028  nnection Admin (
-0000d4d0: 726f 6c65 732f 6269 6771 7565 7279 2e63  roles/bigquery.c
-0000d4e0: 6f6e 6e65 6374 696f 6e41 646d 696e 290a  onnectionAdmin).
-0000d4f0: 2020 2020 2020 2020 2020 2020 2a20 436c              * Cl
-0000d500: 6f75 6420 4675 6e63 7469 6f6e 7320 4465  oud Functions De
-0000d510: 7665 6c6f 7065 7220 2872 6f6c 6573 2f63  veloper (roles/c
-0000d520: 6c6f 7564 6675 6e63 7469 6f6e 732e 6465  loudfunctions.de
-0000d530: 7665 6c6f 7065 7229 0a20 2020 2020 2020  veloper).       
-0000d540: 2020 2020 202a 2053 6572 7669 6365 2041       * Service A
-0000d550: 6363 6f75 6e74 2055 7365 7220 2872 6f6c  ccount User (rol
-0000d560: 6573 2f69 616d 2e73 6572 7669 6365 4163  es/iam.serviceAc
-0000d570: 636f 756e 7455 7365 7229 206f 6e20 7468  countUser) on th
-0000d580: 6520 7365 7276 6963 6520 6163 636f 756e  e service accoun
-0000d590: 7420 6050 524f 4a45 4354 5f4e 554d 4245  t `PROJECT_NUMBE
-0000d5a0: 522d 636f 6d70 7574 6540 6465 7665 6c6f  R-compute@develo
-0000d5b0: 7065 722e 6773 6572 7669 6365 6163 636f  per.gserviceacco
-0000d5c0: 756e 742e 636f 6d60 0a20 2020 2020 2020  unt.com`.       
-0000d5d0: 2020 2020 202a 2053 746f 7261 6765 204f       * Storage O
-0000d5e0: 626a 6563 7420 5669 6577 6572 2028 726f  bject Viewer (ro
-0000d5f0: 6c65 732f 7374 6f72 6167 652e 6f62 6a65  les/storage.obje
-0000d600: 6374 5669 6577 6572 290a 2020 2020 2020  ctViewer).      
-0000d610: 2020 2020 2020 2a20 5072 6f6a 6563 7420        * Project 
-0000d620: 4941 4d20 4164 6d69 6e20 2872 6f6c 6573  IAM Admin (roles
-0000d630: 2f72 6573 6f75 7263 656d 616e 6167 6572  /resourcemanager
-0000d640: 2e70 726f 6a65 6374 4961 6d41 646d 696e  .projectIamAdmin
-0000d650: 2920 284f 6e6c 7920 7265 7175 6972 6564  ) (Only required
-0000d660: 2069 6620 7468 6520 6269 6771 7565 7279   if the bigquery
-0000d670: 2063 6f6e 6e65 6374 696f 6e20 6265 696e   connection bein
-0000d680: 6720 7573 6564 2069 7320 6e6f 7420 7072  g used is not pr
-0000d690: 652d 6372 6561 7465 6420 616e 6420 6973  e-created and is
-0000d6a0: 2063 7265 6174 6564 2064 796e 616d 6963   created dynamic
-0000d6b0: 616c 6c79 2077 6974 6820 7573 6572 2063  ally with user c
-0000d6c0: 7265 6465 6e74 6961 6c73 2e29 0a0a 2020  redentials.)..  
-0000d6d0: 2020 2020 2020 332e 2045 6974 6865 7220        3. Either 
-0000d6e0: 7468 6520 7573 6572 2068 6173 2073 6574  the user has set
-0000d6f0: 4961 6d50 6f6c 6963 7920 7072 6976 696c  IamPolicy privil
-0000d700: 6567 6520 6f6e 2074 6865 2070 726f 6a65  ege on the proje
-0000d710: 6374 2c20 6f72 2061 2042 6967 5175 6572  ct, or a BigQuer
-0000d720: 7920 636f 6e6e 6563 7469 6f6e 2069 7320  y connection is 
-0000d730: 7072 652d 6372 6561 7465 6420 7769 7468  pre-created with
-0000d740: 206e 6563 6573 7361 7279 2049 414d 2072   necessary IAM r
-0000d750: 6f6c 6520 7365 743a 0a0a 2020 2020 2020  ole set:..      
-0000d760: 2020 2020 2020 312e 2054 6f20 6372 6561        1. To crea
-0000d770: 7465 2061 2063 6f6e 6e65 6374 696f 6e2c  te a connection,
-0000d780: 2066 6f6c 6c6f 7720 6874 7470 733a 2f2f   follow https://
-0000d790: 636c 6f75 642e 676f 6f67 6c65 2e63 6f6d  cloud.google.com
-0000d7a0: 2f62 6967 7175 6572 792f 646f 6373 2f72  /bigquery/docs/r
-0000d7b0: 6566 6572 656e 6365 2f73 7461 6e64 6172  eference/standar
-0000d7c0: 642d 7371 6c2f 7265 6d6f 7465 2d66 756e  d-sql/remote-fun
-0000d7d0: 6374 696f 6e73 2363 7265 6174 655f 615f  ctions#create_a_
-0000d7e0: 636f 6e6e 6563 7469 6f6e 0a20 2020 2020  connection.     
-0000d7f0: 2020 2020 2020 2032 2e20 546f 2073 6574         2. To set
-0000d800: 2075 7020 4941 4d2c 2066 6f6c 6c6f 7720   up IAM, follow 
-0000d810: 6874 7470 733a 2f2f 636c 6f75 642e 676f  https://cloud.go
-0000d820: 6f67 6c65 2e63 6f6d 2f62 6967 7175 6572  ogle.com/bigquer
-0000d830: 792f 646f 6373 2f72 6566 6572 656e 6365  y/docs/reference
-0000d840: 2f73 7461 6e64 6172 642d 7371 6c2f 7265  /standard-sql/re
-0000d850: 6d6f 7465 2d66 756e 6374 696f 6e73 2367  mote-functions#g
-0000d860: 7261 6e74 5f70 6572 6d69 7373 696f 6e5f  rant_permission_
-0000d870: 6f6e 5f66 756e 6374 696f 6e0a 0a20 2020  on_function..   
-0000d880: 2020 2020 2020 2020 2020 2020 416c 7465              Alte
-0000d890: 726e 6174 6976 656c 792c 2074 6865 2049  rnatively, the I
-0000d8a0: 414d 2063 6f75 6c64 2061 6c73 6f20 6265  AM could also be
-0000d8b0: 2073 6574 7570 2076 6961 2074 6865 2067   setup via the g
-0000d8c0: 636c 6f75 6420 434c 493a 0a0a 2020 2020  cloud CLI:..    
-0000d8d0: 2020 2020 2020 2020 2020 2060 2420 6763             `$ gc
-0000d8e0: 6c6f 7564 2070 726f 6a65 6374 7320 6164  loud projects ad
-0000d8f0: 642d 6961 6d2d 706f 6c69 6379 2d62 696e  d-iam-policy-bin
-0000d900: 6469 6e67 2050 524f 4a45 4354 5f49 4420  ding PROJECT_ID 
-0000d910: 2d2d 6d65 6d62 6572 3d22 7365 7276 6963  --member="servic
-0000d920: 6541 6363 6f75 6e74 3a43 4f4e 4e45 4354  eAccount:CONNECT
-0000d930: 494f 4e5f 5345 5256 4943 455f 4143 434f  ION_SERVICE_ACCO
-0000d940: 554e 545f 4944 2220 2d2d 726f 6c65 3d22  UNT_ID" --role="
-0000d950: 726f 6c65 732f 7275 6e2e 696e 766f 6b65  roles/run.invoke
-0000d960: 7222 602e 0a0a 2020 2020 2020 2020 4172  r"`...        Ar
-0000d970: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0000d980: 696e 7075 745f 7479 7065 7320 2874 7970  input_types (typ
-0000d990: 6520 6f72 2073 6571 7565 6e63 6528 7479  e or sequence(ty
-0000d9a0: 7065 2929 3a0a 2020 2020 2020 2020 2020  pe)):.          
-0000d9b0: 2020 2020 2020 466f 7220 7363 616c 6172        For scalar
-0000d9c0: 2075 7365 7220 6465 6669 6e65 6420 6675   user defined fu
-0000d9d0: 6e63 7469 6f6e 2069 7420 7368 6f75 6c64  nction it should
-0000d9e0: 2062 6520 7468 6520 696e 7075 7420 7479   be the input ty
-0000d9f0: 7065 206f 720a 2020 2020 2020 2020 2020  pe or.          
-0000da00: 2020 2020 2020 7365 7175 656e 6365 206f        sequence o
-0000da10: 6620 696e 7075 7420 7479 7065 732e 2046  f input types. F
-0000da20: 6f72 2072 6f77 2070 726f 6365 7373 696e  or row processin
-0000da30: 6720 7573 6572 2064 6566 696e 6564 2066  g user defined f
-0000da40: 756e 6374 696f 6e2c 0a20 2020 2020 2020  unction,.       
-0000da50: 2020 2020 2020 2020 2074 7970 6520 6053           type `S
-0000da60: 6572 6965 7360 2073 686f 756c 6420 6265  eries` should be
-0000da70: 2073 7065 6369 6669 6564 2e0a 2020 2020   specified..    
-0000da80: 2020 2020 2020 2020 6f75 7470 7574 5f74          output_t
-0000da90: 7970 6520 2874 7970 6529 3a0a 2020 2020  ype (type):.    
-0000daa0: 2020 2020 2020 2020 2020 2020 4461 7461              Data
-0000dab0: 2074 7970 6520 6f66 2074 6865 206f 7574   type of the out
-0000dac0: 7075 7420 696e 2074 6865 2075 7365 7220  put in the user 
-0000dad0: 6465 6669 6e65 6420 6675 6e63 7469 6f6e  defined function
-0000dae0: 2e0a 2020 2020 2020 2020 2020 2020 6461  ..            da
-0000daf0: 7461 7365 7420 2873 7472 2c20 4f70 7469  taset (str, Opti
-0000db00: 6f6e 616c 293a 0a20 2020 2020 2020 2020  onal):.         
-0000db10: 2020 2020 2020 2044 6174 6173 6574 2069         Dataset i
-0000db20: 6e20 7768 6963 6820 746f 2063 7265 6174  n which to creat
-0000db30: 6520 6120 4269 6751 7565 7279 2072 656d  e a BigQuery rem
-0000db40: 6f74 6520 6675 6e63 7469 6f6e 2e20 4974  ote function. It
-0000db50: 2073 686f 756c 6420 6265 2069 6e0a 2020   should be in.  
-0000db60: 2020 2020 2020 2020 2020 2020 2020 603c                `<
-0000db70: 7072 6f6a 6563 745f 6964 3e2e 3c64 6174  project_id>.<dat
-0000db80: 6173 6574 5f6e 616d 653e 6020 6f72 2060  aset_name>` or `
-0000db90: 3c64 6174 6173 6574 5f6e 616d 653e 6020  <dataset_name>` 
-0000dba0: 666f 726d 6174 2e20 4966 2074 6869 730a  format. If this.
-0000dbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbc0: 7061 7261 6d65 7465 7220 6973 206e 6f74  parameter is not
-0000dbd0: 2070 726f 7669 6465 6420 7468 656e 2073   provided then s
-0000dbe0: 6573 7369 6f6e 2064 6174 6173 6574 2069  ession dataset i
-0000dbf0: 6420 6973 2075 7365 642e 0a20 2020 2020  d is used..     
-0000dc00: 2020 2020 2020 2062 6967 7175 6572 795f         bigquery_
-0000dc10: 636f 6e6e 6563 7469 6f6e 2028 7374 722c  connection (str,
-0000dc20: 204f 7074 696f 6e61 6c29 3a0a 2020 2020   Optional):.    
-0000dc30: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
-0000dc40: 206f 6620 7468 6520 4269 6751 7565 7279   of the BigQuery
-0000dc50: 2063 6f6e 6e65 6374 696f 6e2e 2059 6f75   connection. You
-0000dc60: 2073 686f 756c 6420 6569 7468 6572 2068   should either h
-0000dc70: 6176 6520 7468 650a 2020 2020 2020 2020  ave the.        
-0000dc80: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
-0000dc90: 6f6e 2061 6c72 6561 6479 2063 7265 6174  on already creat
-0000dca0: 6564 2069 6e20 7468 6520 606c 6f63 6174  ed in the `locat
-0000dcb0: 696f 6e60 2079 6f75 2068 6176 6520 6368  ion` you have ch
-0000dcc0: 6f73 656e 2c20 6f72 0a20 2020 2020 2020  osen, or.       
-0000dcd0: 2020 2020 2020 2020 2079 6f75 2073 686f           you sho
-0000dce0: 756c 6420 6861 7665 2074 6865 2050 726f  uld have the Pro
-0000dcf0: 6a65 6374 2049 414d 2041 646d 696e 2072  ject IAM Admin r
-0000dd00: 6f6c 6520 746f 2065 6e61 626c 6520 7468  ole to enable th
-0000dd10: 6520 7365 7276 6963 650a 2020 2020 2020  e service.      
-0000dd20: 2020 2020 2020 2020 2020 746f 2063 7265            to cre
-0000dd30: 6174 6520 7468 6520 636f 6e6e 6563 7469  ate the connecti
-0000dd40: 6f6e 2066 6f72 2079 6f75 2069 6620 796f  on for you if yo
-0000dd50: 7520 6e65 6564 2069 742e 2049 6620 7468  u need it. If th
-0000dd60: 6973 2070 6172 616d 6574 6572 2069 730a  is parameter is.
-0000dd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd80: 6e6f 7420 7072 6f76 6964 6564 2074 6865  not provided the
-0000dd90: 6e20 7468 6520 4269 6751 7565 7279 2063  n the BigQuery c
-0000dda0: 6f6e 6e65 6374 696f 6e20 6672 6f6d 2074  onnection from t
-0000ddb0: 6865 2073 6573 7369 6f6e 2069 7320 7573  he session is us
-0000ddc0: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-0000ddd0: 7265 7573 6520 2862 6f6f 6c2c 204f 7074  reuse (bool, Opt
-0000dde0: 696f 6e61 6c29 3a0a 2020 2020 2020 2020  ional):.        
-0000ddf0: 2020 2020 2020 2020 5265 7573 6520 7468          Reuse th
-0000de00: 6520 7265 6d6f 7465 2066 756e 6374 696f  e remote functio
-0000de10: 6e20 6966 2061 6c72 6561 6479 2065 7869  n if already exi
-0000de20: 7374 732e 0a20 2020 2020 2020 2020 2020  sts..           
-0000de30: 2020 2020 2060 5472 7565 6020 6279 2064       `True` by d
-0000de40: 6566 6175 6c74 2c20 7768 6963 6820 7769  efault, which wi
-0000de50: 6c6c 2072 6573 756c 7420 696e 2072 6575  ll result in reu
-0000de60: 7369 6e67 2061 6e20 6578 6973 7469 6e67  sing an existing
-0000de70: 2072 656d 6f74 650a 2020 2020 2020 2020   remote.        
-0000de80: 2020 2020 2020 2020 6675 6e63 7469 6f6e          function
-0000de90: 2061 6e64 2063 6f72 7265 7370 6f6e 6469   and correspondi
-0000dea0: 6e67 2063 6c6f 7564 2066 756e 6374 696f  ng cloud functio
-0000deb0: 6e20 2869 6620 616e 7929 2074 6861 7420  n (if any) that 
-0000dec0: 7761 730a 2020 2020 2020 2020 2020 2020  was.            
-0000ded0: 2020 2020 7072 6576 696f 7573 6c79 2063      previously c
-0000dee0: 7265 6174 6564 2066 6f72 2074 6865 2073  reated for the s
-0000def0: 616d 6520 7564 662e 0a20 2020 2020 2020  ame udf..       
-0000df00: 2020 2020 2020 2020 2053 6574 7469 6e67           Setting
-0000df10: 2069 7420 746f 2060 4661 6c73 6560 2077   it to `False` w
-0000df20: 6f75 6c64 2066 6f72 6365 2063 7265 6174  ould force creat
-0000df30: 696e 6720 6120 756e 6971 7565 2072 656d  ing a unique rem
-0000df40: 6f74 6520 6675 6e63 7469 6f6e 2e0a 2020  ote function..  
-0000df50: 2020 2020 2020 2020 2020 2020 2020 4966                If
-0000df60: 2074 6865 2072 6571 7569 7265 6420 7265   the required re
-0000df70: 6d6f 7465 2066 756e 6374 696f 6e20 646f  mote function do
-0000df80: 6573 206e 6f74 2065 7869 7374 2074 6865  es not exist the
-0000df90: 6e20 6974 2077 6f75 6c64 2062 650a 2020  n it would be.  
-0000dfa0: 2020 2020 2020 2020 2020 2020 2020 6372                cr
-0000dfb0: 6561 7465 6420 6972 7265 7370 6563 7469  eated irrespecti
-0000dfc0: 7665 206f 6620 7468 6973 2070 6172 616d  ve of this param
-0000dfd0: 2e0a 2020 2020 2020 2020 2020 2020 6e61  ..            na
-0000dfe0: 6d65 2028 7374 722c 204f 7074 696f 6e61  me (str, Optiona
-0000dff0: 6c29 3a0a 2020 2020 2020 2020 2020 2020  l):.            
-0000e000: 2020 2020 4578 706c 6963 6974 206e 616d      Explicit nam
-0000e010: 6520 6f66 2074 6865 2070 6572 7369 7374  e of the persist
-0000e020: 6564 2042 6967 5175 6572 7920 7265 6d6f  ed BigQuery remo
-0000e030: 7465 2066 756e 6374 696f 6e2e 2055 7365  te function. Use
-0000e040: 2069 7420 7769 7468 0a20 2020 2020 2020   it with.       
-0000e050: 2020 2020 2020 2020 2063 6175 7469 6f6e           caution
-0000e060: 2c20 6265 6361 7573 6520 7477 6f20 7573  , because two us
-0000e070: 6572 7320 776f 726b 696e 6720 696e 2074  ers working in t
-0000e080: 6865 2073 616d 6520 7072 6f6a 6563 7420  he same project 
-0000e090: 616e 6420 6461 7461 7365 740a 2020 2020  and dataset.    
-0000e0a0: 2020 2020 2020 2020 2020 2020 636f 756c              coul
-0000e0b0: 6420 6f76 6572 7772 6974 6520 6561 6368  d overwrite each
-0000e0c0: 206f 7468 6572 2773 2072 656d 6f74 6520   other's remote 
-0000e0d0: 6675 6e63 7469 6f6e 7320 6966 2074 6865  functions if the
-0000e0e0: 7920 7573 6520 7468 6520 7361 6d65 0a20  y use the same. 
-0000e0f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000e100: 6572 7369 7374 656e 7420 6e61 6d65 2e0a  ersistent name..
-0000e110: 2020 2020 2020 2020 2020 2020 7061 636b              pack
-0000e120: 6167 6573 2028 7374 725b 5d2c 204f 7074  ages (str[], Opt
-0000e130: 696f 6e61 6c29 3a0a 2020 2020 2020 2020  ional):.        
-0000e140: 2020 2020 2020 2020 4578 706c 6963 6974          Explicit
-0000e150: 206e 616d 6520 6f66 2074 6865 2065 7874   name of the ext
-0000e160: 6572 6e61 6c20 7061 636b 6167 6520 6465  ernal package de
-0000e170: 7065 6e64 656e 6369 6573 2e20 4561 6368  pendencies. Each
-0000e180: 2064 6570 656e 6465 6e63 790a 2020 2020   dependency.    
-0000e190: 2020 2020 2020 2020 2020 2020 6973 2061              is a
-0000e1a0: 6464 6564 2074 6f20 7468 6520 6072 6571  dded to the `req
-0000e1b0: 7569 7265 6d65 6e74 732e 7478 7460 2061  uirements.txt` a
-0000e1c0: 7320 6973 2c20 616e 6420 6361 6e20 6265  s is, and can be
-0000e1d0: 206f 6620 7468 6520 666f 726d 0a20 2020   of the form.   
-0000e1e0: 2020 2020 2020 2020 2020 2020 2073 7570               sup
-0000e1f0: 706f 7274 6564 2069 6e20 6874 7470 733a  ported in https:
-0000e200: 2f2f 7069 702e 7079 7061 2e69 6f2f 656e  //pip.pypa.io/en
-0000e210: 2f73 7461 626c 652f 7265 6665 7265 6e63  /stable/referenc
-0000e220: 652f 7265 7175 6972 656d 656e 7473 2d66  e/requirements-f
-0000e230: 696c 652d 666f 726d 6174 2f2e 0a20 2020  ile-format/..   
-0000e240: 2020 2020 2020 2020 2063 6c6f 7564 5f66           cloud_f
-0000e250: 756e 6374 696f 6e5f 7365 7276 6963 655f  unction_service_
-0000e260: 6163 636f 756e 7420 2873 7472 2c20 4f70  account (str, Op
-0000e270: 7469 6f6e 616c 293a 0a20 2020 2020 2020  tional):.       
-0000e280: 2020 2020 2020 2020 2053 6572 7669 6365           Service
-0000e290: 2061 6363 6f75 6e74 2074 6f20 7573 6520   account to use 
-0000e2a0: 666f 7220 7468 6520 636c 6f75 6420 6675  for the cloud fu
-0000e2b0: 6e63 7469 6f6e 732e 2049 6620 6e6f 7420  nctions. If not 
-0000e2c0: 7072 6f76 6964 6564 0a20 2020 2020 2020  provided.       
-0000e2d0: 2020 2020 2020 2020 2074 6865 6e20 7468           then th
-0000e2e0: 6520 6465 6661 756c 7420 7365 7276 6963  e default servic
-0000e2f0: 6520 6163 636f 756e 7420 776f 756c 6420  e account would 
-0000e300: 6265 2075 7365 642e 2053 6565 0a20 2020  be used. See.   
-0000e310: 2020 2020 2020 2020 2020 2020 2068 7474               htt
-0000e320: 7073 3a2f 2f63 6c6f 7564 2e67 6f6f 676c  ps://cloud.googl
-0000e330: 652e 636f 6d2f 6675 6e63 7469 6f6e 732f  e.com/functions/
-0000e340: 646f 6373 2f73 6563 7572 696e 672f 6675  docs/securing/fu
-0000e350: 6e63 7469 6f6e 2d69 6465 6e74 6974 790a  nction-identity.
-0000e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e370: 666f 7220 6d6f 7265 2064 6574 6169 6c73  for more details
-0000e380: 2e20 506c 6561 7365 206d 616b 6520 7375  . Please make su
-0000e390: 7265 2074 6865 2073 6572 7669 6365 2061  re the service a
-0000e3a0: 6363 6f75 6e74 2068 6173 2074 6865 0a20  ccount has the. 
-0000e3b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000e3c0: 6563 6573 7361 7279 2049 414d 2070 6572  ecessary IAM per
-0000e3d0: 6d69 7373 696f 6e73 2063 6f6e 6669 6775  missions configu
-0000e3e0: 7265 6420 6173 2064 6573 6372 6962 6564  red as described
-0000e3f0: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
-0000e400: 2020 2020 6874 7470 733a 2f2f 636c 6f75      https://clou
-0000e410: 642e 676f 6f67 6c65 2e63 6f6d 2f66 756e  d.google.com/fun
-0000e420: 6374 696f 6e73 2f64 6f63 732f 7265 6665  ctions/docs/refe
-0000e430: 7265 6e63 652f 6961 6d2f 726f 6c65 7323  rence/iam/roles#
-0000e440: 6164 6469 7469 6f6e 616c 2d63 6f6e 6669  additional-confi
-0000e450: 6775 7261 7469 6f6e 2e0a 2020 2020 2020  guration..      
-0000e460: 2020 2020 2020 636c 6f75 645f 6675 6e63        cloud_func
-0000e470: 7469 6f6e 5f6b 6d73 5f6b 6579 5f6e 616d  tion_kms_key_nam
-0000e480: 6520 2873 7472 2c20 4f70 7469 6f6e 616c  e (str, Optional
-0000e490: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000e4a0: 2020 2043 7573 746f 6d65 7220 6d61 6e61     Customer mana
-0000e4b0: 6765 6420 656e 6372 7970 7469 6f6e 206b  ged encryption k
-0000e4c0: 6579 2074 6f20 7072 6f74 6563 7420 636c  ey to protect cl
-0000e4d0: 6f75 6420 6675 6e63 7469 6f6e 7320 616e  oud functions an
-0000e4e0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-0000e4f0: 2020 7265 6c61 7465 6420 6461 7461 2061    related data a
-0000e500: 7420 7265 7374 2e20 5468 6973 2069 7320  t rest. This is 
-0000e510: 6f66 2074 6865 2066 6f72 6d61 740a 2020  of the format.  
-0000e520: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000e530: 6f6a 6563 7473 2f50 524f 4a45 4354 5f49  ojects/PROJECT_I
-0000e540: 442f 6c6f 6361 7469 6f6e 732f 4c4f 4341  D/locations/LOCA
-0000e550: 5449 4f4e 2f6b 6579 5269 6e67 732f 4b45  TION/keyRings/KE
-0000e560: 5952 494e 472f 6372 7970 746f 4b65 7973  YRING/cryptoKeys
-0000e570: 2f4b 4559 2e0a 2020 2020 2020 2020 2020  /KEY..          
-0000e580: 2020 2020 2020 5265 6164 2068 7474 7073        Read https
-0000e590: 3a2f 2f63 6c6f 7564 2e67 6f6f 676c 652e  ://cloud.google.
-0000e5a0: 636f 6d2f 6675 6e63 7469 6f6e 732f 646f  com/functions/do
-0000e5b0: 6373 2f73 6563 7572 696e 672f 636d 656b  cs/securing/cmek
-0000e5c0: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
-0000e5d0: 2020 2020 206d 6f72 6520 6465 7461 696c       more detail
-0000e5e0: 7320 696e 636c 7564 696e 6720 6772 616e  s including gran
-0000e5f0: 7469 6e67 206e 6563 6573 7361 7279 2073  ting necessary s
-0000e600: 6572 7669 6365 2061 6363 6f75 6e74 730a  ervice accounts.
-0000e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e620: 6163 6365 7373 2074 6f20 7468 6520 6b65  access to the ke
-0000e630: 792e 0a20 2020 2020 2020 2020 2020 2063  y..            c
-0000e640: 6c6f 7564 5f66 756e 6374 696f 6e5f 646f  loud_function_do
-0000e650: 636b 6572 5f72 6570 6f73 6974 6f72 7920  cker_repository 
-0000e660: 2873 7472 2c20 4f70 7469 6f6e 616c 293a  (str, Optional):
-0000e670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e680: 2044 6f63 6b65 7220 7265 706f 7369 746f   Docker reposito
-0000e690: 7279 2063 7265 6174 6564 2077 6974 6820  ry created with 
-0000e6a0: 7468 6520 7361 6d65 2065 6e63 7279 7074  the same encrypt
-0000e6b0: 696f 6e20 6b65 7920 6173 0a20 2020 2020  ion key as.     
-0000e6c0: 2020 2020 2020 2020 2020 2060 636c 6f75             `clou
-0000e6d0: 645f 6675 6e63 7469 6f6e 5f6b 6d73 5f6b  d_function_kms_k
-0000e6e0: 6579 5f6e 616d 6560 2074 6f20 7374 6f72  ey_name` to stor
-0000e6f0: 6520 656e 6372 7970 7465 6420 6172 7469  e encrypted arti
-0000e700: 6661 6374 730a 2020 2020 2020 2020 2020  facts.          
-0000e710: 2020 2020 2020 6372 6561 7465 6420 746f        created to
-0000e720: 2073 7570 706f 7274 2074 6865 2063 6c6f   support the clo
-0000e730: 7564 2066 756e 6374 696f 6e2e 2054 6869  ud function. Thi
-0000e740: 7320 6973 206f 6620 7468 6520 666f 726d  s is of the form
-0000e750: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
-0000e760: 2020 2070 726f 6a65 6374 732f 5052 4f4a     projects/PROJ
-0000e770: 4543 545f 4944 2f6c 6f63 6174 696f 6e73  ECT_ID/locations
-0000e780: 2f4c 4f43 4154 494f 4e2f 7265 706f 7369  /LOCATION/reposi
-0000e790: 746f 7269 6573 2f52 4550 4f53 4954 4f52  tories/REPOSITOR
-0000e7a0: 595f 4e41 4d45 2e0a 2020 2020 2020 2020  Y_NAME..        
-0000e7b0: 2020 2020 2020 2020 466f 7220 6d6f 7265          For more
-0000e7c0: 2064 6574 6169 6c73 2073 6565 0a20 2020   details see.   
-0000e7d0: 2020 2020 2020 2020 2020 2020 2068 7474               htt
-0000e7e0: 7073 3a2f 2f63 6c6f 7564 2e67 6f6f 676c  ps://cloud.googl
-0000e7f0: 652e 636f 6d2f 6675 6e63 7469 6f6e 732f  e.com/functions/
-0000e800: 646f 6373 2f73 6563 7572 696e 672f 636d  docs/securing/cm
-0000e810: 656b 2362 6566 6f72 655f 796f 755f 6265  ek#before_you_be
-0000e820: 6769 6e2e 0a20 2020 2020 2020 2020 2020  gin..           
-0000e830: 206d 6178 5f62 6174 6368 696e 675f 726f   max_batching_ro
-0000e840: 7773 2028 696e 742c 204f 7074 696f 6e61  ws (int, Optiona
-0000e850: 6c29 3a0a 2020 2020 2020 2020 2020 2020  l):.            
-0000e860: 2020 2020 5468 6520 6d61 7869 6d75 6d20      The maximum 
-0000e870: 6e75 6d62 6572 206f 6620 726f 7773 2074  number of rows t
-0000e880: 6f20 6265 2062 6174 6368 6564 2066 6f72  o be batched for
-0000e890: 2070 726f 6365 7373 696e 6720 696e 2074   processing in t
-0000e8a0: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
-0000e8b0: 2020 2042 5120 7265 6d6f 7465 2066 756e     BQ remote fun
-0000e8c0: 6374 696f 6e2e 2044 6566 6175 6c74 2076  ction. Default v
-0000e8d0: 616c 7565 2069 7320 3130 3030 2e20 4120  alue is 1000. A 
-0000e8e0: 6c6f 7765 7220 6e75 6d62 6572 2063 616e  lower number can
-0000e8f0: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
-0000e900: 2020 2020 7061 7373 6564 2074 6f20 6176      passed to av
-0000e910: 6f69 6420 7469 6d65 6f75 7473 2069 6e20  oid timeouts in 
-0000e920: 6361 7365 2074 6865 2075 7365 7220 636f  case the user co
-0000e930: 6465 2069 7320 746f 6f20 636f 6d70 6c65  de is too comple
-0000e940: 7820 746f 0a20 2020 2020 2020 2020 2020  x to.           
-0000e950: 2020 2020 2070 726f 6365 7373 206c 6172       process lar
-0000e960: 6765 206e 756d 6265 7220 6f66 2072 6f77  ge number of row
-0000e970: 7320 6661 7374 2065 6e6f 7567 682e 2041  s fast enough. A
-0000e980: 2068 6967 6865 7220 6e75 6d62 6572 2063   higher number c
-0000e990: 616e 2062 650a 2020 2020 2020 2020 2020  an be.          
-0000e9a0: 2020 2020 2020 7573 6564 2074 6f20 696e        used to in
-0000e9b0: 6372 6561 7365 2074 6872 6f75 6768 7075  crease throughpu
-0000e9c0: 7420 696e 2063 6173 6520 7468 6520 7573  t in case the us
-0000e9d0: 6572 2063 6f64 6520 6973 2066 6173 7420  er code is fast 
-0000e9e0: 656e 6f75 6768 2e0a 2020 2020 2020 2020  enough..        
-0000e9f0: 2020 2020 2020 2020 604e 6f6e 6560 2063          `None` c
-0000ea00: 616e 2062 6520 7061 7373 6564 2074 6f20  an be passed to 
-0000ea10: 6c65 7420 4251 2072 656d 6f74 6520 6675  let BQ remote fu
-0000ea20: 6e63 7469 6f6e 7320 7365 7276 6963 6520  nctions service 
-0000ea30: 6170 706c 790a 2020 2020 2020 2020 2020  apply.          
-0000ea40: 2020 2020 2020 6465 6661 756c 7420 6261        default ba
-0000ea50: 7463 6869 6e67 2e20 5365 6520 666f 7220  tching. See for 
-0000ea60: 6d6f 7265 2064 6574 6169 6c73 0a20 2020  more details.   
-0000ea70: 2020 2020 2020 2020 2020 2020 2068 7474               htt
-0000ea80: 7073 3a2f 2f63 6c6f 7564 2e67 6f6f 676c  ps://cloud.googl
-0000ea90: 652e 636f 6d2f 6269 6771 7565 7279 2f64  e.com/bigquery/d
-0000eaa0: 6f63 732f 7265 6d6f 7465 2d66 756e 6374  ocs/remote-funct
-0000eab0: 696f 6e73 236c 696d 6974 696e 675f 6e75  ions#limiting_nu
-0000eac0: 6d62 6572 5f6f 665f 726f 7773 5f69 6e5f  mber_of_rows_in_
-0000ead0: 615f 6261 7463 685f 7265 7175 6573 742e  a_batch_request.
-0000eae0: 0a20 2020 2020 2020 2020 2020 2063 6c6f  .            clo
-0000eaf0: 7564 5f66 756e 6374 696f 6e5f 7469 6d65  ud_function_time
-0000eb00: 6f75 7420 2869 6e74 2c20 4f70 7469 6f6e  out (int, Option
-0000eb10: 616c 293a 0a20 2020 2020 2020 2020 2020  al):.           
-0000eb20: 2020 2020 2054 6865 206d 6178 696d 756d       The maximum
-0000eb30: 2061 6d6f 756e 7420 6f66 2074 696d 6520   amount of time 
-0000eb40: 2869 6e20 7365 636f 6e64 7329 2042 6967  (in seconds) Big
-0000eb50: 5175 6572 7920 7368 6f75 6c64 2077 6169  Query should wai
-0000eb60: 7420 666f 720a 2020 2020 2020 2020 2020  t for.          
-0000eb70: 2020 2020 2020 7468 6520 636c 6f75 6420        the cloud 
-0000eb80: 6675 6e63 7469 6f6e 2074 6f20 7265 7475  function to retu
-0000eb90: 726e 2061 2072 6573 706f 6e73 652e 2053  rn a response. S
-0000eba0: 6565 2066 6f72 206d 6f72 6520 6465 7461  ee for more deta
-0000ebb0: 696c 730a 2020 2020 2020 2020 2020 2020  ils.            
-0000ebc0: 2020 2020 6874 7470 733a 2f2f 636c 6f75      https://clou
-0000ebd0: 642e 676f 6f67 6c65 2e63 6f6d 2f66 756e  d.google.com/fun
-0000ebe0: 6374 696f 6e73 2f64 6f63 732f 636f 6e66  ctions/docs/conf
-0000ebf0: 6967 7572 696e 672f 7469 6d65 6f75 742e  iguring/timeout.
-0000ec00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ec10: 2050 6c65 6173 6520 6e6f 7465 2074 6861   Please note tha
-0000ec20: 7420 6576 656e 2074 686f 7567 6820 7468  t even though th
-0000ec30: 6520 636c 6f75 6420 6675 6e63 7469 6f6e  e cloud function
-0000ec40: 2028 326e 6420 6765 6e29 2069 7473 656c   (2nd gen) itsel
-0000ec50: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
-0000ec60: 2020 616c 6c6f 7773 2073 6565 7469 6e67    allows seeting
-0000ec70: 2075 7020 746f 2036 3020 6d69 6e75 7465   up to 60 minute
-0000ec80: 7320 6f66 2074 696d 656f 7574 2c20 4269  s of timeout, Bi
-0000ec90: 6751 7565 7279 2072 656d 6f74 650a 2020  gQuery remote.  
-0000eca0: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-0000ecb0: 6e63 7469 6f6e 2063 616e 2077 6169 7420  nction can wait 
-0000ecc0: 6f6e 6c79 2075 7020 746f 2032 3020 6d69  only up to 20 mi
-0000ecd0: 6e75 7465 732c 2073 6565 2066 6f72 206d  nutes, see for m
-0000ece0: 6f72 6520 6465 7461 696c 730a 2020 2020  ore details.    
-0000ecf0: 2020 2020 2020 2020 2020 2020 6874 7470              http
-0000ed00: 733a 2f2f 636c 6f75 642e 676f 6f67 6c65  s://cloud.google
-0000ed10: 2e63 6f6d 2f62 6967 7175 6572 792f 7175  .com/bigquery/qu
-0000ed20: 6f74 6173 2372 656d 6f74 655f 6675 6e63  otas#remote_func
-0000ed30: 7469 6f6e 5f6c 696d 6974 732e 0a20 2020  tion_limits..   
-0000ed40: 2020 2020 2020 2020 2020 2020 2042 7920               By 
-0000ed50: 6465 6661 756c 7420 4269 6751 7565 7279  default BigQuery
-0000ed60: 2044 6174 6146 7261 6d65 7320 7573 6573   DataFrames uses
-0000ed70: 2061 2031 3020 6d69 6e75 7465 2074 696d   a 10 minute tim
-0000ed80: 656f 7574 2e20 604e 6f6e 6560 0a20 2020  eout. `None`.   
-0000ed90: 2020 2020 2020 2020 2020 2020 2063 616e               can
-0000eda0: 2062 6520 7061 7373 6564 2074 6f20 6c65   be passed to le
-0000edb0: 7420 7468 6520 636c 6f75 6420 6675 6e63  t the cloud func
-0000edc0: 7469 6f6e 7320 6465 6661 756c 7420 7469  tions default ti
-0000edd0: 6d65 6f75 7420 7461 6b65 2065 6666 6563  meout take effec
-0000ede0: 742e 0a20 2020 2020 2020 2020 2020 2063  t..            c
-0000edf0: 6c6f 7564 5f66 756e 6374 696f 6e5f 6d61  loud_function_ma
-0000ee00: 785f 696e 7374 616e 6365 7320 2869 6e74  x_instances (int
-0000ee10: 2c20 4f70 7469 6f6e 616c 293a 0a20 2020  , Optional):.   
-0000ee20: 2020 2020 2020 2020 2020 2020 2054 6865               The
-0000ee30: 206d 6178 696d 756d 6d20 696e 7374 616e   maximumm instan
-0000ee40: 6365 2063 6f75 6e74 2066 6f72 2074 6865  ce count for the
-0000ee50: 2063 6c6f 7564 2066 756e 6374 696f 6e20   cloud function 
-0000ee60: 6372 6561 7465 642e 2054 6869 730a 2020  created. This.  
-0000ee70: 2020 2020 2020 2020 2020 2020 2020 6361                ca
-0000ee80: 6e20 6265 2075 7365 6420 746f 2063 6f6e  n be used to con
-0000ee90: 7472 6f6c 2068 6f77 206d 616e 7920 636c  trol how many cl
-0000eea0: 6f75 6420 6675 6e63 7469 6f6e 2069 6e73  oud function ins
-0000eeb0: 7461 6e63 6573 2063 616e 2062 650a 2020  tances can be.  
-0000eec0: 2020 2020 2020 2020 2020 2020 2020 6163                ac
-0000eed0: 7469 7665 2061 7420 6d61 7820 6174 2061  tive at max at a
-0000eee0: 6e79 2067 6976 656e 2070 6f69 6e74 206f  ny given point o
-0000eef0: 6620 7469 6d65 2e20 4c6f 7765 7220 7365  f time. Lower se
-0000ef00: 7474 696e 6720 6361 6e20 6865 6c70 0a20  tting can help. 
-0000ef10: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000ef20: 6f6e 7472 6f6c 2074 6865 2073 7069 6b65  ontrol the spike
-0000ef30: 2069 6e20 7468 6520 6269 6c6c 696e 672e   in the billing.
-0000ef40: 2048 6967 6865 7220 7365 7474 696e 6720   Higher setting 
-0000ef50: 6361 6e20 6865 6c70 0a20 2020 2020 2020  can help.       
-0000ef60: 2020 2020 2020 2020 2073 7570 706f 7274           support
-0000ef70: 2070 726f 6365 7373 696e 6720 6c61 7267   processing larg
-0000ef80: 6572 2073 6361 6c65 2064 6174 612e 2057  er scale data. W
-0000ef90: 6865 6e20 6e6f 7420 7370 6563 6966 6965  hen not specifie
-0000efa0: 642c 2063 6c6f 7564 0a20 2020 2020 2020  d, cloud.       
-0000efb0: 2020 2020 2020 2020 2066 756e 6374 696f           functio
-0000efc0: 6e27 7320 6465 6661 756c 7420 7365 7474  n's default sett
-0000efd0: 696e 6720 6170 706c 6965 732e 2046 6f72  ing applies. For
-0000efe0: 206d 6f72 6520 6465 7461 696c 7320 7365   more details se
-0000eff0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000f000: 2020 6874 7470 733a 2f2f 636c 6f75 642e    https://cloud.
-0000f010: 676f 6f67 6c65 2e63 6f6d 2f66 756e 6374  google.com/funct
-0000f020: 696f 6e73 2f64 6f63 732f 636f 6e66 6967  ions/docs/config
-0000f030: 7572 696e 672f 6d61 782d 696e 7374 616e  uring/max-instan
-0000f040: 6365 732e 0a20 2020 2020 2020 2020 2020  ces..           
-0000f050: 2063 6c6f 7564 5f66 756e 6374 696f 6e5f   cloud_function_
-0000f060: 7670 635f 636f 6e6e 6563 746f 7220 2873  vpc_connector (s
-0000f070: 7472 2c20 4f70 7469 6f6e 616c 293a 0a20  tr, Optional):. 
-0000f080: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-0000f090: 6865 2056 5043 2063 6f6e 6e65 6374 6f72  he VPC connector
-0000f0a0: 2079 6f75 2077 6f75 6c64 206c 696b 6520   you would like 
-0000f0b0: 746f 2063 6f6e 6669 6775 7265 2066 6f72  to configure for
-0000f0c0: 2079 6f75 7220 636c 6f75 640a 2020 2020   your cloud.    
-0000f0d0: 2020 2020 2020 2020 2020 2020 6675 6e63              func
-0000f0e0: 7469 6f6e 2e20 5468 6973 2069 7320 7573  tion. This is us
-0000f0f0: 6566 756c 2069 6620 796f 7572 2063 6f64  eful if your cod
-0000f100: 6520 6e65 6564 7320 6163 6365 7373 2074  e needs access t
-0000f110: 6f20 6461 7461 206f 720a 2020 2020 2020  o data or.      
-0000f120: 2020 2020 2020 2020 2020 7365 7276 6963            servic
-0000f130: 6528 7329 2074 6861 7420 6172 6520 6f6e  e(s) that are on
-0000f140: 2061 2056 5043 206e 6574 776f 726b 2e20   a VPC network. 
-0000f150: 5365 6520 666f 7220 6d6f 7265 2064 6574  See for more det
-0000f160: 6169 6c73 0a20 2020 2020 2020 2020 2020  ails.           
-0000f170: 2020 2020 2068 7474 7073 3a2f 2f63 6c6f       https://clo
-0000f180: 7564 2e67 6f6f 676c 652e 636f 6d2f 6675  ud.google.com/fu
-0000f190: 6e63 7469 6f6e 732f 646f 6373 2f6e 6574  nctions/docs/net
-0000f1a0: 776f 726b 696e 672f 636f 6e6e 6563 7469  working/connecti
-0000f1b0: 6e67 2d76 7063 2e0a 2020 2020 2020 2020  ng-vpc..        
-0000f1c0: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
-0000f1d0: 2020 2020 2063 616c 6c61 626c 653a 2041       callable: A
-0000f1e0: 2072 656d 6f74 6520 6675 6e63 7469 6f6e   remote function
-0000f1f0: 206f 626a 6563 7420 706f 696e 7469 6e67   object pointing
-0000f200: 2074 6f20 7468 6520 636c 6f75 6420 6173   to the cloud as
-0000f210: 7365 7473 2063 7265 6174 6564 0a20 2020  sets created.   
-0000f220: 2020 2020 2020 2020 2069 6e20 7468 6520           in the 
-0000f230: 6261 636b 6772 6f75 6e64 2074 6f20 7375  background to su
-0000f240: 7070 6f72 7420 7468 6520 7265 6d6f 7465  pport the remote
-0000f250: 2065 7865 6375 7469 6f6e 2e20 5468 6520   execution. The 
-0000f260: 636c 6f75 6420 6173 7365 7473 2063 616e  cloud assets can
-0000f270: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
-0000f280: 6c6f 6361 7465 6420 7468 726f 7567 6820  located through 
-0000f290: 7468 6520 666f 6c6c 6f77 696e 6720 7072  the following pr
-0000f2a0: 6f70 6572 7469 6573 2073 6574 2069 6e20  operties set in 
-0000f2b0: 7468 6520 6f62 6a65 6374 3a0a 0a20 2020  the object:..   
-0000f2c0: 2020 2020 2020 2020 2060 6269 6766 7261           `bigfra
-0000f2d0: 6d65 735f 636c 6f75 645f 6675 6e63 7469  mes_cloud_functi
-0000f2e0: 6f6e 6020 2d20 5468 6520 676f 6f67 6c65  on` - The google
-0000f2f0: 2063 6c6f 7564 2066 756e 6374 696f 6e20   cloud function 
-0000f300: 6465 706c 6f79 6564 2066 6f72 2074 6865  deployed for the
-0000f310: 2075 7365 7220 6465 6669 6e65 6420 636f   user defined co
-0000f320: 6465 2e0a 0a20 2020 2020 2020 2020 2020  de...           
-0000f330: 2060 6269 6766 7261 6d65 735f 7265 6d6f   `bigframes_remo
-0000f340: 7465 5f66 756e 6374 696f 6e60 202d 2054  te_function` - T
-0000f350: 6865 2062 6967 7175 6572 7920 7265 6d6f  he bigquery remo
-0000f360: 7465 2066 756e 6374 696f 6e20 6361 7061  te function capa
-0000f370: 626c 6520 6f66 2063 616c 6c69 6e67 2069  ble of calling i
-0000f380: 6e74 6f20 6062 6967 6672 616d 6573 5f63  nto `bigframes_c
-0000f390: 6c6f 7564 5f66 756e 6374 696f 6e60 2e0a  loud_function`..
-0000f3a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000f3b0: 2020 2020 7265 7475 726e 2062 6967 6672      return bigfr
-0000f3c0: 616d 6573 5f72 6628 0a20 2020 2020 2020  ames_rf(.       
-0000f3d0: 2020 2020 2069 6e70 7574 5f74 7970 6573       input_types
-0000f3e0: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
-0000f3f0: 7470 7574 5f74 7970 652c 0a20 2020 2020  tput_type,.     
-0000f400: 2020 2020 2020 2073 6573 7369 6f6e 3d73         session=s
-0000f410: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-0000f420: 2064 6174 6173 6574 3d64 6174 6173 6574   dataset=dataset
-0000f430: 2c0a 2020 2020 2020 2020 2020 2020 6269  ,.            bi
-0000f440: 6771 7565 7279 5f63 6f6e 6e65 6374 696f  gquery_connectio
-0000f450: 6e3d 6269 6771 7565 7279 5f63 6f6e 6e65  n=bigquery_conne
-0000f460: 6374 696f 6e2c 0a20 2020 2020 2020 2020  ction,.         
-0000f470: 2020 2072 6575 7365 3d72 6575 7365 2c0a     reuse=reuse,.
-0000f480: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0000f490: 3d6e 616d 652c 0a20 2020 2020 2020 2020  =name,.         
-0000f4a0: 2020 2070 6163 6b61 6765 733d 7061 636b     packages=pack
-0000f4b0: 6167 6573 2c0a 2020 2020 2020 2020 2020  ages,.          
-0000f4c0: 2020 636c 6f75 645f 6675 6e63 7469 6f6e    cloud_function
-0000f4d0: 5f73 6572 7669 6365 5f61 6363 6f75 6e74  _service_account
-0000f4e0: 3d63 6c6f 7564 5f66 756e 6374 696f 6e5f  =cloud_function_
-0000f4f0: 7365 7276 6963 655f 6163 636f 756e 742c  service_account,
-0000f500: 0a20 2020 2020 2020 2020 2020 2063 6c6f  .            clo
-0000f510: 7564 5f66 756e 6374 696f 6e5f 6b6d 735f  ud_function_kms_
-0000f520: 6b65 795f 6e61 6d65 3d63 6c6f 7564 5f66  key_name=cloud_f
-0000f530: 756e 6374 696f 6e5f 6b6d 735f 6b65 795f  unction_kms_key_
-0000f540: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-0000f550: 2020 636c 6f75 645f 6675 6e63 7469 6f6e    cloud_function
-0000f560: 5f64 6f63 6b65 725f 7265 706f 7369 746f  _docker_reposito
-0000f570: 7279 3d63 6c6f 7564 5f66 756e 6374 696f  ry=cloud_functio
-0000f580: 6e5f 646f 636b 6572 5f72 6570 6f73 6974  n_docker_reposit
-0000f590: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
-0000f5a0: 206d 6178 5f62 6174 6368 696e 675f 726f   max_batching_ro
-0000f5b0: 7773 3d6d 6178 5f62 6174 6368 696e 675f  ws=max_batching_
-0000f5c0: 726f 7773 2c0a 2020 2020 2020 2020 2020  rows,.          
-0000f5d0: 2020 636c 6f75 645f 6675 6e63 7469 6f6e    cloud_function
-0000f5e0: 5f74 696d 656f 7574 3d63 6c6f 7564 5f66  _timeout=cloud_f
-0000f5f0: 756e 6374 696f 6e5f 7469 6d65 6f75 742c  unction_timeout,
-0000f600: 0a20 2020 2020 2020 2020 2020 2063 6c6f  .            clo
-0000f610: 7564 5f66 756e 6374 696f 6e5f 6d61 785f  ud_function_max_
-0000f620: 696e 7374 616e 6365 733d 636c 6f75 645f  instances=cloud_
-0000f630: 6675 6e63 7469 6f6e 5f6d 6178 5f69 6e73  function_max_ins
-0000f640: 7461 6e63 6573 2c0a 2020 2020 2020 2020  tances,.        
-0000f650: 2020 2020 636c 6f75 645f 6675 6e63 7469      cloud_functi
-0000f660: 6f6e 5f76 7063 5f63 6f6e 6e65 6374 6f72  on_vpc_connector
-0000f670: 3d63 6c6f 7564 5f66 756e 6374 696f 6e5f  =cloud_function_
-0000f680: 7670 635f 636f 6e6e 6563 746f 722c 0a20  vpc_connector,. 
-0000f690: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0000f6a0: 6620 7265 6164 5f67 6271 5f66 756e 6374  f read_gbq_funct
-0000f6b0: 696f 6e28 0a20 2020 2020 2020 2073 656c  ion(.        sel
-0000f6c0: 662c 0a20 2020 2020 2020 2066 756e 6374  f,.        funct
-0000f6d0: 696f 6e5f 6e61 6d65 3a20 7374 722c 0a20  ion_name: str,. 
-0000f6e0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-0000f6f0: 224c 6f61 6473 2061 2042 6967 5175 6572  "Loads a BigQuer
-0000f700: 7920 6675 6e63 7469 6f6e 2066 726f 6d20  y function from 
-0000f710: 4269 6751 7565 7279 2e0a 0a20 2020 2020  BigQuery...     
-0000f720: 2020 2054 6865 6e20 6974 2063 616e 2062     Then it can b
-0000f730: 6520 6170 706c 6965 6420 746f 2061 2044  e applied to a D
-0000f740: 6174 6146 7261 6d65 206f 7220 5365 7269  ataFrame or Seri
-0000f750: 6573 2e0a 0a20 2020 2020 2020 202e 2e20  es...        .. 
-0000f760: 6e6f 7465 3a3a 0a20 2020 2020 2020 2020  note::.         
-0000f770: 2020 2054 6865 2072 6574 7572 6e20 7479     The return ty
-0000f780: 7065 206f 6620 7468 6520 6675 6e63 7469  pe of the functi
-0000f790: 6f6e 206d 7573 7420 6265 2065 7870 6c69  on must be expli
-0000f7a0: 6369 746c 7920 7370 6563 6966 6965 6420  citly specified 
-0000f7b0: 696e 2074 6865 0a20 2020 2020 2020 2020  in the.         
-0000f7c0: 2020 2066 756e 6374 696f 6e27 7320 6f72     function's or
-0000f7d0: 6967 696e 616c 2064 6566 696e 6974 696f  iginal definitio
-0000f7e0: 6e20 6576 656e 2069 6620 6e6f 7420 6f74  n even if not ot
-0000f7f0: 6865 7277 6973 6520 7265 7175 6972 6564  herwise required
-0000f800: 2e0a 0a20 2020 2020 2020 2042 6967 5175  ...        BigQu
-0000f810: 6572 7920 5574 696c 7320 7072 6f76 6964  ery Utils provid
-0000f820: 6573 206d 616e 7920 7075 626c 6963 2066  es many public f
-0000f830: 756e 6374 696f 6e73 2075 6e64 6572 2074  unctions under t
-0000f840: 6865 2060 6062 7175 7469 6c60 6020 7072  he ``bqutil`` pr
-0000f850: 6f6a 6563 7420 6f6e 2047 6f6f 676c 6520  oject on Google 
-0000f860: 436c 6f75 6420 506c 6174 666f 726d 2070  Cloud Platform p
-0000f870: 726f 6a65 6374 0a20 2020 2020 2020 2028  roject.        (
-0000f880: 5365 653a 2068 7474 7073 3a2f 2f67 6974  See: https://git
-0000f890: 6875 622e 636f 6d2f 476f 6f67 6c65 436c  hub.com/GoogleCl
-0000f8a0: 6f75 6450 6c61 7466 6f72 6d2f 6269 6771  oudPlatform/bigq
-0000f8b0: 7565 7279 2d75 7469 6c73 2f74 7265 652f  uery-utils/tree/
-0000f8c0: 6d61 7374 6572 2f75 6466 7323 7573 696e  master/udfs#usin
-0000f8d0: 672d 7468 652d 7564 6673 292e 0a20 2020  g-the-udfs)..   
-0000f8e0: 2020 2020 2059 6f75 2063 616e 2063 6865       You can che
-0000f8f0: 636b 6f75 7420 436f 6d6d 756e 6974 7920  ckout Community 
-0000f900: 5544 4673 2074 6f20 7573 6520 636f 6d6d  UDFs to use comm
-0000f910: 756e 6974 792d 636f 6e74 7269 6275 7465  unity-contribute
-0000f920: 6420 6675 6e63 7469 6f6e 732e 0a20 2020  d functions..   
-0000f930: 2020 2020 2028 5365 653a 2068 7474 7073       (See: https
-0000f940: 3a2f 2f67 6974 6875 622e 636f 6d2f 476f  ://github.com/Go
-0000f950: 6f67 6c65 436c 6f75 6450 6c61 7466 6f72  ogleCloudPlatfor
-0000f960: 6d2f 6269 6771 7565 7279 2d75 7469 6c73  m/bigquery-utils
-0000f970: 2f74 7265 652f 6d61 7374 6572 2f75 6466  /tree/master/udf
-0000f980: 732f 636f 6d6d 756e 6974 7923 636f 6d6d  s/community#comm
-0000f990: 756e 6974 792d 7564 6673 292e 0a0a 2020  unity-udfs)...  
-0000f9a0: 2020 2020 2020 2a2a 4578 616d 706c 6573        **Examples
-0000f9b0: 3a2a 2a0a 0a20 2020 2020 2020 2055 7365  :**..        Use
-0000f9c0: 2074 6865 2060 6063 775f 6c6f 7765 725f   the ``cw_lower_
-0000f9d0: 6361 7365 5f61 7363 6969 5f6f 6e6c 7960  case_ascii_only`
-0000f9e0: 6020 6675 6e63 7469 6f6e 2066 726f 6d20  ` function from 
-0000f9f0: 436f 6d6d 756e 6974 7920 5544 4673 2e0a  Community UDFs..
-0000fa00: 2020 2020 2020 2020 2868 7474 7073 3a2f          (https:/
-0000fa10: 2f67 6974 6875 622e 636f 6d2f 476f 6f67  /github.com/Goog
-0000fa20: 6c65 436c 6f75 6450 6c61 7466 6f72 6d2f  leCloudPlatform/
-0000fa30: 6269 6771 7565 7279 2d75 7469 6c73 2f62  bigquery-utils/b
-0000fa40: 6c6f 622f 6d61 7374 6572 2f75 6466 732f  lob/master/udfs/
-0000fa50: 636f 6d6d 756e 6974 792f 6377 5f6c 6f77  community/cw_low
-0000fa60: 6572 5f63 6173 655f 6173 6369 695f 6f6e  er_case_ascii_on
-0000fa70: 6c79 2e73 716c 7829 0a0a 2020 2020 2020  ly.sqlx)..      
-0000fa80: 2020 2020 2020 3e3e 3e20 696d 706f 7274        >>> import
-0000fa90: 2062 6967 6672 616d 6573 2e70 616e 6461   bigframes.panda
-0000faa0: 7320 6173 2062 7064 0a20 2020 2020 2020  s as bpd.       
-0000fab0: 2020 2020 203e 3e3e 2062 7064 2e6f 7074       >>> bpd.opt
-0000fac0: 696f 6e73 2e64 6973 706c 6179 2e70 726f  ions.display.pro
-0000fad0: 6772 6573 735f 6261 7220 3d20 4e6f 6e65  gress_bar = None
-0000fae0: 0a0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
-0000faf0: 3e20 6466 203d 2062 7064 2e44 6174 6146  > df = bpd.DataF
-0000fb00: 7261 6d65 287b 2769 6427 3a20 5b31 2c20  rame({'id': [1, 
-0000fb10: 322c 2033 5d2c 2027 6e61 6d65 273a 205b  2, 3], 'name': [
-0000fb20: 2741 5552 c389 4c49 4527 2c20 2743 c389  'AUR..LIE', 'C..
-0000fb30: 4c45 5354 494e 4527 2c20 2744 4150 484e  LESTINE', 'DAPHN
-0000fb40: c389 275d 7d29 0a20 2020 2020 2020 2020  ..']}).         
-0000fb50: 2020 203e 3e3e 2064 660a 2020 2020 2020     >>> df.      
-0000fb60: 2020 2020 2020 2020 2069 6420 2020 2020           id     
-0000fb70: 2020 6e61 6d65 0a20 2020 2020 2020 2020    name.         
-0000fb80: 2020 2030 2020 2031 2020 2020 4155 52c3     0   1    AUR.
-0000fb90: 894c 4945 0a20 2020 2020 2020 2020 2020  .LIE.           
-0000fba0: 2031 2020 2032 2020 43c3 894c 4553 5449   1   2  C..LESTI
-0000fbb0: 4e45 0a20 2020 2020 2020 2020 2020 2032  NE.            2
-0000fbc0: 2020 2033 2020 2020 2044 4150 484e c389     3     DAPHN..
-0000fbd0: 0a20 2020 2020 2020 2020 2020 203c 424c  .            <BL
-0000fbe0: 414e 4b4c 494e 453e 0a20 2020 2020 2020  ANKLINE>.       
-0000fbf0: 2020 2020 205b 3320 726f 7773 2078 2032       [3 rows x 2
-0000fc00: 2063 6f6c 756d 6e73 5d0a 0a20 2020 2020   columns]..     
-0000fc10: 2020 2020 2020 203e 3e3e 2066 756e 6320         >>> func 
-0000fc20: 3d20 6270 642e 7265 6164 5f67 6271 5f66  = bpd.read_gbq_f
-0000fc30: 756e 6374 696f 6e28 2262 7175 7469 6c2e  unction("bqutil.
-0000fc40: 666e 2e63 775f 6c6f 7765 725f 6361 7365  fn.cw_lower_case
-0000fc50: 5f61 7363 6969 5f6f 6e6c 7922 290a 2020  _ascii_only").  
-0000fc60: 2020 2020 2020 2020 2020 3e3e 3e20 6466            >>> df
-0000fc70: 3120 3d20 6466 2e61 7373 6967 6e28 6e65  1 = df.assign(ne
-0000fc80: 775f 6e61 6d65 3d64 665b 276e 616d 6527  w_name=df['name'
-0000fc90: 5d2e 6170 706c 7928 6675 6e63 2929 0a20  ].apply(func)). 
-0000fca0: 2020 2020 2020 2020 2020 203e 3e3e 2064             >>> d
-0000fcb0: 6631 0a20 2020 2020 2020 2020 2020 2020  f1.             
-0000fcc0: 2020 6964 2020 2020 2020 206e 616d 6520    id       name 
-0000fcd0: 2020 6e65 775f 6e61 6d65 0a20 2020 2020    new_name.     
-0000fce0: 2020 2020 2020 2030 2020 2031 2020 2020         0   1    
-0000fcf0: 4155 52c3 894c 4945 2020 2020 6175 72c3  AUR..LIE    aur.
-0000fd00: 896c 6965 0a20 2020 2020 2020 2020 2020  .lie.           
-0000fd10: 2031 2020 2032 2020 43c3 894c 4553 5449   1   2  C..LESTI
-0000fd20: 4e45 2020 63c3 896c 6573 7469 6e65 0a20  NE  c..lestine. 
-0000fd30: 2020 2020 2020 2020 2020 2032 2020 2033             2   3
-0000fd40: 2020 2020 2044 4150 484e c389 2020 2020       DAPHN..    
-0000fd50: 2064 6170 686e c389 0a20 2020 2020 2020   daphn...       
-0000fd60: 2020 2020 203c 424c 414e 4b4c 494e 453e       <BLANKLINE>
-0000fd70: 0a20 2020 2020 2020 2020 2020 205b 3320  .            [3 
-0000fd80: 726f 7773 2078 2033 2063 6f6c 756d 6e73  rows x 3 columns
-0000fd90: 5d0a 0a20 2020 2020 2020 2041 7267 733a  ]..        Args:
-0000fda0: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
-0000fdb0: 6374 696f 6e5f 6e61 6d65 2028 7374 7229  ction_name (str)
-0000fdc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fdd0: 2020 7468 6520 6675 6e63 7469 6f6e 2773    the function's
-0000fde0: 206e 616d 6520 696e 2042 6967 5175 6572   name in BigQuer
-0000fdf0: 7920 696e 2074 6865 2066 6f72 6d61 740a  y in the format.
-0000fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe10: 6070 726f 6a65 6374 5f69 642e 6461 7461  `project_id.data
-0000fe20: 7365 745f 6964 2e66 756e 6374 696f 6e5f  set_id.function_
-0000fe30: 6e61 6d65 602c 206f 720a 2020 2020 2020  name`, or.      
-0000fe40: 2020 2020 2020 2020 2020 6064 6174 6173            `datas
-0000fe50: 6574 5f69 642e 6675 6e63 7469 6f6e 5f6e  et_id.function_n
-0000fe60: 616d 6560 2074 6f20 6c6f 6164 2066 726f  ame` to load fro
-0000fe70: 6d20 7468 6520 6465 6661 756c 7420 7072  m the default pr
-0000fe80: 6f6a 6563 742c 206f 720a 2020 2020 2020  oject, or.      
-0000fe90: 2020 2020 2020 2020 2020 6066 756e 6374            `funct
-0000fea0: 696f 6e5f 6e61 6d65 6020 746f 206c 6f61  ion_name` to loa
-0000feb0: 6420 6672 6f6d 2074 6865 2064 6566 6175  d from the defau
-0000fec0: 6c74 2070 726f 6a65 6374 2061 6e64 2074  lt project and t
-0000fed0: 6865 2064 6174 6173 6574 0a20 2020 2020  he dataset.     
-0000fee0: 2020 2020 2020 2020 2020 2061 7373 6f63             assoc
-0000fef0: 6961 7465 6420 7769 7468 2074 6865 2063  iated with the c
-0000ff00: 7572 7265 6e74 2073 6573 7369 6f6e 2e0a  urrent session..
-0000ff10: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-0000ff20: 3a0a 2020 2020 2020 2020 2020 2020 6361  :.            ca
-0000ff30: 6c6c 6162 6c65 3a20 4120 6675 6e63 7469  llable: A functi
-0000ff40: 6f6e 206f 626a 6563 7420 706f 696e 7469  on object pointi
-0000ff50: 6e67 2074 6f20 7468 6520 4269 6751 7565  ng to the BigQue
-0000ff60: 7279 2066 756e 6374 696f 6e20 7265 6164  ry function read
-0000ff70: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
-0000ff80: 6d20 4269 6751 7565 7279 2e0a 0a20 2020  m BigQuery...   
-0000ff90: 2020 2020 2020 2020 2054 6865 206f 626a           The obj
-0000ffa0: 6563 7420 6973 2073 696d 696c 6172 2074  ect is similar t
-0000ffb0: 6f20 7468 6520 6f6e 6520 6372 6561 7465  o the one create
-0000ffc0: 6420 6279 2074 6865 2060 7265 6d6f 7465  d by the `remote
-0000ffd0: 5f66 756e 6374 696f 6e60 0a20 2020 2020  _function`.     
-0000ffe0: 2020 2020 2020 2064 6563 6f72 6174 6f72         decorator
-0000fff0: 2c20 696e 636c 7564 696e 6720 7468 6520  , including the 
-00010000: 6062 6967 6672 616d 6573 5f72 656d 6f74  `bigframes_remot
-00010010: 655f 6675 6e63 7469 6f6e 6020 7072 6f70  e_function` prop
-00010020: 6572 7479 2c20 6275 740a 2020 2020 2020  erty, but.      
-00010030: 2020 2020 2020 6e6f 7420 696e 636c 7564        not includ
-00010040: 696e 6720 7468 6520 6062 6967 6672 616d  ing the `bigfram
-00010050: 6573 5f63 6c6f 7564 5f66 756e 6374 696f  es_cloud_functio
-00010060: 6e60 2070 726f 7065 7274 792e 0a20 2020  n` property..   
-00010070: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00010080: 2020 7265 7475 726e 2062 6967 6672 616d    return bigfram
-00010090: 6573 5f72 6766 280a 2020 2020 2020 2020  es_rgf(.        
-000100a0: 2020 2020 6675 6e63 7469 6f6e 5f6e 616d      function_nam
-000100b0: 653d 6675 6e63 7469 6f6e 5f6e 616d 652c  e=function_name,
-000100c0: 0a20 2020 2020 2020 2020 2020 2073 6573  .            ses
-000100d0: 7369 6f6e 3d73 656c 662c 0a20 2020 2020  sion=self,.     
-000100e0: 2020 2029 0a0a 2020 2020 6465 6620 5f70     )..    def _p
-000100f0: 7265 7061 7265 5f71 7565 7279 5f6a 6f62  repare_query_job
-00010100: 5f63 6f6e 6669 6728 0a20 2020 2020 2020  _config(.       
-00010110: 2073 656c 662c 0a20 2020 2020 2020 206a   self,.        j
-00010120: 6f62 5f63 6f6e 6669 673a 204f 7074 696f  ob_config: Optio
-00010130: 6e61 6c5b 6269 6771 7565 7279 2e51 7565  nal[bigquery.Que
-00010140: 7279 4a6f 6243 6f6e 6669 675d 203d 204e  ryJobConfig] = N
-00010150: 6f6e 652c 0a20 2020 2029 202d 3e20 6269  one,.    ) -> bi
-00010160: 6771 7565 7279 2e51 7565 7279 4a6f 6243  gquery.QueryJobC
-00010170: 6f6e 6669 673a 0a20 2020 2020 2020 2069  onfig:.        i
-00010180: 6620 6a6f 625f 636f 6e66 6967 2069 7320  f job_config is 
-00010190: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000101a0: 2020 6a6f 625f 636f 6e66 6967 203d 2062    job_config = b
-000101b0: 6967 7175 6572 792e 5175 6572 794a 6f62  igquery.QueryJob
-000101c0: 436f 6e66 6967 2829 0a20 2020 2020 2020  Config().       
-000101d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000101e0: 2020 2023 2043 7265 6174 6520 6120 636f     # Create a co
-000101f0: 7079 2073 6f20 7468 6174 2077 6520 646f  py so that we do
-00010200: 6e27 7420 6d75 7461 7465 2074 6865 206f  n't mutate the o
-00010210: 7269 6769 6e61 6c20 636f 6e66 6967 2070  riginal config p
-00010220: 6173 7365 640a 2020 2020 2020 2020 2020  assed.          
-00010230: 2020 6a6f 625f 636f 6e66 6967 203d 2074    job_config = t
-00010240: 7970 696e 672e 6361 7374 280a 2020 2020  yping.cast(.    
-00010250: 2020 2020 2020 2020 2020 2020 6269 6771              bigq
-00010260: 7565 7279 2e51 7565 7279 4a6f 6243 6f6e  uery.QueryJobCon
-00010270: 6669 672c 0a20 2020 2020 2020 2020 2020  fig,.           
-00010280: 2020 2020 2062 6967 7175 6572 792e 5175       bigquery.Qu
-00010290: 6572 794a 6f62 436f 6e66 6967 2e66 726f  eryJobConfig.fro
-000102a0: 6d5f 6170 695f 7265 7072 286a 6f62 5f63  m_api_repr(job_c
-000102b0: 6f6e 6669 672e 746f 5f61 7069 5f72 6570  onfig.to_api_rep
-000102c0: 7228 2929 2c0a 2020 2020 2020 2020 2020  r()),.          
-000102d0: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-000102e0: 6269 6766 7261 6d65 732e 6f70 7469 6f6e  bigframes.option
-000102f0: 732e 636f 6d70 7574 652e 6d61 7869 6d75  s.compute.maximu
-00010300: 6d5f 6279 7465 735f 6269 6c6c 6564 2069  m_bytes_billed i
-00010310: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00010320: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
-00010330: 6967 2e6d 6178 696d 756d 5f62 7974 6573  ig.maximum_bytes
-00010340: 5f62 696c 6c65 6420 3d20 280a 2020 2020  _billed = (.    
-00010350: 2020 2020 2020 2020 2020 2020 6269 6766              bigf
-00010360: 7261 6d65 732e 6f70 7469 6f6e 732e 636f  rames.options.co
-00010370: 6d70 7574 652e 6d61 7869 6d75 6d5f 6279  mpute.maximum_by
-00010380: 7465 735f 6269 6c6c 6564 0a20 2020 2020  tes_billed.     
-00010390: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-000103a0: 2020 6375 7272 656e 745f 6c61 6265 6c73    current_labels
-000103b0: 203d 206a 6f62 5f63 6f6e 6669 672e 6c61   = job_config.la
-000103c0: 6265 6c73 2069 6620 6a6f 625f 636f 6e66  bels if job_conf
-000103d0: 6967 2e6c 6162 656c 7320 656c 7365 207b  ig.labels else {
-000103e0: 7d0a 2020 2020 2020 2020 666f 7220 6b65  }.        for ke
-000103f0: 792c 2076 616c 7565 2069 6e20 6269 6766  y, value in bigf
-00010400: 7261 6d65 732e 6f70 7469 6f6e 732e 636f  rames.options.co
-00010410: 6d70 7574 652e 6578 7472 615f 7175 6572  mpute.extra_quer
-00010420: 795f 6c61 6265 6c73 2e69 7465 6d73 2829  y_labels.items()
-00010430: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00010440: 206b 6579 206e 6f74 2069 6e20 6375 7272   key not in curr
-00010450: 656e 745f 6c61 6265 6c73 3a0a 2020 2020  ent_labels:.    
-00010460: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00010470: 656e 745f 6c61 6265 6c73 5b6b 6579 5d20  ent_labels[key] 
-00010480: 3d20 7661 6c75 650a 2020 2020 2020 2020  = value.        
-00010490: 6a6f 625f 636f 6e66 6967 2e6c 6162 656c  job_config.label
-000104a0: 7320 3d20 6375 7272 656e 745f 6c61 6265  s = current_labe
-000104b0: 6c73 0a0a 2020 2020 2020 2020 6966 2073  ls..        if s
-000104c0: 656c 662e 5f62 715f 6b6d 735f 6b65 795f  elf._bq_kms_key_
-000104d0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-000104e0: 2020 6a6f 625f 636f 6e66 6967 2e64 6573    job_config.des
-000104f0: 7469 6e61 7469 6f6e 5f65 6e63 7279 7074  tination_encrypt
-00010500: 696f 6e5f 636f 6e66 6967 7572 6174 696f  ion_configuratio
-00010510: 6e20 3d20 280a 2020 2020 2020 2020 2020  n = (.          
-00010520: 2020 2020 2020 6269 6771 7565 7279 2e45        bigquery.E
-00010530: 6e63 7279 7074 696f 6e43 6f6e 6669 6775  ncryptionConfigu
-00010540: 7261 7469 6f6e 286b 6d73 5f6b 6579 5f6e  ration(kms_key_n
-00010550: 616d 653d 7365 6c66 2e5f 6271 5f6b 6d73  ame=self._bq_kms
-00010560: 5f6b 6579 5f6e 616d 6529 0a20 2020 2020  _key_name).     
-00010570: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00010580: 2020 7265 7475 726e 206a 6f62 5f63 6f6e    return job_con
-00010590: 6669 670a 0a20 2020 2064 6566 205f 7072  fig..    def _pr
-000105a0: 6570 6172 655f 6c6f 6164 5f6a 6f62 5f63  epare_load_job_c
-000105b0: 6f6e 6669 6728 7365 6c66 2920 2d3e 2062  onfig(self) -> b
-000105c0: 6967 7175 6572 792e 4c6f 6164 4a6f 6243  igquery.LoadJobC
-000105d0: 6f6e 6669 673a 0a20 2020 2020 2020 2023  onfig:.        #
-000105e0: 2043 7265 6174 6520 6120 636f 7079 2073   Create a copy s
-000105f0: 6f20 7468 6174 2077 6520 646f 6e27 7420  o that we don't 
-00010600: 6d75 7461 7465 2074 6865 206f 7269 6769  mutate the origi
-00010610: 6e61 6c20 636f 6e66 6967 2070 6173 7365  nal config passe
-00010620: 640a 2020 2020 2020 2020 6a6f 625f 636f  d.        job_co
-00010630: 6e66 6967 203d 2062 6967 7175 6572 792e  nfig = bigquery.
-00010640: 4c6f 6164 4a6f 6243 6f6e 6669 6728 290a  LoadJobConfig().
-00010650: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00010660: 2e5f 6271 5f6b 6d73 5f6b 6579 5f6e 616d  ._bq_kms_key_nam
-00010670: 653a 0a20 2020 2020 2020 2020 2020 206a  e:.            j
-00010680: 6f62 5f63 6f6e 6669 672e 6465 7374 696e  ob_config.destin
-00010690: 6174 696f 6e5f 656e 6372 7970 7469 6f6e  ation_encryption
-000106a0: 5f63 6f6e 6669 6775 7261 7469 6f6e 203d  _configuration =
-000106b0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-000106c0: 2020 2062 6967 7175 6572 792e 456e 6372     bigquery.Encr
-000106d0: 7970 7469 6f6e 436f 6e66 6967 7572 6174  yptionConfigurat
-000106e0: 696f 6e28 6b6d 735f 6b65 795f 6e61 6d65  ion(kms_key_name
-000106f0: 3d73 656c 662e 5f62 715f 6b6d 735f 6b65  =self._bq_kms_ke
-00010700: 795f 6e61 6d65 290a 2020 2020 2020 2020  y_name).        
-00010710: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
-00010720: 6574 7572 6e20 6a6f 625f 636f 6e66 6967  eturn job_config
-00010730: 0a0a 2020 2020 6465 6620 5f70 7265 7061  ..    def _prepa
-00010740: 7265 5f63 6f70 795f 6a6f 625f 636f 6e66  re_copy_job_conf
-00010750: 6967 2873 656c 6629 202d 3e20 6269 6771  ig(self) -> bigq
-00010760: 7565 7279 2e43 6f70 794a 6f62 436f 6e66  uery.CopyJobConf
-00010770: 6967 3a0a 2020 2020 2020 2020 2320 4372  ig:.        # Cr
-00010780: 6561 7465 2061 2063 6f70 7920 736f 2074  eate a copy so t
-00010790: 6861 7420 7765 2064 6f6e 2774 206d 7574  hat we don't mut
-000107a0: 6174 6520 7468 6520 6f72 6967 696e 616c  ate the original
-000107b0: 2063 6f6e 6669 6720 7061 7373 6564 0a20   config passed. 
-000107c0: 2020 2020 2020 206a 6f62 5f63 6f6e 6669         job_confi
-000107d0: 6720 3d20 6269 6771 7565 7279 2e43 6f70  g = bigquery.Cop
-000107e0: 794a 6f62 436f 6e66 6967 2829 0a0a 2020  yJobConfig()..  
-000107f0: 2020 2020 2020 6966 2073 656c 662e 5f62        if self._b
-00010800: 715f 6b6d 735f 6b65 795f 6e61 6d65 3a0a  q_kms_key_name:.
-00010810: 2020 2020 2020 2020 2020 2020 6a6f 625f              job_
-00010820: 636f 6e66 6967 2e64 6573 7469 6e61 7469  config.destinati
-00010830: 6f6e 5f65 6e63 7279 7074 696f 6e5f 636f  on_encryption_co
-00010840: 6e66 6967 7572 6174 696f 6e20 3d20 280a  nfiguration = (.
-00010850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010860: 6269 6771 7565 7279 2e45 6e63 7279 7074  bigquery.Encrypt
-00010870: 696f 6e43 6f6e 6669 6775 7261 7469 6f6e  ionConfiguration
-00010880: 286b 6d73 5f6b 6579 5f6e 616d 653d 7365  (kms_key_name=se
-00010890: 6c66 2e5f 6271 5f6b 6d73 5f6b 6579 5f6e  lf._bq_kms_key_n
-000108a0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-000108b0: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
-000108c0: 726e 206a 6f62 5f63 6f6e 6669 670a 0a20  rn job_config.. 
-000108d0: 2020 2064 6566 205f 7374 6172 745f 7175     def _start_qu
-000108e0: 6572 7928 0a20 2020 2020 2020 2073 656c  ery(.        sel
-000108f0: 662c 0a20 2020 2020 2020 2073 716c 3a20  f,.        sql: 
-00010900: 7374 722c 0a20 2020 2020 2020 206a 6f62  str,.        job
-00010910: 5f63 6f6e 6669 673a 204f 7074 696f 6e61  _config: Optiona
-00010920: 6c5b 6269 6771 7565 7279 2e6a 6f62 2e51  l[bigquery.job.Q
-00010930: 7565 7279 4a6f 6243 6f6e 6669 675d 203d  ueryJobConfig] =
-00010940: 204e 6f6e 652c 0a20 2020 2020 2020 206d   None,.        m
-00010950: 6178 5f72 6573 756c 7473 3a20 4f70 7469  ax_results: Opti
-00010960: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
-00010970: 2c0a 2020 2020 2020 2020 7469 6d65 6f75  ,.        timeou
-00010980: 743a 204f 7074 696f 6e61 6c5b 666c 6f61  t: Optional[floa
-00010990: 745d 203d 204e 6f6e 652c 0a20 2020 2029  t] = None,.    )
-000109a0: 202d 3e20 5475 706c 655b 6269 6771 7565   -> Tuple[bigque
-000109b0: 7279 2e74 6162 6c65 2e52 6f77 4974 6572  ry.table.RowIter
-000109c0: 6174 6f72 2c20 6269 6771 7565 7279 2e51  ator, bigquery.Q
-000109d0: 7565 7279 4a6f 625d 3a0a 2020 2020 2020  ueryJob]:.      
-000109e0: 2020 2222 220a 2020 2020 2020 2020 5374    """.        St
-000109f0: 6172 7473 2042 6967 5175 6572 7920 7175  arts BigQuery qu
-00010a00: 6572 7920 6a6f 6220 616e 6420 7761 6974  ery job and wait
-00010a10: 7320 666f 7220 7265 7375 6c74 732e 0a20  s for results.. 
-00010a20: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00010a30: 2020 206a 6f62 5f63 6f6e 6669 6720 3d20     job_config = 
-00010a40: 7365 6c66 2e5f 7072 6570 6172 655f 7175  self._prepare_qu
-00010a50: 6572 795f 6a6f 625f 636f 6e66 6967 286a  ery_job_config(j
-00010a60: 6f62 5f63 6f6e 6669 6729 0a20 2020 2020  ob_config).     
-00010a70: 2020 2072 6574 7572 6e20 6269 6766 7261     return bigfra
-00010a80: 6d65 732e 7365 7373 696f 6e2e 5f69 6f2e  mes.session._io.
-00010a90: 6269 6771 7565 7279 2e73 7461 7274 5f71  bigquery.start_q
-00010aa0: 7565 7279 5f77 6974 685f 636c 6965 6e74  uery_with_client
-00010ab0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00010ac0: 6c66 2e62 7163 6c69 656e 742c 2073 716c  lf.bqclient, sql
-00010ad0: 2c20 6a6f 625f 636f 6e66 6967 2c20 6d61  , job_config, ma
-00010ae0: 785f 7265 7375 6c74 732c 2074 696d 656f  x_results, timeo
-00010af0: 7574 0a20 2020 2020 2020 2029 0a0a 2020  ut.        )..  
-00010b00: 2020 6465 6620 5f73 7461 7274 5f71 7565    def _start_que
-00010b10: 7279 5f6d 6c5f 6464 6c28 0a20 2020 2020  ry_ml_ddl(.     
-00010b20: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00010b30: 2073 716c 3a20 7374 722c 0a20 2020 2029   sql: str,.    )
-00010b40: 202d 3e20 5475 706c 655b 6269 6771 7565   -> Tuple[bigque
-00010b50: 7279 2e74 6162 6c65 2e52 6f77 4974 6572  ry.table.RowIter
-00010b60: 6174 6f72 2c20 6269 6771 7565 7279 2e51  ator, bigquery.Q
-00010b70: 7565 7279 4a6f 625d 3a0a 2020 2020 2020  ueryJob]:.      
-00010b80: 2020 2222 220a 2020 2020 2020 2020 5374    """.        St
-00010b90: 6172 7473 2042 6967 5175 6572 7920 4d4c  arts BigQuery ML
-00010ba0: 2044 444c 2071 7565 7279 206a 6f62 2028   DDL query job (
-00010bb0: 4352 4541 5445 204d 4f44 454c 2f41 4c54  CREATE MODEL/ALT
-00010bc0: 4552 204d 4f44 454c 2f2e 2e2e 2920 616e  ER MODEL/...) an
-00010bd0: 640a 2020 2020 2020 2020 7761 6974 7320  d.        waits 
-00010be0: 666f 7220 7265 7375 6c74 732e 0a20 2020  for results..   
-00010bf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00010c00: 206a 6f62 5f63 6f6e 6669 6720 3d20 7365   job_config = se
-00010c10: 6c66 2e5f 7072 6570 6172 655f 7175 6572  lf._prepare_quer
-00010c20: 795f 6a6f 625f 636f 6e66 6967 2829 0a0a  y_job_config()..
-00010c30: 2020 2020 2020 2020 2320 4251 4d4c 2065          # BQML e
-00010c40: 7870 6563 7473 206b 6d73 5f6b 6579 5f6e  xpects kms_key_n
-00010c50: 616d 6520 7468 726f 7567 6820 4f50 5449  ame through OPTI
-00010c60: 4f4e 5320 616e 6420 6e6f 7420 7468 726f  ONS and not thro
-00010c70: 7567 6820 6a6f 6220 636f 6e66 6967 2c0a  ugh job config,.
-00010c80: 2020 2020 2020 2020 2320 736f 2077 6520          # so we 
-00010c90: 6d75 7374 2072 6573 6574 2061 6e79 2065  must reset any e
-00010ca0: 6e63 7279 7074 696f 6e20 7365 7420 696e  ncryption set in
-00010cb0: 2074 6865 206a 6f62 2063 6f6e 6669 670a   the job config.
-00010cc0: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
-00010cd0: 2f2f 636c 6f75 642e 676f 6f67 6c65 2e63  //cloud.google.c
-00010ce0: 6f6d 2f62 6967 7175 6572 792f 646f 6373  om/bigquery/docs
-00010cf0: 2f63 7573 746f 6d65 722d 6d61 6e61 6765  /customer-manage
-00010d00: 642d 656e 6372 7970 7469 6f6e 2365 6e63  d-encryption#enc
-00010d10: 7279 7074 2d6d 6f64 656c 0a20 2020 2020  rypt-model.     
-00010d20: 2020 206a 6f62 5f63 6f6e 6669 672e 6465     job_config.de
-00010d30: 7374 696e 6174 696f 6e5f 656e 6372 7970  stination_encryp
-00010d40: 7469 6f6e 5f63 6f6e 6669 6775 7261 7469  tion_configurati
-00010d50: 6f6e 203d 204e 6f6e 650a 0a20 2020 2020  on = None..     
-00010d60: 2020 2072 6574 7572 6e20 6269 6766 7261     return bigfra
-00010d70: 6d65 732e 7365 7373 696f 6e2e 5f69 6f2e  mes.session._io.
-00010d80: 6269 6771 7565 7279 2e73 7461 7274 5f71  bigquery.start_q
-00010d90: 7565 7279 5f77 6974 685f 636c 6965 6e74  uery_with_client
-00010da0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00010db0: 6c66 2e62 7163 6c69 656e 742c 2073 716c  lf.bqclient, sql
-00010dc0: 2c20 6a6f 625f 636f 6e66 6967 0a20 2020  , job_config.   
-00010dd0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00010de0: 5f63 6163 6865 5f77 6974 685f 636c 7573  _cache_with_clus
-00010df0: 7465 725f 636f 6c73 280a 2020 2020 2020  ter_cols(.      
-00010e00: 2020 7365 6c66 2c20 6172 7261 795f 7661    self, array_va
-00010e10: 6c75 653a 2063 6f72 652e 4172 7261 7956  lue: core.ArrayV
-00010e20: 616c 7565 2c20 636c 7573 7465 725f 636f  alue, cluster_co
-00010e30: 6c73 3a20 7479 7069 6e67 2e53 6571 7565  ls: typing.Seque
-00010e40: 6e63 655b 7374 725d 0a20 2020 2029 202d  nce[str].    ) -
-00010e50: 3e20 636f 7265 2e41 7272 6179 5661 6c75  > core.ArrayValu
-00010e60: 653a 0a20 2020 2020 2020 2022 2222 4578  e:.        """Ex
-00010e70: 6563 7574 6573 2074 6865 2071 7565 7279  ecutes the query
-00010e80: 2061 6e64 2075 7365 7320 7468 6520 7265   and uses the re
-00010e90: 7375 6c74 696e 6720 7461 626c 6520 746f  sulting table to
-00010ea0: 2072 6577 7269 7465 2066 7574 7572 6520   rewrite future 
-00010eb0: 6578 6563 7574 696f 6e73 2e22 2222 0a20  executions.""". 
-00010ec0: 2020 2020 2020 2023 2054 4f44 4f3a 2055         # TODO: U
-00010ed0: 7365 2074 6869 7320 666f 7220 616c 6c20  se this for all 
-00010ee0: 6578 6563 7574 696f 6e73 3f20 5072 6f62  executions? Prob
-00010ef0: 6c65 6d20 6973 2074 6861 7420 6361 6368  lem is that cach
-00010f00: 696e 6720 6d61 7465 7269 616c 697a 6573  ing materializes
-00010f10: 2065 7874 7261 0a20 2020 2020 2020 2023   extra.        #
-00010f20: 206f 7264 6572 696e 6720 636f 6c75 6d6e   ordering column
-00010f30: 730a 2020 2020 2020 2020 636f 6d70 696c  s.        compil
-00010f40: 6564 5f76 616c 7565 203d 2073 656c 662e  ed_value = self.
-00010f50: 5f63 6f6d 7069 6c65 5f6f 7264 6572 6564  _compile_ordered
-00010f60: 2861 7272 6179 5f76 616c 7565 290a 0a20  (array_value).. 
-00010f70: 2020 2020 2020 2069 6269 735f 6578 7072         ibis_expr
-00010f80: 203d 2063 6f6d 7069 6c65 645f 7661 6c75   = compiled_valu
-00010f90: 652e 5f74 6f5f 6962 6973 5f65 7870 7228  e._to_ibis_expr(
-00010fa0: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-00010fb0: 6572 696e 675f 6d6f 6465 3d22 756e 6f72  ering_mode="unor
-00010fc0: 6465 7265 6422 2c20 6578 706f 7365 5f68  dered", expose_h
-00010fd0: 6964 6465 6e5f 636f 6c73 3d54 7275 650a  idden_cols=True.
-00010fe0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00010ff0: 2020 746d 705f 7461 626c 6520 3d20 7365    tmp_table = se
-00011000: 6c66 2e5f 6962 6973 5f74 6f5f 7465 6d70  lf._ibis_to_temp
-00011010: 5f74 6162 6c65 280a 2020 2020 2020 2020  _table(.        
-00011020: 2020 2020 6962 6973 5f65 7870 722c 2063      ibis_expr, c
-00011030: 6c75 7374 6572 5f63 6f6c 733d 636c 7573  luster_cols=clus
-00011040: 7465 725f 636f 6c73 2c20 6170 695f 6e61  ter_cols, api_na
-00011050: 6d65 3d22 6361 6368 6564 220a 2020 2020  me="cached".    
-00011060: 2020 2020 290a 2020 2020 2020 2020 7461      ).        ta
-00011070: 626c 655f 6578 7072 6573 7369 6f6e 203d  ble_expression =
-00011080: 2073 656c 662e 6962 6973 5f63 6c69 656e   self.ibis_clien
-00011090: 742e 7461 626c 6528 0a20 2020 2020 2020  t.table(.       
-000110a0: 2020 2020 2074 6d70 5f74 6162 6c65 2e74       tmp_table.t
-000110b0: 6162 6c65 5f69 642c 0a20 2020 2020 2020  able_id,.       
-000110c0: 2020 2020 2073 6368 656d 613d 746d 705f       schema=tmp_
-000110d0: 7461 626c 652e 6461 7461 7365 745f 6964  table.dataset_id
-000110e0: 2c0a 2020 2020 2020 2020 2020 2020 6461  ,.            da
-000110f0: 7461 6261 7365 3d74 6d70 5f74 6162 6c65  tabase=tmp_table
-00011100: 2e70 726f 6a65 6374 2c0a 2020 2020 2020  .project,.      
-00011110: 2020 290a 2020 2020 2020 2020 6e65 775f    ).        new_
-00011120: 636f 6c75 6d6e 7320 3d20 5b74 6162 6c65  columns = [table
-00011130: 5f65 7870 7265 7373 696f 6e5b 636f 6c75  _expression[colu
-00011140: 6d6e 5d20 666f 7220 636f 6c75 6d6e 2069  mn] for column i
-00011150: 6e20 636f 6d70 696c 6564 5f76 616c 7565  n compiled_value
-00011160: 2e63 6f6c 756d 6e5f 6964 735d 0a20 2020  .column_ids].   
-00011170: 2020 2020 206e 6577 5f68 6964 6465 6e5f       new_hidden_
-00011180: 636f 6c75 6d6e 7320 3d20 5b0a 2020 2020  columns = [.    
-00011190: 2020 2020 2020 2020 7461 626c 655f 6578          table_ex
-000111a0: 7072 6573 7369 6f6e 5b63 6f6c 756d 6e5d  pression[column]
-000111b0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000111c0: 2063 6f6c 756d 6e20 696e 2063 6f6d 7069   column in compi
-000111d0: 6c65 645f 7661 6c75 652e 5f68 6964 6465  led_value._hidde
-000111e0: 6e5f 6f72 6465 7269 6e67 5f63 6f6c 756d  n_ordering_colum
-000111f0: 6e5f 6e61 6d65 730a 2020 2020 2020 2020  n_names.        
-00011200: 5d0a 2020 2020 2020 2020 2320 544f 444f  ].        # TODO
-00011210: 3a20 496e 7374 6561 642c 206b 6565 7020  : Instead, keep 
-00011220: 7365 7373 696f 6e2d 7769 6465 206d 6170  session-wide map
-00011230: 206f 6620 6361 6368 6564 2072 6573 756c   of cached resul
-00011240: 7473 2061 6e64 2061 7574 6f6d 6174 6963  ts and automatic
-00011250: 616c 6c79 2072 6575 7365 0a20 2020 2020  ally reuse.     
-00011260: 2020 2072 6574 7572 6e20 636f 7265 2e41     return core.A
-00011270: 7272 6179 5661 6c75 652e 6672 6f6d 5f69  rrayValue.from_i
-00011280: 6269 7328 0a20 2020 2020 2020 2020 2020  bis(.           
-00011290: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
-000112a0: 2020 2074 6162 6c65 5f65 7870 7265 7373     table_express
-000112b0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-000112c0: 2063 6f6c 756d 6e73 3d6e 6577 5f63 6f6c   columns=new_col
-000112d0: 756d 6e73 2c0a 2020 2020 2020 2020 2020  umns,.          
-000112e0: 2020 6869 6464 656e 5f6f 7264 6572 696e    hidden_orderin
-000112f0: 675f 636f 6c75 6d6e 733d 6e65 775f 6869  g_columns=new_hi
-00011300: 6464 656e 5f63 6f6c 756d 6e73 2c0a 2020  dden_columns,.  
-00011310: 2020 2020 2020 2020 2020 6f72 6465 7269            orderi
-00011320: 6e67 3d63 6f6d 7069 6c65 645f 7661 6c75  ng=compiled_valu
-00011330: 652e 5f6f 7264 6572 696e 672c 0a20 2020  e._ordering,.   
-00011340: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00011350: 5f63 6163 6865 5f77 6974 685f 6f66 6673  _cache_with_offs
-00011360: 6574 7328 7365 6c66 2c20 6172 7261 795f  ets(self, array_
-00011370: 7661 6c75 653a 2063 6f72 652e 4172 7261  value: core.Arra
-00011380: 7956 616c 7565 2920 2d3e 2063 6f72 652e  yValue) -> core.
-00011390: 4172 7261 7956 616c 7565 3a0a 2020 2020  ArrayValue:.    
-000113a0: 2020 2020 2222 2245 7865 6375 7465 7320      """Executes 
-000113b0: 7468 6520 7175 6572 7920 616e 6420 7573  the query and us
-000113c0: 6573 2074 6865 2072 6573 756c 7469 6e67  es the resulting
-000113d0: 2074 6162 6c65 2074 6f20 7265 7772 6974   table to rewrit
-000113e0: 6520 6675 7475 7265 2065 7865 6375 7469  e future executi
-000113f0: 6f6e 732e 2222 220a 2020 2020 2020 2020  ons.""".        
-00011400: 2320 544f 444f 3a20 5573 6520 7468 6973  # TODO: Use this
-00011410: 2066 6f72 2061 6c6c 2065 7865 6375 7469   for all executi
-00011420: 6f6e 733f 2050 726f 626c 656d 2069 7320  ons? Problem is 
-00011430: 7468 6174 2063 6163 6869 6e67 206d 6174  that caching mat
-00011440: 6572 6961 6c69 7a65 7320 6578 7472 610a  erializes extra.
-00011450: 2020 2020 2020 2020 2320 6f72 6465 7269          # orderi
-00011460: 6e67 2063 6f6c 756d 6e73 0a20 2020 2020  ng columns.     
-00011470: 2020 2063 6f6d 7069 6c65 645f 7661 6c75     compiled_valu
-00011480: 6520 3d20 7365 6c66 2e5f 636f 6d70 696c  e = self._compil
-00011490: 655f 6f72 6465 7265 6428 6172 7261 795f  e_ordered(array_
-000114a0: 7661 6c75 6529 0a0a 2020 2020 2020 2020  value)..        
-000114b0: 6962 6973 5f65 7870 7220 3d20 636f 6d70  ibis_expr = comp
-000114c0: 696c 6564 5f76 616c 7565 2e5f 746f 5f69  iled_value._to_i
-000114d0: 6269 735f 6578 7072 280a 2020 2020 2020  bis_expr(.      
-000114e0: 2020 2020 2020 6f72 6465 7269 6e67 5f6d        ordering_m
-000114f0: 6f64 653d 226f 6666 7365 745f 636f 6c22  ode="offset_col"
-00011500: 2c20 6f72 6465 725f 636f 6c5f 6e61 6d65  , order_col_name
-00011510: 3d22 6269 6766 7261 6d65 735f 6f66 6673  ="bigframes_offs
-00011520: 6574 7322 0a20 2020 2020 2020 2029 0a20  ets".        ). 
-00011530: 2020 2020 2020 2074 6d70 5f74 6162 6c65         tmp_table
-00011540: 203d 2073 656c 662e 5f69 6269 735f 746f   = self._ibis_to
-00011550: 5f74 656d 705f 7461 626c 6528 0a20 2020  _temp_table(.   
-00011560: 2020 2020 2020 2020 2069 6269 735f 6578           ibis_ex
-00011570: 7072 2c20 636c 7573 7465 725f 636f 6c73  pr, cluster_cols
-00011580: 3d5b 2262 6967 6672 616d 6573 5f6f 6666  =["bigframes_off
-00011590: 7365 7473 225d 2c20 6170 695f 6e61 6d65  sets"], api_name
-000115a0: 3d22 6361 6368 6564 220a 2020 2020 2020  ="cached".      
-000115b0: 2020 290a 2020 2020 2020 2020 7461 626c    ).        tabl
-000115c0: 655f 6578 7072 6573 7369 6f6e 203d 2073  e_expression = s
-000115d0: 656c 662e 6962 6973 5f63 6c69 656e 742e  elf.ibis_client.
-000115e0: 7461 626c 6528 0a20 2020 2020 2020 2020  table(.         
-000115f0: 2020 2074 6d70 5f74 6162 6c65 2e74 6162     tmp_table.tab
-00011600: 6c65 5f69 642c 0a20 2020 2020 2020 2020  le_id,.         
-00011610: 2020 2073 6368 656d 613d 746d 705f 7461     schema=tmp_ta
-00011620: 626c 652e 6461 7461 7365 745f 6964 2c0a  ble.dataset_id,.
-00011630: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00011640: 6261 7365 3d74 6d70 5f74 6162 6c65 2e70  base=tmp_table.p
-00011650: 726f 6a65 6374 2c0a 2020 2020 2020 2020  roject,.        
-00011660: 290a 2020 2020 2020 2020 6e65 775f 636f  ).        new_co
-00011670: 6c75 6d6e 7320 3d20 5b74 6162 6c65 5f65  lumns = [table_e
-00011680: 7870 7265 7373 696f 6e5b 636f 6c75 6d6e  xpression[column
-00011690: 5d20 666f 7220 636f 6c75 6d6e 2069 6e20  ] for column in 
-000116a0: 636f 6d70 696c 6564 5f76 616c 7565 2e63  compiled_value.c
-000116b0: 6f6c 756d 6e5f 6964 735d 0a20 2020 2020  olumn_ids].     
-000116c0: 2020 206e 6577 5f68 6964 6465 6e5f 636f     new_hidden_co
-000116d0: 6c75 6d6e 7320 3d20 5b74 6162 6c65 5f65  lumns = [table_e
-000116e0: 7870 7265 7373 696f 6e5b 2262 6967 6672  xpression["bigfr
-000116f0: 616d 6573 5f6f 6666 7365 7473 225d 5d0a  ames_offsets"]].
-00011700: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-00011710: 496e 7374 6561 642c 206b 6565 7020 7365  Instead, keep se
-00011720: 7373 696f 6e2d 7769 6465 206d 6170 206f  ssion-wide map o
-00011730: 6620 6361 6368 6564 2072 6573 756c 7473  f cached results
-00011740: 2061 6e64 2061 7574 6f6d 6174 6963 616c   and automatical
-00011750: 6c79 2072 6575 7365 0a20 2020 2020 2020  ly reuse.       
-00011760: 2072 6574 7572 6e20 636f 7265 2e41 7272   return core.Arr
-00011770: 6179 5661 6c75 652e 6672 6f6d 5f69 6269  ayValue.from_ibi
-00011780: 7328 0a20 2020 2020 2020 2020 2020 2073  s(.            s
-00011790: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-000117a0: 2074 6162 6c65 5f65 7870 7265 7373 696f   table_expressio
-000117b0: 6e2c 0a20 2020 2020 2020 2020 2020 2063  n,.            c
-000117c0: 6f6c 756d 6e73 3d6e 6577 5f63 6f6c 756d  olumns=new_colum
-000117d0: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
-000117e0: 6869 6464 656e 5f6f 7264 6572 696e 675f  hidden_ordering_
-000117f0: 636f 6c75 6d6e 733d 6e65 775f 6869 6464  columns=new_hidd
-00011800: 656e 5f63 6f6c 756d 6e73 2c0a 2020 2020  en_columns,.    
-00011810: 2020 2020 2020 2020 6f72 6465 7269 6e67          ordering
-00011820: 3d6f 7264 6572 2e45 7870 7265 7373 696f  =order.Expressio
-00011830: 6e4f 7264 6572 696e 672e 6672 6f6d 5f6f  nOrdering.from_o
-00011840: 6666 7365 745f 636f 6c28 2262 6967 6672  ffset_col("bigfr
-00011850: 616d 6573 5f6f 6666 7365 7473 2229 2c0a  ames_offsets"),.
-00011860: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00011870: 6566 205f 7369 6d70 6c69 6679 5f77 6974  ef _simplify_wit
-00011880: 685f 6361 6368 696e 6728 7365 6c66 2c20  h_caching(self, 
-00011890: 6172 7261 795f 7661 6c75 653a 2063 6f72  array_value: cor
-000118a0: 652e 4172 7261 7956 616c 7565 2920 2d3e  e.ArrayValue) ->
-000118b0: 2063 6f72 652e 4172 7261 7956 616c 7565   core.ArrayValue
-000118c0: 3a0a 2020 2020 2020 2020 2222 2241 7474  :.        """Att
-000118d0: 656d 7074 7320 746f 2068 616e 646c 6520  empts to handle 
-000118e0: 7468 6520 636f 6d70 6c65 7869 7479 2062  the complexity b
-000118f0: 7920 6361 6368 696e 6720 6475 706c 6963  y caching duplic
-00011900: 6174 6564 2073 7562 7472 6565 7320 616e  ated subtrees an
-00011910: 6420 6272 6561 6b69 6e67 2074 6865 2071  d breaking the q
-00011920: 7565 7279 2069 6e74 6f20 7069 6563 6573  uery into pieces
-00011930: 2e22 2222 0a20 2020 2020 2020 2069 6620  .""".        if 
-00011940: 6e6f 7420 6269 6766 7261 6d65 732e 6f70  not bigframes.op
-00011950: 7469 6f6e 732e 636f 6d70 7574 652e 656e  tions.compute.en
-00011960: 6162 6c65 5f6d 756c 7469 5f71 7565 7279  able_multi_query
-00011970: 5f65 7865 6375 7469 6f6e 3a0a 2020 2020  _execution:.    
-00011980: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00011990: 7272 6179 5f76 616c 7565 0a20 2020 2020  rray_value.     
-000119a0: 2020 206e 6f64 6520 3d20 6172 7261 795f     node = array_
-000119b0: 7661 6c75 652e 6e6f 6465 0a20 2020 2020  value.node.     
-000119c0: 2020 2069 6620 6e6f 6465 2e70 6c61 6e6e     if node.plann
-000119d0: 696e 675f 636f 6d70 6c65 7869 7479 203c  ing_complexity <
-000119e0: 2051 5545 5259 5f43 4f4d 504c 4558 4954   QUERY_COMPLEXIT
-000119f0: 595f 4c49 4d49 543a 0a20 2020 2020 2020  Y_LIMIT:.       
-00011a00: 2020 2020 2072 6574 7572 6e20 6172 7261       return arra
-00011a10: 795f 7661 6c75 650a 0a20 2020 2020 2020  y_value..       
-00011a20: 2066 6f72 205f 2069 6e20 7261 6e67 6528   for _ in range(
-00011a30: 4d41 585f 5355 4254 5245 455f 4641 4354  MAX_SUBTREE_FACT
-00011a40: 4f52 494e 4753 293a 0a20 2020 2020 2020  ORINGS):.       
-00011a50: 2020 2020 2075 7064 6174 6564 203d 2073       updated = s
-00011a60: 656c 662e 5f63 6163 6865 5f6d 6f73 745f  elf._cache_most_
-00011a70: 636f 6d70 6c65 785f 7375 6274 7265 6528  complex_subtree(
-00011a80: 6e6f 6465 290a 2020 2020 2020 2020 2020  node).          
-00011a90: 2020 6966 2075 7064 6174 6564 2069 7320    if updated is 
-00011aa0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00011ab0: 2020 2020 2020 7265 7475 726e 2063 6f72        return cor
-00011ac0: 652e 4172 7261 7956 616c 7565 286e 6f64  e.ArrayValue(nod
-00011ad0: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
-00011ae0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00011af0: 2020 2020 206e 6f64 6520 3d20 7570 6461       node = upda
-00011b00: 7465 640a 0a20 2020 2020 2020 2072 6574  ted..        ret
-00011b10: 7572 6e20 636f 7265 2e41 7272 6179 5661  urn core.ArrayVa
-00011b20: 6c75 6528 6e6f 6465 290a 0a20 2020 2064  lue(node)..    d
-00011b30: 6566 205f 6361 6368 655f 6d6f 7374 5f63  ef _cache_most_c
-00011b40: 6f6d 706c 6578 5f73 7562 7472 6565 280a  omplex_subtree(.
-00011b50: 2020 2020 2020 2020 7365 6c66 2c20 6e6f          self, no
-00011b60: 6465 3a20 6e6f 6465 732e 4269 6746 7261  de: nodes.BigFra
-00011b70: 6d65 4e6f 6465 0a20 2020 2029 202d 3e20  meNode.    ) -> 
-00011b80: 4f70 7469 6f6e 616c 5b6e 6f64 6573 2e42  Optional[nodes.B
-00011b90: 6967 4672 616d 654e 6f64 655d 3a0a 2020  igFrameNode]:.  
-00011ba0: 2020 2020 2020 2320 544f 444f 3a20 4966        # TODO: If
-00011bb0: 2071 7565 7279 2066 6169 6c73 2c20 7265   query fails, re
-00011bc0: 7472 7920 7769 7468 206c 6f77 6572 2063  try with lower c
-00011bd0: 6f6d 706c 6578 6974 7920 6c69 6d69 740a  omplexity limit.
-00011be0: 2020 2020 2020 2020 7661 6c69 645f 6361          valid_ca
-00011bf0: 6e64 6964 6174 6573 203d 2074 7261 7665  ndidates = trave
-00011c00: 7273 616c 732e 636f 756e 745f 636f 6d70  rsals.count_comp
-00011c10: 6c65 785f 6e6f 6465 7328 0a20 2020 2020  lex_nodes(.     
-00011c20: 2020 2020 2020 206e 6f64 652c 0a20 2020         node,.   
-00011c30: 2020 2020 2020 2020 206d 696e 5f63 6f6d           min_com
-00011c40: 706c 6578 6974 793d 2851 5545 5259 5f43  plexity=(QUERY_C
-00011c50: 4f4d 504c 4558 4954 595f 4c49 4d49 5420  OMPLEXITY_LIMIT 
-00011c60: 2f20 3530 3029 2c0a 2020 2020 2020 2020  / 500),.        
-00011c70: 2020 2020 6d61 785f 636f 6d70 6c65 7869      max_complexi
-00011c80: 7479 3d51 5545 5259 5f43 4f4d 504c 4558  ty=QUERY_COMPLEX
-00011c90: 4954 595f 4c49 4d49 542c 0a20 2020 2020  ITY_LIMIT,.     
-00011ca0: 2020 2029 2e69 7465 6d73 2829 0a20 2020     ).items().   
-00011cb0: 2020 2020 2023 2048 6575 7269 7374 6963       # Heuristic
-00011cc0: 3a20 7375 6274 7265 655f 636f 6d70 6c65  : subtree_comple
-00011cd0: 6978 7479 202a 2028 636f 7069 6573 206f  ixty * (copies o
-00011ce0: 6620 7375 6274 7265 6529 5e32 0a20 2020  f subtree)^2.   
-00011cf0: 2020 2020 2062 6573 745f 6361 6e64 6964       best_candid
-00011d00: 6174 6520 3d20 6d61 7828 0a20 2020 2020  ate = max(.     
-00011d10: 2020 2020 2020 2076 616c 6964 5f63 616e         valid_can
-00011d20: 6469 6461 7465 732c 0a20 2020 2020 2020  didates,.       
-00011d30: 2020 2020 206b 6579 3d6c 616d 6264 6120       key=lambda 
-00011d40: 693a 2069 5b30 5d2e 706c 616e 6e69 6e67  i: i[0].planning
-00011d50: 5f63 6f6d 706c 6578 6974 7920 2b20 2869  _complexity + (i
-00011d60: 5b31 5d20 2a2a 2032 292c 0a20 2020 2020  [1] ** 2),.     
-00011d70: 2020 2020 2020 2064 6566 6175 6c74 3d4e         default=N
-00011d80: 6f6e 652c 0a20 2020 2020 2020 2029 0a0a  one,.        )..
-00011d90: 2020 2020 2020 2020 6966 2062 6573 745f          if best_
-00011da0: 6361 6e64 6964 6174 6520 6973 204e 6f6e  candidate is Non
-00011db0: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-00011dc0: 204e 6f20 676f 6f64 2073 7562 7472 6565   No good subtree
-00011dd0: 7320 746f 2063 6163 6865 2c20 6a75 7374  s to cache, just
-00011de0: 2072 6574 7572 6e20 6f72 6967 696e 616c   return original
-00011df0: 2074 7265 650a 2020 2020 2020 2020 2020   tree.          
-00011e00: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-00011e10: 2020 2020 2020 2023 2054 4f44 4f3a 2041         # TODO: A
-00011e20: 6464 2063 6c75 7374 6572 696e 6720 636f  dd clustering co
-00011e30: 6c75 6d6e 7320 6261 7365 6420 6f6e 2061  lumns based on a
-00011e40: 6363 6573 7320 7061 7474 6572 6e73 0a20  ccess patterns. 
-00011e50: 2020 2020 2020 206d 6174 6572 6961 6c69         materiali
-00011e60: 7a65 6420 3d20 7365 6c66 2e5f 6361 6368  zed = self._cach
-00011e70: 655f 7769 7468 5f63 6c75 7374 6572 5f63  e_with_cluster_c
-00011e80: 6f6c 7328 0a20 2020 2020 2020 2020 2020  ols(.           
-00011e90: 2063 6f72 652e 4172 7261 7956 616c 7565   core.ArrayValue
-00011ea0: 2862 6573 745f 6361 6e64 6964 6174 655b  (best_candidate[
-00011eb0: 305d 292c 205b 5d0a 2020 2020 2020 2020  0]), [].        
-00011ec0: 292e 6e6f 6465 0a0a 2020 2020 2020 2020  ).node..        
-00011ed0: 7265 7475 726e 2074 7261 7665 7273 616c  return traversal
-00011ee0: 732e 7265 706c 6163 655f 6e6f 6465 7328  s.replace_nodes(
-00011ef0: 0a20 2020 2020 2020 2020 2020 206e 6f64  .            nod
-00011f00: 652c 2074 6f5f 7265 706c 6163 653d 6265  e, to_replace=be
-00011f10: 7374 5f63 616e 6469 6461 7465 5b30 5d2c  st_candidate[0],
-00011f20: 2072 6570 6c61 6365 6d65 6e65 743d 6d61   replacemenet=ma
-00011f30: 7465 7269 616c 697a 6564 0a20 2020 2020  terialized.     
-00011f40: 2020 2029 0a0a 2020 2020 6465 6620 5f69     )..    def _i
-00011f50: 735f 7472 6976 6961 6c6c 795f 6578 6563  s_trivially_exec
-00011f60: 7574 6162 6c65 2873 656c 662c 2061 7272  utable(self, arr
-00011f70: 6179 5f76 616c 7565 3a20 636f 7265 2e41  ay_value: core.A
-00011f80: 7272 6179 5661 6c75 6529 3a0a 2020 2020  rrayValue):.    
-00011f90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00011fa0: 4361 6e20 7468 6520 626c 6f63 6b20 6265  Can the block be
-00011fb0: 2065 7661 6c75 6174 6564 2076 6572 7920   evaluated very 
-00011fc0: 6368 6561 706c 793f 0a20 2020 2020 2020  cheaply?.       
-00011fd0: 2049 6620 5472 7565 2c20 7468 6520 6172   If True, the ar
-00011fe0: 7261 795f 7661 6c75 6520 7072 6f62 6162  ray_value probab
-00011ff0: 6c79 2069 7320 6e6f 7420 776f 7274 6820  ly is not worth 
-00012000: 6361 6368 696e 672e 0a20 2020 2020 2020  caching..       
-00012010: 2022 2222 0a20 2020 2020 2020 2023 204f   """.        # O
-00012020: 6e63 6520 7265 7772 6974 696e 6720 6973  nce rewriting is
-00012030: 2061 7661 696c 6162 6c65 2c20 7769 6c6c   available, will
-00012040: 2077 616e 7420 746f 2072 6577 7269 7465   want to rewrite
-00012050: 2062 6566 6f72 650a 2020 2020 2020 2020   before.        
-00012060: 2320 6576 616c 7561 7469 6e67 2065 7865  # evaluating exe
-00012070: 6375 7469 6f6e 2063 6f73 742e 0a20 2020  cution cost..   
-00012080: 2020 2020 2072 6574 7572 6e20 7472 6176       return trav
-00012090: 6572 7361 6c73 2e69 735f 7472 6976 6961  ersals.is_trivia
-000120a0: 6c6c 795f 6578 6563 7574 6162 6c65 2861  lly_executable(a
-000120b0: 7272 6179 5f76 616c 7565 2e6e 6f64 6529  rray_value.node)
-000120c0: 0a0a 2020 2020 6465 6620 5f65 7865 6375  ..    def _execu
-000120d0: 7465 280a 2020 2020 2020 2020 7365 6c66  te(.        self
-000120e0: 2c0a 2020 2020 2020 2020 6172 7261 795f  ,.        array_
-000120f0: 7661 6c75 653a 2063 6f72 652e 4172 7261  value: core.Arra
-00012100: 7956 616c 7565 2c0a 2020 2020 2020 2020  yValue,.        
-00012110: 6a6f 625f 636f 6e66 6967 3a20 4f70 7469  job_config: Opti
-00012120: 6f6e 616c 5b62 6967 7175 6572 792e 6a6f  onal[bigquery.jo
-00012130: 622e 5175 6572 794a 6f62 436f 6e66 6967  b.QueryJobConfig
-00012140: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00012150: 2020 2a2c 0a20 2020 2020 2020 2073 6f72    *,.        sor
-00012160: 7465 643a 2062 6f6f 6c20 3d20 5472 7565  ted: bool = True
-00012170: 2c0a 2020 2020 2020 2020 6472 795f 7275  ,.        dry_ru
-00012180: 6e3d 4661 6c73 652c 0a20 2020 2020 2020  n=False,.       
-00012190: 2063 6f6c 5f69 645f 6f76 6572 7269 6465   col_id_override
-000121a0: 733a 204d 6170 7069 6e67 5b73 7472 2c20  s: Mapping[str, 
-000121b0: 7374 725d 203d 207b 7d2c 0a20 2020 2029  str] = {},.    )
-000121c0: 202d 3e20 7475 706c 655b 6269 6771 7565   -> tuple[bigque
-000121d0: 7279 2e74 6162 6c65 2e52 6f77 4974 6572  ry.table.RowIter
-000121e0: 6174 6f72 2c20 6269 6771 7565 7279 2e51  ator, bigquery.Q
-000121f0: 7565 7279 4a6f 625d 3a0a 2020 2020 2020  ueryJob]:.      
-00012200: 2020 7371 6c20 3d20 7365 6c66 2e5f 746f    sql = self._to
-00012210: 5f73 716c 280a 2020 2020 2020 2020 2020  _sql(.          
-00012220: 2020 6172 7261 795f 7661 6c75 652c 2073    array_value, s
-00012230: 6f72 7465 643d 736f 7274 6564 2c20 636f  orted=sorted, co
-00012240: 6c5f 6964 5f6f 7665 7272 6964 6573 3d63  l_id_overrides=c
-00012250: 6f6c 5f69 645f 6f76 6572 7269 6465 730a  ol_id_overrides.
-00012260: 2020 2020 2020 2020 2920 2023 2074 7970          )  # typ
-00012270: 653a 6967 6e6f 7265 0a20 2020 2020 2020  e:ignore.       
-00012280: 2069 6620 6a6f 625f 636f 6e66 6967 2069   if job_config i
-00012290: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-000122a0: 2020 2020 6a6f 625f 636f 6e66 6967 203d      job_config =
-000122b0: 2062 6967 7175 6572 792e 5175 6572 794a   bigquery.QueryJ
-000122c0: 6f62 436f 6e66 6967 2864 7279 5f72 756e  obConfig(dry_run
-000122d0: 3d64 7279 5f72 756e 290a 2020 2020 2020  =dry_run).      
-000122e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000122f0: 2020 2020 6a6f 625f 636f 6e66 6967 2e64      job_config.d
-00012300: 7279 5f72 756e 203d 2064 7279 5f72 756e  ry_run = dry_run
-00012310: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012320: 7365 6c66 2e5f 7374 6172 745f 7175 6572  self._start_quer
-00012330: 7928 0a20 2020 2020 2020 2020 2020 2073  y(.            s
-00012340: 716c 3d73 716c 2c0a 2020 2020 2020 2020  ql=sql,.        
-00012350: 2020 2020 6a6f 625f 636f 6e66 6967 3d6a      job_config=j
-00012360: 6f62 5f63 6f6e 6669 672c 0a20 2020 2020  ob_config,.     
-00012370: 2020 2029 0a0a 2020 2020 6465 6620 5f70     )..    def _p
-00012380: 6565 6b28 0a20 2020 2020 2020 2073 656c  eek(.        sel
-00012390: 662c 2061 7272 6179 5f76 616c 7565 3a20  f, array_value: 
-000123a0: 636f 7265 2e41 7272 6179 5661 6c75 652c  core.ArrayValue,
-000123b0: 206e 5f72 6f77 733a 2069 6e74 0a20 2020   n_rows: int.   
-000123c0: 2029 202d 3e20 7475 706c 655b 6269 6771   ) -> tuple[bigq
-000123d0: 7565 7279 2e74 6162 6c65 2e52 6f77 4974  uery.table.RowIt
-000123e0: 6572 6174 6f72 2c20 6269 6771 7565 7279  erator, bigquery
-000123f0: 2e51 7565 7279 4a6f 625d 3a0a 2020 2020  .QueryJob]:.    
-00012400: 2020 2020 2222 2241 2027 7065 656b 2720      """A 'peek' 
-00012410: 6566 6669 6369 656e 746c 7920 6163 6365  efficiently acce
-00012420: 7373 6573 2061 2073 6d61 6c6c 206e 756d  sses a small num
-00012430: 6265 7220 6f66 2072 6f77 7320 696e 2074  ber of rows in t
-00012440: 6865 2064 6174 6166 7261 6d65 2e22 2222  he dataframe."""
-00012450: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00012460: 7472 6565 5f70 726f 7065 7274 6965 732e  tree_properties.
-00012470: 7065 656b 6162 6c65 2861 7272 6179 5f76  peekable(array_v
-00012480: 616c 7565 2e6e 6f64 6529 3a0a 2020 2020  alue.node):.    
-00012490: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
-000124a0: 2e77 6172 6e28 2250 6565 6b69 6e67 2074  .warn("Peeking t
-000124b0: 6869 7320 7661 6c75 6520 6361 6e6e 6f74  his value cannot
-000124c0: 2062 6520 646f 6e65 2065 6666 6963 6965   be done efficie
-000124d0: 6e74 6c79 2e22 290a 2020 2020 2020 2020  ntly.").        
-000124e0: 7371 6c20 3d20 7365 6c66 2e5f 636f 6d70  sql = self._comp
-000124f0: 696c 655f 756e 6f72 6465 7265 6428 6172  ile_unordered(ar
-00012500: 7261 795f 7661 6c75 6529 2e70 6565 6b5f  ray_value).peek_
-00012510: 7371 6c28 6e5f 726f 7773 290a 2020 2020  sql(n_rows).    
-00012520: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00012530: 5f73 7461 7274 5f71 7565 7279 280a 2020  _start_query(.  
-00012540: 2020 2020 2020 2020 2020 7371 6c3d 7371            sql=sq
-00012550: 6c2c 0a20 2020 2020 2020 2029 0a0a 2020  l,.        )..  
-00012560: 2020 6465 6620 5f74 6f5f 7371 6c28 0a20    def _to_sql(. 
-00012570: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00012580: 2020 2020 2061 7272 6179 5f76 616c 7565       array_value
-00012590: 3a20 636f 7265 2e41 7272 6179 5661 6c75  : core.ArrayValu
-000125a0: 652c 0a20 2020 2020 2020 206f 6666 7365  e,.        offse
-000125b0: 745f 636f 6c75 6d6e 3a20 7479 7069 6e67  t_column: typing
-000125c0: 2e4f 7074 696f 6e61 6c5b 7374 725d 203d  .Optional[str] =
-000125d0: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
-000125e0: 6f6c 5f69 645f 6f76 6572 7269 6465 733a  ol_id_overrides:
-000125f0: 2074 7970 696e 672e 4d61 7070 696e 675b   typing.Mapping[
-00012600: 7374 722c 2073 7472 5d20 3d20 7b7d 2c0a  str, str] = {},.
-00012610: 2020 2020 2020 2020 736f 7274 6564 3a20          sorted: 
-00012620: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-00012630: 2020 2920 2d3e 2073 7472 3a0a 2020 2020    ) -> str:.    
-00012640: 2020 2020 6966 206f 6666 7365 745f 636f      if offset_co
-00012650: 6c75 6d6e 3a0a 2020 2020 2020 2020 2020  lumn:.          
-00012660: 2020 6172 7261 795f 7661 6c75 6520 3d20    array_value = 
-00012670: 6172 7261 795f 7661 6c75 652e 7072 6f6d  array_value.prom
-00012680: 6f74 655f 6f66 6673 6574 7328 6f66 6673  ote_offsets(offs
-00012690: 6574 5f63 6f6c 756d 6e29 0a20 2020 2020  et_column).     
-000126a0: 2020 2069 6620 736f 7274 6564 3a0a 2020     if sorted:.  
-000126b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000126c0: 2073 656c 662e 5f63 6f6d 7069 6c65 5f6f   self._compile_o
-000126d0: 7264 6572 6564 2861 7272 6179 5f76 616c  rdered(array_val
-000126e0: 7565 292e 746f 5f73 716c 280a 2020 2020  ue).to_sql(.    
-000126f0: 2020 2020 2020 2020 2020 2020 636f 6c5f              col_
-00012700: 6964 5f6f 7665 7272 6964 6573 3d63 6f6c  id_overrides=col
-00012710: 5f69 645f 6f76 6572 7269 6465 732c 2073  _id_overrides, s
-00012720: 6f72 7465 643d 5472 7565 0a20 2020 2020  orted=True.     
-00012730: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00012740: 2072 6574 7572 6e20 7365 6c66 2e5f 636f   return self._co
-00012750: 6d70 696c 655f 756e 6f72 6465 7265 6428  mpile_unordered(
-00012760: 6172 7261 795f 7661 6c75 6529 2e74 6f5f  array_value).to_
-00012770: 7371 6c28 0a20 2020 2020 2020 2020 2020  sql(.           
-00012780: 2063 6f6c 5f69 645f 6f76 6572 7269 6465   col_id_override
-00012790: 733d 636f 6c5f 6964 5f6f 7665 7272 6964  s=col_id_overrid
-000127a0: 6573 0a20 2020 2020 2020 2029 0a0a 2020  es.        )..  
-000127b0: 2020 6465 6620 5f63 6f6d 7069 6c65 5f6f    def _compile_o
-000127c0: 7264 6572 6564 280a 2020 2020 2020 2020  rdered(.        
-000127d0: 7365 6c66 2c20 6172 7261 795f 7661 6c75  self, array_valu
-000127e0: 653a 2063 6f72 652e 4172 7261 7956 616c  e: core.ArrayVal
-000127f0: 7565 0a20 2020 2029 202d 3e20 6269 6766  ue.    ) -> bigf
-00012800: 7261 6d65 732e 636f 7265 2e63 6f6d 7069  rames.core.compi
-00012810: 6c65 2e4f 7264 6572 6564 4952 3a0a 2020  le.OrderedIR:.  
-00012820: 2020 2020 2020 7265 7475 726e 2062 6967        return big
-00012830: 6672 616d 6573 2e63 6f72 652e 636f 6d70  frames.core.comp
-00012840: 696c 652e 636f 6d70 696c 655f 6f72 6465  ile.compile_orde
-00012850: 7265 645f 6972 2861 7272 6179 5f76 616c  red_ir(array_val
-00012860: 7565 2e6e 6f64 6529 0a0a 2020 2020 6465  ue.node)..    de
-00012870: 6620 5f63 6f6d 7069 6c65 5f75 6e6f 7264  f _compile_unord
-00012880: 6572 6564 280a 2020 2020 2020 2020 7365  ered(.        se
-00012890: 6c66 2c20 6172 7261 795f 7661 6c75 653a  lf, array_value:
-000128a0: 2063 6f72 652e 4172 7261 7956 616c 7565   core.ArrayValue
-000128b0: 0a20 2020 2029 202d 3e20 6269 6766 7261  .    ) -> bigfra
-000128c0: 6d65 732e 636f 7265 2e63 6f6d 7069 6c65  mes.core.compile
-000128d0: 2e55 6e6f 7264 6572 6564 4952 3a0a 2020  .UnorderedIR:.  
-000128e0: 2020 2020 2020 7265 7475 726e 2062 6967        return big
-000128f0: 6672 616d 6573 2e63 6f72 652e 636f 6d70  frames.core.comp
-00012900: 696c 652e 636f 6d70 696c 655f 756e 6f72  ile.compile_unor
-00012910: 6465 7265 645f 6972 2861 7272 6179 5f76  dered_ir(array_v
-00012920: 616c 7565 2e6e 6f64 6529 0a0a 2020 2020  alue.node)..    
-00012930: 6465 6620 5f67 6574 5f74 6162 6c65 5f73  def _get_table_s
-00012940: 697a 6528 7365 6c66 2c20 6465 7374 696e  ize(self, destin
-00012950: 6174 696f 6e5f 7461 626c 6529 3a0a 2020  ation_table):.  
-00012960: 2020 2020 2020 7461 626c 6520 3d20 7365        table = se
-00012970: 6c66 2e62 7163 6c69 656e 742e 6765 745f  lf.bqclient.get_
-00012980: 7461 626c 6528 6465 7374 696e 6174 696f  table(destinatio
-00012990: 6e5f 7461 626c 6529 0a20 2020 2020 2020  n_table).       
-000129a0: 2072 6574 7572 6e20 7461 626c 652e 6e75   return table.nu
-000129b0: 6d5f 6279 7465 730a 0a20 2020 2064 6566  m_bytes..    def
-000129c0: 205f 726f 7773 5f74 6f5f 6461 7461 6672   _rows_to_datafr
-000129d0: 616d 6528 0a20 2020 2020 2020 2073 656c  ame(.        sel
-000129e0: 662c 2072 6f77 5f69 7465 7261 746f 723a  f, row_iterator:
-000129f0: 2062 6967 7175 6572 792e 7461 626c 652e   bigquery.table.
-00012a00: 526f 7749 7465 7261 746f 722c 2064 7479  RowIterator, dty
-00012a10: 7065 733a 2044 6963 740a 2020 2020 2920  pes: Dict.    ) 
-00012a20: 2d3e 2070 616e 6461 732e 4461 7461 4672  -> pandas.DataFr
-00012a30: 616d 653a 0a20 2020 2020 2020 2023 2043  ame:.        # C
-00012a40: 616e 2069 676e 6f72 6520 696e 6665 7272  an ignore inferr
-00012a50: 6564 2064 6174 6174 7970 6520 756e 7469  ed datatype unti
-00012a60: 6c20 6474 7970 6520 656d 756c 6174 696f  l dtype emulatio
-00012a70: 6e20 6272 6561 6b73 2031 3a31 206d 6170  n breaks 1:1 map
-00012a80: 7069 6e67 2062 6574 7765 656e 2042 5120  ping between BQ 
-00012a90: 7479 7065 7320 616e 6420 6269 6766 7261  types and bigfra
-00012aa0: 6d65 7320 7479 7065 730a 2020 2020 2020  mes types.      
-00012ab0: 2020 6474 7970 6573 5f66 726f 6d5f 6271    dtypes_from_bq
-00012ac0: 203d 2062 6967 6672 616d 6573 2e64 7479   = bigframes.dty
-00012ad0: 7065 732e 6266 5f74 7970 655f 6672 6f6d  pes.bf_type_from
-00012ae0: 5f74 7970 655f 6b69 6e64 2872 6f77 5f69  _type_kind(row_i
-00012af0: 7465 7261 746f 722e 7363 6865 6d61 290a  terator.schema).
-00012b00: 2020 2020 2020 2020 6172 726f 775f 7461          arrow_ta
-00012b10: 626c 6520 3d20 726f 775f 6974 6572 6174  ble = row_iterat
-00012b20: 6f72 2e74 6f5f 6172 726f 7728 290a 2020  or.to_arrow().  
-00012b30: 2020 2020 2020 7265 7475 726e 2062 6967        return big
-00012b40: 6672 616d 6573 2e73 6573 7369 6f6e 2e5f  frames.session._
-00012b50: 696f 2e70 616e 6461 732e 6172 726f 775f  io.pandas.arrow_
-00012b60: 746f 5f70 616e 6461 7328 6172 726f 775f  to_pandas(arrow_
-00012b70: 7461 626c 652c 2064 7479 7065 735f 6672  table, dtypes_fr
-00012b80: 6f6d 5f62 7129 0a0a 2020 2020 6465 6620  om_bq)..    def 
-00012b90: 5f73 7461 7274 5f67 656e 6572 6963 5f6a  _start_generic_j
-00012ba0: 6f62 2873 656c 662c 206a 6f62 3a20 666f  ob(self, job: fo
-00012bb0: 726d 6174 7469 6e67 5f68 656c 7065 7273  rmatting_helpers
-00012bc0: 2e47 656e 6572 6963 4a6f 6229 3a0a 2020  .GenericJob):.  
-00012bd0: 2020 2020 2020 6966 2062 6967 6672 616d        if bigfram
-00012be0: 6573 2e6f 7074 696f 6e73 2e64 6973 706c  es.options.displ
-00012bf0: 6179 2e70 726f 6772 6573 735f 6261 7220  ay.progress_bar 
-00012c00: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00012c10: 2020 2020 2020 2020 2066 6f72 6d61 7474           formatt
-00012c20: 696e 675f 6865 6c70 6572 732e 7761 6974  ing_helpers.wait
-00012c30: 5f66 6f72 5f6a 6f62 280a 2020 2020 2020  _for_job(.      
-00012c40: 2020 2020 2020 2020 2020 6a6f 622c 2062            job, b
-00012c50: 6967 6672 616d 6573 2e6f 7074 696f 6e73  igframes.options
-00012c60: 2e64 6973 706c 6179 2e70 726f 6772 6573  .display.progres
-00012c70: 735f 6261 720a 2020 2020 2020 2020 2020  s_bar.          
-00012c80: 2020 2920 2023 2057 6169 7420 666f 7220    )  # Wait for 
-00012c90: 7468 6520 6a6f 6220 746f 2063 6f6d 706c  the job to compl
-00012ca0: 6574 650a 2020 2020 2020 2020 656c 7365  ete.        else
-00012cb0: 3a0a 2020 2020 2020 2020 2020 2020 6a6f  :.            jo
-00012cc0: 622e 7265 7375 6c74 2829 0a0a 2020 2020  b.result()..    
-00012cd0: 6465 6620 5f72 616e 646f 6d5f 7461 626c  def _random_tabl
-00012ce0: 6528 7365 6c66 2c20 736b 6970 5f63 6c65  e(self, skip_cle
-00012cf0: 616e 7570 3a20 626f 6f6c 203d 2046 616c  anup: bool = Fal
-00012d00: 7365 2920 2d3e 2062 6967 7175 6572 792e  se) -> bigquery.
-00012d10: 5461 626c 6552 6566 6572 656e 6365 3a0a  TableReference:.
-00012d20: 2020 2020 2020 2020 2222 2247 656e 6572          """Gener
-00012d30: 6174 6520 6120 7261 6e64 6f6d 2074 6162  ate a random tab
-00012d40: 6c65 2049 4420 7769 7468 2042 6967 5175  le ID with BigQu
-00012d50: 6572 7920 4461 7461 4672 616d 6573 2070  ery DataFrames p
-00012d60: 7265 6669 782e 0a0a 2020 2020 2020 2020  refix...        
-00012d70: 5468 6520 6765 6e65 7261 7465 6420 4944  The generated ID
-00012d80: 2077 696c 6c20 6265 2073 746f 7265 6420   will be stored 
-00012d90: 616e 6420 6368 6563 6b65 6420 666f 7220  and checked for 
-00012da0: 6465 6c65 7469 6f6e 2077 6865 6e20 7468  deletion when th
-00012db0: 650a 2020 2020 2020 2020 7365 7373 696f  e.        sessio
-00012dc0: 6e20 6973 2063 6c6f 7365 642c 2075 6e6c  n is closed, unl
-00012dd0: 6573 7320 736b 6970 5f63 6c65 616e 7570  ess skip_cleanup
-00012de0: 2069 7320 5472 7565 2e0a 0a20 2020 2020   is True...     
-00012df0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00012e00: 2020 2020 2073 6b69 705f 636c 6561 6e75       skip_cleanu
-00012e10: 7020 2862 6f6f 6c2c 2064 6566 6175 6c74  p (bool, default
-00012e20: 2046 616c 7365 293a 0a20 2020 2020 2020   False):.       
-00012e30: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-00012e40: 2c20 646f 206e 6f74 2061 6464 2074 6865  , do not add the
-00012e50: 2067 656e 6572 6174 6564 2049 4420 746f   generated ID to
-00012e60: 2074 6865 206c 6973 7420 6f66 2074 6162   the list of tab
-00012e70: 6c65 730a 2020 2020 2020 2020 2020 2020  les.            
-00012e80: 2020 2020 746f 2063 6c65 616e 2075 7020      to clean up 
-00012e90: 7768 656e 2074 6865 2073 6573 7369 6f6e  when the session
-00012ea0: 2069 7320 636c 6f73 6564 2e0a 0a20 2020   is closed...   
-00012eb0: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
-00012ec0: 2020 2020 2020 2020 2020 676f 6f67 6c65            google
-00012ed0: 2e63 6c6f 7564 2e62 6967 7175 6572 792e  .cloud.bigquery.
-00012ee0: 5461 626c 6552 6566 6572 656e 6365 3a0a  TableReference:.
-00012ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f00: 4675 6c6c 7920 7175 616c 6966 6965 6420  Fully qualified 
-00012f10: 7461 626c 6520 4944 206f 6620 6120 7461  table ID of a ta
-00012f20: 626c 6520 7468 6174 2064 6f65 736e 2774  ble that doesn't
-00012f30: 2065 7869 7374 2e0a 2020 2020 2020 2020   exist..        
-00012f40: 2222 220a 2020 2020 2020 2020 6461 7461  """.        data
-00012f50: 7365 7420 3d20 7365 6c66 2e5f 616e 6f6e  set = self._anon
-00012f60: 796d 6f75 735f 6461 7461 7365 740a 2020  ymous_dataset.  
-00012f70: 2020 2020 2020 7365 7373 696f 6e5f 6964        session_id
-00012f80: 203d 2073 656c 662e 7365 7373 696f 6e5f   = self.session_
-00012f90: 6964 0a20 2020 2020 2020 206e 6f77 203d  id.        now =
-00012fa0: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
-00012fb0: 6d65 2e6e 6f77 2864 6174 6574 696d 652e  me.now(datetime.
-00012fc0: 7469 6d65 7a6f 6e65 2e75 7463 290a 2020  timezone.utc).  
-00012fd0: 2020 2020 2020 7261 6e64 6f6d 5f69 6420        random_id 
-00012fe0: 3d20 7575 6964 2e75 7569 6434 2829 2e68  = uuid.uuid4().h
-00012ff0: 6578 0a20 2020 2020 2020 2074 6162 6c65  ex.        table
-00013000: 5f69 6420 3d20 5f54 454d 505f 5441 424c  _id = _TEMP_TABL
-00013010: 455f 4944 5f46 4f52 4d41 542e 666f 726d  E_ID_FORMAT.form
-00013020: 6174 280a 2020 2020 2020 2020 2020 2020  at(.            
-00013030: 6461 7465 3d6e 6f77 2e73 7472 6674 696d  date=now.strftim
-00013040: 6528 2225 5925 6d25 6422 292c 2073 6573  e("%Y%m%d"), ses
-00013050: 7369 6f6e 5f69 643d 7365 7373 696f 6e5f  sion_id=session_
-00013060: 6964 2c20 7261 6e64 6f6d 5f69 643d 7261  id, random_id=ra
-00013070: 6e64 6f6d 5f69 640a 2020 2020 2020 2020  ndom_id.        
-00013080: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-00013090: 2073 6b69 705f 636c 6561 6e75 703a 0a20   skip_cleanup:. 
-000130a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000130b0: 5f74 6162 6c65 5f69 6473 2e61 7070 656e  _table_ids.appen
-000130c0: 6428 7461 626c 655f 6964 290a 2020 2020  d(table_id).    
-000130d0: 2020 2020 7265 7475 726e 2064 6174 6173      return datas
-000130e0: 6574 2e74 6162 6c65 2874 6162 6c65 5f69  et.table(table_i
-000130f0: 6429 0a0a 0a64 6566 2063 6f6e 6e65 6374  d)...def connect
-00013100: 2863 6f6e 7465 7874 3a20 4f70 7469 6f6e  (context: Option
-00013110: 616c 5b62 6967 7175 6572 795f 6f70 7469  al[bigquery_opti
-00013120: 6f6e 732e 4269 6751 7565 7279 4f70 7469  ons.BigQueryOpti
-00013130: 6f6e 735d 203d 204e 6f6e 6529 202d 3e20  ons] = None) -> 
-00013140: 5365 7373 696f 6e3a 0a20 2020 2072 6574  Session:.    ret
-00013150: 7572 6e20 5365 7373 696f 6e28 636f 6e74  urn Session(cont
-00013160: 6578 7429 0a0a 0a64 6566 205f 6361 6e5f  ext)...def _can_
-00013170: 636c 7573 7465 725f 6271 2866 6965 6c64  cluster_bq(field
-00013180: 3a20 6269 6771 7565 7279 2e53 6368 656d  : bigquery.Schem
-00013190: 6146 6965 6c64 293a 0a20 2020 2023 2068  aField):.    # h
-000131a0: 7474 7073 3a2f 2f63 6c6f 7564 2e67 6f6f  ttps://cloud.goo
-000131b0: 676c 652e 636f 6d2f 6269 6771 7565 7279  gle.com/bigquery
-000131c0: 2f64 6f63 732f 636c 7573 7465 7265 642d  /docs/clustered-
-000131d0: 7461 626c 6573 0a20 2020 2023 204e 6f74  tables.    # Not
-000131e0: 6162 6c79 2c20 666c 6f61 7420 6973 2065  ably, float is e
-000131f0: 7863 6c75 6465 640a 2020 2020 7479 7065  xcluded.    type
-00013200: 5f20 3d20 6669 656c 642e 6669 656c 645f  _ = field.field_
-00013210: 7479 7065 0a20 2020 2072 6574 7572 6e20  type.    return 
-00013220: 7479 7065 5f20 696e 2028 0a20 2020 2020  type_ in (.     
-00013230: 2020 2022 494e 5445 4745 5222 2c0a 2020     "INTEGER",.  
-00013240: 2020 2020 2020 2249 4e54 3634 222c 0a20        "INT64",. 
-00013250: 2020 2020 2020 2022 5354 5249 4e47 222c         "STRING",
-00013260: 0a20 2020 2020 2020 2022 4e55 4d45 5249  .        "NUMERI
-00013270: 4322 2c0a 2020 2020 2020 2020 2244 4543  C",.        "DEC
-00013280: 494d 414c 222c 0a20 2020 2020 2020 2022  IMAL",.        "
-00013290: 4249 474e 554d 4552 4943 222c 0a20 2020  BIGNUMERIC",.   
-000132a0: 2020 2020 2022 4249 4744 4543 494d 414c       "BIGDECIMAL
-000132b0: 222c 0a20 2020 2020 2020 2022 4441 5445  ",.        "DATE
-000132c0: 222c 0a20 2020 2020 2020 2022 4441 5445  ",.        "DATE
-000132d0: 5449 4d45 222c 0a20 2020 2020 2020 2022  TIME",.        "
-000132e0: 5449 4d45 5354 414d 5022 2c0a 2020 2020  TIMESTAMP",.    
-000132f0: 2020 2020 2242 4f4f 4c22 2c0a 2020 2020      "BOOL",.    
-00013300: 2020 2020 2242 4f4f 4c45 414e 222c 0a20      "BOOLEAN",. 
-00013310: 2020 2029 0a0a 0a64 6566 205f 7472 616e     )...def _tran
-00013320: 7366 6f72 6d5f 7265 6164 5f67 6271 5f63  sform_read_gbq_c
-00013330: 6f6e 6669 6775 7261 7469 6f6e 2863 6f6e  onfiguration(con
-00013340: 6669 6775 7261 7469 6f6e 3a20 4f70 7469  figuration: Opti
-00013350: 6f6e 616c 5b64 6963 745d 2920 2d3e 2064  onal[dict]) -> d
-00013360: 6963 743a 0a20 2020 2022 2222 0a20 2020  ict:.    """.   
-00013370: 2046 6f72 2062 6163 6b77 6172 6473 2d63   For backwards-c
-00013380: 6f6d 7061 7469 6269 6c69 7479 2c20 636f  ompatibility, co
-00013390: 6e76 6572 7420 616e 7920 7072 6576 696f  nvert any previo
-000133a0: 7573 6c79 2063 6c69 656e 742d 7369 6465  usly client-side
-000133b0: 206f 6e6c 790a 2020 2020 7061 7261 6d65   only.    parame
-000133c0: 7465 7273 2073 7563 6820 6173 2074 696d  ters such as tim
-000133d0: 656f 7574 4d73 2074 6f20 7468 6520 7072  eoutMs to the pr
-000133e0: 6f70 6572 7479 206e 616d 6520 6578 7065  operty name expe
-000133f0: 6374 6564 2062 7920 7468 6520 5245 5354  cted by the REST
-00013400: 2041 5049 2e0a 0a20 2020 204d 616b 6573   API...    Makes
-00013410: 2061 2063 6f70 7920 6f66 2063 6f6e 6669   a copy of confi
-00013420: 6775 7261 7469 6f6e 2069 6620 6368 616e  guration if chan
-00013430: 6765 7320 6172 6520 6e65 6564 6564 2e0a  ges are needed..
-00013440: 2020 2020 2222 220a 0a20 2020 2069 6620      """..    if 
-00013450: 636f 6e66 6967 7572 6174 696f 6e20 6973  configuration is
-00013460: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
-00013470: 6574 7572 6e20 7b7d 0a0a 2020 2020 7469  eturn {}..    ti
-00013480: 6d65 6f75 745f 6d73 203d 2063 6f6e 6669  meout_ms = confi
-00013490: 6775 7261 7469 6f6e 2e67 6574 2822 7175  guration.get("qu
-000134a0: 6572 7922 2c20 7b7d 292e 6765 7428 2274  ery", {}).get("t
-000134b0: 696d 656f 7574 4d73 2229 0a20 2020 2069  imeoutMs").    i
-000134c0: 6620 7469 6d65 6f75 745f 6d73 2069 7320  f timeout_ms is 
-000134d0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000134e0: 2020 2320 5472 616e 7366 6f72 6d20 7469    # Transform ti
-000134f0: 6d65 6f75 744d 7320 746f 2061 6e20 6163  meoutMs to an ac
-00013500: 7475 616c 2073 6572 7665 722d 7369 6465  tual server-side
-00013510: 2063 6f6e 6669 6775 7261 7469 6f6e 2e0a   configuration..
-00013520: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
-00013530: 2f2f 6769 7468 7562 2e63 6f6d 2f67 6f6f  //github.com/goo
-00013540: 676c 6561 7069 732f 7079 7468 6f6e 2d62  gleapis/python-b
-00013550: 6967 7175 6572 792d 7061 6e64 6173 2f69  igquery-pandas/i
-00013560: 7373 7565 732f 3437 390a 2020 2020 2020  ssues/479.      
-00013570: 2020 636f 6e66 6967 7572 6174 696f 6e20    configuration 
-00013580: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-00013590: 636f 6e66 6967 7572 6174 696f 6e29 0a20  configuration). 
-000135a0: 2020 2020 2020 2064 656c 2063 6f6e 6669         del confi
-000135b0: 6775 7261 7469 6f6e 5b22 7175 6572 7922  guration["query"
-000135c0: 5d5b 2274 696d 656f 7574 4d73 225d 0a20  ]["timeoutMs"]. 
-000135d0: 2020 2020 2020 2063 6f6e 6669 6775 7261         configura
-000135e0: 7469 6f6e 5b22 6a6f 6254 696d 656f 7574  tion["jobTimeout
-000135f0: 4d73 225d 203d 2074 696d 656f 7574 5f6d  Ms"] = timeout_m
-00013600: 730a 0a20 2020 2072 6574 7572 6e20 636f  s..    return co
-00013610: 6e66 6967 7572 6174 696f 6e0a            nfiguration.
+0000bb70: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
+0000bb80: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000bb90: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000bba0: 5f72 6561 645f 7061 6e64 6173 2870 616e  _read_pandas(pan
+0000bbb0: 6461 735f 6466 2c20 2272 6561 645f 6373  das_df, "read_cs
+0000bbc0: 7622 2920 2023 2074 7970 653a 2069 676e  v")  # type: ign
+0000bbd0: 6f72 650a 0a20 2020 2064 6566 2072 6561  ore..    def rea
+0000bbe0: 645f 7069 636b 6c65 280a 2020 2020 2020  d_pickle(.      
+0000bbf0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0000bc00: 6669 6c65 7061 7468 5f6f 725f 6275 6666  filepath_or_buff
+0000bc10: 6572 3a20 4669 6c65 5061 7468 207c 2052  er: FilePath | R
+0000bc20: 6561 6450 6963 6b6c 6542 7566 6665 722c  eadPickleBuffer,
+0000bc30: 0a20 2020 2020 2020 2063 6f6d 7072 6573  .        compres
+0000bc40: 7369 6f6e 3a20 436f 6d70 7265 7373 696f  sion: Compressio
+0000bc50: 6e4f 7074 696f 6e73 203d 2022 696e 6665  nOptions = "infe
+0000bc60: 7222 2c0a 2020 2020 2020 2020 7374 6f72  r",.        stor
+0000bc70: 6167 655f 6f70 7469 6f6e 733a 2053 746f  age_options: Sto
+0000bc80: 7261 6765 4f70 7469 6f6e 7320 3d20 4e6f  rageOptions = No
+0000bc90: 6e65 2c0a 2020 2020 293a 0a20 2020 2020  ne,.    ):.     
+0000bca0: 2020 2070 616e 6461 735f 6f62 6a20 3d20     pandas_obj = 
+0000bcb0: 7061 6e64 6173 2e72 6561 645f 7069 636b  pandas.read_pick
+0000bcc0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+0000bcd0: 6669 6c65 7061 7468 5f6f 725f 6275 6666  filepath_or_buff
+0000bce0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+0000bcf0: 636f 6d70 7265 7373 696f 6e3d 636f 6d70  compression=comp
+0000bd00: 7265 7373 696f 6e2c 0a20 2020 2020 2020  ression,.       
+0000bd10: 2020 2020 2073 746f 7261 6765 5f6f 7074       storage_opt
+0000bd20: 696f 6e73 3d73 746f 7261 6765 5f6f 7074  ions=storage_opt
+0000bd30: 696f 6e73 2c0a 2020 2020 2020 2020 290a  ions,.        ).
+0000bd40: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0000bd50: 7374 616e 6365 2870 616e 6461 735f 6f62  stance(pandas_ob
+0000bd60: 6a2c 2070 616e 6461 732e 5365 7269 6573  j, pandas.Series
+0000bd70: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+0000bd80: 6620 7061 6e64 6173 5f6f 626a 2e6e 616d  f pandas_obj.nam
+0000bd90: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+0000bda0: 2020 2020 2020 2020 2020 2070 616e 6461             panda
+0000bdb0: 735f 6f62 6a2e 6e61 6d65 203d 2022 3022  s_obj.name = "0"
+0000bdc0: 0a20 2020 2020 2020 2020 2020 2062 6967  .            big
+0000bdd0: 6672 616d 6573 5f64 6620 3d20 7365 6c66  frames_df = self
+0000bde0: 2e5f 7265 6164 5f70 616e 6461 7328 7061  ._read_pandas(pa
+0000bdf0: 6e64 6173 5f6f 626a 2e74 6f5f 6672 616d  ndas_obj.to_fram
+0000be00: 6528 292c 2022 7265 6164 5f70 6963 6b6c  e(), "read_pickl
+0000be10: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
+0000be20: 7265 7475 726e 2062 6967 6672 616d 6573  return bigframes
+0000be30: 5f64 665b 6269 6766 7261 6d65 735f 6466  _df[bigframes_df
+0000be40: 2e63 6f6c 756d 6e73 5b30 5d5d 0a20 2020  .columns[0]].   
+0000be50: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000be60: 2e5f 7265 6164 5f70 616e 6461 7328 7061  ._read_pandas(pa
+0000be70: 6e64 6173 5f6f 626a 2c20 2272 6561 645f  ndas_obj, "read_
+0000be80: 7069 636b 6c65 2229 0a0a 2020 2020 6465  pickle")..    de
+0000be90: 6620 7265 6164 5f70 6172 7175 6574 280a  f read_parquet(.
+0000bea0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0000beb0: 2020 2020 2020 7061 7468 3a20 7374 7220        path: str 
+0000bec0: 7c20 494f 5b22 6279 7465 7322 5d2c 0a20  | IO["bytes"],. 
+0000bed0: 2020 2020 2020 202a 2c0a 2020 2020 2020         *,.      
+0000bee0: 2020 656e 6769 6e65 3a20 7374 7220 3d20    engine: str = 
+0000bef0: 2261 7574 6f22 2c0a 2020 2020 2920 2d3e  "auto",.    ) ->
+0000bf00: 2064 6174 6166 7261 6d65 2e44 6174 6146   dataframe.DataF
+0000bf10: 7261 6d65 3a0a 2020 2020 2020 2020 7461  rame:.        ta
+0000bf20: 626c 6520 3d20 7365 6c66 2e5f 7261 6e64  ble = self._rand
+0000bf30: 6f6d 5f74 6162 6c65 2829 0a0a 2020 2020  om_table()..    
+0000bf40: 2020 2020 6966 2065 6e67 696e 6520 3d3d      if engine ==
+0000bf50: 2022 6269 6771 7565 7279 223a 0a20 2020   "bigquery":.   
+0000bf60: 2020 2020 2020 2020 206a 6f62 5f63 6f6e           job_con
+0000bf70: 6669 6720 3d20 7365 6c66 2e5f 7072 6570  fig = self._prep
+0000bf80: 6172 655f 6c6f 6164 5f6a 6f62 5f63 6f6e  are_load_job_con
+0000bf90: 6669 6728 290a 2020 2020 2020 2020 2020  fig().          
+0000bfa0: 2020 6a6f 625f 636f 6e66 6967 2e63 7265    job_config.cre
+0000bfb0: 6174 655f 6469 7370 6f73 6974 696f 6e20  ate_disposition 
+0000bfc0: 3d20 6269 6771 7565 7279 2e43 7265 6174  = bigquery.Creat
+0000bfd0: 6544 6973 706f 7369 7469 6f6e 2e43 5245  eDisposition.CRE
+0000bfe0: 4154 455f 4946 5f4e 4545 4445 440a 2020  ATE_IF_NEEDED.  
+0000bff0: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
+0000c000: 6e66 6967 2e73 6f75 7263 655f 666f 726d  nfig.source_form
+0000c010: 6174 203d 2062 6967 7175 6572 792e 536f  at = bigquery.So
+0000c020: 7572 6365 466f 726d 6174 2e50 4152 5155  urceFormat.PARQU
+0000c030: 4554 0a20 2020 2020 2020 2020 2020 206a  ET.            j
+0000c040: 6f62 5f63 6f6e 6669 672e 7772 6974 655f  ob_config.write_
+0000c050: 6469 7370 6f73 6974 696f 6e20 3d20 6269  disposition = bi
+0000c060: 6771 7565 7279 2e57 7269 7465 4469 7370  gquery.WriteDisp
+0000c070: 6f73 6974 696f 6e2e 5752 4954 455f 454d  osition.WRITE_EM
+0000c080: 5054 590a 2020 2020 2020 2020 2020 2020  PTY.            
+0000c090: 6a6f 625f 636f 6e66 6967 2e6c 6162 656c  job_config.label
+0000c0a0: 7320 3d20 7b22 6269 6766 7261 6d65 732d  s = {"bigframes-
+0000c0b0: 6170 6922 3a20 2272 6561 645f 7061 7271  api": "read_parq
+0000c0c0: 7565 7422 7d0a 0a20 2020 2020 2020 2020  uet"}..         
+0000c0d0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000c0e0: 7265 6164 5f62 6967 7175 6572 795f 6c6f  read_bigquery_lo
+0000c0f0: 6164 5f6a 6f62 2870 6174 682c 2074 6162  ad_job(path, tab
+0000c100: 6c65 2c20 6a6f 625f 636f 6e66 6967 3d6a  le, job_config=j
+0000c110: 6f62 5f63 6f6e 6669 6729 0a20 2020 2020  ob_config).     
+0000c120: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000c130: 2020 2020 2072 6561 645f 7061 7271 7565       read_parque
+0000c140: 745f 6b77 6172 6773 3a20 4469 6374 5b73  t_kwargs: Dict[s
+0000c150: 7472 2c20 416e 795d 203d 207b 7d0a 2020  tr, Any] = {}.  
+0000c160: 2020 2020 2020 2020 2020 6966 2070 616e            if pan
+0000c170: 6461 732e 5f5f 7665 7273 696f 6e5f 5f2e  das.__version__.
+0000c180: 7374 6172 7473 7769 7468 2822 312e 2229  startswith("1.")
+0000c190: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c1a0: 2020 7265 6164 5f70 6172 7175 6574 5f6b    read_parquet_k
+0000c1b0: 7761 7267 735b 2275 7365 5f6e 756c 6c61  wargs["use_nulla
+0000c1c0: 626c 655f 6474 7970 6573 225d 203d 2054  ble_dtypes"] = T
+0000c1d0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0000c1e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000c1f0: 2020 2020 2020 7265 6164 5f70 6172 7175        read_parqu
+0000c200: 6574 5f6b 7761 7267 735b 2264 7479 7065  et_kwargs["dtype
+0000c210: 5f62 6163 6b65 6e64 225d 203d 2022 7079  _backend"] = "py
+0000c220: 6172 726f 7722 0a0a 2020 2020 2020 2020  arrow"..        
+0000c230: 2020 2020 7061 6e64 6173 5f6f 626a 203d      pandas_obj =
+0000c240: 2070 616e 6461 732e 7265 6164 5f70 6172   pandas.read_par
+0000c250: 7175 6574 280a 2020 2020 2020 2020 2020  quet(.          
+0000c260: 2020 2020 2020 7061 7468 2c0a 2020 2020        path,.    
+0000c270: 2020 2020 2020 2020 2020 2020 656e 6769              engi
+0000c280: 6e65 3d65 6e67 696e 652c 2020 2320 7479  ne=engine,  # ty
+0000c290: 7065 3a20 6967 6e6f 7265 0a20 2020 2020  pe: ignore.     
+0000c2a0: 2020 2020 2020 2020 2020 202a 2a72 6561             **rea
+0000c2b0: 645f 7061 7271 7565 745f 6b77 6172 6773  d_parquet_kwargs
+0000c2c0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000c2d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000c2e0: 726e 2073 656c 662e 5f72 6561 645f 7061  rn self._read_pa
+0000c2f0: 6e64 6173 2870 616e 6461 735f 6f62 6a2c  ndas(pandas_obj,
+0000c300: 2022 7265 6164 5f70 6172 7175 6574 2229   "read_parquet")
+0000c310: 0a0a 2020 2020 6465 6620 7265 6164 5f6a  ..    def read_j
+0000c320: 736f 6e28 0a20 2020 2020 2020 2073 656c  son(.        sel
+0000c330: 662c 0a20 2020 2020 2020 2070 6174 685f  f,.        path_
+0000c340: 6f72 5f62 7566 3a20 7374 7220 7c20 494f  or_buf: str | IO
+0000c350: 5b22 6279 7465 7322 5d2c 0a20 2020 2020  ["bytes"],.     
+0000c360: 2020 202a 2c0a 2020 2020 2020 2020 6f72     *,.        or
+0000c370: 6965 6e74 3a20 4c69 7465 7261 6c5b 0a20  ient: Literal[. 
+0000c380: 2020 2020 2020 2020 2020 2022 7370 6c69             "spli
+0000c390: 7422 2c20 2272 6563 6f72 6473 222c 2022  t", "records", "
+0000c3a0: 696e 6465 7822 2c20 2263 6f6c 756d 6e73  index", "columns
+0000c3b0: 222c 2022 7661 6c75 6573 222c 2022 7461  ", "values", "ta
+0000c3c0: 626c 6522 0a20 2020 2020 2020 205d 203d  ble".        ] =
+0000c3d0: 2022 636f 6c75 6d6e 7322 2c0a 2020 2020   "columns",.    
+0000c3e0: 2020 2020 6474 7970 653a 204f 7074 696f      dtype: Optio
+0000c3f0: 6e61 6c5b 4469 6374 5d20 3d20 4e6f 6e65  nal[Dict] = None
+0000c400: 2c0a 2020 2020 2020 2020 656e 636f 6469  ,.        encodi
+0000c410: 6e67 3a20 4f70 7469 6f6e 616c 5b73 7472  ng: Optional[str
+0000c420: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0000c430: 2020 6c69 6e65 733a 2062 6f6f 6c20 3d20    lines: bool = 
+0000c440: 4661 6c73 652c 0a20 2020 2020 2020 2065  False,.        e
+0000c450: 6e67 696e 653a 204c 6974 6572 616c 5b22  ngine: Literal["
+0000c460: 756a 736f 6e22 2c20 2270 7961 7272 6f77  ujson", "pyarrow
+0000c470: 222c 2022 6269 6771 7565 7279 225d 203d  ", "bigquery"] =
+0000c480: 2022 756a 736f 6e22 2c0a 2020 2020 2020   "ujson",.      
+0000c490: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+0000c4a0: 2920 2d3e 2064 6174 6166 7261 6d65 2e44  ) -> dataframe.D
+0000c4b0: 6174 6146 7261 6d65 3a0a 2020 2020 2020  ataFrame:.      
+0000c4c0: 2020 7461 626c 6520 3d20 7365 6c66 2e5f    table = self._
+0000c4d0: 7261 6e64 6f6d 5f74 6162 6c65 2829 0a0a  random_table()..
+0000c4e0: 2020 2020 2020 2020 6966 2065 6e67 696e          if engin
+0000c4f0: 6520 3d3d 2022 6269 6771 7565 7279 223a  e == "bigquery":
+0000c500: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000c510: 2064 7479 7065 2069 7320 6e6f 7420 4e6f   dtype is not No
+0000c520: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000c530: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
+0000c540: 6c65 6d65 6e74 6564 4572 726f 7228 0a20  lementedError(. 
+0000c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c560: 2020 2022 4269 6751 7565 7279 2065 6e67     "BigQuery eng
+0000c570: 696e 6520 646f 6573 206e 6f74 2073 7570  ine does not sup
+0000c580: 706f 7274 2074 6865 2064 7479 7065 2061  port the dtype a
+0000c590: 7267 756d 656e 7473 2e22 0a20 2020 2020  rguments.".     
+0000c5a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000c5b0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000c5c0: 206c 696e 6573 3a0a 2020 2020 2020 2020   lines:.        
+0000c5d0: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
+0000c5e0: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
+0000c5f0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000c600: 2020 2020 2020 2022 4f6e 6c79 206e 6577         "Only new
+0000c610: 6c69 6e65 2064 656c 696d 6974 6564 204a  line delimited J
+0000c620: 534f 4e20 666f 726d 6174 2069 7320 7375  SON format is su
+0000c630: 7070 6f72 7465 642e 220a 2020 2020 2020  pported.".      
+0000c640: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0000c650: 2020 2020 2020 2020 2069 6620 656e 636f           if enco
+0000c660: 6469 6e67 2069 7320 6e6f 7420 4e6f 6e65  ding is not None
+0000c670: 2061 6e64 2065 6e63 6f64 696e 6720 6e6f   and encoding no
+0000c680: 7420 696e 205f 5641 4c49 445f 454e 434f  t in _VALID_ENCO
+0000c690: 4449 4e47 533a 0a20 2020 2020 2020 2020  DINGS:.         
+0000c6a0: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
+0000c6b0: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
+0000c6c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000c6d0: 2020 2020 2020 6622 4269 6751 7565 7279        f"BigQuery
+0000c6e0: 2065 6e67 696e 6520 6f6e 6c79 2073 7570   engine only sup
+0000c6f0: 706f 7274 7320 7468 6520 666f 6c6c 6f77  ports the follow
+0000c700: 696e 6720 656e 636f 6469 6e67 733a 207b  ing encodings: {
+0000c710: 5f56 414c 4944 5f45 4e43 4f44 494e 4753  _VALID_ENCODINGS
+0000c720: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+0000c730: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0000c740: 2020 6966 206c 696e 6573 2061 6e64 206f    if lines and o
+0000c750: 7269 656e 7420 213d 2022 7265 636f 7264  rient != "record
+0000c760: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
+0000c770: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000c780: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0000c790: 2020 2020 2020 2020 2020 2227 6c69 6e65            "'line
+0000c7a0: 7327 206b 6579 776f 7264 2069 7320 6f6e  s' keyword is on
+0000c7b0: 6c79 2076 616c 6964 2077 6865 6e20 276f  ly valid when 'o
+0000c7c0: 7269 656e 7427 2069 7320 2772 6563 6f72  rient' is 'recor
+0000c7d0: 6473 272e 220a 2020 2020 2020 2020 2020  ds'.".          
+0000c7e0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0000c7f0: 2020 2020 206a 6f62 5f63 6f6e 6669 6720       job_config 
+0000c800: 3d20 7365 6c66 2e5f 7072 6570 6172 655f  = self._prepare_
+0000c810: 6c6f 6164 5f6a 6f62 5f63 6f6e 6669 6728  load_job_config(
+0000c820: 290a 2020 2020 2020 2020 2020 2020 6a6f  ).            jo
+0000c830: 625f 636f 6e66 6967 2e63 7265 6174 655f  b_config.create_
+0000c840: 6469 7370 6f73 6974 696f 6e20 3d20 6269  disposition = bi
+0000c850: 6771 7565 7279 2e43 7265 6174 6544 6973  gquery.CreateDis
+0000c860: 706f 7369 7469 6f6e 2e43 5245 4154 455f  position.CREATE_
+0000c870: 4946 5f4e 4545 4445 440a 2020 2020 2020  IF_NEEDED.      
+0000c880: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
+0000c890: 2e73 6f75 7263 655f 666f 726d 6174 203d  .source_format =
+0000c8a0: 2062 6967 7175 6572 792e 536f 7572 6365   bigquery.Source
+0000c8b0: 466f 726d 6174 2e4e 4557 4c49 4e45 5f44  Format.NEWLINE_D
+0000c8c0: 454c 494d 4954 4544 5f4a 534f 4e0a 2020  ELIMITED_JSON.  
+0000c8d0: 2020 2020 2020 2020 2020 6a6f 625f 636f            job_co
+0000c8e0: 6e66 6967 2e77 7269 7465 5f64 6973 706f  nfig.write_dispo
+0000c8f0: 7369 7469 6f6e 203d 2062 6967 7175 6572  sition = bigquer
+0000c900: 792e 5772 6974 6544 6973 706f 7369 7469  y.WriteDispositi
+0000c910: 6f6e 2e57 5249 5445 5f45 4d50 5459 0a20  on.WRITE_EMPTY. 
+0000c920: 2020 2020 2020 2020 2020 206a 6f62 5f63             job_c
+0000c930: 6f6e 6669 672e 6175 746f 6465 7465 6374  onfig.autodetect
+0000c940: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0000c950: 2020 2020 6a6f 625f 636f 6e66 6967 2e65      job_config.e
+0000c960: 6e63 6f64 696e 6720 3d20 656e 636f 6469  ncoding = encodi
+0000c970: 6e67 0a20 2020 2020 2020 2020 2020 206a  ng.            j
+0000c980: 6f62 5f63 6f6e 6669 672e 6c61 6265 6c73  ob_config.labels
+0000c990: 203d 207b 2262 6967 6672 616d 6573 2d61   = {"bigframes-a
+0000c9a0: 7069 223a 2022 7265 6164 5f6a 736f 6e22  pi": "read_json"
+0000c9b0: 7d0a 0a20 2020 2020 2020 2020 2020 2072  }..            r
+0000c9c0: 6574 7572 6e20 7365 6c66 2e5f 7265 6164  eturn self._read
+0000c9d0: 5f62 6967 7175 6572 795f 6c6f 6164 5f6a  _bigquery_load_j
+0000c9e0: 6f62 280a 2020 2020 2020 2020 2020 2020  ob(.            
+0000c9f0: 2020 2020 7061 7468 5f6f 725f 6275 662c      path_or_buf,
+0000ca00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ca10: 2074 6162 6c65 2c0a 2020 2020 2020 2020   table,.        
+0000ca20: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+0000ca30: 6967 3d6a 6f62 5f63 6f6e 6669 672c 0a20  ig=job_config,. 
+0000ca40: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000ca50: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000ca60: 2020 2020 2020 2069 6620 616e 7928 6172         if any(ar
+0000ca70: 6720 696e 206b 7761 7267 7320 666f 7220  g in kwargs for 
+0000ca80: 6172 6720 696e 2028 2263 6875 6e6b 7369  arg in ("chunksi
+0000ca90: 7a65 222c 2022 6974 6572 6174 6f72 2229  ze", "iterator")
+0000caa0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000cab0: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
+0000cac0: 656d 656e 7465 6445 7272 6f72 280a 2020  ementedError(.  
+0000cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cae0: 2020 2227 6368 756e 6b73 697a 6527 2061    "'chunksize' a
+0000caf0: 6e64 2027 6974 6572 6174 6f72 2720 6172  nd 'iterator' ar
+0000cb00: 6775 6d65 6e74 7320 6172 6520 6e6f 7420  guments are not 
+0000cb10: 7375 7070 6f72 7465 642e 220a 2020 2020  supported.".    
+0000cb20: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0000cb30: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0000cb40: 696e 7374 616e 6365 2870 6174 685f 6f72  instance(path_or
+0000cb50: 5f62 7566 2c20 7374 7229 3a0a 2020 2020  _buf, str):.    
+0000cb60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000cb70: 2e5f 6368 6563 6b5f 6669 6c65 5f73 697a  ._check_file_siz
+0000cb80: 6528 7061 7468 5f6f 725f 6275 6629 0a0a  e(path_or_buf)..
+0000cb90: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+0000cba0: 6e67 696e 6520 3d3d 2022 756a 736f 6e22  ngine == "ujson"
+0000cbb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000cbc0: 2020 7061 6e64 6173 5f64 6620 3d20 7061    pandas_df = pa
+0000cbd0: 6e64 6173 2e72 6561 645f 6a73 6f6e 2820  ndas.read_json( 
+0000cbe0: 2023 2074 7970 653a 2069 676e 6f72 650a   # type: ignore.
+0000cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc00: 2020 2020 7061 7468 5f6f 725f 6275 662c      path_or_buf,
+0000cc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cc20: 2020 2020 206f 7269 656e 743d 6f72 6965       orient=orie
+0000cc30: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+0000cc40: 2020 2020 2020 2020 6474 7970 653d 6474          dtype=dt
+0000cc50: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+0000cc60: 2020 2020 2020 2020 2065 6e63 6f64 696e           encodin
+0000cc70: 673d 656e 636f 6469 6e67 2c0a 2020 2020  g=encoding,.    
+0000cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc90: 6c69 6e65 733d 6c69 6e65 732c 0a20 2020  lines=lines,.   
+0000cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ccb0: 202a 2a6b 7761 7267 732c 0a20 2020 2020   **kwargs,.     
+0000ccc0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000ccd0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ccf0: 7061 6e64 6173 5f64 6620 3d20 7061 6e64  pandas_df = pand
+0000cd00: 6173 2e72 6561 645f 6a73 6f6e 2820 2023  as.read_json(  #
+0000cd10: 2074 7970 653a 2069 676e 6f72 650a 2020   type: ignore.  
+0000cd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd30: 2020 7061 7468 5f6f 725f 6275 662c 0a20    path_or_buf,. 
+0000cd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd50: 2020 206f 7269 656e 743d 6f72 6965 6e74     orient=orient
+0000cd60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cd70: 2020 2020 2020 6474 7970 653d 6474 7970        dtype=dtyp
+0000cd80: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000cd90: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
+0000cda0: 656e 636f 6469 6e67 2c0a 2020 2020 2020  encoding,.      
+0000cdb0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0000cdc0: 6e65 733d 6c69 6e65 732c 0a20 2020 2020  nes=lines,.     
+0000cdd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000cde0: 6e67 696e 653d 656e 6769 6e65 2c0a 2020  ngine=engine,.  
+0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce00: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+0000ce10: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000ce20: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000ce30: 2073 656c 662e 5f72 6561 645f 7061 6e64   self._read_pand
+0000ce40: 6173 2870 616e 6461 735f 6466 2c20 2272  as(pandas_df, "r
+0000ce50: 6561 645f 6a73 6f6e 2229 0a0a 2020 2020  ead_json")..    
+0000ce60: 6465 6620 5f63 6865 636b 5f66 696c 655f  def _check_file_
+0000ce70: 7369 7a65 2873 656c 662c 2066 696c 6570  size(self, filep
+0000ce80: 6174 683a 2073 7472 293a 0a20 2020 2020  ath: str):.     
+0000ce90: 2020 206d 6178 5f73 697a 6520 3d20 3130     max_size = 10
+0000cea0: 3234 202a 2031 3032 3420 2a20 3130 3234  24 * 1024 * 1024
+0000ceb0: 2020 2320 3120 4742 2069 6e20 6279 7465    # 1 GB in byte
+0000cec0: 730a 2020 2020 2020 2020 6966 2066 696c  s.        if fil
+0000ced0: 6570 6174 682e 7374 6172 7473 7769 7468  epath.startswith
+0000cee0: 2822 6773 3a2f 2f22 293a 2020 2320 4743  ("gs://"):  # GC
+0000cef0: 5320 6669 6c65 2070 6174 680a 2020 2020  S file path.    
+0000cf00: 2020 2020 2020 2020 636c 6965 6e74 203d          client =
+0000cf10: 2073 746f 7261 6765 2e43 6c69 656e 7428   storage.Client(
+0000cf20: 290a 2020 2020 2020 2020 2020 2020 6275  ).            bu
+0000cf30: 636b 6574 5f6e 616d 652c 2062 6c6f 625f  cket_name, blob_
+0000cf40: 6e61 6d65 203d 2066 696c 6570 6174 682e  name = filepath.
+0000cf50: 7370 6c69 7428 222f 222c 2033 295b 323a  split("/", 3)[2:
+0000cf60: 5d0a 2020 2020 2020 2020 2020 2020 6275  ].            bu
+0000cf70: 636b 6574 203d 2063 6c69 656e 742e 6275  cket = client.bu
+0000cf80: 636b 6574 2862 7563 6b65 745f 6e61 6d65  cket(bucket_name
+0000cf90: 290a 2020 2020 2020 2020 2020 2020 626c  ).            bl
+0000cfa0: 6f62 203d 2062 7563 6b65 742e 626c 6f62  ob = bucket.blob
+0000cfb0: 2862 6c6f 625f 6e61 6d65 290a 2020 2020  (blob_name).    
+0000cfc0: 2020 2020 2020 2020 626c 6f62 2e72 656c          blob.rel
+0000cfd0: 6f61 6428 290a 2020 2020 2020 2020 2020  oad().          
+0000cfe0: 2020 6669 6c65 5f73 697a 6520 3d20 626c    file_size = bl
+0000cff0: 6f62 2e73 697a 650a 2020 2020 2020 2020  ob.size.        
+0000d000: 656c 7365 3a20 2023 206c 6f63 616c 2066  else:  # local f
+0000d010: 696c 6520 7061 7468 0a20 2020 2020 2020  ile path.       
+0000d020: 2020 2020 2066 696c 655f 7369 7a65 203d       file_size =
+0000d030: 206f 732e 7061 7468 2e67 6574 7369 7a65   os.path.getsize
+0000d040: 2866 696c 6570 6174 6829 0a0a 2020 2020  (filepath)..    
+0000d050: 2020 2020 6966 2066 696c 655f 7369 7a65      if file_size
+0000d060: 203e 206d 6178 5f73 697a 653a 0a20 2020   > max_size:.   
+0000d070: 2020 2020 2020 2020 2023 2043 6f6e 7665           # Conve
+0000d080: 7274 2074 6f20 4742 0a20 2020 2020 2020  rt to GB.       
+0000d090: 2020 2020 2066 696c 655f 7369 7a65 203d       file_size =
+0000d0a0: 2072 6f75 6e64 2866 696c 655f 7369 7a65   round(file_size
+0000d0b0: 202f 2028 3130 3234 2a2a 3329 2c20 3129   / (1024**3), 1)
+0000d0c0: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
+0000d0d0: 5f73 697a 6520 3d20 696e 7428 6d61 785f  _size = int(max_
+0000d0e0: 7369 7a65 202f 2031 3032 342a 2a33 290a  size / 1024**3).
+0000d0f0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0000d100: 6572 2e77 6172 6e69 6e67 280a 2020 2020  er.warning(.    
+0000d110: 2020 2020 2020 2020 2020 2020 6622 4669              f"Fi
+0000d120: 6c65 2073 697a 6520 7b66 696c 655f 7369  le size {file_si
+0000d130: 7a65 7d47 4220 6578 6365 6564 7320 7b6d  ze}GB exceeds {m
+0000d140: 6178 5f73 697a 657d 4742 2e20 220a 2020  ax_size}GB. ".  
+0000d150: 2020 2020 2020 2020 2020 2020 2020 2249                "I
+0000d160: 7420 6973 2072 6563 6f6d 6d65 6e64 6564  t is recommended
+0000d170: 2074 6f20 7573 6520 656e 6769 6e65 3d27   to use engine='
+0000d180: 6269 6771 7565 7279 2720 220a 2020 2020  bigquery' ".    
+0000d190: 2020 2020 2020 2020 2020 2020 2266 6f72              "for
+0000d1a0: 206c 6172 6765 2066 696c 6573 2074 6f20   large files to 
+0000d1b0: 6176 6f69 6420 6c6f 6164 696e 6720 7468  avoid loading th
+0000d1c0: 6520 6669 6c65 2069 6e74 6f20 6c6f 6361  e file into loca
+0000d1d0: 6c20 6d65 6d6f 7279 2e22 0a20 2020 2020  l memory.".     
+0000d1e0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0000d1f0: 6620 5f63 7265 6174 655f 656d 7074 795f  f _create_empty_
+0000d200: 7465 6d70 5f74 6162 6c65 280a 2020 2020  temp_table(.    
+0000d210: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0000d220: 2020 7363 6865 6d61 3a20 4974 6572 6162    schema: Iterab
+0000d230: 6c65 5b62 6967 7175 6572 792e 5363 6865  le[bigquery.Sche
+0000d240: 6d61 4669 656c 645d 2c0a 2020 2020 2020  maField],.      
+0000d250: 2020 636c 7573 7465 725f 636f 6c73 3a20    cluster_cols: 
+0000d260: 4c69 7374 5b73 7472 5d2c 0a20 2020 2029  List[str],.    )
+0000d270: 202d 3e20 6269 6771 7565 7279 2e54 6162   -> bigquery.Tab
+0000d280: 6c65 5265 6665 7265 6e63 653a 0a20 2020  leReference:.   
+0000d290: 2020 2020 2023 2043 616e 2774 2073 6574       # Can't set
+0000d2a0: 2061 2074 6162 6c65 2069 6e20 5f53 4553   a table in _SES
+0000d2b0: 5349 4f4e 2061 7320 6465 7374 696e 6174  SION as destinat
+0000d2c0: 696f 6e20 7669 6120 7175 6572 7920 6a6f  ion via query jo
+0000d2d0: 6220 4150 492c 2073 6f20 7765 0a20 2020  b API, so we.   
+0000d2e0: 2020 2020 2023 2072 756e 2044 444c 2c20       # run DDL, 
+0000d2f0: 696e 7374 6561 642e 0a20 2020 2020 2020  instead..       
+0000d300: 2065 7870 6972 6174 696f 6e20 3d20 280a   expiration = (.
+0000d310: 2020 2020 2020 2020 2020 2020 6461 7465              date
+0000d320: 7469 6d65 2e64 6174 6574 696d 652e 6e6f  time.datetime.no
+0000d330: 7728 6461 7465 7469 6d65 2e74 696d 657a  w(datetime.timez
+0000d340: 6f6e 652e 7574 6329 202b 2063 6f6e 7374  one.utc) + const
+0000d350: 616e 7473 2e44 4546 4155 4c54 5f45 5850  ants.DEFAULT_EXP
+0000d360: 4952 4154 494f 4e0a 2020 2020 2020 2020  IRATION.        
+0000d370: 290a 0a20 2020 2020 2020 2074 6162 6c65  )..        table
+0000d380: 203d 2062 665f 696f 5f62 6967 7175 6572   = bf_io_bigquer
+0000d390: 792e 6372 6561 7465 5f74 656d 705f 7461  y.create_temp_ta
+0000d3a0: 626c 6528 0a20 2020 2020 2020 2020 2020  ble(.           
+0000d3b0: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
+0000d3c0: 2020 2065 7870 6972 6174 696f 6e2c 0a20     expiration,. 
+0000d3d0: 2020 2020 2020 2020 2020 2073 6368 656d             schem
+0000d3e0: 613d 7363 6865 6d61 2c0a 2020 2020 2020  a=schema,.      
+0000d3f0: 2020 2020 2020 636c 7573 7465 725f 636f        cluster_co
+0000d400: 6c75 6d6e 733d 636c 7573 7465 725f 636f  lumns=cluster_co
+0000d410: 6c73 2c0a 2020 2020 2020 2020 290a 2020  ls,.        ).  
+0000d420: 2020 2020 2020 7265 7475 726e 2062 6967        return big
+0000d430: 7175 6572 792e 5461 626c 6552 6566 6572  query.TableRefer
+0000d440: 656e 6365 2e66 726f 6d5f 7374 7269 6e67  ence.from_string
+0000d450: 2874 6162 6c65 290a 0a20 2020 2064 6566  (table)..    def
+0000d460: 205f 6962 6973 5f74 6f5f 7465 6d70 5f74   _ibis_to_temp_t
+0000d470: 6162 6c65 280a 2020 2020 2020 2020 7365  able(.        se
+0000d480: 6c66 2c0a 2020 2020 2020 2020 7461 626c  lf,.        tabl
+0000d490: 653a 2069 6269 735f 7479 7065 732e 5461  e: ibis_types.Ta
+0000d4a0: 626c 652c 0a20 2020 2020 2020 2063 6c75  ble,.        clu
+0000d4b0: 7374 6572 5f63 6f6c 733a 2049 7465 7261  ster_cols: Itera
+0000d4c0: 626c 655b 7374 725d 2c0a 2020 2020 2020  ble[str],.      
+0000d4d0: 2020 6170 695f 6e61 6d65 3a20 7374 722c    api_name: str,
+0000d4e0: 0a20 2020 2029 202d 3e20 6269 6771 7565  .    ) -> bigque
+0000d4f0: 7279 2e54 6162 6c65 5265 6665 7265 6e63  ry.TableReferenc
+0000d500: 653a 0a20 2020 2020 2020 2064 6573 7469  e:.        desti
+0000d510: 6e61 7469 6f6e 2c20 5f20 3d20 7365 6c66  nation, _ = self
+0000d520: 2e5f 7175 6572 795f 746f 5f64 6573 7469  ._query_to_desti
+0000d530: 6e61 7469 6f6e 280a 2020 2020 2020 2020  nation(.        
+0000d540: 2020 2020 7365 6c66 2e69 6269 735f 636c      self.ibis_cl
+0000d550: 6965 6e74 2e63 6f6d 7069 6c65 2874 6162  ient.compile(tab
+0000d560: 6c65 292c 0a20 2020 2020 2020 2020 2020  le),.           
+0000d570: 2069 6e64 6578 5f63 6f6c 733d 6c69 7374   index_cols=list
+0000d580: 2863 6c75 7374 6572 5f63 6f6c 7329 2c0a  (cluster_cols),.
+0000d590: 2020 2020 2020 2020 2020 2020 6170 695f              api_
+0000d5a0: 6e61 6d65 3d61 7069 5f6e 616d 652c 0a20  name=api_name,. 
+0000d5b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000d5c0: 2023 2054 6865 7265 2073 686f 756c 6420   # There should 
+0000d5d0: 616c 7761 7973 2062 6520 6120 6465 7374  always be a dest
+0000d5e0: 696e 6174 696f 6e20 7461 626c 6520 666f  ination table fo
+0000d5f0: 7220 7468 6973 2071 7565 7279 2074 7970  r this query typ
+0000d600: 652e 0a20 2020 2020 2020 2072 6574 7572  e..        retur
+0000d610: 6e20 7479 7069 6e67 2e63 6173 7428 6269  n typing.cast(bi
+0000d620: 6771 7565 7279 2e54 6162 6c65 5265 6665  gquery.TableRefe
+0000d630: 7265 6e63 652c 2064 6573 7469 6e61 7469  rence, destinati
+0000d640: 6f6e 290a 0a20 2020 2064 6566 2072 656d  on)..    def rem
+0000d650: 6f74 655f 6675 6e63 7469 6f6e 280a 2020  ote_function(.  
+0000d660: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0000d670: 2020 2020 696e 7075 745f 7479 7065 733a      input_types:
+0000d680: 2055 6e69 6f6e 5b74 7970 652c 2053 6571   Union[type, Seq
+0000d690: 7565 6e63 655b 7479 7065 5d5d 2c0a 2020  uence[type]],.  
+0000d6a0: 2020 2020 2020 6f75 7470 7574 5f74 7970        output_typ
+0000d6b0: 653a 2074 7970 652c 0a20 2020 2020 2020  e: type,.       
+0000d6c0: 2064 6174 6173 6574 3a20 4f70 7469 6f6e   dataset: Option
+0000d6d0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+0000d6e0: 2020 2020 2020 2020 6269 6771 7565 7279          bigquery
+0000d6f0: 5f63 6f6e 6e65 6374 696f 6e3a 204f 7074  _connection: Opt
+0000d700: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0000d710: 652c 0a20 2020 2020 2020 2072 6575 7365  e,.        reuse
+0000d720: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
+0000d730: 2020 2020 2020 206e 616d 653a 204f 7074         name: Opt
+0000d740: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0000d750: 652c 0a20 2020 2020 2020 2070 6163 6b61  e,.        packa
+0000d760: 6765 733a 204f 7074 696f 6e61 6c5b 5365  ges: Optional[Se
+0000d770: 7175 656e 6365 5b73 7472 5d5d 203d 204e  quence[str]] = N
+0000d780: 6f6e 652c 0a20 2020 2020 2020 2063 6c6f  one,.        clo
+0000d790: 7564 5f66 756e 6374 696f 6e5f 7365 7276  ud_function_serv
+0000d7a0: 6963 655f 6163 636f 756e 743a 204f 7074  ice_account: Opt
+0000d7b0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0000d7c0: 652c 0a20 2020 2020 2020 2063 6c6f 7564  e,.        cloud
+0000d7d0: 5f66 756e 6374 696f 6e5f 6b6d 735f 6b65  _function_kms_ke
+0000d7e0: 795f 6e61 6d65 3a20 4f70 7469 6f6e 616c  y_name: Optional
+0000d7f0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+0000d800: 2020 2020 2020 636c 6f75 645f 6675 6e63        cloud_func
+0000d810: 7469 6f6e 5f64 6f63 6b65 725f 7265 706f  tion_docker_repo
+0000d820: 7369 746f 7279 3a20 4f70 7469 6f6e 616c  sitory: Optional
+0000d830: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+0000d840: 2020 2020 2020 6d61 785f 6261 7463 6869        max_batchi
+0000d850: 6e67 5f72 6f77 733a 204f 7074 696f 6e61  ng_rows: Optiona
+0000d860: 6c5b 696e 745d 203d 2031 3030 302c 0a20  l[int] = 1000,. 
+0000d870: 2020 2020 2020 2063 6c6f 7564 5f66 756e         cloud_fun
+0000d880: 6374 696f 6e5f 7469 6d65 6f75 743a 204f  ction_timeout: O
+0000d890: 7074 696f 6e61 6c5b 696e 745d 203d 2036  ptional[int] = 6
+0000d8a0: 3030 2c0a 2020 2020 2020 2020 636c 6f75  00,.        clou
+0000d8b0: 645f 6675 6e63 7469 6f6e 5f6d 6178 5f69  d_function_max_i
+0000d8c0: 6e73 7461 6e63 6573 3a20 4f70 7469 6f6e  nstances: Option
+0000d8d0: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a  al[int] = None,.
+0000d8e0: 2020 2020 2020 2020 636c 6f75 645f 6675          cloud_fu
+0000d8f0: 6e63 7469 6f6e 5f76 7063 5f63 6f6e 6e65  nction_vpc_conne
+0000d900: 6374 6f72 3a20 4f70 7469 6f6e 616c 5b73  ctor: Optional[s
+0000d910: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+0000d920: 293a 0a20 2020 2020 2020 2022 2222 4465  ):.        """De
+0000d930: 636f 7261 746f 7220 746f 2074 7572 6e20  corator to turn 
+0000d940: 6120 7573 6572 2064 6566 696e 6564 2066  a user defined f
+0000d950: 756e 6374 696f 6e20 696e 746f 2061 2042  unction into a B
+0000d960: 6967 5175 6572 7920 7265 6d6f 7465 2066  igQuery remote f
+0000d970: 756e 6374 696f 6e2e 2043 6865 636b 206f  unction. Check o
+0000d980: 7574 0a20 2020 2020 2020 2074 6865 2063  ut.        the c
+0000d990: 6f64 6520 7361 6d70 6c65 7320 6174 3a20  ode samples at: 
+0000d9a0: 6874 7470 733a 2f2f 636c 6f75 642e 676f  https://cloud.go
+0000d9b0: 6f67 6c65 2e63 6f6d 2f62 6967 7175 6572  ogle.com/bigquer
+0000d9c0: 792f 646f 6373 2f72 656d 6f74 652d 6675  y/docs/remote-fu
+0000d9d0: 6e63 7469 6f6e 7323 6269 6771 7565 7279  nctions#bigquery
+0000d9e0: 2d64 6174 6166 7261 6d65 732e 0a0a 2020  -dataframes...  
+0000d9f0: 2020 2020 2020 2e2e 206e 6f74 653a 3a0a        .. note::.
+0000da00: 2020 2020 2020 2020 2020 2020 6060 696e              ``in
+0000da10: 7075 745f 7479 7065 733d 5365 7269 6573  put_types=Series
+0000da20: 6060 2073 6365 6e61 7269 6f20 6973 2069  `` scenario is i
+0000da30: 6e20 7072 6576 6965 772e 0a0a 2020 2020  n preview...    
+0000da40: 2020 2020 2e2e 206e 6f74 653a 3a0a 2020      .. note::.  
+0000da50: 2020 2020 2020 2020 2020 506c 6561 7365            Please
+0000da60: 206d 616b 6520 7375 7265 2066 6f6c 6c6f   make sure follo
+0000da70: 7769 6e67 2069 7320 7365 7475 7020 6265  wing is setup be
+0000da80: 666f 7265 2075 7369 6e67 2074 6869 7320  fore using this 
+0000da90: 4150 493a 0a0a 2020 2020 2020 2020 312e  API:..        1.
+0000daa0: 2048 6176 6520 7468 6520 6265 6c6f 7720   Have the below 
+0000dab0: 4150 4973 2065 6e61 626c 6564 2066 6f72  APIs enabled for
+0000dac0: 2079 6f75 7220 7072 6f6a 6563 743a 0a0a   your project:..
+0000dad0: 2020 2020 2020 2020 2020 2020 2a20 4269              * Bi
+0000dae0: 6751 7565 7279 2043 6f6e 6e65 6374 696f  gQuery Connectio
+0000daf0: 6e20 4150 490a 2020 2020 2020 2020 2020  n API.          
+0000db00: 2020 2a20 436c 6f75 6420 4675 6e63 7469    * Cloud Functi
+0000db10: 6f6e 7320 4150 490a 2020 2020 2020 2020  ons API.        
+0000db20: 2020 2020 2a20 436c 6f75 6420 5275 6e20      * Cloud Run 
+0000db30: 4150 490a 2020 2020 2020 2020 2020 2020  API.            
+0000db40: 2a20 436c 6f75 6420 4275 696c 6420 4150  * Cloud Build AP
+0000db50: 490a 2020 2020 2020 2020 2020 2020 2a20  I.            * 
+0000db60: 4172 7469 6661 6374 2052 6567 6973 7472  Artifact Registr
+0000db70: 7920 4150 490a 2020 2020 2020 2020 2020  y API.          
+0000db80: 2020 2a20 436c 6f75 6420 5265 736f 7572    * Cloud Resour
+0000db90: 6365 204d 616e 6167 6572 2041 5049 0a0a  ce Manager API..
+0000dba0: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+0000dbb0: 6361 6e20 6265 2064 6f6e 6520 6672 6f6d  can be done from
+0000dbc0: 2074 6865 2063 6c6f 7564 2063 6f6e 736f   the cloud conso
+0000dbd0: 6c65 2028 6368 616e 6765 2060 5052 4f4a  le (change `PROJ
+0000dbe0: 4543 545f 4944 6020 746f 2079 6f75 7273  ECT_ID` to yours
+0000dbf0: 293a 0a20 2020 2020 2020 2020 2020 6874  ):.           ht
+0000dc00: 7470 733a 2f2f 636f 6e73 6f6c 652e 636c  tps://console.cl
+0000dc10: 6f75 642e 676f 6f67 6c65 2e63 6f6d 2f61  oud.google.com/a
+0000dc20: 7069 732f 656e 6162 6c65 666c 6f77 3f61  pis/enableflow?a
+0000dc30: 7069 6964 3d62 6967 7175 6572 7963 6f6e  piid=bigquerycon
+0000dc40: 6e65 6374 696f 6e2e 676f 6f67 6c65 6170  nection.googleap
+0000dc50: 6973 2e63 6f6d 2c63 6c6f 7564 6675 6e63  is.com,cloudfunc
+0000dc60: 7469 6f6e 732e 676f 6f67 6c65 6170 6973  tions.googleapis
+0000dc70: 2e63 6f6d 2c72 756e 2e67 6f6f 676c 6561  .com,run.googlea
+0000dc80: 7069 732e 636f 6d2c 636c 6f75 6462 7569  pis.com,cloudbui
+0000dc90: 6c64 2e67 6f6f 676c 6561 7069 732e 636f  ld.googleapis.co
+0000dca0: 6d2c 6172 7469 6661 6374 7265 6769 7374  m,artifactregist
+0000dcb0: 7279 2e67 6f6f 676c 6561 7069 732e 636f  ry.googleapis.co
+0000dcc0: 6d2c 636c 6f75 6472 6573 6f75 7263 656d  m,cloudresourcem
+0000dcd0: 616e 6167 6572 2e67 6f6f 676c 6561 7069  anager.googleapi
+0000dce0: 732e 636f 6d26 7072 6f6a 6563 743d 5052  s.com&project=PR
+0000dcf0: 4f4a 4543 545f 4944 0a0a 2020 2020 2020  OJECT_ID..      
+0000dd00: 2020 2020 204f 7220 6672 6f6d 2074 6865       Or from the
+0000dd10: 2067 636c 6f75 6420 434c 493a 0a0a 2020   gcloud CLI:..  
+0000dd20: 2020 2020 2020 2020 2060 2420 6763 6c6f           `$ gclo
+0000dd30: 7564 2073 6572 7669 6365 7320 656e 6162  ud services enab
+0000dd40: 6c65 2062 6967 7175 6572 7963 6f6e 6e65  le bigqueryconne
+0000dd50: 6374 696f 6e2e 676f 6f67 6c65 6170 6973  ction.googleapis
+0000dd60: 2e63 6f6d 2063 6c6f 7564 6675 6e63 7469  .com cloudfuncti
+0000dd70: 6f6e 732e 676f 6f67 6c65 6170 6973 2e63  ons.googleapis.c
+0000dd80: 6f6d 2072 756e 2e67 6f6f 676c 6561 7069  om run.googleapi
+0000dd90: 732e 636f 6d20 636c 6f75 6462 7569 6c64  s.com cloudbuild
+0000dda0: 2e67 6f6f 676c 6561 7069 732e 636f 6d20  .googleapis.com 
+0000ddb0: 6172 7469 6661 6374 7265 6769 7374 7279  artifactregistry
+0000ddc0: 2e67 6f6f 676c 6561 7069 732e 636f 6d20  .googleapis.com 
+0000ddd0: 636c 6f75 6472 6573 6f75 7263 656d 616e  cloudresourceman
+0000dde0: 6167 6572 2e67 6f6f 676c 6561 7069 732e  ager.googleapis.
+0000ddf0: 636f 6d60 0a0a 2020 2020 2020 2020 322e  com`..        2.
+0000de00: 2048 6176 6520 666f 6c6c 6f77 696e 6720   Have following 
+0000de10: 4941 4d20 726f 6c65 7320 656e 6162 6c65  IAM roles enable
+0000de20: 6420 666f 7220 796f 753a 0a0a 2020 2020  d for you:..    
+0000de30: 2020 2020 2020 2020 2a20 4269 6751 7565          * BigQue
+0000de40: 7279 2044 6174 6120 4564 6974 6f72 2028  ry Data Editor (
+0000de50: 726f 6c65 732f 6269 6771 7565 7279 2e64  roles/bigquery.d
+0000de60: 6174 6145 6469 746f 7229 0a20 2020 2020  ataEditor).     
+0000de70: 2020 2020 2020 202a 2042 6967 5175 6572         * BigQuer
+0000de80: 7920 436f 6e6e 6563 7469 6f6e 2041 646d  y Connection Adm
+0000de90: 696e 2028 726f 6c65 732f 6269 6771 7565  in (roles/bigque
+0000dea0: 7279 2e63 6f6e 6e65 6374 696f 6e41 646d  ry.connectionAdm
+0000deb0: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
+0000dec0: 2a20 436c 6f75 6420 4675 6e63 7469 6f6e  * Cloud Function
+0000ded0: 7320 4465 7665 6c6f 7065 7220 2872 6f6c  s Developer (rol
+0000dee0: 6573 2f63 6c6f 7564 6675 6e63 7469 6f6e  es/cloudfunction
+0000def0: 732e 6465 7665 6c6f 7065 7229 0a20 2020  s.developer).   
+0000df00: 2020 2020 2020 2020 202a 2053 6572 7669           * Servi
+0000df10: 6365 2041 6363 6f75 6e74 2055 7365 7220  ce Account User 
+0000df20: 2872 6f6c 6573 2f69 616d 2e73 6572 7669  (roles/iam.servi
+0000df30: 6365 4163 636f 756e 7455 7365 7229 206f  ceAccountUser) o
+0000df40: 6e20 7468 6520 7365 7276 6963 6520 6163  n the service ac
+0000df50: 636f 756e 7420 6050 524f 4a45 4354 5f4e  count `PROJECT_N
+0000df60: 554d 4245 522d 636f 6d70 7574 6540 6465  UMBER-compute@de
+0000df70: 7665 6c6f 7065 722e 6773 6572 7669 6365  veloper.gservice
+0000df80: 6163 636f 756e 742e 636f 6d60 0a20 2020  account.com`.   
+0000df90: 2020 2020 2020 2020 202a 2053 746f 7261           * Stora
+0000dfa0: 6765 204f 626a 6563 7420 5669 6577 6572  ge Object Viewer
+0000dfb0: 2028 726f 6c65 732f 7374 6f72 6167 652e   (roles/storage.
+0000dfc0: 6f62 6a65 6374 5669 6577 6572 290a 2020  objectViewer).  
+0000dfd0: 2020 2020 2020 2020 2020 2a20 5072 6f6a            * Proj
+0000dfe0: 6563 7420 4941 4d20 4164 6d69 6e20 2872  ect IAM Admin (r
+0000dff0: 6f6c 6573 2f72 6573 6f75 7263 656d 616e  oles/resourceman
+0000e000: 6167 6572 2e70 726f 6a65 6374 4961 6d41  ager.projectIamA
+0000e010: 646d 696e 2920 284f 6e6c 7920 7265 7175  dmin) (Only requ
+0000e020: 6972 6564 2069 6620 7468 6520 6269 6771  ired if the bigq
+0000e030: 7565 7279 2063 6f6e 6e65 6374 696f 6e20  uery connection 
+0000e040: 6265 696e 6720 7573 6564 2069 7320 6e6f  being used is no
+0000e050: 7420 7072 652d 6372 6561 7465 6420 616e  t pre-created an
+0000e060: 6420 6973 2063 7265 6174 6564 2064 796e  d is created dyn
+0000e070: 616d 6963 616c 6c79 2077 6974 6820 7573  amically with us
+0000e080: 6572 2063 7265 6465 6e74 6961 6c73 2e29  er credentials.)
+0000e090: 0a0a 2020 2020 2020 2020 332e 2045 6974  ..        3. Eit
+0000e0a0: 6865 7220 7468 6520 7573 6572 2068 6173  her the user has
+0000e0b0: 2073 6574 4961 6d50 6f6c 6963 7920 7072   setIamPolicy pr
+0000e0c0: 6976 696c 6567 6520 6f6e 2074 6865 2070  ivilege on the p
+0000e0d0: 726f 6a65 6374 2c20 6f72 2061 2042 6967  roject, or a Big
+0000e0e0: 5175 6572 7920 636f 6e6e 6563 7469 6f6e  Query connection
+0000e0f0: 2069 7320 7072 652d 6372 6561 7465 6420   is pre-created 
+0000e100: 7769 7468 206e 6563 6573 7361 7279 2049  with necessary I
+0000e110: 414d 2072 6f6c 6520 7365 743a 0a0a 2020  AM role set:..  
+0000e120: 2020 2020 2020 2020 2020 312e 2054 6f20            1. To 
+0000e130: 6372 6561 7465 2061 2063 6f6e 6e65 6374  create a connect
+0000e140: 696f 6e2c 2066 6f6c 6c6f 7720 6874 7470  ion, follow http
+0000e150: 733a 2f2f 636c 6f75 642e 676f 6f67 6c65  s://cloud.google
+0000e160: 2e63 6f6d 2f62 6967 7175 6572 792f 646f  .com/bigquery/do
+0000e170: 6373 2f72 6566 6572 656e 6365 2f73 7461  cs/reference/sta
+0000e180: 6e64 6172 642d 7371 6c2f 7265 6d6f 7465  ndard-sql/remote
+0000e190: 2d66 756e 6374 696f 6e73 2363 7265 6174  -functions#creat
+0000e1a0: 655f 615f 636f 6e6e 6563 7469 6f6e 0a20  e_a_connection. 
+0000e1b0: 2020 2020 2020 2020 2020 2032 2e20 546f             2. To
+0000e1c0: 2073 6574 2075 7020 4941 4d2c 2066 6f6c   set up IAM, fol
+0000e1d0: 6c6f 7720 6874 7470 733a 2f2f 636c 6f75  low https://clou
+0000e1e0: 642e 676f 6f67 6c65 2e63 6f6d 2f62 6967  d.google.com/big
+0000e1f0: 7175 6572 792f 646f 6373 2f72 6566 6572  query/docs/refer
+0000e200: 656e 6365 2f73 7461 6e64 6172 642d 7371  ence/standard-sq
+0000e210: 6c2f 7265 6d6f 7465 2d66 756e 6374 696f  l/remote-functio
+0000e220: 6e73 2367 7261 6e74 5f70 6572 6d69 7373  ns#grant_permiss
+0000e230: 696f 6e5f 6f6e 5f66 756e 6374 696f 6e0a  ion_on_function.
+0000e240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e250: 416c 7465 726e 6174 6976 656c 792c 2074  Alternatively, t
+0000e260: 6865 2049 414d 2063 6f75 6c64 2061 6c73  he IAM could als
+0000e270: 6f20 6265 2073 6574 7570 2076 6961 2074  o be setup via t
+0000e280: 6865 2067 636c 6f75 6420 434c 493a 0a0a  he gcloud CLI:..
+0000e290: 2020 2020 2020 2020 2020 2020 2020 2060                 `
+0000e2a0: 2420 6763 6c6f 7564 2070 726f 6a65 6374  $ gcloud project
+0000e2b0: 7320 6164 642d 6961 6d2d 706f 6c69 6379  s add-iam-policy
+0000e2c0: 2d62 696e 6469 6e67 2050 524f 4a45 4354  -binding PROJECT
+0000e2d0: 5f49 4420 2d2d 6d65 6d62 6572 3d22 7365  _ID --member="se
+0000e2e0: 7276 6963 6541 6363 6f75 6e74 3a43 4f4e  rviceAccount:CON
+0000e2f0: 4e45 4354 494f 4e5f 5345 5256 4943 455f  NECTION_SERVICE_
+0000e300: 4143 434f 554e 545f 4944 2220 2d2d 726f  ACCOUNT_ID" --ro
+0000e310: 6c65 3d22 726f 6c65 732f 7275 6e2e 696e  le="roles/run.in
+0000e320: 766f 6b65 7222 602e 0a0a 2020 2020 2020  voker"`...      
+0000e330: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+0000e340: 2020 2020 696e 7075 745f 7479 7065 7320      input_types 
+0000e350: 2874 7970 6520 6f72 2073 6571 7565 6e63  (type or sequenc
+0000e360: 6528 7479 7065 2929 3a0a 2020 2020 2020  e(type)):.      
+0000e370: 2020 2020 2020 2020 2020 466f 7220 7363            For sc
+0000e380: 616c 6172 2075 7365 7220 6465 6669 6e65  alar user define
+0000e390: 6420 6675 6e63 7469 6f6e 2069 7420 7368  d function it sh
+0000e3a0: 6f75 6c64 2062 6520 7468 6520 696e 7075  ould be the inpu
+0000e3b0: 7420 7479 7065 206f 720a 2020 2020 2020  t type or.      
+0000e3c0: 2020 2020 2020 2020 2020 7365 7175 656e            sequen
+0000e3d0: 6365 206f 6620 696e 7075 7420 7479 7065  ce of input type
+0000e3e0: 732e 2046 6f72 2072 6f77 2070 726f 6365  s. For row proce
+0000e3f0: 7373 696e 6720 7573 6572 2064 6566 696e  ssing user defin
+0000e400: 6564 2066 756e 6374 696f 6e2c 0a20 2020  ed function,.   
+0000e410: 2020 2020 2020 2020 2020 2020 2074 7970               typ
+0000e420: 6520 6053 6572 6965 7360 2073 686f 756c  e `Series` shoul
+0000e430: 6420 6265 2073 7065 6369 6669 6564 2e0a  d be specified..
+0000e440: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+0000e450: 7574 5f74 7970 6520 2874 7970 6529 3a0a  ut_type (type):.
+0000e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e470: 4461 7461 2074 7970 6520 6f66 2074 6865  Data type of the
+0000e480: 206f 7574 7075 7420 696e 2074 6865 2075   output in the u
+0000e490: 7365 7220 6465 6669 6e65 6420 6675 6e63  ser defined func
+0000e4a0: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
+0000e4b0: 2020 6461 7461 7365 7420 2873 7472 2c20    dataset (str, 
+0000e4c0: 4f70 7469 6f6e 616c 293a 0a20 2020 2020  Optional):.     
+0000e4d0: 2020 2020 2020 2020 2020 2044 6174 6173             Datas
+0000e4e0: 6574 2069 6e20 7768 6963 6820 746f 2063  et in which to c
+0000e4f0: 7265 6174 6520 6120 4269 6751 7565 7279  reate a BigQuery
+0000e500: 2072 656d 6f74 6520 6675 6e63 7469 6f6e   remote function
+0000e510: 2e20 4974 2073 686f 756c 6420 6265 2069  . It should be i
+0000e520: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0000e530: 2020 603c 7072 6f6a 6563 745f 6964 3e2e    `<project_id>.
+0000e540: 3c64 6174 6173 6574 5f6e 616d 653e 6020  <dataset_name>` 
+0000e550: 6f72 2060 3c64 6174 6173 6574 5f6e 616d  or `<dataset_nam
+0000e560: 653e 6020 666f 726d 6174 2e20 4966 2074  e>` format. If t
+0000e570: 6869 730a 2020 2020 2020 2020 2020 2020  his.            
+0000e580: 2020 2020 7061 7261 6d65 7465 7220 6973      parameter is
+0000e590: 206e 6f74 2070 726f 7669 6465 6420 7468   not provided th
+0000e5a0: 656e 2073 6573 7369 6f6e 2064 6174 6173  en session datas
+0000e5b0: 6574 2069 6420 6973 2075 7365 642e 0a20  et id is used.. 
+0000e5c0: 2020 2020 2020 2020 2020 2062 6967 7175             bigqu
+0000e5d0: 6572 795f 636f 6e6e 6563 7469 6f6e 2028  ery_connection (
+0000e5e0: 7374 722c 204f 7074 696f 6e61 6c29 3a0a  str, Optional):.
+0000e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e600: 4e61 6d65 206f 6620 7468 6520 4269 6751  Name of the BigQ
+0000e610: 7565 7279 2063 6f6e 6e65 6374 696f 6e2e  uery connection.
+0000e620: 2059 6f75 2073 686f 756c 6420 6569 7468   You should eith
+0000e630: 6572 2068 6176 6520 7468 650a 2020 2020  er have the.    
+0000e640: 2020 2020 2020 2020 2020 2020 636f 6e6e              conn
+0000e650: 6563 7469 6f6e 2061 6c72 6561 6479 2063  ection already c
+0000e660: 7265 6174 6564 2069 6e20 7468 6520 606c  reated in the `l
+0000e670: 6f63 6174 696f 6e60 2079 6f75 2068 6176  ocation` you hav
+0000e680: 6520 6368 6f73 656e 2c20 6f72 0a20 2020  e chosen, or.   
+0000e690: 2020 2020 2020 2020 2020 2020 2079 6f75               you
+0000e6a0: 2073 686f 756c 6420 6861 7665 2074 6865   should have the
+0000e6b0: 2050 726f 6a65 6374 2049 414d 2041 646d   Project IAM Adm
+0000e6c0: 696e 2072 6f6c 6520 746f 2065 6e61 626c  in role to enabl
+0000e6d0: 6520 7468 6520 7365 7276 6963 650a 2020  e the service.  
+0000e6e0: 2020 2020 2020 2020 2020 2020 2020 746f                to
+0000e6f0: 2063 7265 6174 6520 7468 6520 636f 6e6e   create the conn
+0000e700: 6563 7469 6f6e 2066 6f72 2079 6f75 2069  ection for you i
+0000e710: 6620 796f 7520 6e65 6564 2069 742e 2049  f you need it. I
+0000e720: 6620 7468 6973 2070 6172 616d 6574 6572  f this parameter
+0000e730: 2069 730a 2020 2020 2020 2020 2020 2020   is.            
+0000e740: 2020 2020 6e6f 7420 7072 6f76 6964 6564      not provided
+0000e750: 2074 6865 6e20 7468 6520 4269 6751 7565   then the BigQue
+0000e760: 7279 2063 6f6e 6e65 6374 696f 6e20 6672  ry connection fr
+0000e770: 6f6d 2074 6865 2073 6573 7369 6f6e 2069  om the session i
+0000e780: 7320 7573 6564 2e0a 2020 2020 2020 2020  s used..        
+0000e790: 2020 2020 7265 7573 6520 2862 6f6f 6c2c      reuse (bool,
+0000e7a0: 204f 7074 696f 6e61 6c29 3a0a 2020 2020   Optional):.    
+0000e7b0: 2020 2020 2020 2020 2020 2020 5265 7573              Reus
+0000e7c0: 6520 7468 6520 7265 6d6f 7465 2066 756e  e the remote fun
+0000e7d0: 6374 696f 6e20 6966 2061 6c72 6561 6479  ction if already
+0000e7e0: 2065 7869 7374 732e 0a20 2020 2020 2020   exists..       
+0000e7f0: 2020 2020 2020 2020 2060 5472 7565 6020           `True` 
+0000e800: 6279 2064 6566 6175 6c74 2c20 7768 6963  by default, whic
+0000e810: 6820 7769 6c6c 2072 6573 756c 7420 696e  h will result in
+0000e820: 2072 6575 7369 6e67 2061 6e20 6578 6973   reusing an exis
+0000e830: 7469 6e67 2072 656d 6f74 650a 2020 2020  ting remote.    
+0000e840: 2020 2020 2020 2020 2020 2020 6675 6e63              func
+0000e850: 7469 6f6e 2061 6e64 2063 6f72 7265 7370  tion and corresp
+0000e860: 6f6e 6469 6e67 2063 6c6f 7564 2066 756e  onding cloud fun
+0000e870: 6374 696f 6e20 2869 6620 616e 7929 2074  ction (if any) t
+0000e880: 6861 7420 7761 730a 2020 2020 2020 2020  hat was.        
+0000e890: 2020 2020 2020 2020 7072 6576 696f 7573          previous
+0000e8a0: 6c79 2063 7265 6174 6564 2066 6f72 2074  ly created for t
+0000e8b0: 6865 2073 616d 6520 7564 662e 0a20 2020  he same udf..   
+0000e8c0: 2020 2020 2020 2020 2020 2020 2053 6574               Set
+0000e8d0: 7469 6e67 2069 7420 746f 2060 4661 6c73  ting it to `Fals
+0000e8e0: 6560 2077 6f75 6c64 2066 6f72 6365 2063  e` would force c
+0000e8f0: 7265 6174 696e 6720 6120 756e 6971 7565  reating a unique
+0000e900: 2072 656d 6f74 6520 6675 6e63 7469 6f6e   remote function
+0000e910: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e920: 2020 4966 2074 6865 2072 6571 7569 7265    If the require
+0000e930: 6420 7265 6d6f 7465 2066 756e 6374 696f  d remote functio
+0000e940: 6e20 646f 6573 206e 6f74 2065 7869 7374  n does not exist
+0000e950: 2074 6865 6e20 6974 2077 6f75 6c64 2062   then it would b
+0000e960: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000e970: 2020 6372 6561 7465 6420 6972 7265 7370    created irresp
+0000e980: 6563 7469 7665 206f 6620 7468 6973 2070  ective of this p
+0000e990: 6172 616d 2e0a 2020 2020 2020 2020 2020  aram..          
+0000e9a0: 2020 6e61 6d65 2028 7374 722c 204f 7074    name (str, Opt
+0000e9b0: 696f 6e61 6c29 3a0a 2020 2020 2020 2020  ional):.        
+0000e9c0: 2020 2020 2020 2020 4578 706c 6963 6974          Explicit
+0000e9d0: 206e 616d 6520 6f66 2074 6865 2070 6572   name of the per
+0000e9e0: 7369 7374 6564 2042 6967 5175 6572 7920  sisted BigQuery 
+0000e9f0: 7265 6d6f 7465 2066 756e 6374 696f 6e2e  remote function.
+0000ea00: 2055 7365 2069 7420 7769 7468 0a20 2020   Use it with.   
+0000ea10: 2020 2020 2020 2020 2020 2020 2063 6175               cau
+0000ea20: 7469 6f6e 2c20 6265 6361 7573 6520 7477  tion, because tw
+0000ea30: 6f20 7573 6572 7320 776f 726b 696e 6720  o users working 
+0000ea40: 696e 2074 6865 2073 616d 6520 7072 6f6a  in the same proj
+0000ea50: 6563 7420 616e 6420 6461 7461 7365 740a  ect and dataset.
+0000ea60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea70: 636f 756c 6420 6f76 6572 7772 6974 6520  could overwrite 
+0000ea80: 6561 6368 206f 7468 6572 2773 2072 656d  each other's rem
+0000ea90: 6f74 6520 6675 6e63 7469 6f6e 7320 6966  ote functions if
+0000eaa0: 2074 6865 7920 7573 6520 7468 6520 7361   they use the sa
+0000eab0: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+0000eac0: 2020 2070 6572 7369 7374 656e 7420 6e61     persistent na
+0000ead0: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
+0000eae0: 7061 636b 6167 6573 2028 7374 725b 5d2c  packages (str[],
+0000eaf0: 204f 7074 696f 6e61 6c29 3a0a 2020 2020   Optional):.    
+0000eb00: 2020 2020 2020 2020 2020 2020 4578 706c              Expl
+0000eb10: 6963 6974 206e 616d 6520 6f66 2074 6865  icit name of the
+0000eb20: 2065 7874 6572 6e61 6c20 7061 636b 6167   external packag
+0000eb30: 6520 6465 7065 6e64 656e 6369 6573 2e20  e dependencies. 
+0000eb40: 4561 6368 2064 6570 656e 6465 6e63 790a  Each dependency.
+0000eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb60: 6973 2061 6464 6564 2074 6f20 7468 6520  is added to the 
+0000eb70: 6072 6571 7569 7265 6d65 6e74 732e 7478  `requirements.tx
+0000eb80: 7460 2061 7320 6973 2c20 616e 6420 6361  t` as is, and ca
+0000eb90: 6e20 6265 206f 6620 7468 6520 666f 726d  n be of the form
+0000eba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ebb0: 2073 7570 706f 7274 6564 2069 6e20 6874   supported in ht
+0000ebc0: 7470 733a 2f2f 7069 702e 7079 7061 2e69  tps://pip.pypa.i
+0000ebd0: 6f2f 656e 2f73 7461 626c 652f 7265 6665  o/en/stable/refe
+0000ebe0: 7265 6e63 652f 7265 7175 6972 656d 656e  rence/requiremen
+0000ebf0: 7473 2d66 696c 652d 666f 726d 6174 2f2e  ts-file-format/.
+0000ec00: 0a20 2020 2020 2020 2020 2020 2063 6c6f  .            clo
+0000ec10: 7564 5f66 756e 6374 696f 6e5f 7365 7276  ud_function_serv
+0000ec20: 6963 655f 6163 636f 756e 7420 2873 7472  ice_account (str
+0000ec30: 2c20 4f70 7469 6f6e 616c 293a 0a20 2020  , Optional):.   
+0000ec40: 2020 2020 2020 2020 2020 2020 2053 6572               Ser
+0000ec50: 7669 6365 2061 6363 6f75 6e74 2074 6f20  vice account to 
+0000ec60: 7573 6520 666f 7220 7468 6520 636c 6f75  use for the clou
+0000ec70: 6420 6675 6e63 7469 6f6e 732e 2049 6620  d functions. If 
+0000ec80: 6e6f 7420 7072 6f76 6964 6564 0a20 2020  not provided.   
+0000ec90: 2020 2020 2020 2020 2020 2020 2074 6865               the
+0000eca0: 6e20 7468 6520 6465 6661 756c 7420 7365  n the default se
+0000ecb0: 7276 6963 6520 6163 636f 756e 7420 776f  rvice account wo
+0000ecc0: 756c 6420 6265 2075 7365 642e 2053 6565  uld be used. See
+0000ecd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ece0: 2068 7474 7073 3a2f 2f63 6c6f 7564 2e67   https://cloud.g
+0000ecf0: 6f6f 676c 652e 636f 6d2f 6675 6e63 7469  oogle.com/functi
+0000ed00: 6f6e 732f 646f 6373 2f73 6563 7572 696e  ons/docs/securin
+0000ed10: 672f 6675 6e63 7469 6f6e 2d69 6465 6e74  g/function-ident
+0000ed20: 6974 790a 2020 2020 2020 2020 2020 2020  ity.            
+0000ed30: 2020 2020 666f 7220 6d6f 7265 2064 6574      for more det
+0000ed40: 6169 6c73 2e20 506c 6561 7365 206d 616b  ails. Please mak
+0000ed50: 6520 7375 7265 2074 6865 2073 6572 7669  e sure the servi
+0000ed60: 6365 2061 6363 6f75 6e74 2068 6173 2074  ce account has t
+0000ed70: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
+0000ed80: 2020 206e 6563 6573 7361 7279 2049 414d     necessary IAM
+0000ed90: 2070 6572 6d69 7373 696f 6e73 2063 6f6e   permissions con
+0000eda0: 6669 6775 7265 6420 6173 2064 6573 6372  figured as descr
+0000edb0: 6962 6564 2069 6e0a 2020 2020 2020 2020  ibed in.        
+0000edc0: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+0000edd0: 636c 6f75 642e 676f 6f67 6c65 2e63 6f6d  cloud.google.com
+0000ede0: 2f66 756e 6374 696f 6e73 2f64 6f63 732f  /functions/docs/
+0000edf0: 7265 6665 7265 6e63 652f 6961 6d2f 726f  reference/iam/ro
+0000ee00: 6c65 7323 6164 6469 7469 6f6e 616c 2d63  les#additional-c
+0000ee10: 6f6e 6669 6775 7261 7469 6f6e 2e0a 2020  onfiguration..  
+0000ee20: 2020 2020 2020 2020 2020 636c 6f75 645f            cloud_
+0000ee30: 6675 6e63 7469 6f6e 5f6b 6d73 5f6b 6579  function_kms_key
+0000ee40: 5f6e 616d 6520 2873 7472 2c20 4f70 7469  _name (str, Opti
+0000ee50: 6f6e 616c 293a 0a20 2020 2020 2020 2020  onal):.         
+0000ee60: 2020 2020 2020 2043 7573 746f 6d65 7220         Customer 
+0000ee70: 6d61 6e61 6765 6420 656e 6372 7970 7469  managed encrypti
+0000ee80: 6f6e 206b 6579 2074 6f20 7072 6f74 6563  on key to protec
+0000ee90: 7420 636c 6f75 6420 6675 6e63 7469 6f6e  t cloud function
+0000eea0: 7320 616e 640a 2020 2020 2020 2020 2020  s and.          
+0000eeb0: 2020 2020 2020 7265 6c61 7465 6420 6461        related da
+0000eec0: 7461 2061 7420 7265 7374 2e20 5468 6973  ta at rest. This
+0000eed0: 2069 7320 6f66 2074 6865 2066 6f72 6d61   is of the forma
+0000eee0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0000eef0: 2020 7072 6f6a 6563 7473 2f50 524f 4a45    projects/PROJE
+0000ef00: 4354 5f49 442f 6c6f 6361 7469 6f6e 732f  CT_ID/locations/
+0000ef10: 4c4f 4341 5449 4f4e 2f6b 6579 5269 6e67  LOCATION/keyRing
+0000ef20: 732f 4b45 5952 494e 472f 6372 7970 746f  s/KEYRING/crypto
+0000ef30: 4b65 7973 2f4b 4559 2e0a 2020 2020 2020  Keys/KEY..      
+0000ef40: 2020 2020 2020 2020 2020 5265 6164 2068            Read h
+0000ef50: 7474 7073 3a2f 2f63 6c6f 7564 2e67 6f6f  ttps://cloud.goo
+0000ef60: 676c 652e 636f 6d2f 6675 6e63 7469 6f6e  gle.com/function
+0000ef70: 732f 646f 6373 2f73 6563 7572 696e 672f  s/docs/securing/
+0000ef80: 636d 656b 2066 6f72 0a20 2020 2020 2020  cmek for.       
+0000ef90: 2020 2020 2020 2020 206d 6f72 6520 6465           more de
+0000efa0: 7461 696c 7320 696e 636c 7564 696e 6720  tails including 
+0000efb0: 6772 616e 7469 6e67 206e 6563 6573 7361  granting necessa
+0000efc0: 7279 2073 6572 7669 6365 2061 6363 6f75  ry service accou
+0000efd0: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
+0000efe0: 2020 2020 6163 6365 7373 2074 6f20 7468      access to th
+0000eff0: 6520 6b65 792e 0a20 2020 2020 2020 2020  e key..         
+0000f000: 2020 2063 6c6f 7564 5f66 756e 6374 696f     cloud_functio
+0000f010: 6e5f 646f 636b 6572 5f72 6570 6f73 6974  n_docker_reposit
+0000f020: 6f72 7920 2873 7472 2c20 4f70 7469 6f6e  ory (str, Option
+0000f030: 616c 293a 0a20 2020 2020 2020 2020 2020  al):.           
+0000f040: 2020 2020 2044 6f63 6b65 7220 7265 706f       Docker repo
+0000f050: 7369 746f 7279 2063 7265 6174 6564 2077  sitory created w
+0000f060: 6974 6820 7468 6520 7361 6d65 2065 6e63  ith the same enc
+0000f070: 7279 7074 696f 6e20 6b65 7920 6173 0a20  ryption key as. 
+0000f080: 2020 2020 2020 2020 2020 2020 2020 2060                 `
+0000f090: 636c 6f75 645f 6675 6e63 7469 6f6e 5f6b  cloud_function_k
+0000f0a0: 6d73 5f6b 6579 5f6e 616d 6560 2074 6f20  ms_key_name` to 
+0000f0b0: 7374 6f72 6520 656e 6372 7970 7465 6420  store encrypted 
+0000f0c0: 6172 7469 6661 6374 730a 2020 2020 2020  artifacts.      
+0000f0d0: 2020 2020 2020 2020 2020 6372 6561 7465            create
+0000f0e0: 6420 746f 2073 7570 706f 7274 2074 6865  d to support the
+0000f0f0: 2063 6c6f 7564 2066 756e 6374 696f 6e2e   cloud function.
+0000f100: 2054 6869 7320 6973 206f 6620 7468 6520   This is of the 
+0000f110: 666f 726d 6174 0a20 2020 2020 2020 2020  format.         
+0000f120: 2020 2020 2020 2070 726f 6a65 6374 732f         projects/
+0000f130: 5052 4f4a 4543 545f 4944 2f6c 6f63 6174  PROJECT_ID/locat
+0000f140: 696f 6e73 2f4c 4f43 4154 494f 4e2f 7265  ions/LOCATION/re
+0000f150: 706f 7369 746f 7269 6573 2f52 4550 4f53  positories/REPOS
+0000f160: 4954 4f52 595f 4e41 4d45 2e0a 2020 2020  ITORY_NAME..    
+0000f170: 2020 2020 2020 2020 2020 2020 466f 7220              For 
+0000f180: 6d6f 7265 2064 6574 6169 6c73 2073 6565  more details see
+0000f190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f1a0: 2068 7474 7073 3a2f 2f63 6c6f 7564 2e67   https://cloud.g
+0000f1b0: 6f6f 676c 652e 636f 6d2f 6675 6e63 7469  oogle.com/functi
+0000f1c0: 6f6e 732f 646f 6373 2f73 6563 7572 696e  ons/docs/securin
+0000f1d0: 672f 636d 656b 2362 6566 6f72 655f 796f  g/cmek#before_yo
+0000f1e0: 755f 6265 6769 6e2e 0a20 2020 2020 2020  u_begin..       
+0000f1f0: 2020 2020 206d 6178 5f62 6174 6368 696e       max_batchin
+0000f200: 675f 726f 7773 2028 696e 742c 204f 7074  g_rows (int, Opt
+0000f210: 696f 6e61 6c29 3a0a 2020 2020 2020 2020  ional):.        
+0000f220: 2020 2020 2020 2020 5468 6520 6d61 7869          The maxi
+0000f230: 6d75 6d20 6e75 6d62 6572 206f 6620 726f  mum number of ro
+0000f240: 7773 2074 6f20 6265 2062 6174 6368 6564  ws to be batched
+0000f250: 2066 6f72 2070 726f 6365 7373 696e 6720   for processing 
+0000f260: 696e 2074 6865 0a20 2020 2020 2020 2020  in the.         
+0000f270: 2020 2020 2020 2042 5120 7265 6d6f 7465         BQ remote
+0000f280: 2066 756e 6374 696f 6e2e 2044 6566 6175   function. Defau
+0000f290: 6c74 2076 616c 7565 2069 7320 3130 3030  lt value is 1000
+0000f2a0: 2e20 4120 6c6f 7765 7220 6e75 6d62 6572  . A lower number
+0000f2b0: 2063 616e 2062 650a 2020 2020 2020 2020   can be.        
+0000f2c0: 2020 2020 2020 2020 7061 7373 6564 2074          passed t
+0000f2d0: 6f20 6176 6f69 6420 7469 6d65 6f75 7473  o avoid timeouts
+0000f2e0: 2069 6e20 6361 7365 2074 6865 2075 7365   in case the use
+0000f2f0: 7220 636f 6465 2069 7320 746f 6f20 636f  r code is too co
+0000f300: 6d70 6c65 7820 746f 0a20 2020 2020 2020  mplex to.       
+0000f310: 2020 2020 2020 2020 2070 726f 6365 7373           process
+0000f320: 206c 6172 6765 206e 756d 6265 7220 6f66   large number of
+0000f330: 2072 6f77 7320 6661 7374 2065 6e6f 7567   rows fast enoug
+0000f340: 682e 2041 2068 6967 6865 7220 6e75 6d62  h. A higher numb
+0000f350: 6572 2063 616e 2062 650a 2020 2020 2020  er can be.      
+0000f360: 2020 2020 2020 2020 2020 7573 6564 2074            used t
+0000f370: 6f20 696e 6372 6561 7365 2074 6872 6f75  o increase throu
+0000f380: 6768 7075 7420 696e 2063 6173 6520 7468  ghput in case th
+0000f390: 6520 7573 6572 2063 6f64 6520 6973 2066  e user code is f
+0000f3a0: 6173 7420 656e 6f75 6768 2e0a 2020 2020  ast enough..    
+0000f3b0: 2020 2020 2020 2020 2020 2020 604e 6f6e              `Non
+0000f3c0: 6560 2063 616e 2062 6520 7061 7373 6564  e` can be passed
+0000f3d0: 2074 6f20 6c65 7420 4251 2072 656d 6f74   to let BQ remot
+0000f3e0: 6520 6675 6e63 7469 6f6e 7320 7365 7276  e functions serv
+0000f3f0: 6963 6520 6170 706c 790a 2020 2020 2020  ice apply.      
+0000f400: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+0000f410: 7420 6261 7463 6869 6e67 2e20 5365 6520  t batching. See 
+0000f420: 666f 7220 6d6f 7265 2064 6574 6169 6c73  for more details
+0000f430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f440: 2068 7474 7073 3a2f 2f63 6c6f 7564 2e67   https://cloud.g
+0000f450: 6f6f 676c 652e 636f 6d2f 6269 6771 7565  oogle.com/bigque
+0000f460: 7279 2f64 6f63 732f 7265 6d6f 7465 2d66  ry/docs/remote-f
+0000f470: 756e 6374 696f 6e73 236c 696d 6974 696e  unctions#limitin
+0000f480: 675f 6e75 6d62 6572 5f6f 665f 726f 7773  g_number_of_rows
+0000f490: 5f69 6e5f 615f 6261 7463 685f 7265 7175  _in_a_batch_requ
+0000f4a0: 6573 742e 0a20 2020 2020 2020 2020 2020  est..           
+0000f4b0: 2063 6c6f 7564 5f66 756e 6374 696f 6e5f   cloud_function_
+0000f4c0: 7469 6d65 6f75 7420 2869 6e74 2c20 4f70  timeout (int, Op
+0000f4d0: 7469 6f6e 616c 293a 0a20 2020 2020 2020  tional):.       
+0000f4e0: 2020 2020 2020 2020 2054 6865 206d 6178           The max
+0000f4f0: 696d 756d 2061 6d6f 756e 7420 6f66 2074  imum amount of t
+0000f500: 696d 6520 2869 6e20 7365 636f 6e64 7329  ime (in seconds)
+0000f510: 2042 6967 5175 6572 7920 7368 6f75 6c64   BigQuery should
+0000f520: 2077 6169 7420 666f 720a 2020 2020 2020   wait for.      
+0000f530: 2020 2020 2020 2020 2020 7468 6520 636c            the cl
+0000f540: 6f75 6420 6675 6e63 7469 6f6e 2074 6f20  oud function to 
+0000f550: 7265 7475 726e 2061 2072 6573 706f 6e73  return a respons
+0000f560: 652e 2053 6565 2066 6f72 206d 6f72 6520  e. See for more 
+0000f570: 6465 7461 696c 730a 2020 2020 2020 2020  details.        
+0000f580: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+0000f590: 636c 6f75 642e 676f 6f67 6c65 2e63 6f6d  cloud.google.com
+0000f5a0: 2f66 756e 6374 696f 6e73 2f64 6f63 732f  /functions/docs/
+0000f5b0: 636f 6e66 6967 7572 696e 672f 7469 6d65  configuring/time
+0000f5c0: 6f75 742e 0a20 2020 2020 2020 2020 2020  out..           
+0000f5d0: 2020 2020 2050 6c65 6173 6520 6e6f 7465       Please note
+0000f5e0: 2074 6861 7420 6576 656e 2074 686f 7567   that even thoug
+0000f5f0: 6820 7468 6520 636c 6f75 6420 6675 6e63  h the cloud func
+0000f600: 7469 6f6e 2028 326e 6420 6765 6e29 2069  tion (2nd gen) i
+0000f610: 7473 656c 660a 2020 2020 2020 2020 2020  tself.          
+0000f620: 2020 2020 2020 616c 6c6f 7773 2073 6565        allows see
+0000f630: 7469 6e67 2075 7020 746f 2036 3020 6d69  ting up to 60 mi
+0000f640: 6e75 7465 7320 6f66 2074 696d 656f 7574  nutes of timeout
+0000f650: 2c20 4269 6751 7565 7279 2072 656d 6f74  , BigQuery remot
+0000f660: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000f670: 2020 6675 6e63 7469 6f6e 2063 616e 2077    function can w
+0000f680: 6169 7420 6f6e 6c79 2075 7020 746f 2032  ait only up to 2
+0000f690: 3020 6d69 6e75 7465 732c 2073 6565 2066  0 minutes, see f
+0000f6a0: 6f72 206d 6f72 6520 6465 7461 696c 730a  or more details.
+0000f6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6c0: 6874 7470 733a 2f2f 636c 6f75 642e 676f  https://cloud.go
+0000f6d0: 6f67 6c65 2e63 6f6d 2f62 6967 7175 6572  ogle.com/bigquer
+0000f6e0: 792f 7175 6f74 6173 2372 656d 6f74 655f  y/quotas#remote_
+0000f6f0: 6675 6e63 7469 6f6e 5f6c 696d 6974 732e  function_limits.
+0000f700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f710: 2042 7920 6465 6661 756c 7420 4269 6751   By default BigQ
+0000f720: 7565 7279 2044 6174 6146 7261 6d65 7320  uery DataFrames 
+0000f730: 7573 6573 2061 2031 3020 6d69 6e75 7465  uses a 10 minute
+0000f740: 2074 696d 656f 7574 2e20 604e 6f6e 6560   timeout. `None`
+0000f750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f760: 2063 616e 2062 6520 7061 7373 6564 2074   can be passed t
+0000f770: 6f20 6c65 7420 7468 6520 636c 6f75 6420  o let the cloud 
+0000f780: 6675 6e63 7469 6f6e 7320 6465 6661 756c  functions defaul
+0000f790: 7420 7469 6d65 6f75 7420 7461 6b65 2065  t timeout take e
+0000f7a0: 6666 6563 742e 0a20 2020 2020 2020 2020  ffect..         
+0000f7b0: 2020 2063 6c6f 7564 5f66 756e 6374 696f     cloud_functio
+0000f7c0: 6e5f 6d61 785f 696e 7374 616e 6365 7320  n_max_instances 
+0000f7d0: 2869 6e74 2c20 4f70 7469 6f6e 616c 293a  (int, Optional):
+0000f7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f7f0: 2054 6865 206d 6178 696d 756d 6d20 696e   The maximumm in
+0000f800: 7374 616e 6365 2063 6f75 6e74 2066 6f72  stance count for
+0000f810: 2074 6865 2063 6c6f 7564 2066 756e 6374   the cloud funct
+0000f820: 696f 6e20 6372 6561 7465 642e 2054 6869  ion created. Thi
+0000f830: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0000f840: 2020 6361 6e20 6265 2075 7365 6420 746f    can be used to
+0000f850: 2063 6f6e 7472 6f6c 2068 6f77 206d 616e   control how man
+0000f860: 7920 636c 6f75 6420 6675 6e63 7469 6f6e  y cloud function
+0000f870: 2069 6e73 7461 6e63 6573 2063 616e 2062   instances can b
+0000f880: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000f890: 2020 6163 7469 7665 2061 7420 6d61 7820    active at max 
+0000f8a0: 6174 2061 6e79 2067 6976 656e 2070 6f69  at any given poi
+0000f8b0: 6e74 206f 6620 7469 6d65 2e20 4c6f 7765  nt of time. Lowe
+0000f8c0: 7220 7365 7474 696e 6720 6361 6e20 6865  r setting can he
+0000f8d0: 6c70 0a20 2020 2020 2020 2020 2020 2020  lp.             
+0000f8e0: 2020 2063 6f6e 7472 6f6c 2074 6865 2073     control the s
+0000f8f0: 7069 6b65 2069 6e20 7468 6520 6269 6c6c  pike in the bill
+0000f900: 696e 672e 2048 6967 6865 7220 7365 7474  ing. Higher sett
+0000f910: 696e 6720 6361 6e20 6865 6c70 0a20 2020  ing can help.   
+0000f920: 2020 2020 2020 2020 2020 2020 2073 7570               sup
+0000f930: 706f 7274 2070 726f 6365 7373 696e 6720  port processing 
+0000f940: 6c61 7267 6572 2073 6361 6c65 2064 6174  larger scale dat
+0000f950: 612e 2057 6865 6e20 6e6f 7420 7370 6563  a. When not spec
+0000f960: 6966 6965 642c 2063 6c6f 7564 0a20 2020  ified, cloud.   
+0000f970: 2020 2020 2020 2020 2020 2020 2066 756e               fun
+0000f980: 6374 696f 6e27 7320 6465 6661 756c 7420  ction's default 
+0000f990: 7365 7474 696e 6720 6170 706c 6965 732e  setting applies.
+0000f9a0: 2046 6f72 206d 6f72 6520 6465 7461 696c   For more detail
+0000f9b0: 7320 7365 650a 2020 2020 2020 2020 2020  s see.          
+0000f9c0: 2020 2020 2020 6874 7470 733a 2f2f 636c        https://cl
+0000f9d0: 6f75 642e 676f 6f67 6c65 2e63 6f6d 2f66  oud.google.com/f
+0000f9e0: 756e 6374 696f 6e73 2f64 6f63 732f 636f  unctions/docs/co
+0000f9f0: 6e66 6967 7572 696e 672f 6d61 782d 696e  nfiguring/max-in
+0000fa00: 7374 616e 6365 732e 0a20 2020 2020 2020  stances..       
+0000fa10: 2020 2020 2063 6c6f 7564 5f66 756e 6374       cloud_funct
+0000fa20: 696f 6e5f 7670 635f 636f 6e6e 6563 746f  ion_vpc_connecto
+0000fa30: 7220 2873 7472 2c20 4f70 7469 6f6e 616c  r (str, Optional
+0000fa40: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000fa50: 2020 2054 6865 2056 5043 2063 6f6e 6e65     The VPC conne
+0000fa60: 6374 6f72 2079 6f75 2077 6f75 6c64 206c  ctor you would l
+0000fa70: 696b 6520 746f 2063 6f6e 6669 6775 7265  ike to configure
+0000fa80: 2066 6f72 2079 6f75 7220 636c 6f75 640a   for your cloud.
+0000fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000faa0: 6675 6e63 7469 6f6e 2e20 5468 6973 2069  function. This i
+0000fab0: 7320 7573 6566 756c 2069 6620 796f 7572  s useful if your
+0000fac0: 2063 6f64 6520 6e65 6564 7320 6163 6365   code needs acce
+0000fad0: 7373 2074 6f20 6461 7461 206f 720a 2020  ss to data or.  
+0000fae0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000faf0: 7276 6963 6528 7329 2074 6861 7420 6172  rvice(s) that ar
+0000fb00: 6520 6f6e 2061 2056 5043 206e 6574 776f  e on a VPC netwo
+0000fb10: 726b 2e20 5365 6520 666f 7220 6d6f 7265  rk. See for more
+0000fb20: 2064 6574 6169 6c73 0a20 2020 2020 2020   details.       
+0000fb30: 2020 2020 2020 2020 2068 7474 7073 3a2f           https:/
+0000fb40: 2f63 6c6f 7564 2e67 6f6f 676c 652e 636f  /cloud.google.co
+0000fb50: 6d2f 6675 6e63 7469 6f6e 732f 646f 6373  m/functions/docs
+0000fb60: 2f6e 6574 776f 726b 696e 672f 636f 6e6e  /networking/conn
+0000fb70: 6563 7469 6e67 2d76 7063 2e0a 2020 2020  ecting-vpc..    
+0000fb80: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+0000fb90: 2020 2020 2020 2020 2063 616c 6c61 626c           callabl
+0000fba0: 653a 2041 2072 656d 6f74 6520 6675 6e63  e: A remote func
+0000fbb0: 7469 6f6e 206f 626a 6563 7420 706f 696e  tion object poin
+0000fbc0: 7469 6e67 2074 6f20 7468 6520 636c 6f75  ting to the clou
+0000fbd0: 6420 6173 7365 7473 2063 7265 6174 6564  d assets created
+0000fbe0: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
+0000fbf0: 7468 6520 6261 636b 6772 6f75 6e64 2074  the background t
+0000fc00: 6f20 7375 7070 6f72 7420 7468 6520 7265  o support the re
+0000fc10: 6d6f 7465 2065 7865 6375 7469 6f6e 2e20  mote execution. 
+0000fc20: 5468 6520 636c 6f75 6420 6173 7365 7473  The cloud assets
+0000fc30: 2063 616e 2062 650a 2020 2020 2020 2020   can be.        
+0000fc40: 2020 2020 6c6f 6361 7465 6420 7468 726f      located thro
+0000fc50: 7567 6820 7468 6520 666f 6c6c 6f77 696e  ugh the followin
+0000fc60: 6720 7072 6f70 6572 7469 6573 2073 6574  g properties set
+0000fc70: 2069 6e20 7468 6520 6f62 6a65 6374 3a0a   in the object:.
+0000fc80: 0a20 2020 2020 2020 2020 2020 2060 6269  .            `bi
+0000fc90: 6766 7261 6d65 735f 636c 6f75 645f 6675  gframes_cloud_fu
+0000fca0: 6e63 7469 6f6e 6020 2d20 5468 6520 676f  nction` - The go
+0000fcb0: 6f67 6c65 2063 6c6f 7564 2066 756e 6374  ogle cloud funct
+0000fcc0: 696f 6e20 6465 706c 6f79 6564 2066 6f72  ion deployed for
+0000fcd0: 2074 6865 2075 7365 7220 6465 6669 6e65   the user define
+0000fce0: 6420 636f 6465 2e0a 0a20 2020 2020 2020  d code...       
+0000fcf0: 2020 2020 2060 6269 6766 7261 6d65 735f       `bigframes_
+0000fd00: 7265 6d6f 7465 5f66 756e 6374 696f 6e60  remote_function`
+0000fd10: 202d 2054 6865 2062 6967 7175 6572 7920   - The bigquery 
+0000fd20: 7265 6d6f 7465 2066 756e 6374 696f 6e20  remote function 
+0000fd30: 6361 7061 626c 6520 6f66 2063 616c 6c69  capable of calli
+0000fd40: 6e67 2069 6e74 6f20 6062 6967 6672 616d  ng into `bigfram
+0000fd50: 6573 5f63 6c6f 7564 5f66 756e 6374 696f  es_cloud_functio
+0000fd60: 6e60 2e0a 2020 2020 2020 2020 2222 220a  n`..        """.
+0000fd70: 2020 2020 2020 2020 7265 7475 726e 2062          return b
+0000fd80: 6967 6672 616d 6573 5f72 6628 0a20 2020  igframes_rf(.   
+0000fd90: 2020 2020 2020 2020 2069 6e70 7574 5f74           input_t
+0000fda0: 7970 6573 2c0a 2020 2020 2020 2020 2020  ypes,.          
+0000fdb0: 2020 6f75 7470 7574 5f74 7970 652c 0a20    output_type,. 
+0000fdc0: 2020 2020 2020 2020 2020 2073 6573 7369             sessi
+0000fdd0: 6f6e 3d73 656c 662c 0a20 2020 2020 2020  on=self,.       
+0000fde0: 2020 2020 2064 6174 6173 6574 3d64 6174       dataset=dat
+0000fdf0: 6173 6574 2c0a 2020 2020 2020 2020 2020  aset,.          
+0000fe00: 2020 6269 6771 7565 7279 5f63 6f6e 6e65    bigquery_conne
+0000fe10: 6374 696f 6e3d 6269 6771 7565 7279 5f63  ction=bigquery_c
+0000fe20: 6f6e 6e65 6374 696f 6e2c 0a20 2020 2020  onnection,.     
+0000fe30: 2020 2020 2020 2072 6575 7365 3d72 6575         reuse=reu
+0000fe40: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+0000fe50: 6e61 6d65 3d6e 616d 652c 0a20 2020 2020  name=name,.     
+0000fe60: 2020 2020 2020 2070 6163 6b61 6765 733d         packages=
+0000fe70: 7061 636b 6167 6573 2c0a 2020 2020 2020  packages,.      
+0000fe80: 2020 2020 2020 636c 6f75 645f 6675 6e63        cloud_func
+0000fe90: 7469 6f6e 5f73 6572 7669 6365 5f61 6363  tion_service_acc
+0000fea0: 6f75 6e74 3d63 6c6f 7564 5f66 756e 6374  ount=cloud_funct
+0000feb0: 696f 6e5f 7365 7276 6963 655f 6163 636f  ion_service_acco
+0000fec0: 756e 742c 0a20 2020 2020 2020 2020 2020  unt,.           
+0000fed0: 2063 6c6f 7564 5f66 756e 6374 696f 6e5f   cloud_function_
+0000fee0: 6b6d 735f 6b65 795f 6e61 6d65 3d63 6c6f  kms_key_name=clo
+0000fef0: 7564 5f66 756e 6374 696f 6e5f 6b6d 735f  ud_function_kms_
+0000ff00: 6b65 795f 6e61 6d65 2c0a 2020 2020 2020  key_name,.      
+0000ff10: 2020 2020 2020 636c 6f75 645f 6675 6e63        cloud_func
+0000ff20: 7469 6f6e 5f64 6f63 6b65 725f 7265 706f  tion_docker_repo
+0000ff30: 7369 746f 7279 3d63 6c6f 7564 5f66 756e  sitory=cloud_fun
+0000ff40: 6374 696f 6e5f 646f 636b 6572 5f72 6570  ction_docker_rep
+0000ff50: 6f73 6974 6f72 792c 0a20 2020 2020 2020  ository,.       
+0000ff60: 2020 2020 206d 6178 5f62 6174 6368 696e       max_batchin
+0000ff70: 675f 726f 7773 3d6d 6178 5f62 6174 6368  g_rows=max_batch
+0000ff80: 696e 675f 726f 7773 2c0a 2020 2020 2020  ing_rows,.      
+0000ff90: 2020 2020 2020 636c 6f75 645f 6675 6e63        cloud_func
+0000ffa0: 7469 6f6e 5f74 696d 656f 7574 3d63 6c6f  tion_timeout=clo
+0000ffb0: 7564 5f66 756e 6374 696f 6e5f 7469 6d65  ud_function_time
+0000ffc0: 6f75 742c 0a20 2020 2020 2020 2020 2020  out,.           
+0000ffd0: 2063 6c6f 7564 5f66 756e 6374 696f 6e5f   cloud_function_
+0000ffe0: 6d61 785f 696e 7374 616e 6365 733d 636c  max_instances=cl
+0000fff0: 6f75 645f 6675 6e63 7469 6f6e 5f6d 6178  oud_function_max
+00010000: 5f69 6e73 7461 6e63 6573 2c0a 2020 2020  _instances,.    
+00010010: 2020 2020 2020 2020 636c 6f75 645f 6675          cloud_fu
+00010020: 6e63 7469 6f6e 5f76 7063 5f63 6f6e 6e65  nction_vpc_conne
+00010030: 6374 6f72 3d63 6c6f 7564 5f66 756e 6374  ctor=cloud_funct
+00010040: 696f 6e5f 7670 635f 636f 6e6e 6563 746f  ion_vpc_connecto
+00010050: 722c 0a20 2020 2020 2020 2029 0a0a 2020  r,.        )..  
+00010060: 2020 6465 6620 7265 6164 5f67 6271 5f66    def read_gbq_f
+00010070: 756e 6374 696f 6e28 0a20 2020 2020 2020  unction(.       
+00010080: 2073 656c 662c 0a20 2020 2020 2020 2066   self,.        f
+00010090: 756e 6374 696f 6e5f 6e61 6d65 3a20 7374  unction_name: st
+000100a0: 722c 0a20 2020 2029 3a0a 2020 2020 2020  r,.    ):.      
+000100b0: 2020 2222 224c 6f61 6473 2061 2042 6967    """Loads a Big
+000100c0: 5175 6572 7920 6675 6e63 7469 6f6e 2066  Query function f
+000100d0: 726f 6d20 4269 6751 7565 7279 2e0a 0a20  rom BigQuery... 
+000100e0: 2020 2020 2020 2054 6865 6e20 6974 2063         Then it c
+000100f0: 616e 2062 6520 6170 706c 6965 6420 746f  an be applied to
+00010100: 2061 2044 6174 6146 7261 6d65 206f 7220   a DataFrame or 
+00010110: 5365 7269 6573 2e0a 0a20 2020 2020 2020  Series...       
+00010120: 202e 2e20 6e6f 7465 3a3a 0a20 2020 2020   .. note::.     
+00010130: 2020 2020 2020 2054 6865 2072 6574 7572         The retur
+00010140: 6e20 7479 7065 206f 6620 7468 6520 6675  n type of the fu
+00010150: 6e63 7469 6f6e 206d 7573 7420 6265 2065  nction must be e
+00010160: 7870 6c69 6369 746c 7920 7370 6563 6966  xplicitly specif
+00010170: 6965 6420 696e 2074 6865 0a20 2020 2020  ied in the.     
+00010180: 2020 2020 2020 2066 756e 6374 696f 6e27         function'
+00010190: 7320 6f72 6967 696e 616c 2064 6566 696e  s original defin
+000101a0: 6974 696f 6e20 6576 656e 2069 6620 6e6f  ition even if no
+000101b0: 7420 6f74 6865 7277 6973 6520 7265 7175  t otherwise requ
+000101c0: 6972 6564 2e0a 0a20 2020 2020 2020 2042  ired...        B
+000101d0: 6967 5175 6572 7920 5574 696c 7320 7072  igQuery Utils pr
+000101e0: 6f76 6964 6573 206d 616e 7920 7075 626c  ovides many publ
+000101f0: 6963 2066 756e 6374 696f 6e73 2075 6e64  ic functions und
+00010200: 6572 2074 6865 2060 6062 7175 7469 6c60  er the ``bqutil`
+00010210: 6020 7072 6f6a 6563 7420 6f6e 2047 6f6f  ` project on Goo
+00010220: 676c 6520 436c 6f75 6420 506c 6174 666f  gle Cloud Platfo
+00010230: 726d 2070 726f 6a65 6374 0a20 2020 2020  rm project.     
+00010240: 2020 2028 5365 653a 2068 7474 7073 3a2f     (See: https:/
+00010250: 2f67 6974 6875 622e 636f 6d2f 476f 6f67  /github.com/Goog
+00010260: 6c65 436c 6f75 6450 6c61 7466 6f72 6d2f  leCloudPlatform/
+00010270: 6269 6771 7565 7279 2d75 7469 6c73 2f74  bigquery-utils/t
+00010280: 7265 652f 6d61 7374 6572 2f75 6466 7323  ree/master/udfs#
+00010290: 7573 696e 672d 7468 652d 7564 6673 292e  using-the-udfs).
+000102a0: 0a20 2020 2020 2020 2059 6f75 2063 616e  .        You can
+000102b0: 2063 6865 636b 6f75 7420 436f 6d6d 756e   checkout Commun
+000102c0: 6974 7920 5544 4673 2074 6f20 7573 6520  ity UDFs to use 
+000102d0: 636f 6d6d 756e 6974 792d 636f 6e74 7269  community-contri
+000102e0: 6275 7465 6420 6675 6e63 7469 6f6e 732e  buted functions.
+000102f0: 0a20 2020 2020 2020 2028 5365 653a 2068  .        (See: h
+00010300: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+00010310: 6d2f 476f 6f67 6c65 436c 6f75 6450 6c61  m/GoogleCloudPla
+00010320: 7466 6f72 6d2f 6269 6771 7565 7279 2d75  tform/bigquery-u
+00010330: 7469 6c73 2f74 7265 652f 6d61 7374 6572  tils/tree/master
+00010340: 2f75 6466 732f 636f 6d6d 756e 6974 7923  /udfs/community#
+00010350: 636f 6d6d 756e 6974 792d 7564 6673 292e  community-udfs).
+00010360: 0a0a 2020 2020 2020 2020 2a2a 4578 616d  ..        **Exam
+00010370: 706c 6573 3a2a 2a0a 0a20 2020 2020 2020  ples:**..       
+00010380: 2055 7365 2074 6865 2060 6063 775f 6c6f   Use the ``cw_lo
+00010390: 7765 725f 6361 7365 5f61 7363 6969 5f6f  wer_case_ascii_o
+000103a0: 6e6c 7960 6020 6675 6e63 7469 6f6e 2066  nly`` function f
+000103b0: 726f 6d20 436f 6d6d 756e 6974 7920 5544  rom Community UD
+000103c0: 4673 2e0a 2020 2020 2020 2020 2868 7474  Fs..        (htt
+000103d0: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+000103e0: 476f 6f67 6c65 436c 6f75 6450 6c61 7466  GoogleCloudPlatf
+000103f0: 6f72 6d2f 6269 6771 7565 7279 2d75 7469  orm/bigquery-uti
+00010400: 6c73 2f62 6c6f 622f 6d61 7374 6572 2f75  ls/blob/master/u
+00010410: 6466 732f 636f 6d6d 756e 6974 792f 6377  dfs/community/cw
+00010420: 5f6c 6f77 6572 5f63 6173 655f 6173 6369  _lower_case_asci
+00010430: 695f 6f6e 6c79 2e73 716c 7829 0a0a 2020  i_only.sqlx)..  
+00010440: 2020 2020 2020 2020 2020 3e3e 3e20 696d            >>> im
+00010450: 706f 7274 2062 6967 6672 616d 6573 2e70  port bigframes.p
+00010460: 616e 6461 7320 6173 2062 7064 0a20 2020  andas as bpd.   
+00010470: 2020 2020 2020 2020 203e 3e3e 2062 7064           >>> bpd
+00010480: 2e6f 7074 696f 6e73 2e64 6973 706c 6179  .options.display
+00010490: 2e70 726f 6772 6573 735f 6261 7220 3d20  .progress_bar = 
+000104a0: 4e6f 6e65 0a0a 2020 2020 2020 2020 2020  None..          
+000104b0: 2020 3e3e 3e20 6466 203d 2062 7064 2e44    >>> df = bpd.D
+000104c0: 6174 6146 7261 6d65 287b 2769 6427 3a20  ataFrame({'id': 
+000104d0: 5b31 2c20 322c 2033 5d2c 2027 6e61 6d65  [1, 2, 3], 'name
+000104e0: 273a 205b 2741 5552 c389 4c49 4527 2c20  ': ['AUR..LIE', 
+000104f0: 2743 c389 4c45 5354 494e 4527 2c20 2744  'C..LESTINE', 'D
+00010500: 4150 484e c389 275d 7d29 0a20 2020 2020  APHN..']}).     
+00010510: 2020 2020 2020 203e 3e3e 2064 660a 2020         >>> df.  
+00010520: 2020 2020 2020 2020 2020 2020 2069 6420               id 
+00010530: 2020 2020 2020 6e61 6d65 0a20 2020 2020        name.     
+00010540: 2020 2020 2020 2030 2020 2031 2020 2020         0   1    
+00010550: 4155 52c3 894c 4945 0a20 2020 2020 2020  AUR..LIE.       
+00010560: 2020 2020 2031 2020 2032 2020 43c3 894c       1   2  C..L
+00010570: 4553 5449 4e45 0a20 2020 2020 2020 2020  ESTINE.         
+00010580: 2020 2032 2020 2033 2020 2020 2044 4150     2   3     DAP
+00010590: 484e c389 0a20 2020 2020 2020 2020 2020  HN...           
+000105a0: 203c 424c 414e 4b4c 494e 453e 0a20 2020   <BLANKLINE>.   
+000105b0: 2020 2020 2020 2020 205b 3320 726f 7773           [3 rows
+000105c0: 2078 2032 2063 6f6c 756d 6e73 5d0a 0a20   x 2 columns].. 
+000105d0: 2020 2020 2020 2020 2020 203e 3e3e 2066             >>> f
+000105e0: 756e 6320 3d20 6270 642e 7265 6164 5f67  unc = bpd.read_g
+000105f0: 6271 5f66 756e 6374 696f 6e28 2262 7175  bq_function("bqu
+00010600: 7469 6c2e 666e 2e63 775f 6c6f 7765 725f  til.fn.cw_lower_
+00010610: 6361 7365 5f61 7363 6969 5f6f 6e6c 7922  case_ascii_only"
+00010620: 290a 2020 2020 2020 2020 2020 2020 3e3e  ).            >>
+00010630: 3e20 6466 3120 3d20 6466 2e61 7373 6967  > df1 = df.assig
+00010640: 6e28 6e65 775f 6e61 6d65 3d64 665b 276e  n(new_name=df['n
+00010650: 616d 6527 5d2e 6170 706c 7928 6675 6e63  ame'].apply(func
+00010660: 2929 0a20 2020 2020 2020 2020 2020 203e  )).            >
+00010670: 3e3e 2064 6631 0a20 2020 2020 2020 2020  >> df1.         
+00010680: 2020 2020 2020 6964 2020 2020 2020 206e        id       n
+00010690: 616d 6520 2020 6e65 775f 6e61 6d65 0a20  ame   new_name. 
+000106a0: 2020 2020 2020 2020 2020 2030 2020 2031             0   1
+000106b0: 2020 2020 4155 52c3 894c 4945 2020 2020      AUR..LIE    
+000106c0: 6175 72c3 896c 6965 0a20 2020 2020 2020  aur..lie.       
+000106d0: 2020 2020 2031 2020 2032 2020 43c3 894c       1   2  C..L
+000106e0: 4553 5449 4e45 2020 63c3 896c 6573 7469  ESTINE  c..lesti
+000106f0: 6e65 0a20 2020 2020 2020 2020 2020 2032  ne.            2
+00010700: 2020 2033 2020 2020 2044 4150 484e c389     3     DAPHN..
+00010710: 2020 2020 2064 6170 686e c389 0a20 2020       daphn...   
+00010720: 2020 2020 2020 2020 203c 424c 414e 4b4c           <BLANKL
+00010730: 494e 453e 0a20 2020 2020 2020 2020 2020  INE>.           
+00010740: 205b 3320 726f 7773 2078 2033 2063 6f6c   [3 rows x 3 col
+00010750: 756d 6e73 5d0a 0a20 2020 2020 2020 2041  umns]..        A
+00010760: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00010770: 2066 756e 6374 696f 6e5f 6e61 6d65 2028   function_name (
+00010780: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
+00010790: 2020 2020 2020 7468 6520 6675 6e63 7469        the functi
+000107a0: 6f6e 2773 206e 616d 6520 696e 2042 6967  on's name in Big
+000107b0: 5175 6572 7920 696e 2074 6865 2066 6f72  Query in the for
+000107c0: 6d61 740a 2020 2020 2020 2020 2020 2020  mat.            
+000107d0: 2020 2020 6070 726f 6a65 6374 5f69 642e      `project_id.
+000107e0: 6461 7461 7365 745f 6964 2e66 756e 6374  dataset_id.funct
+000107f0: 696f 6e5f 6e61 6d65 602c 206f 720a 2020  ion_name`, or.  
+00010800: 2020 2020 2020 2020 2020 2020 2020 6064                `d
+00010810: 6174 6173 6574 5f69 642e 6675 6e63 7469  ataset_id.functi
+00010820: 6f6e 5f6e 616d 6560 2074 6f20 6c6f 6164  on_name` to load
+00010830: 2066 726f 6d20 7468 6520 6465 6661 756c   from the defaul
+00010840: 7420 7072 6f6a 6563 742c 206f 720a 2020  t project, or.  
+00010850: 2020 2020 2020 2020 2020 2020 2020 6066                `f
+00010860: 756e 6374 696f 6e5f 6e61 6d65 6020 746f  unction_name` to
+00010870: 206c 6f61 6420 6672 6f6d 2074 6865 2064   load from the d
+00010880: 6566 6175 6c74 2070 726f 6a65 6374 2061  efault project a
+00010890: 6e64 2074 6865 2064 6174 6173 6574 0a20  nd the dataset. 
+000108a0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000108b0: 7373 6f63 6961 7465 6420 7769 7468 2074  ssociated with t
+000108c0: 6865 2063 7572 7265 6e74 2073 6573 7369  he current sessi
+000108d0: 6f6e 2e0a 0a20 2020 2020 2020 2052 6574  on...        Ret
+000108e0: 7572 6e73 3a0a 2020 2020 2020 2020 2020  urns:.          
+000108f0: 2020 6361 6c6c 6162 6c65 3a20 4120 6675    callable: A fu
+00010900: 6e63 7469 6f6e 206f 626a 6563 7420 706f  nction object po
+00010910: 696e 7469 6e67 2074 6f20 7468 6520 4269  inting to the Bi
+00010920: 6751 7565 7279 2066 756e 6374 696f 6e20  gQuery function 
+00010930: 7265 6164 0a20 2020 2020 2020 2020 2020  read.           
+00010940: 2066 726f 6d20 4269 6751 7565 7279 2e0a   from BigQuery..
+00010950: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00010960: 206f 626a 6563 7420 6973 2073 696d 696c   object is simil
+00010970: 6172 2074 6f20 7468 6520 6f6e 6520 6372  ar to the one cr
+00010980: 6561 7465 6420 6279 2074 6865 2060 7265  eated by the `re
+00010990: 6d6f 7465 5f66 756e 6374 696f 6e60 0a20  mote_function`. 
+000109a0: 2020 2020 2020 2020 2020 2064 6563 6f72             decor
+000109b0: 6174 6f72 2c20 696e 636c 7564 696e 6720  ator, including 
+000109c0: 7468 6520 6062 6967 6672 616d 6573 5f72  the `bigframes_r
+000109d0: 656d 6f74 655f 6675 6e63 7469 6f6e 6020  emote_function` 
+000109e0: 7072 6f70 6572 7479 2c20 6275 740a 2020  property, but.  
+000109f0: 2020 2020 2020 2020 2020 6e6f 7420 696e            not in
+00010a00: 636c 7564 696e 6720 7468 6520 6062 6967  cluding the `big
+00010a10: 6672 616d 6573 5f63 6c6f 7564 5f66 756e  frames_cloud_fun
+00010a20: 6374 696f 6e60 2070 726f 7065 7274 792e  ction` property.
+00010a30: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00010a40: 2020 2020 2020 7265 7475 726e 2062 6967        return big
+00010a50: 6672 616d 6573 5f72 6766 280a 2020 2020  frames_rgf(.    
+00010a60: 2020 2020 2020 2020 6675 6e63 7469 6f6e          function
+00010a70: 5f6e 616d 653d 6675 6e63 7469 6f6e 5f6e  _name=function_n
+00010a80: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00010a90: 2073 6573 7369 6f6e 3d73 656c 662c 0a20   session=self,. 
+00010aa0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00010ab0: 6620 5f70 7265 7061 7265 5f71 7565 7279  f _prepare_query
+00010ac0: 5f6a 6f62 5f63 6f6e 6669 6728 0a20 2020  _job_config(.   
+00010ad0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00010ae0: 2020 206a 6f62 5f63 6f6e 6669 673a 204f     job_config: O
+00010af0: 7074 696f 6e61 6c5b 6269 6771 7565 7279  ptional[bigquery
+00010b00: 2e51 7565 7279 4a6f 6243 6f6e 6669 675d  .QueryJobConfig]
+00010b10: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
+00010b20: 3e20 6269 6771 7565 7279 2e51 7565 7279  > bigquery.Query
+00010b30: 4a6f 6243 6f6e 6669 673a 0a20 2020 2020  JobConfig:.     
+00010b40: 2020 2069 6620 6a6f 625f 636f 6e66 6967     if job_config
+00010b50: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00010b60: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
+00010b70: 203d 2062 6967 7175 6572 792e 5175 6572   = bigquery.Quer
+00010b80: 794a 6f62 436f 6e66 6967 2829 0a20 2020  yJobConfig().   
+00010b90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00010ba0: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+00010bb0: 6120 636f 7079 2073 6f20 7468 6174 2077  a copy so that w
+00010bc0: 6520 646f 6e27 7420 6d75 7461 7465 2074  e don't mutate t
+00010bd0: 6865 206f 7269 6769 6e61 6c20 636f 6e66  he original conf
+00010be0: 6967 2070 6173 7365 640a 2020 2020 2020  ig passed.      
+00010bf0: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
+00010c00: 203d 2074 7970 696e 672e 6361 7374 280a   = typing.cast(.
+00010c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c20: 6269 6771 7565 7279 2e51 7565 7279 4a6f  bigquery.QueryJo
+00010c30: 6243 6f6e 6669 672c 0a20 2020 2020 2020  bConfig,.       
+00010c40: 2020 2020 2020 2020 2062 6967 7175 6572           bigquer
+00010c50: 792e 5175 6572 794a 6f62 436f 6e66 6967  y.QueryJobConfig
+00010c60: 2e66 726f 6d5f 6170 695f 7265 7072 286a  .from_api_repr(j
+00010c70: 6f62 5f63 6f6e 6669 672e 746f 5f61 7069  ob_config.to_api
+00010c80: 5f72 6570 7228 2929 2c0a 2020 2020 2020  _repr()),.      
+00010c90: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00010ca0: 2069 6620 6269 6766 7261 6d65 732e 6f70   if bigframes.op
+00010cb0: 7469 6f6e 732e 636f 6d70 7574 652e 6d61  tions.compute.ma
+00010cc0: 7869 6d75 6d5f 6279 7465 735f 6269 6c6c  ximum_bytes_bill
+00010cd0: 6564 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ed is not None:.
+00010ce0: 2020 2020 2020 2020 2020 2020 6a6f 625f              job_
+00010cf0: 636f 6e66 6967 2e6d 6178 696d 756d 5f62  config.maximum_b
+00010d00: 7974 6573 5f62 696c 6c65 6420 3d20 280a  ytes_billed = (.
+00010d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d20: 6269 6766 7261 6d65 732e 6f70 7469 6f6e  bigframes.option
+00010d30: 732e 636f 6d70 7574 652e 6d61 7869 6d75  s.compute.maximu
+00010d40: 6d5f 6279 7465 735f 6269 6c6c 6564 0a20  m_bytes_billed. 
+00010d50: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00010d60: 2020 2020 2020 6375 7272 656e 745f 6c61        current_la
+00010d70: 6265 6c73 203d 206a 6f62 5f63 6f6e 6669  bels = job_confi
+00010d80: 672e 6c61 6265 6c73 2069 6620 6a6f 625f  g.labels if job_
+00010d90: 636f 6e66 6967 2e6c 6162 656c 7320 656c  config.labels el
+00010da0: 7365 207b 7d0a 2020 2020 2020 2020 666f  se {}.        fo
+00010db0: 7220 6b65 792c 2076 616c 7565 2069 6e20  r key, value in 
+00010dc0: 6269 6766 7261 6d65 732e 6f70 7469 6f6e  bigframes.option
+00010dd0: 732e 636f 6d70 7574 652e 6578 7472 615f  s.compute.extra_
+00010de0: 7175 6572 795f 6c61 6265 6c73 2e69 7465  query_labels.ite
+00010df0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00010e00: 2020 6966 206b 6579 206e 6f74 2069 6e20    if key not in 
+00010e10: 6375 7272 656e 745f 6c61 6265 6c73 3a0a  current_labels:.
+00010e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e30: 6375 7272 656e 745f 6c61 6265 6c73 5b6b  current_labels[k
+00010e40: 6579 5d20 3d20 7661 6c75 650a 2020 2020  ey] = value.    
+00010e50: 2020 2020 6a6f 625f 636f 6e66 6967 2e6c      job_config.l
+00010e60: 6162 656c 7320 3d20 6375 7272 656e 745f  abels = current_
+00010e70: 6c61 6265 6c73 0a0a 2020 2020 2020 2020  labels..        
+00010e80: 6966 2073 656c 662e 5f62 715f 6b6d 735f  if self._bq_kms_
+00010e90: 6b65 795f 6e61 6d65 3a0a 2020 2020 2020  key_name:.      
+00010ea0: 2020 2020 2020 6a6f 625f 636f 6e66 6967        job_config
+00010eb0: 2e64 6573 7469 6e61 7469 6f6e 5f65 6e63  .destination_enc
+00010ec0: 7279 7074 696f 6e5f 636f 6e66 6967 7572  ryption_configur
+00010ed0: 6174 696f 6e20 3d20 280a 2020 2020 2020  ation = (.      
+00010ee0: 2020 2020 2020 2020 2020 6269 6771 7565            bigque
+00010ef0: 7279 2e45 6e63 7279 7074 696f 6e43 6f6e  ry.EncryptionCon
+00010f00: 6669 6775 7261 7469 6f6e 286b 6d73 5f6b  figuration(kms_k
+00010f10: 6579 5f6e 616d 653d 7365 6c66 2e5f 6271  ey_name=self._bq
+00010f20: 5f6b 6d73 5f6b 6579 5f6e 616d 6529 0a20  _kms_key_name). 
+00010f30: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00010f40: 2020 2020 2020 7265 7475 726e 206a 6f62        return job
+00010f50: 5f63 6f6e 6669 670a 0a20 2020 2064 6566  _config..    def
+00010f60: 205f 7072 6570 6172 655f 6c6f 6164 5f6a   _prepare_load_j
+00010f70: 6f62 5f63 6f6e 6669 6728 7365 6c66 2920  ob_config(self) 
+00010f80: 2d3e 2062 6967 7175 6572 792e 4c6f 6164  -> bigquery.Load
+00010f90: 4a6f 6243 6f6e 6669 673a 0a20 2020 2020  JobConfig:.     
+00010fa0: 2020 2023 2043 7265 6174 6520 6120 636f     # Create a co
+00010fb0: 7079 2073 6f20 7468 6174 2077 6520 646f  py so that we do
+00010fc0: 6e27 7420 6d75 7461 7465 2074 6865 206f  n't mutate the o
+00010fd0: 7269 6769 6e61 6c20 636f 6e66 6967 2070  riginal config p
+00010fe0: 6173 7365 640a 2020 2020 2020 2020 6a6f  assed.        jo
+00010ff0: 625f 636f 6e66 6967 203d 2062 6967 7175  b_config = bigqu
+00011000: 6572 792e 4c6f 6164 4a6f 6243 6f6e 6669  ery.LoadJobConfi
+00011010: 6728 290a 0a20 2020 2020 2020 2069 6620  g()..        if 
+00011020: 7365 6c66 2e5f 6271 5f6b 6d73 5f6b 6579  self._bq_kms_key
+00011030: 5f6e 616d 653a 0a20 2020 2020 2020 2020  _name:.         
+00011040: 2020 206a 6f62 5f63 6f6e 6669 672e 6465     job_config.de
+00011050: 7374 696e 6174 696f 6e5f 656e 6372 7970  stination_encryp
+00011060: 7469 6f6e 5f63 6f6e 6669 6775 7261 7469  tion_configurati
+00011070: 6f6e 203d 2028 0a20 2020 2020 2020 2020  on = (.         
+00011080: 2020 2020 2020 2062 6967 7175 6572 792e         bigquery.
+00011090: 456e 6372 7970 7469 6f6e 436f 6e66 6967  EncryptionConfig
+000110a0: 7572 6174 696f 6e28 6b6d 735f 6b65 795f  uration(kms_key_
+000110b0: 6e61 6d65 3d73 656c 662e 5f62 715f 6b6d  name=self._bq_km
+000110c0: 735f 6b65 795f 6e61 6d65 290a 2020 2020  s_key_name).    
+000110d0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000110e0: 2020 2072 6574 7572 6e20 6a6f 625f 636f     return job_co
+000110f0: 6e66 6967 0a0a 2020 2020 6465 6620 5f70  nfig..    def _p
+00011100: 7265 7061 7265 5f63 6f70 795f 6a6f 625f  repare_copy_job_
+00011110: 636f 6e66 6967 2873 656c 6629 202d 3e20  config(self) -> 
+00011120: 6269 6771 7565 7279 2e43 6f70 794a 6f62  bigquery.CopyJob
+00011130: 436f 6e66 6967 3a0a 2020 2020 2020 2020  Config:.        
+00011140: 2320 4372 6561 7465 2061 2063 6f70 7920  # Create a copy 
+00011150: 736f 2074 6861 7420 7765 2064 6f6e 2774  so that we don't
+00011160: 206d 7574 6174 6520 7468 6520 6f72 6967   mutate the orig
+00011170: 696e 616c 2063 6f6e 6669 6720 7061 7373  inal config pass
+00011180: 6564 0a20 2020 2020 2020 206a 6f62 5f63  ed.        job_c
+00011190: 6f6e 6669 6720 3d20 6269 6771 7565 7279  onfig = bigquery
+000111a0: 2e43 6f70 794a 6f62 436f 6e66 6967 2829  .CopyJobConfig()
+000111b0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+000111c0: 662e 5f62 715f 6b6d 735f 6b65 795f 6e61  f._bq_kms_key_na
+000111d0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+000111e0: 6a6f 625f 636f 6e66 6967 2e64 6573 7469  job_config.desti
+000111f0: 6e61 7469 6f6e 5f65 6e63 7279 7074 696f  nation_encryptio
+00011200: 6e5f 636f 6e66 6967 7572 6174 696f 6e20  n_configuration 
+00011210: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00011220: 2020 2020 6269 6771 7565 7279 2e45 6e63      bigquery.Enc
+00011230: 7279 7074 696f 6e43 6f6e 6669 6775 7261  ryptionConfigura
+00011240: 7469 6f6e 286b 6d73 5f6b 6579 5f6e 616d  tion(kms_key_nam
+00011250: 653d 7365 6c66 2e5f 6271 5f6b 6d73 5f6b  e=self._bq_kms_k
+00011260: 6579 5f6e 616d 6529 0a20 2020 2020 2020  ey_name).       
+00011270: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00011280: 7265 7475 726e 206a 6f62 5f63 6f6e 6669  return job_confi
+00011290: 670a 0a20 2020 2064 6566 205f 7374 6172  g..    def _star
+000112a0: 745f 7175 6572 7928 0a20 2020 2020 2020  t_query(.       
+000112b0: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
+000112c0: 716c 3a20 7374 722c 0a20 2020 2020 2020  ql: str,.       
+000112d0: 206a 6f62 5f63 6f6e 6669 673a 204f 7074   job_config: Opt
+000112e0: 696f 6e61 6c5b 6269 6771 7565 7279 2e6a  ional[bigquery.j
+000112f0: 6f62 2e51 7565 7279 4a6f 6243 6f6e 6669  ob.QueryJobConfi
+00011300: 675d 203d 204e 6f6e 652c 0a20 2020 2020  g] = None,.     
+00011310: 2020 206d 6178 5f72 6573 756c 7473 3a20     max_results: 
+00011320: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
+00011330: 4e6f 6e65 2c0a 2020 2020 2020 2020 7469  None,.        ti
+00011340: 6d65 6f75 743a 204f 7074 696f 6e61 6c5b  meout: Optional[
+00011350: 666c 6f61 745d 203d 204e 6f6e 652c 0a20  float] = None,. 
+00011360: 2020 2029 202d 3e20 5475 706c 655b 6269     ) -> Tuple[bi
+00011370: 6771 7565 7279 2e74 6162 6c65 2e52 6f77  gquery.table.Row
+00011380: 4974 6572 6174 6f72 2c20 6269 6771 7565  Iterator, bigque
+00011390: 7279 2e51 7565 7279 4a6f 625d 3a0a 2020  ry.QueryJob]:.  
+000113a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000113b0: 2020 5374 6172 7473 2042 6967 5175 6572    Starts BigQuer
+000113c0: 7920 7175 6572 7920 6a6f 6220 616e 6420  y query job and 
+000113d0: 7761 6974 7320 666f 7220 7265 7375 6c74  waits for result
+000113e0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+000113f0: 2020 2020 2020 206a 6f62 5f63 6f6e 6669         job_confi
+00011400: 6720 3d20 7365 6c66 2e5f 7072 6570 6172  g = self._prepar
+00011410: 655f 7175 6572 795f 6a6f 625f 636f 6e66  e_query_job_conf
+00011420: 6967 286a 6f62 5f63 6f6e 6669 6729 0a20  ig(job_config). 
+00011430: 2020 2020 2020 2072 6574 7572 6e20 6269         return bi
+00011440: 6766 7261 6d65 732e 7365 7373 696f 6e2e  gframes.session.
+00011450: 5f69 6f2e 6269 6771 7565 7279 2e73 7461  _io.bigquery.sta
+00011460: 7274 5f71 7565 7279 5f77 6974 685f 636c  rt_query_with_cl
+00011470: 6965 6e74 280a 2020 2020 2020 2020 2020  ient(.          
+00011480: 2020 7365 6c66 2e62 7163 6c69 656e 742c    self.bqclient,
+00011490: 2073 716c 2c20 6a6f 625f 636f 6e66 6967   sql, job_config
+000114a0: 2c20 6d61 785f 7265 7375 6c74 732c 2074  , max_results, t
+000114b0: 696d 656f 7574 0a20 2020 2020 2020 2029  imeout.        )
+000114c0: 0a0a 2020 2020 6465 6620 5f73 7461 7274  ..    def _start
+000114d0: 5f71 7565 7279 5f6d 6c5f 6464 6c28 0a20  _query_ml_ddl(. 
+000114e0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+000114f0: 2020 2020 2073 716c 3a20 7374 722c 0a20       sql: str,. 
+00011500: 2020 2029 202d 3e20 5475 706c 655b 6269     ) -> Tuple[bi
+00011510: 6771 7565 7279 2e74 6162 6c65 2e52 6f77  gquery.table.Row
+00011520: 4974 6572 6174 6f72 2c20 6269 6771 7565  Iterator, bigque
+00011530: 7279 2e51 7565 7279 4a6f 625d 3a0a 2020  ry.QueryJob]:.  
+00011540: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00011550: 2020 5374 6172 7473 2042 6967 5175 6572    Starts BigQuer
+00011560: 7920 4d4c 2044 444c 2071 7565 7279 206a  y ML DDL query j
+00011570: 6f62 2028 4352 4541 5445 204d 4f44 454c  ob (CREATE MODEL
+00011580: 2f41 4c54 4552 204d 4f44 454c 2f2e 2e2e  /ALTER MODEL/...
+00011590: 2920 616e 640a 2020 2020 2020 2020 7761  ) and.        wa
+000115a0: 6974 7320 666f 7220 7265 7375 6c74 732e  its for results.
+000115b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000115c0: 2020 2020 206a 6f62 5f63 6f6e 6669 6720       job_config 
+000115d0: 3d20 7365 6c66 2e5f 7072 6570 6172 655f  = self._prepare_
+000115e0: 7175 6572 795f 6a6f 625f 636f 6e66 6967  query_job_config
+000115f0: 2829 0a0a 2020 2020 2020 2020 2320 4251  ()..        # BQ
+00011600: 4d4c 2065 7870 6563 7473 206b 6d73 5f6b  ML expects kms_k
+00011610: 6579 5f6e 616d 6520 7468 726f 7567 6820  ey_name through 
+00011620: 4f50 5449 4f4e 5320 616e 6420 6e6f 7420  OPTIONS and not 
+00011630: 7468 726f 7567 6820 6a6f 6220 636f 6e66  through job conf
+00011640: 6967 2c0a 2020 2020 2020 2020 2320 736f  ig,.        # so
+00011650: 2077 6520 6d75 7374 2072 6573 6574 2061   we must reset a
+00011660: 6e79 2065 6e63 7279 7074 696f 6e20 7365  ny encryption se
+00011670: 7420 696e 2074 6865 206a 6f62 2063 6f6e  t in the job con
+00011680: 6669 670a 2020 2020 2020 2020 2320 6874  fig.        # ht
+00011690: 7470 733a 2f2f 636c 6f75 642e 676f 6f67  tps://cloud.goog
+000116a0: 6c65 2e63 6f6d 2f62 6967 7175 6572 792f  le.com/bigquery/
+000116b0: 646f 6373 2f63 7573 746f 6d65 722d 6d61  docs/customer-ma
+000116c0: 6e61 6765 642d 656e 6372 7970 7469 6f6e  naged-encryption
+000116d0: 2365 6e63 7279 7074 2d6d 6f64 656c 0a20  #encrypt-model. 
+000116e0: 2020 2020 2020 206a 6f62 5f63 6f6e 6669         job_confi
+000116f0: 672e 6465 7374 696e 6174 696f 6e5f 656e  g.destination_en
+00011700: 6372 7970 7469 6f6e 5f63 6f6e 6669 6775  cryption_configu
+00011710: 7261 7469 6f6e 203d 204e 6f6e 650a 0a20  ration = None.. 
+00011720: 2020 2020 2020 2072 6574 7572 6e20 6269         return bi
+00011730: 6766 7261 6d65 732e 7365 7373 696f 6e2e  gframes.session.
+00011740: 5f69 6f2e 6269 6771 7565 7279 2e73 7461  _io.bigquery.sta
+00011750: 7274 5f71 7565 7279 5f77 6974 685f 636c  rt_query_with_cl
+00011760: 6965 6e74 280a 2020 2020 2020 2020 2020  ient(.          
+00011770: 2020 7365 6c66 2e62 7163 6c69 656e 742c    self.bqclient,
+00011780: 2073 716c 2c20 6a6f 625f 636f 6e66 6967   sql, job_config
+00011790: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000117a0: 6465 6620 5f63 6163 6865 5f77 6974 685f  def _cache_with_
+000117b0: 636c 7573 7465 725f 636f 6c73 280a 2020  cluster_cols(.  
+000117c0: 2020 2020 2020 7365 6c66 2c20 6172 7261        self, arra
+000117d0: 795f 7661 6c75 653a 2063 6f72 652e 4172  y_value: core.Ar
+000117e0: 7261 7956 616c 7565 2c20 636c 7573 7465  rayValue, cluste
+000117f0: 725f 636f 6c73 3a20 7479 7069 6e67 2e53  r_cols: typing.S
+00011800: 6571 7565 6e63 655b 7374 725d 0a20 2020  equence[str].   
+00011810: 2029 202d 3e20 636f 7265 2e41 7272 6179   ) -> core.Array
+00011820: 5661 6c75 653a 0a20 2020 2020 2020 2022  Value:.        "
+00011830: 2222 4578 6563 7574 6573 2074 6865 2071  ""Executes the q
+00011840: 7565 7279 2061 6e64 2075 7365 7320 7468  uery and uses th
+00011850: 6520 7265 7375 6c74 696e 6720 7461 626c  e resulting tabl
+00011860: 6520 746f 2072 6577 7269 7465 2066 7574  e to rewrite fut
+00011870: 7572 6520 6578 6563 7574 696f 6e73 2e22  ure executions."
+00011880: 2222 0a20 2020 2020 2020 2023 2054 4f44  "".        # TOD
+00011890: 4f3a 2055 7365 2074 6869 7320 666f 7220  O: Use this for 
+000118a0: 616c 6c20 6578 6563 7574 696f 6e73 3f20  all executions? 
+000118b0: 5072 6f62 6c65 6d20 6973 2074 6861 7420  Problem is that 
+000118c0: 6361 6368 696e 6720 6d61 7465 7269 616c  caching material
+000118d0: 697a 6573 2065 7874 7261 0a20 2020 2020  izes extra.     
+000118e0: 2020 2023 206f 7264 6572 696e 6720 636f     # ordering co
+000118f0: 6c75 6d6e 730a 2020 2020 2020 2020 636f  lumns.        co
+00011900: 6d70 696c 6564 5f76 616c 7565 203d 2073  mpiled_value = s
+00011910: 656c 662e 5f63 6f6d 7069 6c65 5f6f 7264  elf._compile_ord
+00011920: 6572 6564 2861 7272 6179 5f76 616c 7565  ered(array_value
+00011930: 290a 0a20 2020 2020 2020 2069 6269 735f  )..        ibis_
+00011940: 6578 7072 203d 2063 6f6d 7069 6c65 645f  expr = compiled_
+00011950: 7661 6c75 652e 5f74 6f5f 6962 6973 5f65  value._to_ibis_e
+00011960: 7870 7228 0a20 2020 2020 2020 2020 2020  xpr(.           
+00011970: 206f 7264 6572 696e 675f 6d6f 6465 3d22   ordering_mode="
+00011980: 756e 6f72 6465 7265 6422 2c20 6578 706f  unordered", expo
+00011990: 7365 5f68 6964 6465 6e5f 636f 6c73 3d54  se_hidden_cols=T
+000119a0: 7275 650a 2020 2020 2020 2020 290a 2020  rue.        ).  
+000119b0: 2020 2020 2020 746d 705f 7461 626c 6520        tmp_table 
+000119c0: 3d20 7365 6c66 2e5f 6962 6973 5f74 6f5f  = self._ibis_to_
+000119d0: 7465 6d70 5f74 6162 6c65 280a 2020 2020  temp_table(.    
+000119e0: 2020 2020 2020 2020 6962 6973 5f65 7870          ibis_exp
+000119f0: 722c 2063 6c75 7374 6572 5f63 6f6c 733d  r, cluster_cols=
+00011a00: 636c 7573 7465 725f 636f 6c73 2c20 6170  cluster_cols, ap
+00011a10: 695f 6e61 6d65 3d22 6361 6368 6564 220a  i_name="cached".
+00011a20: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00011a30: 2020 7461 626c 655f 6578 7072 6573 7369    table_expressi
+00011a40: 6f6e 203d 2073 656c 662e 6962 6973 5f63  on = self.ibis_c
+00011a50: 6c69 656e 742e 7461 626c 6528 0a20 2020  lient.table(.   
+00011a60: 2020 2020 2020 2020 2074 6d70 5f74 6162           tmp_tab
+00011a70: 6c65 2e74 6162 6c65 5f69 642c 0a20 2020  le.table_id,.   
+00011a80: 2020 2020 2020 2020 2073 6368 656d 613d           schema=
+00011a90: 746d 705f 7461 626c 652e 6461 7461 7365  tmp_table.datase
+00011aa0: 745f 6964 2c0a 2020 2020 2020 2020 2020  t_id,.          
+00011ab0: 2020 6461 7461 6261 7365 3d74 6d70 5f74    database=tmp_t
+00011ac0: 6162 6c65 2e70 726f 6a65 6374 2c0a 2020  able.project,.  
+00011ad0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00011ae0: 6e65 775f 636f 6c75 6d6e 7320 3d20 5b74  new_columns = [t
+00011af0: 6162 6c65 5f65 7870 7265 7373 696f 6e5b  able_expression[
+00011b00: 636f 6c75 6d6e 5d20 666f 7220 636f 6c75  column] for colu
+00011b10: 6d6e 2069 6e20 636f 6d70 696c 6564 5f76  mn in compiled_v
+00011b20: 616c 7565 2e63 6f6c 756d 6e5f 6964 735d  alue.column_ids]
+00011b30: 0a20 2020 2020 2020 206e 6577 5f68 6964  .        new_hid
+00011b40: 6465 6e5f 636f 6c75 6d6e 7320 3d20 5b0a  den_columns = [.
+00011b50: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
+00011b60: 655f 6578 7072 6573 7369 6f6e 5b63 6f6c  e_expression[col
+00011b70: 756d 6e5d 0a20 2020 2020 2020 2020 2020  umn].           
+00011b80: 2066 6f72 2063 6f6c 756d 6e20 696e 2063   for column in c
+00011b90: 6f6d 7069 6c65 645f 7661 6c75 652e 5f68  ompiled_value._h
+00011ba0: 6964 6465 6e5f 6f72 6465 7269 6e67 5f63  idden_ordering_c
+00011bb0: 6f6c 756d 6e5f 6e61 6d65 730a 2020 2020  olumn_names.    
+00011bc0: 2020 2020 5d0a 2020 2020 2020 2020 2320      ].        # 
+00011bd0: 544f 444f 3a20 496e 7374 6561 642c 206b  TODO: Instead, k
+00011be0: 6565 7020 7365 7373 696f 6e2d 7769 6465  eep session-wide
+00011bf0: 206d 6170 206f 6620 6361 6368 6564 2072   map of cached r
+00011c00: 6573 756c 7473 2061 6e64 2061 7574 6f6d  esults and autom
+00011c10: 6174 6963 616c 6c79 2072 6575 7365 0a20  atically reuse. 
+00011c20: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+00011c30: 7265 2e41 7272 6179 5661 6c75 652e 6672  re.ArrayValue.fr
+00011c40: 6f6d 5f69 6269 7328 0a20 2020 2020 2020  om_ibis(.       
+00011c50: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00011c60: 2020 2020 2020 2074 6162 6c65 5f65 7870         table_exp
+00011c70: 7265 7373 696f 6e2c 0a20 2020 2020 2020  ression,.       
+00011c80: 2020 2020 2063 6f6c 756d 6e73 3d6e 6577       columns=new
+00011c90: 5f63 6f6c 756d 6e73 2c0a 2020 2020 2020  _columns,.      
+00011ca0: 2020 2020 2020 6869 6464 656e 5f6f 7264        hidden_ord
+00011cb0: 6572 696e 675f 636f 6c75 6d6e 733d 6e65  ering_columns=ne
+00011cc0: 775f 6869 6464 656e 5f63 6f6c 756d 6e73  w_hidden_columns
+00011cd0: 2c0a 2020 2020 2020 2020 2020 2020 6f72  ,.            or
+00011ce0: 6465 7269 6e67 3d63 6f6d 7069 6c65 645f  dering=compiled_
+00011cf0: 7661 6c75 652e 5f6f 7264 6572 696e 672c  value._ordering,
+00011d00: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00011d10: 6465 6620 5f63 6163 6865 5f77 6974 685f  def _cache_with_
+00011d20: 6f66 6673 6574 7328 7365 6c66 2c20 6172  offsets(self, ar
+00011d30: 7261 795f 7661 6c75 653a 2063 6f72 652e  ray_value: core.
+00011d40: 4172 7261 7956 616c 7565 2920 2d3e 2063  ArrayValue) -> c
+00011d50: 6f72 652e 4172 7261 7956 616c 7565 3a0a  ore.ArrayValue:.
+00011d60: 2020 2020 2020 2020 2222 2245 7865 6375          """Execu
+00011d70: 7465 7320 7468 6520 7175 6572 7920 616e  tes the query an
+00011d80: 6420 7573 6573 2074 6865 2072 6573 756c  d uses the resul
+00011d90: 7469 6e67 2074 6162 6c65 2074 6f20 7265  ting table to re
+00011da0: 7772 6974 6520 6675 7475 7265 2065 7865  write future exe
+00011db0: 6375 7469 6f6e 732e 2222 220a 2020 2020  cutions.""".    
+00011dc0: 2020 2020 2320 544f 444f 3a20 5573 6520      # TODO: Use 
+00011dd0: 7468 6973 2066 6f72 2061 6c6c 2065 7865  this for all exe
+00011de0: 6375 7469 6f6e 733f 2050 726f 626c 656d  cutions? Problem
+00011df0: 2069 7320 7468 6174 2063 6163 6869 6e67   is that caching
+00011e00: 206d 6174 6572 6961 6c69 7a65 7320 6578   materializes ex
+00011e10: 7472 610a 2020 2020 2020 2020 2320 6f72  tra.        # or
+00011e20: 6465 7269 6e67 2063 6f6c 756d 6e73 0a20  dering columns. 
+00011e30: 2020 2020 2020 2063 6f6d 7069 6c65 645f         compiled_
+00011e40: 7661 6c75 6520 3d20 7365 6c66 2e5f 636f  value = self._co
+00011e50: 6d70 696c 655f 6f72 6465 7265 6428 6172  mpile_ordered(ar
+00011e60: 7261 795f 7661 6c75 6529 0a0a 2020 2020  ray_value)..    
+00011e70: 2020 2020 6962 6973 5f65 7870 7220 3d20      ibis_expr = 
+00011e80: 636f 6d70 696c 6564 5f76 616c 7565 2e5f  compiled_value._
+00011e90: 746f 5f69 6269 735f 6578 7072 280a 2020  to_ibis_expr(.  
+00011ea0: 2020 2020 2020 2020 2020 6f72 6465 7269            orderi
+00011eb0: 6e67 5f6d 6f64 653d 226f 6666 7365 745f  ng_mode="offset_
+00011ec0: 636f 6c22 2c20 6f72 6465 725f 636f 6c5f  col", order_col_
+00011ed0: 6e61 6d65 3d22 6269 6766 7261 6d65 735f  name="bigframes_
+00011ee0: 6f66 6673 6574 7322 0a20 2020 2020 2020  offsets".       
+00011ef0: 2029 0a20 2020 2020 2020 2074 6d70 5f74   ).        tmp_t
+00011f00: 6162 6c65 203d 2073 656c 662e 5f69 6269  able = self._ibi
+00011f10: 735f 746f 5f74 656d 705f 7461 626c 6528  s_to_temp_table(
+00011f20: 0a20 2020 2020 2020 2020 2020 2069 6269  .            ibi
+00011f30: 735f 6578 7072 2c20 636c 7573 7465 725f  s_expr, cluster_
+00011f40: 636f 6c73 3d5b 2262 6967 6672 616d 6573  cols=["bigframes
+00011f50: 5f6f 6666 7365 7473 225d 2c20 6170 695f  _offsets"], api_
+00011f60: 6e61 6d65 3d22 6361 6368 6564 220a 2020  name="cached".  
+00011f70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00011f80: 7461 626c 655f 6578 7072 6573 7369 6f6e  table_expression
+00011f90: 203d 2073 656c 662e 6962 6973 5f63 6c69   = self.ibis_cli
+00011fa0: 656e 742e 7461 626c 6528 0a20 2020 2020  ent.table(.     
+00011fb0: 2020 2020 2020 2074 6d70 5f74 6162 6c65         tmp_table
+00011fc0: 2e74 6162 6c65 5f69 642c 0a20 2020 2020  .table_id,.     
+00011fd0: 2020 2020 2020 2073 6368 656d 613d 746d         schema=tm
+00011fe0: 705f 7461 626c 652e 6461 7461 7365 745f  p_table.dataset_
+00011ff0: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
+00012000: 6461 7461 6261 7365 3d74 6d70 5f74 6162  database=tmp_tab
+00012010: 6c65 2e70 726f 6a65 6374 2c0a 2020 2020  le.project,.    
+00012020: 2020 2020 290a 2020 2020 2020 2020 6e65      ).        ne
+00012030: 775f 636f 6c75 6d6e 7320 3d20 5b74 6162  w_columns = [tab
+00012040: 6c65 5f65 7870 7265 7373 696f 6e5b 636f  le_expression[co
+00012050: 6c75 6d6e 5d20 666f 7220 636f 6c75 6d6e  lumn] for column
+00012060: 2069 6e20 636f 6d70 696c 6564 5f76 616c   in compiled_val
+00012070: 7565 2e63 6f6c 756d 6e5f 6964 735d 0a20  ue.column_ids]. 
+00012080: 2020 2020 2020 206e 6577 5f68 6964 6465         new_hidde
+00012090: 6e5f 636f 6c75 6d6e 7320 3d20 5b74 6162  n_columns = [tab
+000120a0: 6c65 5f65 7870 7265 7373 696f 6e5b 2262  le_expression["b
+000120b0: 6967 6672 616d 6573 5f6f 6666 7365 7473  igframes_offsets
+000120c0: 225d 5d0a 2020 2020 2020 2020 2320 544f  "]].        # TO
+000120d0: 444f 3a20 496e 7374 6561 642c 206b 6565  DO: Instead, kee
+000120e0: 7020 7365 7373 696f 6e2d 7769 6465 206d  p session-wide m
+000120f0: 6170 206f 6620 6361 6368 6564 2072 6573  ap of cached res
+00012100: 756c 7473 2061 6e64 2061 7574 6f6d 6174  ults and automat
+00012110: 6963 616c 6c79 2072 6575 7365 0a20 2020  ically reuse.   
+00012120: 2020 2020 2072 6574 7572 6e20 636f 7265       return core
+00012130: 2e41 7272 6179 5661 6c75 652e 6672 6f6d  .ArrayValue.from
+00012140: 5f69 6269 7328 0a20 2020 2020 2020 2020  _ibis(.         
+00012150: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00012160: 2020 2020 2074 6162 6c65 5f65 7870 7265       table_expre
+00012170: 7373 696f 6e2c 0a20 2020 2020 2020 2020  ssion,.         
+00012180: 2020 2063 6f6c 756d 6e73 3d6e 6577 5f63     columns=new_c
+00012190: 6f6c 756d 6e73 2c0a 2020 2020 2020 2020  olumns,.        
+000121a0: 2020 2020 6869 6464 656e 5f6f 7264 6572      hidden_order
+000121b0: 696e 675f 636f 6c75 6d6e 733d 6e65 775f  ing_columns=new_
+000121c0: 6869 6464 656e 5f63 6f6c 756d 6e73 2c0a  hidden_columns,.
+000121d0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+000121e0: 7269 6e67 3d6f 7264 6572 2e45 7870 7265  ring=order.Expre
+000121f0: 7373 696f 6e4f 7264 6572 696e 672e 6672  ssionOrdering.fr
+00012200: 6f6d 5f6f 6666 7365 745f 636f 6c28 2262  om_offset_col("b
+00012210: 6967 6672 616d 6573 5f6f 6666 7365 7473  igframes_offsets
+00012220: 2229 2c0a 2020 2020 2020 2020 290a 0a20  "),.        ).. 
+00012230: 2020 2064 6566 205f 7369 6d70 6c69 6679     def _simplify
+00012240: 5f77 6974 685f 6361 6368 696e 6728 7365  _with_caching(se
+00012250: 6c66 2c20 6172 7261 795f 7661 6c75 653a  lf, array_value:
+00012260: 2063 6f72 652e 4172 7261 7956 616c 7565   core.ArrayValue
+00012270: 2920 2d3e 2063 6f72 652e 4172 7261 7956  ) -> core.ArrayV
+00012280: 616c 7565 3a0a 2020 2020 2020 2020 2222  alue:.        ""
+00012290: 2241 7474 656d 7074 7320 746f 2068 616e  "Attempts to han
+000122a0: 646c 6520 7468 6520 636f 6d70 6c65 7869  dle the complexi
+000122b0: 7479 2062 7920 6361 6368 696e 6720 6475  ty by caching du
+000122c0: 706c 6963 6174 6564 2073 7562 7472 6565  plicated subtree
+000122d0: 7320 616e 6420 6272 6561 6b69 6e67 2074  s and breaking t
+000122e0: 6865 2071 7565 7279 2069 6e74 6f20 7069  he query into pi
+000122f0: 6563 6573 2e22 2222 0a20 2020 2020 2020  eces.""".       
+00012300: 2069 6620 6e6f 7420 6269 6766 7261 6d65   if not bigframe
+00012310: 732e 6f70 7469 6f6e 732e 636f 6d70 7574  s.options.comput
+00012320: 652e 656e 6162 6c65 5f6d 756c 7469 5f71  e.enable_multi_q
+00012330: 7565 7279 5f65 7865 6375 7469 6f6e 3a0a  uery_execution:.
+00012340: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00012350: 726e 2061 7272 6179 5f76 616c 7565 0a20  rn array_value. 
+00012360: 2020 2020 2020 206e 6f64 6520 3d20 6172         node = ar
+00012370: 7261 795f 7661 6c75 652e 6e6f 6465 0a20  ray_value.node. 
+00012380: 2020 2020 2020 2069 6620 6e6f 6465 2e70         if node.p
+00012390: 6c61 6e6e 696e 675f 636f 6d70 6c65 7869  lanning_complexi
+000123a0: 7479 203c 2051 5545 5259 5f43 4f4d 504c  ty < QUERY_COMPL
+000123b0: 4558 4954 595f 4c49 4d49 543a 0a20 2020  EXITY_LIMIT:.   
+000123c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000123d0: 6172 7261 795f 7661 6c75 650a 0a20 2020  array_value..   
+000123e0: 2020 2020 2066 6f72 205f 2069 6e20 7261       for _ in ra
+000123f0: 6e67 6528 4d41 585f 5355 4254 5245 455f  nge(MAX_SUBTREE_
+00012400: 4641 4354 4f52 494e 4753 293a 0a20 2020  FACTORINGS):.   
+00012410: 2020 2020 2020 2020 2075 7064 6174 6564           updated
+00012420: 203d 2073 656c 662e 5f63 6163 6865 5f6d   = self._cache_m
+00012430: 6f73 745f 636f 6d70 6c65 785f 7375 6274  ost_complex_subt
+00012440: 7265 6528 6e6f 6465 290a 2020 2020 2020  ree(node).      
+00012450: 2020 2020 2020 6966 2075 7064 6174 6564        if updated
+00012460: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00012470: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00012480: 2063 6f72 652e 4172 7261 7956 616c 7565   core.ArrayValue
+00012490: 286e 6f64 6529 0a20 2020 2020 2020 2020  (node).         
+000124a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000124b0: 2020 2020 2020 2020 206e 6f64 6520 3d20           node = 
+000124c0: 7570 6461 7465 640a 0a20 2020 2020 2020  updated..       
+000124d0: 2072 6574 7572 6e20 636f 7265 2e41 7272   return core.Arr
+000124e0: 6179 5661 6c75 6528 6e6f 6465 290a 0a20  ayValue(node).. 
+000124f0: 2020 2064 6566 205f 6361 6368 655f 6d6f     def _cache_mo
+00012500: 7374 5f63 6f6d 706c 6578 5f73 7562 7472  st_complex_subtr
+00012510: 6565 280a 2020 2020 2020 2020 7365 6c66  ee(.        self
+00012520: 2c20 6e6f 6465 3a20 6e6f 6465 732e 4269  , node: nodes.Bi
+00012530: 6746 7261 6d65 4e6f 6465 0a20 2020 2029  gFrameNode.    )
+00012540: 202d 3e20 4f70 7469 6f6e 616c 5b6e 6f64   -> Optional[nod
+00012550: 6573 2e42 6967 4672 616d 654e 6f64 655d  es.BigFrameNode]
+00012560: 3a0a 2020 2020 2020 2020 2320 544f 444f  :.        # TODO
+00012570: 3a20 4966 2071 7565 7279 2066 6169 6c73  : If query fails
+00012580: 2c20 7265 7472 7920 7769 7468 206c 6f77  , retry with low
+00012590: 6572 2063 6f6d 706c 6578 6974 7920 6c69  er complexity li
+000125a0: 6d69 740a 2020 2020 2020 2020 7661 6c69  mit.        vali
+000125b0: 645f 6361 6e64 6964 6174 6573 203d 2074  d_candidates = t
+000125c0: 7261 7665 7273 616c 732e 636f 756e 745f  raversals.count_
+000125d0: 636f 6d70 6c65 785f 6e6f 6465 7328 0a20  complex_nodes(. 
+000125e0: 2020 2020 2020 2020 2020 206e 6f64 652c             node,
+000125f0: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
+00012600: 5f63 6f6d 706c 6578 6974 793d 2851 5545  _complexity=(QUE
+00012610: 5259 5f43 4f4d 504c 4558 4954 595f 4c49  RY_COMPLEXITY_LI
+00012620: 4d49 5420 2f20 3530 3029 2c0a 2020 2020  MIT / 500),.    
+00012630: 2020 2020 2020 2020 6d61 785f 636f 6d70          max_comp
+00012640: 6c65 7869 7479 3d51 5545 5259 5f43 4f4d  lexity=QUERY_COM
+00012650: 504c 4558 4954 595f 4c49 4d49 542c 0a20  PLEXITY_LIMIT,. 
+00012660: 2020 2020 2020 2029 2e69 7465 6d73 2829         ).items()
+00012670: 0a20 2020 2020 2020 2023 2048 6575 7269  .        # Heuri
+00012680: 7374 6963 3a20 7375 6274 7265 655f 636f  stic: subtree_co
+00012690: 6d70 6c65 6978 7479 202a 2028 636f 7069  mpleixty * (copi
+000126a0: 6573 206f 6620 7375 6274 7265 6529 5e32  es of subtree)^2
+000126b0: 0a20 2020 2020 2020 2062 6573 745f 6361  .        best_ca
+000126c0: 6e64 6964 6174 6520 3d20 6d61 7828 0a20  ndidate = max(. 
+000126d0: 2020 2020 2020 2020 2020 2076 616c 6964             valid
+000126e0: 5f63 616e 6469 6461 7465 732c 0a20 2020  _candidates,.   
+000126f0: 2020 2020 2020 2020 206b 6579 3d6c 616d           key=lam
+00012700: 6264 6120 693a 2069 5b30 5d2e 706c 616e  bda i: i[0].plan
+00012710: 6e69 6e67 5f63 6f6d 706c 6578 6974 7920  ning_complexity 
+00012720: 2b20 2869 5b31 5d20 2a2a 2032 292c 0a20  + (i[1] ** 2),. 
+00012730: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00012740: 6c74 3d4e 6f6e 652c 0a20 2020 2020 2020  lt=None,.       
+00012750: 2029 0a0a 2020 2020 2020 2020 6966 2062   )..        if b
+00012760: 6573 745f 6361 6e64 6964 6174 6520 6973  est_candidate is
+00012770: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00012780: 2020 2023 204e 6f20 676f 6f64 2073 7562     # No good sub
+00012790: 7472 6565 7320 746f 2063 6163 6865 2c20  trees to cache, 
+000127a0: 6a75 7374 2072 6574 7572 6e20 6f72 6967  just return orig
+000127b0: 696e 616c 2074 7265 650a 2020 2020 2020  inal tree.      
+000127c0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+000127d0: 650a 0a20 2020 2020 2020 2023 2054 4f44  e..        # TOD
+000127e0: 4f3a 2041 6464 2063 6c75 7374 6572 696e  O: Add clusterin
+000127f0: 6720 636f 6c75 6d6e 7320 6261 7365 6420  g columns based 
+00012800: 6f6e 2061 6363 6573 7320 7061 7474 6572  on access patter
+00012810: 6e73 0a20 2020 2020 2020 206d 6174 6572  ns.        mater
+00012820: 6961 6c69 7a65 6420 3d20 7365 6c66 2e5f  ialized = self._
+00012830: 6361 6368 655f 7769 7468 5f63 6c75 7374  cache_with_clust
+00012840: 6572 5f63 6f6c 7328 0a20 2020 2020 2020  er_cols(.       
+00012850: 2020 2020 2063 6f72 652e 4172 7261 7956       core.ArrayV
+00012860: 616c 7565 2862 6573 745f 6361 6e64 6964  alue(best_candid
+00012870: 6174 655b 305d 292c 205b 5d0a 2020 2020  ate[0]), [].    
+00012880: 2020 2020 292e 6e6f 6465 0a0a 2020 2020      ).node..    
+00012890: 2020 2020 7265 7475 726e 2074 7261 7665      return trave
+000128a0: 7273 616c 732e 7265 706c 6163 655f 6e6f  rsals.replace_no
+000128b0: 6465 7328 0a20 2020 2020 2020 2020 2020  des(.           
+000128c0: 206e 6f64 652c 2074 6f5f 7265 706c 6163   node, to_replac
+000128d0: 653d 6265 7374 5f63 616e 6469 6461 7465  e=best_candidate
+000128e0: 5b30 5d2c 2072 6570 6c61 6365 6d65 6e65  [0], replacemene
+000128f0: 743d 6d61 7465 7269 616c 697a 6564 0a20  t=materialized. 
+00012900: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00012910: 6620 5f69 735f 7472 6976 6961 6c6c 795f  f _is_trivially_
+00012920: 6578 6563 7574 6162 6c65 2873 656c 662c  executable(self,
+00012930: 2061 7272 6179 5f76 616c 7565 3a20 636f   array_value: co
+00012940: 7265 2e41 7272 6179 5661 6c75 6529 3a0a  re.ArrayValue):.
+00012950: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012960: 2020 2020 4361 6e20 7468 6520 626c 6f63      Can the bloc
+00012970: 6b20 6265 2065 7661 6c75 6174 6564 2076  k be evaluated v
+00012980: 6572 7920 6368 6561 706c 793f 0a20 2020  ery cheaply?.   
+00012990: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
+000129a0: 6520 6172 7261 795f 7661 6c75 6520 7072  e array_value pr
+000129b0: 6f62 6162 6c79 2069 7320 6e6f 7420 776f  obably is not wo
+000129c0: 7274 6820 6361 6368 696e 672e 0a20 2020  rth caching..   
+000129d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000129e0: 2023 204f 6e63 6520 7265 7772 6974 696e   # Once rewritin
+000129f0: 6720 6973 2061 7661 696c 6162 6c65 2c20  g is available, 
+00012a00: 7769 6c6c 2077 616e 7420 746f 2072 6577  will want to rew
+00012a10: 7269 7465 2062 6566 6f72 650a 2020 2020  rite before.    
+00012a20: 2020 2020 2320 6576 616c 7561 7469 6e67      # evaluating
+00012a30: 2065 7865 6375 7469 6f6e 2063 6f73 742e   execution cost.
+00012a40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00012a50: 7472 6176 6572 7361 6c73 2e69 735f 7472  traversals.is_tr
+00012a60: 6976 6961 6c6c 795f 6578 6563 7574 6162  ivially_executab
+00012a70: 6c65 2861 7272 6179 5f76 616c 7565 2e6e  le(array_value.n
+00012a80: 6f64 6529 0a0a 2020 2020 6465 6620 5f65  ode)..    def _e
+00012a90: 7865 6375 7465 280a 2020 2020 2020 2020  xecute(.        
+00012aa0: 7365 6c66 2c0a 2020 2020 2020 2020 6172  self,.        ar
+00012ab0: 7261 795f 7661 6c75 653a 2063 6f72 652e  ray_value: core.
+00012ac0: 4172 7261 7956 616c 7565 2c0a 2020 2020  ArrayValue,.    
+00012ad0: 2020 2020 6a6f 625f 636f 6e66 6967 3a20      job_config: 
+00012ae0: 4f70 7469 6f6e 616c 5b62 6967 7175 6572  Optional[bigquer
+00012af0: 792e 6a6f 622e 5175 6572 794a 6f62 436f  y.job.QueryJobCo
+00012b00: 6e66 6967 5d20 3d20 4e6f 6e65 2c0a 2020  nfig] = None,.  
+00012b10: 2020 2020 2020 2a2c 0a20 2020 2020 2020        *,.       
+00012b20: 2073 6f72 7465 643a 2062 6f6f 6c20 3d20   sorted: bool = 
+00012b30: 5472 7565 2c0a 2020 2020 2020 2020 6472  True,.        dr
+00012b40: 795f 7275 6e3d 4661 6c73 652c 0a20 2020  y_run=False,.   
+00012b50: 2020 2020 2063 6f6c 5f69 645f 6f76 6572       col_id_over
+00012b60: 7269 6465 733a 204d 6170 7069 6e67 5b73  rides: Mapping[s
+00012b70: 7472 2c20 7374 725d 203d 207b 7d2c 0a20  tr, str] = {},. 
+00012b80: 2020 2029 202d 3e20 7475 706c 655b 6269     ) -> tuple[bi
+00012b90: 6771 7565 7279 2e74 6162 6c65 2e52 6f77  gquery.table.Row
+00012ba0: 4974 6572 6174 6f72 2c20 6269 6771 7565  Iterator, bigque
+00012bb0: 7279 2e51 7565 7279 4a6f 625d 3a0a 2020  ry.QueryJob]:.  
+00012bc0: 2020 2020 2020 7371 6c20 3d20 7365 6c66        sql = self
+00012bd0: 2e5f 746f 5f73 716c 280a 2020 2020 2020  ._to_sql(.      
+00012be0: 2020 2020 2020 6172 7261 795f 7661 6c75        array_valu
+00012bf0: 652c 2073 6f72 7465 643d 736f 7274 6564  e, sorted=sorted
+00012c00: 2c20 636f 6c5f 6964 5f6f 7665 7272 6964  , col_id_overrid
+00012c10: 6573 3d63 6f6c 5f69 645f 6f76 6572 7269  es=col_id_overri
+00012c20: 6465 730a 2020 2020 2020 2020 2920 2023  des.        )  #
+00012c30: 2074 7970 653a 6967 6e6f 7265 0a20 2020   type:ignore.   
+00012c40: 2020 2020 2069 6620 6a6f 625f 636f 6e66       if job_conf
+00012c50: 6967 2069 7320 4e6f 6e65 3a0a 2020 2020  ig is None:.    
+00012c60: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+00012c70: 6967 203d 2062 6967 7175 6572 792e 5175  ig = bigquery.Qu
+00012c80: 6572 794a 6f62 436f 6e66 6967 2864 7279  eryJobConfig(dry
+00012c90: 5f72 756e 3d64 7279 5f72 756e 290a 2020  _run=dry_run).  
+00012ca0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00012cb0: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+00012cc0: 6967 2e64 7279 5f72 756e 203d 2064 7279  ig.dry_run = dry
+00012cd0: 5f72 756e 0a20 2020 2020 2020 2072 6574  _run.        ret
+00012ce0: 7572 6e20 7365 6c66 2e5f 7374 6172 745f  urn self._start_
+00012cf0: 7175 6572 7928 0a20 2020 2020 2020 2020  query(.         
+00012d00: 2020 2073 716c 3d73 716c 2c0a 2020 2020     sql=sql,.    
+00012d10: 2020 2020 2020 2020 6a6f 625f 636f 6e66          job_conf
+00012d20: 6967 3d6a 6f62 5f63 6f6e 6669 672c 0a20  ig=job_config,. 
+00012d30: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00012d40: 6620 5f70 6565 6b28 0a20 2020 2020 2020  f _peek(.       
+00012d50: 2073 656c 662c 2061 7272 6179 5f76 616c   self, array_val
+00012d60: 7565 3a20 636f 7265 2e41 7272 6179 5661  ue: core.ArrayVa
+00012d70: 6c75 652c 206e 5f72 6f77 733a 2069 6e74  lue, n_rows: int
+00012d80: 0a20 2020 2029 202d 3e20 7475 706c 655b  .    ) -> tuple[
+00012d90: 6269 6771 7565 7279 2e74 6162 6c65 2e52  bigquery.table.R
+00012da0: 6f77 4974 6572 6174 6f72 2c20 6269 6771  owIterator, bigq
+00012db0: 7565 7279 2e51 7565 7279 4a6f 625d 3a0a  uery.QueryJob]:.
+00012dc0: 2020 2020 2020 2020 2222 2241 2027 7065          """A 'pe
+00012dd0: 656b 2720 6566 6669 6369 656e 746c 7920  ek' efficiently 
+00012de0: 6163 6365 7373 6573 2061 2073 6d61 6c6c  accesses a small
+00012df0: 206e 756d 6265 7220 6f66 2072 6f77 7320   number of rows 
+00012e00: 696e 2074 6865 2064 6174 6166 7261 6d65  in the dataframe
+00012e10: 2e22 2222 0a20 2020 2020 2020 2069 6620  .""".        if 
+00012e20: 6e6f 7420 7472 6565 5f70 726f 7065 7274  not tree_propert
+00012e30: 6965 732e 7065 656b 6162 6c65 2861 7272  ies.peekable(arr
+00012e40: 6179 5f76 616c 7565 2e6e 6f64 6529 3a0a  ay_value.node):.
+00012e50: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00012e60: 696e 6773 2e77 6172 6e28 2250 6565 6b69  ings.warn("Peeki
+00012e70: 6e67 2074 6869 7320 7661 6c75 6520 6361  ng this value ca
+00012e80: 6e6e 6f74 2062 6520 646f 6e65 2065 6666  nnot be done eff
+00012e90: 6963 6965 6e74 6c79 2e22 290a 2020 2020  iciently.").    
+00012ea0: 2020 2020 7371 6c20 3d20 7365 6c66 2e5f      sql = self._
+00012eb0: 636f 6d70 696c 655f 756e 6f72 6465 7265  compile_unordere
+00012ec0: 6428 6172 7261 795f 7661 6c75 6529 2e70  d(array_value).p
+00012ed0: 6565 6b5f 7371 6c28 6e5f 726f 7773 290a  eek_sql(n_rows).
+00012ee0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00012ef0: 656c 662e 5f73 7461 7274 5f71 7565 7279  elf._start_query
+00012f00: 280a 2020 2020 2020 2020 2020 2020 7371  (.            sq
+00012f10: 6c3d 7371 6c2c 0a20 2020 2020 2020 2029  l=sql,.        )
+00012f20: 0a0a 2020 2020 6465 6620 5f74 6f5f 7371  ..    def _to_sq
+00012f30: 6c28 0a20 2020 2020 2020 2073 656c 662c  l(.        self,
+00012f40: 0a20 2020 2020 2020 2061 7272 6179 5f76  .        array_v
+00012f50: 616c 7565 3a20 636f 7265 2e41 7272 6179  alue: core.Array
+00012f60: 5661 6c75 652c 0a20 2020 2020 2020 206f  Value,.        o
+00012f70: 6666 7365 745f 636f 6c75 6d6e 3a20 7479  ffset_column: ty
+00012f80: 7069 6e67 2e4f 7074 696f 6e61 6c5b 7374  ping.Optional[st
+00012f90: 725d 203d 204e 6f6e 652c 0a20 2020 2020  r] = None,.     
+00012fa0: 2020 2063 6f6c 5f69 645f 6f76 6572 7269     col_id_overri
+00012fb0: 6465 733a 2074 7970 696e 672e 4d61 7070  des: typing.Mapp
+00012fc0: 696e 675b 7374 722c 2073 7472 5d20 3d20  ing[str, str] = 
+00012fd0: 7b7d 2c0a 2020 2020 2020 2020 736f 7274  {},.        sort
+00012fe0: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
+00012ff0: 2c0a 2020 2020 2920 2d3e 2073 7472 3a0a  ,.    ) -> str:.
+00013000: 2020 2020 2020 2020 6966 206f 6666 7365          if offse
+00013010: 745f 636f 6c75 6d6e 3a0a 2020 2020 2020  t_column:.      
+00013020: 2020 2020 2020 6172 7261 795f 7661 6c75        array_valu
+00013030: 6520 3d20 6172 7261 795f 7661 6c75 652e  e = array_value.
+00013040: 7072 6f6d 6f74 655f 6f66 6673 6574 7328  promote_offsets(
+00013050: 6f66 6673 6574 5f63 6f6c 756d 6e29 0a20  offset_column). 
+00013060: 2020 2020 2020 2069 6620 736f 7274 6564         if sorted
+00013070: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00013080: 7475 726e 2073 656c 662e 5f63 6f6d 7069  turn self._compi
+00013090: 6c65 5f6f 7264 6572 6564 2861 7272 6179  le_ordered(array
+000130a0: 5f76 616c 7565 292e 746f 5f73 716c 280a  _value).to_sql(.
+000130b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130c0: 636f 6c5f 6964 5f6f 7665 7272 6964 6573  col_id_overrides
+000130d0: 3d63 6f6c 5f69 645f 6f76 6572 7269 6465  =col_id_override
+000130e0: 732c 2073 6f72 7465 643d 5472 7565 0a20  s, sorted=True. 
+000130f0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00013100: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00013110: 2e5f 636f 6d70 696c 655f 756e 6f72 6465  ._compile_unorde
+00013120: 7265 6428 6172 7261 795f 7661 6c75 6529  red(array_value)
+00013130: 2e74 6f5f 7371 6c28 0a20 2020 2020 2020  .to_sql(.       
+00013140: 2020 2020 2063 6f6c 5f69 645f 6f76 6572       col_id_over
+00013150: 7269 6465 733d 636f 6c5f 6964 5f6f 7665  rides=col_id_ove
+00013160: 7272 6964 6573 0a20 2020 2020 2020 2029  rrides.        )
+00013170: 0a0a 2020 2020 6465 6620 5f63 6f6d 7069  ..    def _compi
+00013180: 6c65 5f6f 7264 6572 6564 280a 2020 2020  le_ordered(.    
+00013190: 2020 2020 7365 6c66 2c20 6172 7261 795f      self, array_
+000131a0: 7661 6c75 653a 2063 6f72 652e 4172 7261  value: core.Arra
+000131b0: 7956 616c 7565 0a20 2020 2029 202d 3e20  yValue.    ) -> 
+000131c0: 6269 6766 7261 6d65 732e 636f 7265 2e63  bigframes.core.c
+000131d0: 6f6d 7069 6c65 2e4f 7264 6572 6564 4952  ompile.OrderedIR
+000131e0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000131f0: 2062 6967 6672 616d 6573 2e63 6f72 652e   bigframes.core.
+00013200: 636f 6d70 696c 652e 636f 6d70 696c 655f  compile.compile_
+00013210: 6f72 6465 7265 645f 6972 2861 7272 6179  ordered_ir(array
+00013220: 5f76 616c 7565 2e6e 6f64 6529 0a0a 2020  _value.node)..  
+00013230: 2020 6465 6620 5f63 6f6d 7069 6c65 5f75    def _compile_u
+00013240: 6e6f 7264 6572 6564 280a 2020 2020 2020  nordered(.      
+00013250: 2020 7365 6c66 2c20 6172 7261 795f 7661    self, array_va
+00013260: 6c75 653a 2063 6f72 652e 4172 7261 7956  lue: core.ArrayV
+00013270: 616c 7565 0a20 2020 2029 202d 3e20 6269  alue.    ) -> bi
+00013280: 6766 7261 6d65 732e 636f 7265 2e63 6f6d  gframes.core.com
+00013290: 7069 6c65 2e55 6e6f 7264 6572 6564 4952  pile.UnorderedIR
+000132a0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000132b0: 2062 6967 6672 616d 6573 2e63 6f72 652e   bigframes.core.
+000132c0: 636f 6d70 696c 652e 636f 6d70 696c 655f  compile.compile_
+000132d0: 756e 6f72 6465 7265 645f 6972 2861 7272  unordered_ir(arr
+000132e0: 6179 5f76 616c 7565 2e6e 6f64 6529 0a0a  ay_value.node)..
+000132f0: 2020 2020 6465 6620 5f67 6574 5f74 6162      def _get_tab
+00013300: 6c65 5f73 697a 6528 7365 6c66 2c20 6465  le_size(self, de
+00013310: 7374 696e 6174 696f 6e5f 7461 626c 6529  stination_table)
+00013320: 3a0a 2020 2020 2020 2020 7461 626c 6520  :.        table 
+00013330: 3d20 7365 6c66 2e62 7163 6c69 656e 742e  = self.bqclient.
+00013340: 6765 745f 7461 626c 6528 6465 7374 696e  get_table(destin
+00013350: 6174 696f 6e5f 7461 626c 6529 0a20 2020  ation_table).   
+00013360: 2020 2020 2072 6574 7572 6e20 7461 626c       return tabl
+00013370: 652e 6e75 6d5f 6279 7465 730a 0a20 2020  e.num_bytes..   
+00013380: 2064 6566 205f 726f 7773 5f74 6f5f 6461   def _rows_to_da
+00013390: 7461 6672 616d 6528 0a20 2020 2020 2020  taframe(.       
+000133a0: 2073 656c 662c 2072 6f77 5f69 7465 7261   self, row_itera
+000133b0: 746f 723a 2062 6967 7175 6572 792e 7461  tor: bigquery.ta
+000133c0: 626c 652e 526f 7749 7465 7261 746f 722c  ble.RowIterator,
+000133d0: 2064 7479 7065 733a 2044 6963 740a 2020   dtypes: Dict.  
+000133e0: 2020 2920 2d3e 2070 616e 6461 732e 4461    ) -> pandas.Da
+000133f0: 7461 4672 616d 653a 0a20 2020 2020 2020  taFrame:.       
+00013400: 2023 2043 616e 2069 676e 6f72 6520 696e   # Can ignore in
+00013410: 6665 7272 6564 2064 6174 6174 7970 6520  ferred datatype 
+00013420: 756e 7469 6c20 6474 7970 6520 656d 756c  until dtype emul
+00013430: 6174 696f 6e20 6272 6561 6b73 2031 3a31  ation breaks 1:1
+00013440: 206d 6170 7069 6e67 2062 6574 7765 656e   mapping between
+00013450: 2042 5120 7479 7065 7320 616e 6420 6269   BQ types and bi
+00013460: 6766 7261 6d65 7320 7479 7065 730a 2020  gframes types.  
+00013470: 2020 2020 2020 6474 7970 6573 5f66 726f        dtypes_fro
+00013480: 6d5f 6271 203d 2062 6967 6672 616d 6573  m_bq = bigframes
+00013490: 2e64 7479 7065 732e 6266 5f74 7970 655f  .dtypes.bf_type_
+000134a0: 6672 6f6d 5f74 7970 655f 6b69 6e64 2872  from_type_kind(r
+000134b0: 6f77 5f69 7465 7261 746f 722e 7363 6865  ow_iterator.sche
+000134c0: 6d61 290a 2020 2020 2020 2020 6172 726f  ma).        arro
+000134d0: 775f 7461 626c 6520 3d20 726f 775f 6974  w_table = row_it
+000134e0: 6572 6174 6f72 2e74 6f5f 6172 726f 7728  erator.to_arrow(
+000134f0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00013500: 2062 6967 6672 616d 6573 2e73 6573 7369   bigframes.sessi
+00013510: 6f6e 2e5f 696f 2e70 616e 6461 732e 6172  on._io.pandas.ar
+00013520: 726f 775f 746f 5f70 616e 6461 7328 6172  row_to_pandas(ar
+00013530: 726f 775f 7461 626c 652c 2064 7479 7065  row_table, dtype
+00013540: 735f 6672 6f6d 5f62 7129 0a0a 2020 2020  s_from_bq)..    
+00013550: 6465 6620 5f73 7461 7274 5f67 656e 6572  def _start_gener
+00013560: 6963 5f6a 6f62 2873 656c 662c 206a 6f62  ic_job(self, job
+00013570: 3a20 666f 726d 6174 7469 6e67 5f68 656c  : formatting_hel
+00013580: 7065 7273 2e47 656e 6572 6963 4a6f 6229  pers.GenericJob)
+00013590: 3a0a 2020 2020 2020 2020 6966 2062 6967  :.        if big
+000135a0: 6672 616d 6573 2e6f 7074 696f 6e73 2e64  frames.options.d
+000135b0: 6973 706c 6179 2e70 726f 6772 6573 735f  isplay.progress_
+000135c0: 6261 7220 6973 206e 6f74 204e 6f6e 653a  bar is not None:
+000135d0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000135e0: 6d61 7474 696e 675f 6865 6c70 6572 732e  matting_helpers.
+000135f0: 7761 6974 5f66 6f72 5f6a 6f62 280a 2020  wait_for_job(.  
+00013600: 2020 2020 2020 2020 2020 2020 2020 6a6f                jo
+00013610: 622c 2062 6967 6672 616d 6573 2e6f 7074  b, bigframes.opt
+00013620: 696f 6e73 2e64 6973 706c 6179 2e70 726f  ions.display.pro
+00013630: 6772 6573 735f 6261 720a 2020 2020 2020  gress_bar.      
+00013640: 2020 2020 2020 2920 2023 2057 6169 7420        )  # Wait 
+00013650: 666f 7220 7468 6520 6a6f 6220 746f 2063  for the job to c
+00013660: 6f6d 706c 6574 650a 2020 2020 2020 2020  omplete.        
+00013670: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00013680: 2020 6a6f 622e 7265 7375 6c74 2829 0a0a    job.result()..
+00013690: 2020 2020 6465 6620 5f72 616e 646f 6d5f      def _random_
+000136a0: 7461 626c 6528 7365 6c66 2c20 736b 6970  table(self, skip
+000136b0: 5f63 6c65 616e 7570 3a20 626f 6f6c 203d  _cleanup: bool =
+000136c0: 2046 616c 7365 2920 2d3e 2062 6967 7175   False) -> bigqu
+000136d0: 6572 792e 5461 626c 6552 6566 6572 656e  ery.TableReferen
+000136e0: 6365 3a0a 2020 2020 2020 2020 2222 2247  ce:.        """G
+000136f0: 656e 6572 6174 6520 6120 7261 6e64 6f6d  enerate a random
+00013700: 2074 6162 6c65 2049 4420 7769 7468 2042   table ID with B
+00013710: 6967 5175 6572 7920 4461 7461 4672 616d  igQuery DataFram
+00013720: 6573 2070 7265 6669 782e 0a0a 2020 2020  es prefix...    
+00013730: 2020 2020 5468 6520 6765 6e65 7261 7465      The generate
+00013740: 6420 4944 2077 696c 6c20 6265 2073 746f  d ID will be sto
+00013750: 7265 6420 616e 6420 6368 6563 6b65 6420  red and checked 
+00013760: 666f 7220 6465 6c65 7469 6f6e 2077 6865  for deletion whe
+00013770: 6e20 7468 650a 2020 2020 2020 2020 7365  n the.        se
+00013780: 7373 696f 6e20 6973 2063 6c6f 7365 642c  ssion is closed,
+00013790: 2075 6e6c 6573 7320 736b 6970 5f63 6c65   unless skip_cle
+000137a0: 616e 7570 2069 7320 5472 7565 2e0a 0a20  anup is True... 
+000137b0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+000137c0: 2020 2020 2020 2020 2073 6b69 705f 636c           skip_cl
+000137d0: 6561 6e75 7020 2862 6f6f 6c2c 2064 6566  eanup (bool, def
+000137e0: 6175 6c74 2046 616c 7365 293a 0a20 2020  ault False):.   
+000137f0: 2020 2020 2020 2020 2020 2020 2049 6620               If 
+00013800: 5472 7565 2c20 646f 206e 6f74 2061 6464  True, do not add
+00013810: 2074 6865 2067 656e 6572 6174 6564 2049   the generated I
+00013820: 4420 746f 2074 6865 206c 6973 7420 6f66  D to the list of
+00013830: 2074 6162 6c65 730a 2020 2020 2020 2020   tables.        
+00013840: 2020 2020 2020 2020 746f 2063 6c65 616e          to clean
+00013850: 2075 7020 7768 656e 2074 6865 2073 6573   up when the ses
+00013860: 7369 6f6e 2069 7320 636c 6f73 6564 2e0a  sion is closed..
+00013870: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00013880: 3a0a 2020 2020 2020 2020 2020 2020 676f  :.            go
+00013890: 6f67 6c65 2e63 6c6f 7564 2e62 6967 7175  ogle.cloud.bigqu
+000138a0: 6572 792e 5461 626c 6552 6566 6572 656e  ery.TableReferen
+000138b0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+000138c0: 2020 2020 4675 6c6c 7920 7175 616c 6966      Fully qualif
+000138d0: 6965 6420 7461 626c 6520 4944 206f 6620  ied table ID of 
+000138e0: 6120 7461 626c 6520 7468 6174 2064 6f65  a table that doe
+000138f0: 736e 2774 2065 7869 7374 2e0a 2020 2020  sn't exist..    
+00013900: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00013910: 6461 7461 7365 7420 3d20 7365 6c66 2e5f  dataset = self._
+00013920: 616e 6f6e 796d 6f75 735f 6461 7461 7365  anonymous_datase
+00013930: 740a 2020 2020 2020 2020 7365 7373 696f  t.        sessio
+00013940: 6e5f 6964 203d 2073 656c 662e 7365 7373  n_id = self.sess
+00013950: 696f 6e5f 6964 0a20 2020 2020 2020 206e  ion_id.        n
+00013960: 6f77 203d 2064 6174 6574 696d 652e 6461  ow = datetime.da
+00013970: 7465 7469 6d65 2e6e 6f77 2864 6174 6574  tetime.now(datet
+00013980: 696d 652e 7469 6d65 7a6f 6e65 2e75 7463  ime.timezone.utc
+00013990: 290a 2020 2020 2020 2020 7261 6e64 6f6d  ).        random
+000139a0: 5f69 6420 3d20 7575 6964 2e75 7569 6434  _id = uuid.uuid4
+000139b0: 2829 2e68 6578 0a20 2020 2020 2020 2074  ().hex.        t
+000139c0: 6162 6c65 5f69 6420 3d20 5f54 454d 505f  able_id = _TEMP_
+000139d0: 5441 424c 455f 4944 5f46 4f52 4d41 542e  TABLE_ID_FORMAT.
+000139e0: 666f 726d 6174 280a 2020 2020 2020 2020  format(.        
+000139f0: 2020 2020 6461 7465 3d6e 6f77 2e73 7472      date=now.str
+00013a00: 6674 696d 6528 2225 5925 6d25 6422 292c  ftime("%Y%m%d"),
+00013a10: 2073 6573 7369 6f6e 5f69 643d 7365 7373   session_id=sess
+00013a20: 696f 6e5f 6964 2c20 7261 6e64 6f6d 5f69  ion_id, random_i
+00013a30: 643d 7261 6e64 6f6d 5f69 640a 2020 2020  d=random_id.    
+00013a40: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
+00013a50: 206e 6f74 2073 6b69 705f 636c 6561 6e75   not skip_cleanu
+00013a60: 703a 0a20 2020 2020 2020 2020 2020 2073  p:.            s
+00013a70: 656c 662e 5f74 6162 6c65 5f69 6473 2e61  elf._table_ids.a
+00013a80: 7070 656e 6428 7461 626c 655f 6964 290a  ppend(table_id).
+00013a90: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00013aa0: 6174 6173 6574 2e74 6162 6c65 2874 6162  ataset.table(tab
+00013ab0: 6c65 5f69 6429 0a0a 0a64 6566 2063 6f6e  le_id)...def con
+00013ac0: 6e65 6374 2863 6f6e 7465 7874 3a20 4f70  nect(context: Op
+00013ad0: 7469 6f6e 616c 5b62 6967 7175 6572 795f  tional[bigquery_
+00013ae0: 6f70 7469 6f6e 732e 4269 6751 7565 7279  options.BigQuery
+00013af0: 4f70 7469 6f6e 735d 203d 204e 6f6e 6529  Options] = None)
+00013b00: 202d 3e20 5365 7373 696f 6e3a 0a20 2020   -> Session:.   
+00013b10: 2072 6574 7572 6e20 5365 7373 696f 6e28   return Session(
+00013b20: 636f 6e74 6578 7429 0a0a 0a64 6566 205f  context)...def _
+00013b30: 6361 6e5f 636c 7573 7465 725f 6271 2866  can_cluster_bq(f
+00013b40: 6965 6c64 3a20 6269 6771 7565 7279 2e53  ield: bigquery.S
+00013b50: 6368 656d 6146 6965 6c64 293a 0a20 2020  chemaField):.   
+00013b60: 2023 2068 7474 7073 3a2f 2f63 6c6f 7564   # https://cloud
+00013b70: 2e67 6f6f 676c 652e 636f 6d2f 6269 6771  .google.com/bigq
+00013b80: 7565 7279 2f64 6f63 732f 636c 7573 7465  uery/docs/cluste
+00013b90: 7265 642d 7461 626c 6573 0a20 2020 2023  red-tables.    #
+00013ba0: 204e 6f74 6162 6c79 2c20 666c 6f61 7420   Notably, float 
+00013bb0: 6973 2065 7863 6c75 6465 640a 2020 2020  is excluded.    
+00013bc0: 7479 7065 5f20 3d20 6669 656c 642e 6669  type_ = field.fi
+00013bd0: 656c 645f 7479 7065 0a20 2020 2072 6574  eld_type.    ret
+00013be0: 7572 6e20 7479 7065 5f20 696e 2028 0a20  urn type_ in (. 
+00013bf0: 2020 2020 2020 2022 494e 5445 4745 5222         "INTEGER"
+00013c00: 2c0a 2020 2020 2020 2020 2249 4e54 3634  ,.        "INT64
+00013c10: 222c 0a20 2020 2020 2020 2022 5354 5249  ",.        "STRI
+00013c20: 4e47 222c 0a20 2020 2020 2020 2022 4e55  NG",.        "NU
+00013c30: 4d45 5249 4322 2c0a 2020 2020 2020 2020  MERIC",.        
+00013c40: 2244 4543 494d 414c 222c 0a20 2020 2020  "DECIMAL",.     
+00013c50: 2020 2022 4249 474e 554d 4552 4943 222c     "BIGNUMERIC",
+00013c60: 0a20 2020 2020 2020 2022 4249 4744 4543  .        "BIGDEC
+00013c70: 494d 414c 222c 0a20 2020 2020 2020 2022  IMAL",.        "
+00013c80: 4441 5445 222c 0a20 2020 2020 2020 2022  DATE",.        "
+00013c90: 4441 5445 5449 4d45 222c 0a20 2020 2020  DATETIME",.     
+00013ca0: 2020 2022 5449 4d45 5354 414d 5022 2c0a     "TIMESTAMP",.
+00013cb0: 2020 2020 2020 2020 2242 4f4f 4c22 2c0a          "BOOL",.
+00013cc0: 2020 2020 2020 2020 2242 4f4f 4c45 414e          "BOOLEAN
+00013cd0: 222c 0a20 2020 2029 0a0a 0a64 6566 205f  ",.    )...def _
+00013ce0: 7472 616e 7366 6f72 6d5f 7265 6164 5f67  transform_read_g
+00013cf0: 6271 5f63 6f6e 6669 6775 7261 7469 6f6e  bq_configuration
+00013d00: 2863 6f6e 6669 6775 7261 7469 6f6e 3a20  (configuration: 
+00013d10: 4f70 7469 6f6e 616c 5b64 6963 745d 2920  Optional[dict]) 
+00013d20: 2d3e 2064 6963 743a 0a20 2020 2022 2222  -> dict:.    """
+00013d30: 0a20 2020 2046 6f72 2062 6163 6b77 6172  .    For backwar
+00013d40: 6473 2d63 6f6d 7061 7469 6269 6c69 7479  ds-compatibility
+00013d50: 2c20 636f 6e76 6572 7420 616e 7920 7072  , convert any pr
+00013d60: 6576 696f 7573 6c79 2063 6c69 656e 742d  eviously client-
+00013d70: 7369 6465 206f 6e6c 790a 2020 2020 7061  side only.    pa
+00013d80: 7261 6d65 7465 7273 2073 7563 6820 6173  rameters such as
+00013d90: 2074 696d 656f 7574 4d73 2074 6f20 7468   timeoutMs to th
+00013da0: 6520 7072 6f70 6572 7479 206e 616d 6520  e property name 
+00013db0: 6578 7065 6374 6564 2062 7920 7468 6520  expected by the 
+00013dc0: 5245 5354 2041 5049 2e0a 0a20 2020 204d  REST API...    M
+00013dd0: 616b 6573 2061 2063 6f70 7920 6f66 2063  akes a copy of c
+00013de0: 6f6e 6669 6775 7261 7469 6f6e 2069 6620  onfiguration if 
+00013df0: 6368 616e 6765 7320 6172 6520 6e65 6564  changes are need
+00013e00: 6564 2e0a 2020 2020 2222 220a 0a20 2020  ed..    """..   
+00013e10: 2069 6620 636f 6e66 6967 7572 6174 696f   if configuratio
+00013e20: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
+00013e30: 2020 2072 6574 7572 6e20 7b7d 0a0a 2020     return {}..  
+00013e40: 2020 7469 6d65 6f75 745f 6d73 203d 2063    timeout_ms = c
+00013e50: 6f6e 6669 6775 7261 7469 6f6e 2e67 6574  onfiguration.get
+00013e60: 2822 7175 6572 7922 2c20 7b7d 292e 6765  ("query", {}).ge
+00013e70: 7428 2274 696d 656f 7574 4d73 2229 0a20  t("timeoutMs"). 
+00013e80: 2020 2069 6620 7469 6d65 6f75 745f 6d73     if timeout_ms
+00013e90: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00013ea0: 2020 2020 2020 2320 5472 616e 7366 6f72        # Transfor
+00013eb0: 6d20 7469 6d65 6f75 744d 7320 746f 2061  m timeoutMs to a
+00013ec0: 6e20 6163 7475 616c 2073 6572 7665 722d  n actual server-
+00013ed0: 7369 6465 2063 6f6e 6669 6775 7261 7469  side configurati
+00013ee0: 6f6e 2e0a 2020 2020 2020 2020 2320 6874  on..        # ht
+00013ef0: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+00013f00: 2f67 6f6f 676c 6561 7069 732f 7079 7468  /googleapis/pyth
+00013f10: 6f6e 2d62 6967 7175 6572 792d 7061 6e64  on-bigquery-pand
+00013f20: 6173 2f69 7373 7565 732f 3437 390a 2020  as/issues/479.  
+00013f30: 2020 2020 2020 636f 6e66 6967 7572 6174        configurat
+00013f40: 696f 6e20 3d20 636f 7079 2e64 6565 7063  ion = copy.deepc
+00013f50: 6f70 7928 636f 6e66 6967 7572 6174 696f  opy(configuratio
+00013f60: 6e29 0a20 2020 2020 2020 2064 656c 2063  n).        del c
+00013f70: 6f6e 6669 6775 7261 7469 6f6e 5b22 7175  onfiguration["qu
+00013f80: 6572 7922 5d5b 2274 696d 656f 7574 4d73  ery"]["timeoutMs
+00013f90: 225d 0a20 2020 2020 2020 2063 6f6e 6669  "].        confi
+00013fa0: 6775 7261 7469 6f6e 5b22 6a6f 6254 696d  guration["jobTim
+00013fb0: 656f 7574 4d73 225d 203d 2074 696d 656f  eoutMs"] = timeo
+00013fc0: 7574 5f6d 730a 0a20 2020 2072 6574 7572  ut_ms..    retur
+00013fd0: 6e20 636f 6e66 6967 7572 6174 696f 6e0a  n configuration.
```

### Comparing `bigframes-1.6.0/bigframes/session/_io/__init__.py` & `bigframes-1.7.0/bigframes/session/_io/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/session/_io/bigquery/__init__.py` & `bigframes-1.7.0/bigframes/session/_io/bigquery/__init__.py`

 * *Files 6% similar despite different names*

```diff
@@ -27,14 +27,15 @@
 
 import bigframes_vendored.pandas.io.gbq as third_party_pandas_gbq
 import google.api_core.exceptions
 import google.cloud.bigquery as bigquery
 
 import bigframes
 from bigframes.core import log_adapter
+import bigframes.core.sql
 import bigframes.formatting_helpers as formatting_helpers
 
 IO_ORDERING_ID = "bqdf_row_nums"
 MAX_LABELS_COUNT = 64
 _LIST_TABLES_LIMIT = 10000  # calls to bqclient.list_tables
 # will be limited to this many tables
 
@@ -332,14 +333,16 @@
 
 
 def to_query(
     query_or_table: str,
     index_cols: Iterable[str],
     columns: Iterable[str],
     filters: third_party_pandas_gbq.FiltersType,
+    max_results: Optional[int],
+    time_travel_timestamp: Optional[datetime.datetime],
 ) -> str:
     """Compile query_or_table with conditions(filters, wildcards) to query."""
     filters = list(filters)
     sub_query = (
         f"({query_or_table})" if is_query(query_or_table) else f"`{query_or_table}`"
     )
 
@@ -349,15 +352,24 @@
         # We only reduce the selection if columns is set, but we always
         # want to make sure index_cols is also included.
         all_columns = itertools.chain(index_cols, columns)
         select_clause = "SELECT " + ", ".join(f"`{column}`" for column in all_columns)
     else:
         select_clause = "SELECT *"
 
-    where_clause = ""
+    time_travel_clause = ""
+    if time_travel_timestamp is not None:
+        time_travel_literal = bigframes.core.sql.simple_literal(time_travel_timestamp)
+        time_travel_clause = f" FOR SYSTEM_TIME AS OF {time_travel_literal}"
+
+    limit_clause = ""
+    if max_results is not None:
+        limit_clause = f" LIMIT {bigframes.core.sql.simple_literal(max_results)}"
+
+    filter_string = ""
     if filters:
         valid_operators: Mapping[third_party_pandas_gbq.FilterOps, str] = {
             "in": "IN",
             "not in": "NOT IN",
             "LIKE": "LIKE",
             "==": "=",
             ">": ">",
@@ -369,45 +381,61 @@
 
         # If single layer filter, add another pseudo layer. So the single layer represents "and" logic.
         if isinstance(filters[0], tuple) and (
             len(filters[0]) == 0 or not isinstance(list(filters[0])[0], tuple)
         ):
             filters = typing.cast(third_party_pandas_gbq.FiltersType, [filters])
 
-        or_expressions = []
         for group in filters:
             if not isinstance(group, Iterable):
                 group = [group]
 
-            and_expressions = []
+            and_expression = ""
             for filter_item in group:
                 if not isinstance(filter_item, tuple) or (len(filter_item) != 3):
                     raise ValueError(
-                        f"Filter condition should be a tuple of length 3, {filter_item} is not valid."
+                        f"Elements of filters must be tuples of length 3, but got {repr(filter_item)}.",
                     )
 
                 column, operator, value = filter_item
 
                 if not isinstance(column, str):
                     raise ValueError(
                         f"Column name should be a string, but received '{column}' of type {type(column).__name__}."
                     )
 
                 if operator not in valid_operators:
                     raise ValueError(f"Operator {operator} is not valid.")
 
                 operator_str = valid_operators[operator]
 
+                column_ref = bigframes.core.sql.identifier(column)
                 if operator_str in ["IN", "NOT IN"]:
-                    value_list = ", ".join([repr(v) for v in value])
-                    expression = f"`{column}` {operator_str} ({value_list})"
+                    value_literal = bigframes.core.sql.multi_literal(*value)
+                else:
+                    value_literal = bigframes.core.sql.simple_literal(value)
+                expression = bigframes.core.sql.infix_op(
+                    operator_str, column_ref, value_literal
+                )
+                if and_expression:
+                    and_expression = bigframes.core.sql.infix_op(
+                        "AND", and_expression, expression
+                    )
                 else:
-                    expression = f"`{column}` {operator_str} {repr(value)}"
-                and_expressions.append(expression)
+                    and_expression = expression
 
-            or_expressions.append(" AND ".join(and_expressions))
+            if filter_string:
+                filter_string = bigframes.core.sql.infix_op(
+                    "OR", filter_string, and_expression
+                )
+            else:
+                filter_string = and_expression
 
-        if or_expressions:
-            where_clause = " WHERE " + " OR ".join(or_expressions)
+    where_clause = ""
+    if filter_string:
+        where_clause = f" WHERE {filter_string}"
 
-    full_query = f"{select_clause} FROM {sub_query} AS sub{where_clause}"
-    return full_query
+    return (
+        f"{select_clause} "
+        f"FROM {sub_query}"
+        f"{time_travel_clause}{where_clause}{limit_clause}"
+    )
```

### Comparing `bigframes-1.6.0/bigframes/session/_io/bigquery/read_gbq_table.py` & `bigframes-1.7.0/bigframes/session/_io/bigquery/read_gbq_table.py`

 * *Files 8% similar despite different names*

```diff
@@ -16,36 +16,37 @@
 Private helpers for loading a BigQuery table as a BigQuery DataFrames DataFrame.
 """
 
 from __future__ import annotations
 
 import datetime
 import itertools
-import textwrap
 import typing
 from typing import Dict, Iterable, List, Optional, Tuple
 import warnings
 
 import bigframes_vendored.ibis.expr.operations as vendored_ibis_ops
+import bigframes_vendored.pandas.io.gbq as third_party_pandas_gbq
 import google.api_core.exceptions
 import google.cloud.bigquery as bigquery
 import ibis
 import ibis.backends
 import ibis.expr.datatypes as ibis_dtypes
 import ibis.expr.types as ibis_types
 
 import bigframes
 import bigframes.clients
 import bigframes.constants
 import bigframes.core as core
 import bigframes.core.compile
 import bigframes.core.guid as guid
 import bigframes.core.ordering as order
+import bigframes.core.sql
 import bigframes.dtypes
-import bigframes.session._io.bigquery.read_gbq_table
+import bigframes.session._io.bigquery
 import bigframes.session.clients
 import bigframes.version
 
 # Avoid circular imports.
 if typing.TYPE_CHECKING:
     import bigframes.session
 
@@ -121,74 +122,71 @@
         ).result()
     )[0][0]
     cached_table = (snapshot_timestamp, table)
     cache[table_ref] = cached_table
     return cached_table
 
 
-def _create_time_travel_sql(
-    table_ref: bigquery.TableReference, time_travel_timestamp: datetime.datetime
-) -> str:
-    """Query a table via 'time travel' for consistent reads."""
-    # If we have an anonymous query results table, it can't be modified and
-    # there isn't any BigQuery time travel.
-    if table_ref.dataset_id.startswith("_"):
-        return f"SELECT * FROM `{table_ref.project}`.`{table_ref.dataset_id}`.`{table_ref.table_id}`"
-
-    return textwrap.dedent(
-        f"""
-        SELECT *
-        FROM `{table_ref.project}`.`{table_ref.dataset_id}`.`{table_ref.table_id}`
-        FOR SYSTEM_TIME AS OF TIMESTAMP({repr(time_travel_timestamp.isoformat())})
-        """
-    )
-
-
 def get_ibis_time_travel_table(
     ibis_client: ibis.BaseBackend,
     table_ref: bigquery.TableReference,
-    time_travel_timestamp: datetime.datetime,
+    index_cols: Iterable[str],
+    columns: Iterable[str],
+    filters: third_party_pandas_gbq.FiltersType,
+    time_travel_timestamp: Optional[datetime.datetime],
 ) -> ibis_types.Table:
+    # If we have an anonymous query results table, it can't be modified and
+    # there isn't any BigQuery time travel.
+    if table_ref.dataset_id.startswith("_"):
+        time_travel_timestamp = None
+
     try:
         return ibis_client.sql(
-            _create_time_travel_sql(table_ref, time_travel_timestamp)
+            bigframes.session._io.bigquery.to_query(
+                f"{table_ref.project}.{table_ref.dataset_id}.{table_ref.table_id}",
+                index_cols=index_cols,
+                columns=columns,
+                filters=filters,
+                time_travel_timestamp=time_travel_timestamp,
+                # If we've made it this far, we know we don't have any
+                # max_results to worry about, because in that case we will
+                # have executed a query with a LIMI clause.
+                max_results=None,
+            )
         )
     except google.api_core.exceptions.Forbidden as ex:
         # Ibis does a dry run to get the types of the columns from the SQL.
         if "Drive credentials" in ex.message:
             ex.message += "\nCheck https://cloud.google.com/bigquery/docs/query-drive-data#Google_Drive_permissions."
         raise
 
 
-def _check_index_uniqueness(
+def are_index_cols_unique(
     bqclient: bigquery.Client,
-    ibis_client: ibis.BaseBackend,
-    table: ibis_types.Table,
+    table: bigquery.table.Table,
     index_cols: List[str],
     api_name: str,
 ) -> bool:
-    distinct_table = table.select(*index_cols).distinct()
-    is_unique_sql = f"""WITH full_table AS (
-        {ibis_client.compile(table)}
-    ),
-    distinct_table AS (
-        {ibis_client.compile(distinct_table)}
-    )
+    if len(index_cols) == 0:
+        return False
+    # If index_cols contain the primary_keys, the query engine assumes they are
+    # provide a unique index.
+    primary_keys = frozenset(_get_primary_keys(table))
+    if (len(primary_keys) > 0) and primary_keys <= frozenset(index_cols):
+        return True
 
-    SELECT (SELECT COUNT(*) FROM full_table) AS `total_count`,
-    (SELECT COUNT(*) FROM distinct_table) AS `distinct_count`
-    """
+    # TODO(b/337925142): Avoid a "SELECT *" subquery here by ensuring
+    # table_expression only selects just index_cols.
+    is_unique_sql = bigframes.core.sql.is_distinct_sql(index_cols, table.reference)
     job_config = bigquery.QueryJobConfig()
     job_config.labels["bigframes-api"] = api_name
     results = bqclient.query_and_wait(is_unique_sql, job_config=job_config)
     row = next(iter(results))
 
-    total_count = row["total_count"]
-    distinct_count = row["distinct_count"]
-    return total_count == distinct_count
+    return row["total_count"] == row["distinct_count"]
 
 
 def _get_primary_keys(
     table: bigquery.table.Table,
 ) -> List[str]:
     """Get primary keys from table if they are set."""
 
@@ -224,39 +222,33 @@
         range_partitioning := table.range_partitioning
     ) is not None and range_partitioning.field is not None:
         return True
 
     return False
 
 
-def get_index_cols_and_uniqueness(
-    bqclient: bigquery.Client,
-    ibis_client: ibis.BaseBackend,
+def get_index_cols(
     table: bigquery.table.Table,
-    table_expression: ibis_types.Table,
     index_col: Iterable[str] | str | bigframes.enums.DefaultIndexKind,
-    api_name: str,
-) -> Tuple[List[str], bool]:
+) -> List[str]:
     """
     If we can get a total ordering from the table, such as via primary key
     column(s), then return those too so that ordering generation can be
     avoided.
     """
 
     # Transform index_col -> index_cols so we have a variable that is
     # always a list of column names (possibly empty).
     if isinstance(index_col, bigframes.enums.DefaultIndexKind):
         if index_col == bigframes.enums.DefaultIndexKind.SEQUENTIAL_INT64:
             # User has explicity asked for a default, sequential index.
             # Use that, even if there are primary keys on the table.
-            #
-            # Note: This relies on the default behavior of the Block
-            # constructor to create a default sequential index. If that ever
-            # changes, this logic will need to be revisited.
-            return [], False
+            return []
+        if index_col == bigframes.enums.DefaultIndexKind.NULL:
+            return []
         else:
             # Note: It's actually quite difficult to mock this out to unit
             # test, as it's not possible to subclass enums in Python. See:
             # https://stackoverflow.com/a/33680021/101923
             raise NotImplementedError(
                 f"Got unexpected index_col {repr(index_col)}. {bigframes.constants.FEEDBACK_LINK}"
             )
@@ -285,27 +277,16 @@
                 category=bigframes.exceptions.DefaultIndexWarning,
             )
 
         # If there are primary keys defined, the query engine assumes these
         # columns are unique, even if the constraint is not enforced. We make
         # the same assumption and use these columns as the total ordering keys.
         index_cols = primary_keys
-        is_index_unique = len(index_cols) != 0
-    else:
-        is_index_unique = _check_index_uniqueness(
-            bqclient=bqclient,
-            ibis_client=ibis_client,
-            # TODO(b/337925142): Avoid a "SELECT *" subquery here by using
-            # _create_time_travel_sql with just index_cols.
-            table=table_expression,
-            index_cols=index_cols,
-            api_name=api_name,
-        )
 
-    return index_cols, is_index_unique
+    return index_cols
 
 
 def get_time_travel_datetime_and_table_metadata(
     bqclient: bigquery.Client,
     table_ref: bigquery.TableReference,
     *,
     api_name: str,
```

### Comparing `bigframes-1.6.0/bigframes/session/_io/pandas.py` & `bigframes-1.7.0/bigframes/session/_io/pandas.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/bigframes/session/clients.py` & `bigframes-1.7.0/bigframes/session/clients.py`

 * *Files 9% similar despite different names*

```diff
@@ -113,18 +113,19 @@
         self._bqstoragereadclient = None
         self._cloudfunctionsclient = None
         self._resourcemanagerclient = None
 
     def _create_bigquery_client(self):
         bq_options = None
         if self._use_regional_endpoints:
+            # TODO(b/340896138): fix type error
             bq_options = google.api_core.client_options.ClientOptions(
                 api_endpoint=(
                     _BIGQUERY_REGIONAL_ENDPOINT
-                    if self._location.lower() in _REP_SUPPORTED_REGIONS
+                    if self._location.lower() in _REP_SUPPORTED_REGIONS  # type: ignore
                     else _BIGQUERY_LOCATIONAL_ENDPOINT
                 ).format(location=self._location),
             )
         bq_info = google.api_core.client_info.ClientInfo(
             user_agent=self._application_name
         )
 
@@ -154,70 +155,73 @@
                     api_endpoint=_BIGQUERYCONNECTION_LOCATIONAL_ENDPOINT.format(
                         location=self._location
                     )
                 )
             bqconnection_info = google.api_core.gapic_v1.client_info.ClientInfo(
                 user_agent=self._application_name
             )
-            self._bqconnectionclient = (
-                google.cloud.bigquery_connection_v1.ConnectionServiceClient(
-                    client_info=bqconnection_info,
-                    client_options=bqconnection_options,
-                    credentials=self._credentials,
-                )
+            # TODO(b/340896138): fix type error
+            self._bqconnectionclient = google.cloud.bigquery_connection_v1.ConnectionServiceClient(  # type: ignore
+                client_info=bqconnection_info,
+                client_options=bqconnection_options,
+                credentials=self._credentials,
             )
 
         return self._bqconnectionclient
 
     @property
     def bqstoragereadclient(self):
         if not self._bqstoragereadclient:
             bqstorage_options = None
             if self._use_regional_endpoints:
+                # TODO(b/340896138): fix type error
                 bqstorage_options = google.api_core.client_options.ClientOptions(
                     api_endpoint=(
                         _BIGQUERYSTORAGE_REGIONAL_ENDPOINT
-                        if self._location.lower() in _REP_SUPPORTED_REGIONS
+                        if self._location.lower() in _REP_SUPPORTED_REGIONS  # type: ignore
                         else _BIGQUERYSTORAGE_LOCATIONAL_ENDPOINT
                     ).format(location=self._location),
                 )
             bqstorage_info = google.api_core.gapic_v1.client_info.ClientInfo(
                 user_agent=self._application_name
             )
+            # TODO(b/340896138): fix type error
             self._bqstoragereadclient = (
-                google.cloud.bigquery_storage_v1.BigQueryReadClient(
+                google.cloud.bigquery_storage_v1.BigQueryReadClient(  # type: ignore
                     client_info=bqstorage_info,
                     client_options=bqstorage_options,
                     credentials=self._credentials,
                 )
             )
 
         return self._bqstoragereadclient
 
     @property
     def cloudfunctionsclient(self):
         if not self._cloudfunctionsclient:
             functions_info = google.api_core.gapic_v1.client_info.ClientInfo(
                 user_agent=self._application_name
             )
+            # TODO(b/340896138): fix type error
             self._cloudfunctionsclient = (
-                google.cloud.functions_v2.FunctionServiceClient(
+                google.cloud.functions_v2.FunctionServiceClient(  # type: ignore
                     client_info=functions_info,
                     credentials=self._credentials,
                 )
             )
 
         return self._cloudfunctionsclient
 
     @property
     def resourcemanagerclient(self):
         if not self._resourcemanagerclient:
             resourcemanager_info = google.api_core.gapic_v1.client_info.ClientInfo(
                 user_agent=self._application_name
             )
+            # TODO(b/340896138): fix type error
             self._resourcemanagerclient = (
-                google.cloud.resourcemanager_v3.ProjectsClient(
+                google.cloud.resourcemanager_v3.ProjectsClient(  # type: ignore
                     credentials=self._credentials, client_info=resourcemanager_info
                 )
             )
 
         return self._resourcemanagerclient
```

### Comparing `bigframes-1.6.0/bigframes/version.py` & `bigframes-1.7.0/bigframes/version.py`

 * *Files 1% similar despite different names*

```diff
@@ -8,8 +8,8 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-__version__ = "1.6.0"
+__version__ = "1.7.0"
```

### Comparing `bigframes-1.6.0/bigframes.egg-info/PKG-INFO` & `bigframes-1.7.0/bigframes.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: bigframes
-Version: 1.6.0
+Version: 1.7.0
 Summary: BigQuery DataFrames -- scalable analytics and machine learning with BigQuery
 Home-page: https://github.com/googleapis/python-bigquery-dataframes
 Author: Google LLC
 Author-email: bigframes-feedback@google.com
 License: Apache 2.0
 Platform: Posix; MacOS X; Windows
 Classifier: Development Status :: 5 - Production/Stable
```

### Comparing `bigframes-1.6.0/bigframes.egg-info/SOURCES.txt` & `bigframes-1.7.0/bigframes.egg-info/SOURCES.txt`

 * *Files 0% similar despite different names*

```diff
@@ -140,14 +140,15 @@
 tests/system/large/ml/test_linear_model.py
 tests/system/large/ml/test_pipeline.py
 tests/system/load/test_large_tables.py
 tests/system/load/test_llm.py
 tests/system/small/__init__.py
 tests/system/small/test_dataframe.py
 tests/system/small/test_dataframe_io.py
+tests/system/small/test_empty_index.py
 tests/system/small/test_encryption.py
 tests/system/small/test_groupby.py
 tests/system/small/test_ibis.py
 tests/system/small/test_index.py
 tests/system/small/test_ipython.py
 tests/system/small/test_multiindex.py
 tests/system/small/test_numpy.py
@@ -231,15 +232,15 @@
 third_party/bigframes_vendored/ibis/backends/bigquery/__init__.py
 third_party/bigframes_vendored/ibis/backends/bigquery/compiler.py
 third_party/bigframes_vendored/ibis/backends/bigquery/datatypes.py
 third_party/bigframes_vendored/ibis/backends/bigquery/registry.py
 third_party/bigframes_vendored/ibis/expr/__init__.py
 third_party/bigframes_vendored/ibis/expr/operations/__init__.py
 third_party/bigframes_vendored/ibis/expr/operations/analytic.py
-third_party/bigframes_vendored/ibis/expr/operations/generic.py
+third_party/bigframes_vendored/ibis/expr/operations/arrays.py
 third_party/bigframes_vendored/ibis/expr/operations/json.py
 third_party/bigframes_vendored/ibis/expr/operations/reductions.py
 third_party/bigframes_vendored/pandas/AUTHORS.md
 third_party/bigframes_vendored/pandas/LICENSE
 third_party/bigframes_vendored/pandas/README.md
 third_party/bigframes_vendored/pandas/__init__.py
 third_party/bigframes_vendored/pandas/_config/config.py
```

### Comparing `bigframes-1.6.0/bigframes.egg-info/requires.txt` & `bigframes-1.7.0/bigframes.egg-info/requires.txt`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/setup.py` & `bigframes-1.7.0/setup.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/__init__.py` & `bigframes-1.7.0/tests/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/data/hockey_players.json` & `bigframes-1.7.0/tests/data/hockey_players.json`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/data/hockey_players.jsonl` & `bigframes-1.7.0/tests/data/hockey_players.jsonl`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/data/nested.jsonl` & `bigframes-1.7.0/tests/data/nested.jsonl`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/data/nested_schema.json` & `bigframes-1.7.0/tests/data/nested_schema.json`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/data/penguins.jsonl` & `bigframes-1.7.0/tests/data/penguins.jsonl`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/data/penguins_schema.json` & `bigframes-1.7.0/tests/data/penguins_schema.json`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/data/scalars.jsonl` & `bigframes-1.7.0/tests/data/scalars.jsonl`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/data/scalars_schema.json` & `bigframes-1.7.0/tests/data/scalars_schema.json`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/data/time_series.jsonl` & `bigframes-1.7.0/tests/data/time_series.jsonl`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/__init__.py` & `bigframes-1.7.0/tests/system/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/conftest.py` & `bigframes-1.7.0/tests/system/conftest.py`

 * *Files 0% similar despite different names*

```diff
@@ -388,14 +388,24 @@
     scalars_table_id: str, session: bigframes.Session
 ) -> bigframes.dataframe.DataFrame:
     """DataFrame pointing at test data."""
     return session.read_gbq(scalars_table_id, index_col="rowindex")
 
 
 @pytest.fixture(scope="session")
+def scalars_df_empty_index(
+    scalars_table_id: str, session: bigframes.Session
+) -> bigframes.dataframe.DataFrame:
+    """DataFrame pointing at test data."""
+    return session.read_gbq(
+        scalars_table_id, index_col=bigframes.enums.DefaultIndexKind.NULL
+    ).sort_values("rowindex")
+
+
+@pytest.fixture(scope="session")
 def scalars_df_2_default_index(
     scalars_df_2_index: bigframes.dataframe.DataFrame,
 ) -> bigframes.dataframe.DataFrame:
     """DataFrame pointing at test data."""
     return scalars_df_2_index.reset_index(drop=False)
 
 
@@ -1036,25 +1046,25 @@
                 float(1.23124 * (2**70)),
                 pd.NA,
             ]
         },
         dtype=pd.Float64Dtype(),
     )
     # Index helps debug failed cases
-    df.index = df.float64_col
+    df.index = df.float64_col  # type: ignore
     # Upload fails if index name same as column name
     df.index.name = None
     return df.float64_col
 
 
 @pytest.fixture()
 def floats_product_pd(floats_pd):
     df = pd.merge(floats_pd, floats_pd, how="cross")
     # Index helps debug failed cases
-    df = df.set_index([df.float64_col_x, df.float64_col_y])
+    df = df.set_index([df.float64_col_x, df.float64_col_y])  # type: ignore
     df.index.names = ["left", "right"]
     return df
 
 
 @pytest.fixture()
 def floats_bf(session, floats_pd):
     return session.read_pandas(floats_pd.to_frame()).float64_col
```

### Comparing `bigframes-1.6.0/tests/system/large/__init__.py` & `bigframes-1.7.0/tests/system/large/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/large/ml/test_cluster.py` & `bigframes-1.7.0/tests/system/large/ml/test_cluster.py`

 * *Files 7% similar despite different names*

```diff
@@ -9,21 +9,19 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import pandas as pd
-import pytest
 
 from bigframes.ml import cluster
-from tests.system.utils import assert_pandas_df_equal
+from tests.system import utils
 
 
-@pytest.mark.flaky(retries=2)
 def test_cluster_configure_fit_score_predict(
     session, penguins_df_default_index, dataset_id
 ):
     model = cluster.KMeans(n_clusters=3, init="random")
 
     df = penguins_df_default_index.dropna()[
         [
@@ -84,39 +82,32 @@
     )
     pd_new_penguins.index.name = "observation"
 
     new_penguins = session.read_pandas(pd_new_penguins)
 
     # Check score to ensure the model was fitted
     score_result = model.score(new_penguins).to_pandas()
-    score_expected = pd.DataFrame(
-        {"davies_bouldin_index": [1.502182], "mean_squared_distance": [1.953408]},
-        dtype="Float64",
-    )
-    score_expected = score_expected.reindex(index=score_expected.index.astype("Int64"))
 
-    pd.testing.assert_frame_equal(
-        score_result, score_expected, check_exact=False, rtol=0.1
-    )
+    eval_metrics = ["davies_bouldin_index", "mean_squared_distance"]
+    utils.check_pandas_df_schema_and_index(score_result, columns=eval_metrics, index=1)
 
     predictions = model.predict(new_penguins).to_pandas()
     assert predictions.shape == (4, 9)
-    result = predictions[["CENTROID_ID"]]
-    expected = pd.DataFrame(
-        {"CENTROID_ID": [2, 3, 1, 2]},
-        dtype="Int64",
-        index=pd.Index(["test1", "test2", "test3", "test4"], dtype="string[pyarrow]"),
+    utils.check_pandas_df_schema_and_index(
+        predictions,
+        columns=["CENTROID_ID"],
+        index=["test1", "test2", "test3", "test4"],
+        col_exact=False,
     )
-    expected.index.name = "observation"
-    assert_pandas_df_equal(result, expected, ignore_order=True)
 
     # save, load, check n_clusters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_cluster_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_cluster_model"
         in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.n_clusters == 3
     assert reloaded_model.init == "RANDOM"
     assert reloaded_model.distance_type == "EUCLIDEAN"
@@ -149,14 +140,15 @@
 
     model.fit(df)
 
     # save, load, check n_clusters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_cluster_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_cluster_model"
         in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.n_clusters == 4
     assert reloaded_model.init == "RANDOM"
     assert reloaded_model.distance_type == "COSINE"
```

### Comparing `bigframes-1.6.0/tests/system/large/ml/test_core.py` & `bigframes-1.7.0/tests/system/small/ml/test_decomposition.py`

 * *Files 27% similar despite different names*

```diff
@@ -8,184 +8,204 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-import pandas
-import pytest
+import pandas as pd
 
-from bigframes.ml import globals
+from bigframes.ml import decomposition
+import bigframes.pandas as bpd
+import tests.system.utils
 
 
-# TODO(garrettwu): Re-enable or not check exact numbers.
-@pytest.mark.skip(reason="bqml regression")
-def test_bqml_e2e(session, dataset_id, penguins_df_default_index, new_penguins_df):
-    df = penguins_df_default_index.dropna()
-    X_train = df[
-        [
-            "species",
-            "island",
-            "culmen_length_mm",
-            "culmen_depth_mm",
-            "flipper_length_mm",
-            "sex",
-        ]
-    ]
-    y_train = df[["body_mass_g"]]
-
-    model = globals.bqml_model_factory().create_model(
-        X_train, y_train, options={"model_type": "linear_reg"}
-    )
-
-    # no data - report evaluation from the automatic data split
-    evaluate_result = model.evaluate().to_pandas()
-    evaluate_expected = pandas.DataFrame(
+def test_pca_predict(
+    penguins_pca_model: decomposition.PCA, new_penguins_df: bpd.DataFrame
+):
+    predictions = penguins_pca_model.predict(new_penguins_df).to_pandas()
+    expected = pd.DataFrame(
         {
-            "mean_absolute_error": [225.817334],
-            "mean_squared_error": [80540.705944],
-            "mean_squared_log_error": [0.004972],
-            "median_absolute_error": [173.080816],
-            "r2_score": [0.87529],
-            "explained_variance": [0.87529],
+            "principal_component_1": [-1.314041, -0.855813, -1.848786],
+            "principal_component_2": [-0.889106, -1.259753, -0.983304],
+            "principal_component_3": [-0.704345, 0.322555, -0.095759],
         },
         dtype="Float64",
-    )
-    evaluate_expected = evaluate_expected.reindex(
-        index=evaluate_expected.index.astype("Int64")
-    )
-    pandas.testing.assert_frame_equal(
-        evaluate_result, evaluate_expected, check_exact=False, rtol=0.1
+        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
     )
 
-    # evaluate on all training data
-    evaluate_result = model.evaluate(df).to_pandas()
-    pandas.testing.assert_frame_equal(
-        evaluate_result, evaluate_expected, check_exact=False, rtol=0.1
+    tests.system.utils.assert_pandas_df_equal_pca(
+        predictions, expected, check_exact=False, rtol=0.1
     )
 
-    # predict new labels
-    predictions = model.predict(new_penguins_df).to_pandas()
-    expected = pandas.DataFrame(
-        {"predicted_body_mass_g": [4030.1, 3280.8, 3177.9]},
-        dtype="Float64",
-        index=pandas.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
-    )
-    pandas.testing.assert_frame_equal(
-        predictions[["predicted_body_mass_g"]], expected, check_exact=False, rtol=0.1
-    )
 
-    new_name = f"{dataset_id}.my_model"
-    new_model = model.copy(new_name, True)
-    assert new_model.model_name == new_name
+def test_pca_detect_anomalies(
+    penguins_pca_model: decomposition.PCA, new_penguins_df: bpd.DataFrame
+):
+    anomalies = penguins_pca_model.detect_anomalies(new_penguins_df).to_pandas()
+    expected = pd.DataFrame(
+        {
+            "is_anomaly": [False, True, False],
+            "mean_squared_error": [0.254188, 0.731243, 0.298889],
+        },
+        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
+    )
 
-    fetch_result = session.bqclient.get_model(new_name)
-    assert fetch_result.model_type == "LINEAR_REGRESSION"
+    pd.testing.assert_frame_equal(
+        anomalies[["is_anomaly", "mean_squared_error"]].sort_index(),
+        expected,
+        check_exact=False,
+        check_dtype=False,
+        rtol=0.1,
+    )
 
 
-def test_bqml_manual_preprocessing_e2e(
-    session, dataset_id, penguins_df_default_index, new_penguins_df
+def test_pca_detect_anomalies_params(
+    penguins_pca_model: decomposition.PCA, new_penguins_df: bpd.DataFrame
 ):
-    base_sql_generator = globals.base_sql_generator()
-    bqml_model_factory = globals.bqml_model_factory()
-
-    df = penguins_df_default_index.dropna()
-    X_train = df[
-        [
-            "culmen_length_mm",
-            "culmen_depth_mm",
-            "flipper_length_mm",
-        ]
-    ]
-    y_train = df[["body_mass_g"]]
-    transforms = [
-        base_sql_generator.ml_standard_scaler(column, column)
-        for column in X_train.columns.tolist()
-    ]
-    transforms.extend(y_train.columns.tolist())
-    options = {"model_type": "linear_reg"}
-    model = bqml_model_factory.create_model(
-        X_train, y_train, transforms=transforms, options=options
-    )
-
-    # no data - report evaluation from the automatic data split
-    evaluate_result = model.evaluate().to_pandas()
-    evaluate_expected = pandas.DataFrame(
+    anomalies = penguins_pca_model.detect_anomalies(
+        new_penguins_df, contamination=0.2
+    ).to_pandas()
+    expected = pd.DataFrame(
         {
-            "mean_absolute_error": [309.477334],
-            "mean_squared_error": [152184.227218],
-            "mean_squared_log_error": [0.009524],
-            "median_absolute_error": [257.727777],
-            "r2_score": [0.764356],
-            "explained_variance": [0.764356],
+            "is_anomaly": [False, True, True],
+            "mean_squared_error": [0.254188, 0.731243, 0.298889],
         },
-        dtype="Float64",
-    )
-    evaluate_expected = evaluate_expected.reindex(
-        index=evaluate_expected.index.astype("Int64")
+        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
     )
 
-    pandas.testing.assert_frame_equal(
-        evaluate_result, evaluate_expected, check_exact=False, rtol=0.1
+    pd.testing.assert_frame_equal(
+        anomalies[["is_anomaly", "mean_squared_error"]].sort_index(),
+        expected,
+        check_exact=False,
+        check_dtype=False,
+        rtol=0.1,
     )
 
-    # evaluate on all training data
-    evaluate_result = model.evaluate(df).to_pandas()
-    pandas.testing.assert_frame_equal(
-        evaluate_result, evaluate_expected, check_exact=False, rtol=0.1
-    )
 
-    # predict new labels
-    predictions = model.predict(new_penguins_df).to_pandas()
-    expected = pandas.DataFrame(
-        {"predicted_body_mass_g": [3968.8, 3176.3, 3545.2]},
+def test_pca_score(penguins_pca_model: decomposition.PCA):
+    result = penguins_pca_model.score().to_pandas()
+    expected = pd.DataFrame(
+        {"total_explained_variance_ratio": [0.812383]},
         dtype="Float64",
-        index=pandas.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
     )
-    pandas.testing.assert_frame_equal(
-        predictions[["predicted_body_mass_g"]], expected, check_exact=False, rtol=0.1
+    pd.testing.assert_frame_equal(
+        result,
+        expected,
+        check_exact=False,
+        rtol=0.1,
+        check_index_type=False,
     )
 
-    new_name = f"{dataset_id}.my_model"
-    new_model = model.copy(new_name, True)
-    assert new_model.model_name == new_name
-
-    fetch_result = session.bqclient.get_model(new_name)
-    assert fetch_result.model_type == "LINEAR_REGRESSION"
 
+def test_pca_components_(penguins_pca_model: decomposition.PCA):
+    result = penguins_pca_model.components_.to_pandas()
 
-def test_bqml_standalone_transform(penguins_df_default_index, new_penguins_df):
-    bqml_model_factory = globals.bqml_model_factory()
+    # result is too long, only check the first principal component here.
+    result = result.head(7)
+    expected = (
+        pd.DataFrame(
+            {
+                "principal_component_id": [0] * 7,
+                "feature": [
+                    "species",
+                    "island",
+                    "culmen_length_mm",
+                    "culmen_depth_mm",
+                    "flipper_length_mm",
+                    "body_mass_g",
+                    "sex",
+                ],
+                "numerical_value": [
+                    pd.NA,
+                    pd.NA,
+                    0.401489,
+                    -0.377482,
+                    0.524052,
+                    0.501174,
+                    pd.NA,
+                ],
+                "categorical_value": [
+                    [
+                        {
+                            "category": "Gentoo penguin (Pygoscelis papua)",
+                            "value": 0.25068877125667804,
+                        },
+                        {
+                            "category": "Adelie Penguin (Pygoscelis adeliae)",
+                            "value": -0.20622291900416198,
+                        },
+                        {
+                            "category": "Chinstrap penguin (Pygoscelis antarctica)",
+                            "value": -0.030161149275185855,
+                        },
+                    ],
+                    [
+                        {"category": "Biscoe", "value": 0.19761120114410635},
+                        {"category": "Dream", "value": -0.11264736305259061},
+                        {"category": "Torgersen", "value": -0.07065913511418596},
+                    ],
+                    [],
+                    [],
+                    [],
+                    [],
+                    [
+                        {"category": ".", "value": 0.0015916894448071784},
+                        {"category": "MALE", "value": 0.06869704739750442},
+                        {"category": "FEMALE", "value": -0.052521171596813174},
+                        {"category": "_null_filler", "value": -0.0034628622681684906},
+                    ],
+                ],
+            },
+        )
+        .sort_values(["principal_component_id", "feature"])
+        .reset_index(drop=True)
+    )
 
-    X = penguins_df_default_index[["culmen_length_mm", "species"]]
-    model = bqml_model_factory.create_model(
-        X,
-        options={"model_type": "transform_only"},
-        transforms=[
-            "ML.STANDARD_SCALER(culmen_length_mm) OVER() AS scaled_culmen_length_mm",
-            "ML.ONE_HOT_ENCODER(species, 'none', 1000000, 0) OVER() AS onehotencoded_species",
-        ],
+    tests.system.utils.assert_pandas_df_equal_pca_components(
+        result,
+        expected,
+        check_exact=False,
+        rtol=0.1,
+        check_index_type=False,
+        check_dtype=False,
     )
 
-    transformed = model.transform(new_penguins_df).to_pandas()
-    expected = pandas.DataFrame(
+
+def test_pca_explained_variance_(penguins_pca_model: decomposition.PCA):
+    result = penguins_pca_model.explained_variance_.to_pandas()
+
+    expected = pd.DataFrame(
         {
-            "scaled_culmen_length_mm": [-0.8099, -0.9931, -1.103],
-            "onehotencoded_species": [
-                [{"index": 1, "value": 1.0}],
-                [{"index": 1, "value": 1.0}],
-                [{"index": 2, "value": 1.0}],
-            ],
+            "principal_component_id": [0, 1, 2],
+            "explained_variance": [3.278657, 1.270829, 1.125354],
         },
-        index=pandas.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
     )
-    expected["scaled_culmen_length_mm"] = expected["scaled_culmen_length_mm"].astype(
-        "Float64"
+    tests.system.utils.assert_pandas_df_equal(
+        result,
+        expected,
+        check_exact=False,
+        rtol=0.1,
+        check_index_type=False,
+        check_dtype=False,
+        ignore_order=True,
+    )
+
+
+def test_pca_explained_variance_ratio_(penguins_pca_model: decomposition.PCA):
+    result = penguins_pca_model.explained_variance_ratio_.to_pandas()
+
+    expected = pd.DataFrame(
+        {
+            "principal_component_id": [0, 1, 2],
+            "explained_variance_ratio": [0.469357, 0.181926, 0.1611],
+        },
     )
-    pandas.testing.assert_frame_equal(
-        transformed[["scaled_culmen_length_mm", "onehotencoded_species"]],
+    tests.system.utils.assert_pandas_df_equal(
+        result,
         expected,
         check_exact=False,
         rtol=0.1,
+        check_index_type=False,
         check_dtype=False,
+        ignore_order=True,
     )
```

### Comparing `bigframes-1.6.0/tests/system/large/ml/test_decomposition.py` & `bigframes-1.7.0/tests/system/large/ml/test_decomposition.py`

 * *Files 14% similar despite different names*

```diff
@@ -11,15 +11,15 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import pandas as pd
 
 from bigframes.ml import decomposition
-import tests.system.utils
+from tests.system import utils
 
 
 def test_decomposition_configure_fit_score_predict(
     session, penguins_df_default_index, dataset_id
 ):
     model = decomposition.PCA(n_components=3)
     model.fit(penguins_df_default_index)
@@ -41,48 +41,34 @@
                 "sex": ["MALE", "FEMALE", "MALE"],
             }
         ).set_index("tag_number")
     )
 
     # Check score to ensure the model was fitted
     score_result = model.score(new_penguins).to_pandas()
-    score_expected = pd.DataFrame(
-        {
-            "total_explained_variance_ratio": [0.812383],
-        },
-        dtype="Float64",
-    )
-    score_expected = score_expected.reindex(index=score_expected.index.astype("Int64"))
-
-    pd.testing.assert_frame_equal(
-        score_result, score_expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        score_result, columns=["total_explained_variance_ratio"], index=1
     )
 
     result = model.predict(new_penguins).to_pandas()
-    expected = pd.DataFrame(
-        {
-            "principal_component_1": [-1.459, 2.258, -1.685],
-            "principal_component_2": [-1.120, -1.351, -0.874],
-            "principal_component_3": [-0.646, 0.443, -0.704],
-        },
-        dtype="Float64",
-        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
-    )
-
-    tests.system.utils.assert_pandas_df_equal_pca(
+    utils.check_pandas_df_schema_and_index(
         result,
-        expected,
-        check_exact=False,
-        rtol=0.1,
+        columns=[
+            "principal_component_1",
+            "principal_component_2",
+            "principal_component_3",
+        ],
+        index=[1633, 1672, 1690],
     )
 
     # save, load, check n_components to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_pca_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_pca_model"
         in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.n_components == 3
 
 
@@ -109,50 +95,36 @@
                 "sex": ["MALE", "FEMALE", "MALE"],
             }
         ).set_index("tag_number")
     )
 
     # Check score to ensure the model was fitted
     score_result = model.score(new_penguins).to_pandas()
-    score_expected = pd.DataFrame(
-        {
-            "total_explained_variance_ratio": [0.932897],
-        },
-        dtype="Float64",
-    )
-    score_expected = score_expected.reindex(index=score_expected.index.astype("Int64"))
-
-    pd.testing.assert_frame_equal(
-        score_result, score_expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        score_result, columns=["total_explained_variance_ratio"], index=1
     )
 
     result = model.predict(new_penguins).to_pandas()
-    expected = pd.DataFrame(
-        {
-            "principal_component_1": [-1.459, 2.258, -1.685],
-            "principal_component_2": [-1.120, -1.351, -0.874],
-            "principal_component_3": [-0.646, 0.443, -0.704],
-            "principal_component_4": [-0.539, 0.234, -0.571],
-            "principal_component_5": [-0.876, 0.122, 0.609],
-        },
-        dtype="Float64",
-        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
-    )
-
-    tests.system.utils.assert_pandas_df_equal_pca(
+    utils.check_pandas_df_schema_and_index(
         result,
-        expected,
-        check_exact=False,
-        rtol=0.1,
+        columns=[
+            "principal_component_1",
+            "principal_component_2",
+            "principal_component_3",
+            "principal_component_4",
+            "principal_component_5",
+        ],
+        index=[1633, 1672, 1690],
     )
 
     # save, load, check n_components to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_pca_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_pca_model"
         in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.n_components == 5
     assert reloaded_model.svd_solver == "RANDOMIZED"
 
@@ -163,14 +135,15 @@
     model = decomposition.PCA(n_components=0.2)
     model.fit(penguins_df_default_index)
 
     # save, load, check n_components to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_pca_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_pca_model"
         in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.n_components == 0.2
 
 
@@ -180,12 +153,13 @@
     model = decomposition.PCA(n_components=None)
     model.fit(penguins_df_default_index)
 
     # save, load, check n_components. Here n_components is the column size of the training input.
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_pca_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_pca_model"
         in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.n_components == 7
```

### Comparing `bigframes-1.6.0/tests/system/large/ml/test_ensemble.py` & `bigframes-1.7.0/tests/system/large/ml/test_ensemble.py`

 * *Files 18% similar despite different names*

```diff
@@ -8,24 +8,20 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-from unittest import TestCase
-
-import pandas
 import pytest
 
 import bigframes.ml.ensemble
+from tests.system import utils
 
 
-# TODO(garrettwu): Re-enable or not check exact numbers.
-@pytest.mark.skip(reason="bqml regression")
 @pytest.mark.flaky(retries=2)
 def test_xgbregressor_default_params(penguins_df_default_index, dataset_id):
     model = bigframes.ml.ensemble.XGBRegressor()
 
     df = penguins_df_default_index.dropna()
     X_train = df[
         [
@@ -38,32 +34,23 @@
         ]
     ]
     y_train = df[["body_mass_g"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    expected = pandas.DataFrame(
-        {
-            "mean_absolute_error": [97.368139],
-            "mean_squared_error": [16284.877027],
-            "mean_squared_log_error": [0.0010189],
-            "median_absolute_error": [72.158691],
-            "r2_score": [0.974784],
-            "explained_variance": [0.974845],
-        },
-        dtype="Float64",
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_REGRESSION_METRICS, index=1
     )
-    expected = expected.reindex(index=expected.index.astype("Int64"))
-    pandas.testing.assert_frame_equal(result, expected, check_exact=False, rtol=0.1)
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_xgbregressor_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_xgbregressor_model"
         in reloaded_model._bqml_model.model_name
     )
 
 
 @pytest.mark.flaky(retries=2)
@@ -99,29 +86,23 @@
         ]
     ]
     y_train = df[["body_mass_g"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    TestCase().assertSequenceEqual(result.shape, (1, 6))
-    for col_name in [
-        "mean_absolute_error",
-        "mean_squared_error",
-        "mean_squared_log_error",
-        "median_absolute_error",
-        "r2_score",
-        "explained_variance",
-    ]:
-        assert col_name in result.columns
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_REGRESSION_METRICS, index=1
+    )
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_xgbregressor_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_xgbregressor_model"
         in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.booster == "DART"
     assert reloaded_model.dart_normalized_type == "TREE"
     assert reloaded_model.tree_method == "AUTO"
@@ -155,36 +136,30 @@
         ]
     ]
     y_train = df[["sex"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    TestCase().assertSequenceEqual(result.shape, (1, 6))
-    for col_name in [
-        "precision",
-        "recall",
-        "accuracy",
-        "f1_score",
-        "log_loss",
-        "roc_auc",
-    ]:
-        assert col_name in result.columns
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_CLASSFICATION_METRICS, index=1
+    )
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_xgbclassifier_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_xgbclassifier_model"
         in reloaded_model._bqml_model.model_name
     )
 
 
-@pytest.mark.flaky(retries=2)
+# @pytest.mark.flaky(retries=2)
 def test_xgbclassifier_dart_booster_multiple_params(
     penguins_df_default_index, dataset_id
 ):
     model = bigframes.ml.ensemble.XGBClassifier(
         booster="dart",
         tree_method="auto",
         min_tree_child_weight=2,
@@ -212,29 +187,23 @@
         ]
     ]
     y_train = df[["sex"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    TestCase().assertSequenceEqual(result.shape, (1, 6))
-    for col_name in [
-        "precision",
-        "recall",
-        "accuracy",
-        "f1_score",
-        "log_loss",
-        "roc_auc",
-    ]:
-        assert col_name in result.columns
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_CLASSFICATION_METRICS, index=1
+    )
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_xgbclassifier_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_xgbclassifier_model"
         in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.booster == "DART"
     assert reloaded_model.dart_normalized_type == "TREE"
     assert reloaded_model.tree_method == "AUTO"
@@ -269,29 +238,23 @@
         ]
     ]
     y_train = df[["body_mass_g"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    TestCase().assertSequenceEqual(result.shape, (1, 6))
-    for col_name in [
-        "mean_absolute_error",
-        "mean_squared_error",
-        "mean_squared_log_error",
-        "median_absolute_error",
-        "r2_score",
-        "explained_variance",
-    ]:
-        assert col_name in result.columns
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_REGRESSION_METRICS, index=1
+    )
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_randomforestregressor_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_randomforestregressor_model"
         in reloaded_model._bqml_model.model_name
     )
 
 
 @pytest.mark.flaky(retries=2)
@@ -322,29 +285,23 @@
         ]
     ]
     y_train = df[["body_mass_g"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    TestCase().assertSequenceEqual(result.shape, (1, 6))
-    for col_name in [
-        "mean_absolute_error",
-        "mean_squared_error",
-        "mean_squared_log_error",
-        "median_absolute_error",
-        "r2_score",
-        "explained_variance",
-    ]:
-        assert col_name in result.columns
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_REGRESSION_METRICS, index=1
+    )
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_randomforestregressor_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_randomforestregressor_model"
         in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.tree_method == "AUTO"
     assert reloaded_model.colsample_bytree == 0.95
     assert reloaded_model.colsample_bylevel == 0.95
@@ -375,39 +332,33 @@
         ]
     ]
     y_train = df[["sex"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    TestCase().assertSequenceEqual(result.shape, (1, 6))
-    for col_name in [
-        "precision",
-        "recall",
-        "accuracy",
-        "f1_score",
-        "log_loss",
-        "roc_auc",
-    ]:
-        assert col_name in result.columns
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_CLASSFICATION_METRICS, index=1
+    )
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_randomforestclassifier_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_randomforestclassifier_model"
         in reloaded_model._bqml_model.model_name
     )
 
 
 @pytest.mark.flaky(retries=2)
 def test_randomforestclassifier_multiple_params(penguins_df_default_index, dataset_id):
     model = bigframes.ml.ensemble.RandomForestClassifier(
-        tree_method="AUTO",
+        tree_method="auto",
         min_tree_child_weight=2,
         colsample_bytree=0.95,
         colsample_bylevel=0.95,
         colsample_bynode=0.95,
         n_estimators=90,
         max_depth=14,
         subsample=0.95,
@@ -427,34 +378,28 @@
         ]
     ]
     y_train = df[["sex"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    TestCase().assertSequenceEqual(result.shape, (1, 6))
-    for col_name in [
-        "precision",
-        "recall",
-        "accuracy",
-        "f1_score",
-        "log_loss",
-        "roc_auc",
-    ]:
-        assert col_name in result.columns
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_CLASSFICATION_METRICS, index=1
+    )
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_randomforestclassifier_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_randomforestclassifier_model"
         in reloaded_model._bqml_model.model_name
     )
-    assert reloaded_model.tree_method == "AUTO"
+    assert reloaded_model.tree_method == "auto"
     assert reloaded_model.colsample_bytree == 0.95
     assert reloaded_model.colsample_bylevel == 0.95
     assert reloaded_model.colsample_bynode == 0.95
     assert reloaded_model.subsample == 0.95
     assert reloaded_model.reg_alpha == 0.0001
     assert reloaded_model.reg_lambda == 0.0001
     assert reloaded_model.tol == 0.02
```

### Comparing `bigframes-1.6.0/tests/system/large/ml/test_forecasting.py` & `bigframes-1.7.0/tests/system/large/ml/test_forecasting.py`

 * *Files 12% similar despite different names*

```diff
@@ -8,23 +8,24 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-import pandas as pd
 import pytest
 
 from bigframes.ml import forecasting
+from tests.system import utils
 
 ARIMA_EVALUATE_OUTPUT_COL = [
     "non_seasonal_p",
     "non_seasonal_d",
     "non_seasonal_q",
+    "has_drift",
     "log_likelihood",
     "AIC",
     "variance",
     "seasonal_periods",
     "has_holiday_effect",
     "has_spikes_and_dips",
     "has_step_changes",
@@ -46,59 +47,58 @@
     new_time_series_df,
     arima_model,
 ):
 
     result = arima_model.score(
         new_time_series_df[["parsed_date"]], new_time_series_df[["total_visits"]]
     ).to_pandas()
-    expected = pd.DataFrame(
-        {
-            "mean_absolute_error": [154.742547],
-            "mean_squared_error": [26844.868855],
-            "root_mean_squared_error": [163.844038],
-            "mean_absolute_percentage_error": [6.189702],
-            "symmetric_mean_absolute_percentage_error": [6.097155],
-        },
-        dtype="Float64",
+    utils.check_pandas_df_schema_and_index(
+        result,
+        columns=[
+            "mean_absolute_error",
+            "mean_squared_error",
+            "root_mean_squared_error",
+            "mean_absolute_percentage_error",
+            "symmetric_mean_absolute_percentage_error",
+        ],
+        index=1,
     )
-    expected = expected.reindex(index=expected.index.astype("Int64"))
-    pd.testing.assert_frame_equal(result, expected, check_exact=False, rtol=0.1)
 
     # save, load to ensure configuration was kept
     reloaded_model = arima_model.to_gbq(
         f"{dataset_id}.temp_arima_plus_model", replace=True
     )
     assert (
         f"{dataset_id}.temp_arima_plus_model" in reloaded_model._bqml_model.model_name
     )
 
 
 def test_arima_plus_model_fit_summary(dataset_id, arima_model):
-
-    result = arima_model.summary()
-    assert result.shape == (1, 12)
-    assert all(column in result.columns for column in ARIMA_EVALUATE_OUTPUT_COL)
+    result = arima_model.summary().to_pandas()
+    utils.check_pandas_df_schema_and_index(
+        result, columns=ARIMA_EVALUATE_OUTPUT_COL, index=1
+    )
 
     # save, load to ensure configuration was kept
     reloaded_model = arima_model.to_gbq(
         f"{dataset_id}.temp_arima_plus_model", replace=True
     )
     assert (
         f"{dataset_id}.temp_arima_plus_model" in reloaded_model._bqml_model.model_name
     )
 
 
 def test_arima_coefficients(arima_model):
-    got = arima_model.coef_
-    expected_columns = {
+    result = arima_model.coef_.to_pandas()
+    expected_columns = [
         "ar_coefficients",
         "ma_coefficients",
         "intercept_or_drift",
-    }
-    assert set(got.columns) == expected_columns
+    ]
+    utils.check_pandas_df_schema_and_index(result, columns=expected_columns, index=1)
 
 
 def test_arima_plus_model_fit_params(time_series_df_default_index, dataset_id):
     model = forecasting.ARIMAPlus(
         horizon=100,
         auto_arima=True,
         auto_arima_max_order=4,
@@ -115,14 +115,15 @@
 
     X_train = time_series_df_default_index[["parsed_date"]]
     y_train = time_series_df_default_index[["total_visits"]]
     model.fit(X_train, y_train)
 
     # save, load to ensure configuration was kept
     reloaded_model = model.to_gbq(f"{dataset_id}.temp_arima_plus_model", replace=True)
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_arima_plus_model" in reloaded_model._bqml_model.model_name
     )
 
     assert reloaded_model.horizon == 100
     assert reloaded_model.auto_arima is True
     assert reloaded_model.auto_arima_max_order == 4
```

### Comparing `bigframes-1.6.0/tests/system/large/ml/test_linear_model.py` & `bigframes-1.7.0/tests/system/large/ml/test_linear_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -8,17 +8,16 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-import pandas as pd
-
 import bigframes.ml.linear_model
+from tests.system import utils
 
 
 def test_linear_regression_configure_fit_score(penguins_df_default_index, dataset_id):
     model = bigframes.ml.linear_model.LinearRegression()
 
     df = penguins_df_default_index.dropna()
     X_train = df[
@@ -32,30 +31,21 @@
         ]
     ]
     y_train = df[["body_mass_g"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    expected = pd.DataFrame(
-        {
-            "mean_absolute_error": [225.735767],
-            "mean_squared_error": [80417.461828],
-            "mean_squared_log_error": [0.004967],
-            "median_absolute_error": [172.543702],
-            "r2_score": [0.87548],
-            "explained_variance": [0.87548],
-        },
-        dtype="Float64",
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_REGRESSION_METRICS, index=1
     )
-    expected = expected.reindex(index=expected.index.astype("Int64"))
-    pd.testing.assert_frame_equal(result, expected, check_exact=False, rtol=0.1)
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(f"{dataset_id}.temp_configured_model", replace=True)
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_model" in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.optimize_strategy == "NORMAL_EQUATION"
     assert reloaded_model.fit_intercept is True
     assert reloaded_model.calculate_p_values is False
     assert reloaded_model.enable_global_explain is False
@@ -94,30 +84,21 @@
         ]
     ]
     y_train = df[["body_mass_g"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    expected = pd.DataFrame(
-        {
-            "mean_absolute_error": [240],
-            "mean_squared_error": [91197],
-            "mean_squared_log_error": [0.00573],
-            "median_absolute_error": [197],
-            "r2_score": [0.858],
-            "explained_variance": [0.8588],
-        },
-        dtype="Float64",
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_REGRESSION_METRICS, index=1
     )
-    expected = expected.reindex(index=expected.index.astype("Int64"))
-    pd.testing.assert_frame_equal(result, expected, check_exact=False, rtol=0.1)
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(f"{dataset_id}.temp_configured_model", replace=True)
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_model" in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.optimize_strategy == "BATCH_GRADIENT_DESCENT"
     assert reloaded_model.fit_intercept is False
     assert reloaded_model.calculate_p_values is False
     assert reloaded_model.enable_global_explain is False
@@ -148,32 +129,23 @@
         ]
     ]
     y_train = df[["sex"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    expected = pd.DataFrame(
-        {
-            "precision": [0.616753],
-            "recall": [0.618615],
-            "accuracy": [0.92515],
-            "f1_score": [0.617681],
-            "log_loss": [1.498832],
-            "roc_auc": [0.975807],
-        },
-        dtype="Float64",
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_CLASSFICATION_METRICS, index=1
     )
-    expected = expected.reindex(index=expected.index.astype("Int64"))
-    pd.testing.assert_frame_equal(result, expected, check_exact=False, rtol=0.1)
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_logistic_reg_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_logistic_reg_model"
         in reloaded_model._bqml_model.model_name
     )
     assert reloaded_model.fit_intercept is True
     assert reloaded_model.class_weight is None
 
@@ -203,32 +175,23 @@
         ]
     ]
     y_train = df[["sex"]]
     model.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     result = model.score(X_train, y_train).to_pandas()
-    expected = pd.DataFrame(
-        {
-            "precision": [0.487],
-            "recall": [0.602],
-            "accuracy": [0.464],
-            "f1_score": [0.379],
-            "log_loss": [0.972],
-            "roc_auc": [0.700],
-        },
-        dtype="Float64",
+    utils.check_pandas_df_schema_and_index(
+        result, columns=utils.ML_CLASSFICATION_METRICS, index=1
     )
-    expected = expected.reindex(index=expected.index.astype("Int64"))
-    pd.testing.assert_frame_equal(result, expected, check_exact=False, rtol=0.1)
 
     # save, load, check parameters to ensure configuration was kept
     reloaded_model = model.to_gbq(
         f"{dataset_id}.temp_configured_logistic_reg_model", replace=True
     )
+    assert reloaded_model._bqml_model is not None
     assert (
         f"{dataset_id}.temp_configured_logistic_reg_model"
         in reloaded_model._bqml_model.model_name
     )
     # TODO(garrettwu) optimize_strategy isn't logged in BQML
     # assert reloaded_model.optimize_strategy == "BATCH_GRADIENT_DESCENT"
     assert reloaded_model.fit_intercept is False
```

### Comparing `bigframes-1.6.0/tests/system/large/ml/test_pipeline.py` & `bigframes-1.7.0/tests/system/large/ml/test_pipeline.py`

 * *Files 11% similar despite different names*

```diff
@@ -20,15 +20,15 @@
     compose,
     decomposition,
     ensemble,
     linear_model,
     pipeline,
     preprocessing,
 )
-from tests.system.utils import assert_pandas_df_equal, assert_pandas_df_equal_pca
+from tests.system import utils
 
 
 def test_pipeline_linear_regression_fit_score_predict(
     session, penguins_df_default_index
 ):
     """Test a supervised model with a minimal preprocessing step"""
     pl = pipeline.Pipeline(
@@ -47,29 +47,16 @@
         ]
     ]
     y_train = df[["body_mass_g"]]
     pl.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     score_result = pl.score(X_train, y_train).to_pandas()
-    score_expected = pd.DataFrame(
-        {
-            "mean_absolute_error": [309.477331],
-            "mean_squared_error": [152184.227219],
-            "mean_squared_log_error": [0.009524],
-            "median_absolute_error": [257.728263],
-            "r2_score": [0.764356],
-            "explained_variance": [0.764356],
-        },
-        dtype="Float64",
-    )
-    score_expected = score_expected.reindex(index=score_expected.index.astype("Int64"))
-
-    pd.testing.assert_frame_equal(
-        score_result, score_expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        score_result, columns=utils.ML_REGRESSION_METRICS, index=1
     )
 
     # predict new labels
     new_penguins = session.read_pandas(
         pd.DataFrame(
             {
                 "tag_number": [1633, 1672, 1690],
@@ -83,21 +70,19 @@
                 "culmen_depth_mm": [18.8, 17.2, 18.1],
                 "flipper_length_mm": [196.0, 181.0, 188.0],
                 "sex": ["MALE", "FEMALE", "FEMALE"],
             }
         ).set_index("tag_number")
     )
     predictions = pl.predict(new_penguins).to_pandas()
-    expected = pd.DataFrame(
-        {"predicted_body_mass_g": [3968.8, 3176.3, 3545.2]},
-        dtype="Float64",
-        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
-    )
-    pd.testing.assert_frame_equal(
-        predictions[["predicted_body_mass_g"]], expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        predictions,
+        columns=["predicted_body_mass_g"],
+        index=[1633, 1672, 1690],
+        col_exact=False,
     )
 
 
 def test_pipeline_linear_regression_series_fit_score_predict(
     session, penguins_df_default_index
 ):
     """Test a supervised model with a minimal preprocessing step"""
@@ -111,48 +96,33 @@
     df = penguins_df_default_index.dropna()
     X_train = df["culmen_length_mm"]
     y_train = df["body_mass_g"]
     pl.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     score_result = pl.score(X_train, y_train).to_pandas()
-    score_expected = pd.DataFrame(
-        {
-            "mean_absolute_error": [528.495599],
-            "mean_squared_error": [421722.261808],
-            "mean_squared_log_error": [0.022963],
-            "median_absolute_error": [468.895249],
-            "r2_score": [0.346999],
-            "explained_variance": [0.346999],
-        },
-        dtype="Float64",
-    )
-    score_expected = score_expected.reindex(index=score_expected.index.astype("Int64"))
-
-    pd.testing.assert_frame_equal(
-        score_result, score_expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        score_result, columns=utils.ML_REGRESSION_METRICS, index=1
     )
 
     # predict new labels
     new_penguins = session.read_pandas(
         pd.DataFrame(
             {
                 "tag_number": [1633, 1672, 1690],
                 "culmen_length_mm": [39.5, 38.5, 37.9],
             }
         ).set_index("tag_number")
     )
     predictions = pl.predict(new_penguins["culmen_length_mm"]).to_pandas()
-    expected = pd.DataFrame(
-        {"predicted_body_mass_g": [3818.845703, 3732.022253, 3679.928123]},
-        dtype="Float64",
-        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
-    )
-    pd.testing.assert_frame_equal(
-        predictions[["predicted_body_mass_g"]], expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        predictions,
+        columns=["predicted_body_mass_g"],
+        index=[1633, 1672, 1690],
+        col_exact=False,
     )
 
 
 def test_pipeline_logistic_regression_fit_score_predict(
     session, penguins_df_default_index
 ):
     """Test a supervised model with a minimal preprocessing step"""
@@ -172,29 +142,16 @@
         ]
     ]
     y_train = df[["sex"]]
     pl.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     score_result = pl.score(X_train, y_train).to_pandas()
-    score_expected = pd.DataFrame(
-        {
-            "precision": [0.537091],
-            "recall": [0.538636],
-            "accuracy": [0.805389],
-            "f1_score": [0.537716],
-            "log_loss": [1.445433],
-            "roc_auc": [0.917818],
-        },
-        dtype="Float64",
-    )
-    score_expected = score_expected.reindex(index=score_expected.index.astype("Int64"))
-
-    pd.testing.assert_frame_equal(
-        score_result, score_expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        score_result, columns=utils.ML_CLASSFICATION_METRICS, index=1
     )
 
     # predict new labels
     new_penguins = session.read_pandas(
         pd.DataFrame(
             {
                 "tag_number": [1633, 1672, 1690],
@@ -207,27 +164,22 @@
                 "culmen_length_mm": [39.5, 38.5, 37.9],
                 "culmen_depth_mm": [18.8, 17.2, 18.1],
                 "flipper_length_mm": [196.0, 181.0, 188.0],
             }
         ).set_index("tag_number")
     )
     predictions = pl.predict(new_penguins).to_pandas()
-    expected = pd.DataFrame(
-        {"predicted_sex": ["MALE", "FEMALE", "FEMALE"]},
-        dtype=pd.StringDtype(storage="pyarrow"),
-        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
-    )
-    pd.testing.assert_frame_equal(
-        predictions[["predicted_sex"]],
-        expected,
+    utils.check_pandas_df_schema_and_index(
+        predictions,
+        columns=["predicted_sex"],
+        index=[1633, 1672, 1690],
+        col_exact=False,
     )
 
 
-# TODO(garrettwu): Re-enable or not check exact numbers.
-@pytest.mark.skip(reason="bqml regression")
 @pytest.mark.flaky(retries=2)
 def test_pipeline_xgbregressor_fit_score_predict(session, penguins_df_default_index):
     """Test a supervised model with a minimal preprocessing step"""
     pl = pipeline.Pipeline(
         [
             ("scale", preprocessing.StandardScaler()),
             ("xgbreg", ensemble.XGBRegressor()),
@@ -243,29 +195,16 @@
         ]
     ]
     y_train = df[["body_mass_g"]]
     pl.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     score_result = pl.score(X_train, y_train).to_pandas()
-    score_expected = pd.DataFrame(
-        {
-            "mean_absolute_error": [202.298434],
-            "mean_squared_error": [74515.108971],
-            "mean_squared_log_error": [0.004365],
-            "median_absolute_error": [142.949219],
-            "r2_score": [0.88462],
-            "explained_variance": [0.886454],
-        },
-        dtype="Float64",
-    )
-    score_expected = score_expected.reindex(index=score_expected.index.astype("Int64"))
-
-    pd.testing.assert_frame_equal(
-        score_result, score_expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        score_result, columns=utils.ML_REGRESSION_METRICS, index=1
     )
 
     # predict new labels
     new_penguins = session.read_pandas(
         pd.DataFrame(
             {
                 "tag_number": [1633, 1672, 1690],
@@ -279,32 +218,22 @@
                 "culmen_depth_mm": [18.8, 17.2, 18.1],
                 "flipper_length_mm": [196.0, 181.0, 188.0],
                 "sex": ["MALE", "FEMALE", "FEMALE"],
             }
         ).set_index("tag_number")
     )
     predictions = pl.predict(new_penguins).to_pandas()
-    expected = pd.DataFrame(
-        {
-            "predicted_body_mass_g": [
-                4287.34521484375,
-                3198.351806640625,
-                3385.34130859375,
-            ]
-        },
-        dtype="Float64",
-        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
-    )
-    pd.testing.assert_frame_equal(
-        predictions[["predicted_body_mass_g"]], expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        predictions,
+        columns=["predicted_body_mass_g"],
+        index=[1633, 1672, 1690],
+        col_exact=False,
     )
 
 
-# TODO(garrettwu): Re-enable or not check exact numbers.
-@pytest.mark.skip(reason="bqml regression")
 @pytest.mark.flaky(retries=2)
 def test_pipeline_random_forest_classifier_fit_score_predict(
     session, penguins_df_default_index
 ):
     """Test a supervised model with a minimal preprocessing step"""
     pl = pipeline.Pipeline(
         [
@@ -322,29 +251,16 @@
         ]
     ]
     y_train = df[["sex"]]
     pl.fit(X_train, y_train)
 
     # Check score to ensure the model was fitted
     score_result = pl.score(X_train, y_train).to_pandas()
-    score_expected = pd.DataFrame(
-        {
-            "precision": [0.585505],
-            "recall": [0.58676],
-            "accuracy": [0.877246],
-            "f1_score": [0.585657],
-            "log_loss": [0.880643],
-            "roc_auc": [0.970697],
-        },
-        dtype="Float64",
-    )
-    score_expected = score_expected.reindex(index=score_expected.index.astype("Int64"))
-
-    pd.testing.assert_frame_equal(
-        score_result, score_expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        score_result, columns=utils.ML_CLASSFICATION_METRICS, index=1
     )
 
     # predict new labels
     new_penguins = session.read_pandas(
         pd.DataFrame(
             {
                 "tag_number": [1633, 1672, 1690],
@@ -357,22 +273,19 @@
                 "culmen_length_mm": [39.5, 38.5, 37.9],
                 "culmen_depth_mm": [18.8, 17.2, 18.1],
                 "flipper_length_mm": [196.0, 181.0, 188.0],
             }
         ).set_index("tag_number")
     )
     predictions = pl.predict(new_penguins).to_pandas()
-    expected = pd.DataFrame(
-        {"predicted_sex": ["MALE", "FEMALE", "FEMALE"]},
-        dtype=pd.StringDtype(storage="pyarrow"),
-        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
-    )
-    pd.testing.assert_frame_equal(
-        predictions[["predicted_sex"]],
-        expected,
+    utils.check_pandas_df_schema_and_index(
+        predictions,
+        columns=["predicted_sex"],
+        index=[1633, 1672, 1690],
+        col_exact=False,
     )
 
 
 def test_pipeline_PCA_fit_score_predict(session, penguins_df_default_index):
     """Test a supervised model with a minimal preprocessing step"""
     pl = pipeline.Pipeline(
         [
@@ -408,48 +321,28 @@
                 "sex": ["MALE", "FEMALE", "FEMALE"],
             }
         ).set_index("tag_number")
     )
 
     # Check score to ensure the model was fitted
     score_result = pl.score(new_penguins).to_pandas()
-    score_expected = pd.DataFrame(
-        {
-            "total_explained_variance_ratio": [1.0],
-        },
-        dtype="Float64",
-    )
-    score_expected = score_expected.reindex(index=score_expected.index.astype("Int64"))
-
-    pd.testing.assert_frame_equal(
-        score_result, score_expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        score_result, columns=["total_explained_variance_ratio"], index=1
     )
 
     predictions = pl.predict(new_penguins).to_pandas()
-    expected = pd.DataFrame(
-        {
-            "principal_component_1": [-1.115259, -1.506141, -1.471173],
-            "principal_component_2": [-0.074825, 0.69664, 0.406103],
-            "principal_component_3": [0.500013, -0.544479, 0.075849],
-        },
-        dtype="Float64",
-        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
-    )
-
-    assert_pandas_df_equal_pca(
-        predictions[
-            [
-                "principal_component_1",
-                "principal_component_2",
-                "principal_component_3",
-            ]
+    utils.check_pandas_df_schema_and_index(
+        predictions,
+        columns=[
+            "principal_component_1",
+            "principal_component_2",
+            "principal_component_3",
         ],
-        expected,
-        check_exact=False,
-        rtol=0.1,
+        index=[1633, 1672, 1690],
+        col_exact=False,
     )
 
 
 @pytest.mark.flaky(retries=2)
 def test_pipeline_standard_scaler_kmeans_fit_score_predict(
     session, penguins_pandas_df_default_index
 ):
@@ -534,37 +427,24 @@
     )
     pd_new_penguins.index.name = "observation"
 
     new_penguins = session.read_pandas(pd_new_penguins)
 
     # Check score to ensure the model was fitted
     score_result = pl.score(new_penguins).to_pandas()
-    score_expected = pd.DataFrame(
-        {"davies_bouldin_index": [7.542981], "mean_squared_distance": [94.692409]},
-        dtype="Float64",
-    )
-    score_expected = score_expected.reindex(index=score_expected.index.astype("Int64"))
-
-    pd.testing.assert_frame_equal(
-        score_result, score_expected, check_exact=False, rtol=0.1
-    )
+    eval_metrics = ["davies_bouldin_index", "mean_squared_distance"]
+    utils.check_pandas_df_schema_and_index(score_result, columns=eval_metrics, index=1)
 
     predictions = pl.predict(new_penguins).to_pandas().sort_index()
-    assert predictions.shape == (6, 9)
-    result = predictions[["CENTROID_ID"]]
-    expected = pd.DataFrame(
-        {"CENTROID_ID": [1, 2, 1, 2, 1, 2]},
-        dtype="Int64",
-        index=pd.Index(
-            ["test1", "test2", "test3", "test4", "test5", "test6"],
-            dtype="string[pyarrow]",
-        ),
+    utils.check_pandas_df_schema_and_index(
+        predictions,
+        columns=["CENTROID_ID"],
+        index=["test1", "test2", "test3", "test4", "test5", "test6"],
+        col_exact=False,
     )
-    expected.index.name = "observation"
-    assert_pandas_df_equal(result, expected, ignore_order=True)
 
 
 def test_pipeline_columntransformer_fit_predict(session, penguins_df_default_index):
     """Test a preprocessing step that manages heterogeneous data with ColumnTransformer"""
     pl = pipeline.Pipeline(
         [
             (
@@ -628,21 +508,19 @@
                 "culmen_depth_mm": [18.8, 17.2, 18.1],
                 "flipper_length_mm": [196.0, 181.0, 188.0],
                 "sex": ["MALE", "FEMALE", "FEMALE"],
             }
         ).set_index("tag_number")
     )
     predictions = pl.predict(new_penguins).to_pandas()
-    expected = pd.DataFrame(
-        {"predicted_body_mass_g": [3909.2, 3436.0, 2860.0]},
-        dtype="Float64",
-        index=pd.Index([1633, 1672, 1690], name="tag_number", dtype="Int64"),
-    )
-    pd.testing.assert_frame_equal(
-        predictions[["predicted_body_mass_g"]], expected, check_exact=False, rtol=0.1
+    utils.check_pandas_df_schema_and_index(
+        predictions,
+        columns=["predicted_body_mass_g"],
+        index=[1633, 1672, 1690],
+        col_exact=False,
     )
 
 
 def test_pipeline_columntransformer_to_gbq(penguins_df_default_index, dataset_id):
     pl = pipeline.Pipeline(
         [
             (
```

### Comparing `bigframes-1.6.0/tests/system/large/test_location.py` & `bigframes-1.7.0/tests/system/large/test_location.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/large/test_remote_function.py` & `bigframes-1.7.0/tests/system/large/test_remote_function.py`

 * *Files 0% similar despite different names*

```diff
@@ -88,15 +88,16 @@
         # TODO(shobs): Find a better way of modifying the udf, maybe regex?
         source_key = f"def {udf.__name__}"
         target_key = f"def {udf_uniq_name}"
         source_code = textwrap.dedent(inspect.getsource(udf))
         target_code = source_code.replace(source_key, target_key, 1)
         f.write(target_code)
     spec = importlib.util.spec_from_file_location(udf_file_name, udf_file_path)
-    udf_uniq = getattr(spec.loader.load_module(), udf_uniq_name)
+    # TODO(b/340875260): fix type error
+    udf_uniq = getattr(spec.loader.load_module(), udf_uniq_name)  # type: ignore
 
     # This is a bit of a hack but we need to remove the reference to a foreign
     # module, otherwise the serialization would keep the foreign module
     # reference and deserialization would fail with error like following:
     #     ModuleNotFoundError: No module named 'add_one_2nxcmd9j'
     # TODO(shobs): Figure out if there is a better way of generating the unique
     # function object, but for now let's just set it to same module as the
@@ -217,15 +218,15 @@
     finally:
         # clean up the gcp assets created for the remote function
         cleanup_remote_function_assets(
             bigquery_client, session.cloudfunctionsclient, stringify
         )
 
 
-# @pytest.mark.flaky(retries=2, delay=120)
+@pytest.mark.flaky(retries=2, delay=120)
 def test_remote_function_binop(session, scalars_dfs, dataset_id, bq_cf_connection):
     try:
 
         def func(x, y):
             return x * abs(y % 4)
 
         remote_func = session.remote_function(
```

### Comparing `bigframes-1.6.0/tests/system/large/test_session.py` & `bigframes-1.7.0/tests/system/large/test_session.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/load/test_large_tables.py` & `bigframes-1.7.0/tests/system/load/test_large_tables.py`

 * *Files 12% similar despite different names*

```diff
@@ -76,28 +76,31 @@
 
 def test_to_pandas_batches_large_table():
     df = bpd.read_gbq("load_testing.scalars_10gb")
     # df will be downloaded locally
     expected_row_count, expected_column_count = df.shape
 
     row_count = 0
-    for df in df.to_pandas_batches():
+    # TODO(b/340890167): fix type error
+    for df in df.to_pandas_batches():  # type: ignore
         batch_row_count, batch_column_count = df.shape
         assert batch_column_count == expected_column_count
         row_count += batch_row_count
 
         # Attempt to save on memory by manually removing the batch df
         # from local memory after finishing with processing.
         del df
 
     assert row_count == expected_row_count
 
 
+@pytest.mark.skip(reason="See if it caused kokoro build aborted.")
 def test_to_pandas_large_table():
     df = bpd.read_gbq("load_testing.scalars_10gb")
     # df will be downloaded locally
     expected_row_count, expected_column_count = df.shape
 
-    df = df.to_pandas()
+    # TODO(b/340893653): fix type error
+    df = df.to_pandas()  # type: ignore
     row_count, column_count = df.shape
     assert column_count == expected_column_count
     assert row_count == expected_row_count
```

### Comparing `bigframes-1.6.0/tests/system/load/test_llm.py` & `bigframes-1.7.0/tests/system/load/test_llm.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/__init__.py` & `bigframes-1.7.0/tests/system/small/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/bigquery/__init__.py` & `bigframes-1.7.0/tests/system/small/bigquery/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/__init__.py` & `bigframes-1.7.0/tests/system/small/ml/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/conftest.py` & `bigframes-1.7.0/tests/system/small/ml/conftest.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_cluster.py` & `bigframes-1.7.0/tests/system/small/ml/test_cluster.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_core.py` & `bigframes-1.7.0/tests/system/small/ml/test_core.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_ensemble.py` & `bigframes-1.7.0/tests/system/small/ml/test_ensemble.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_forecasting.py` & `bigframes-1.7.0/tests/system/small/ml/test_forecasting.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_imported.py` & `bigframes-1.7.0/tests/system/small/ml/test_imported.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_linear_model.py` & `bigframes-1.7.0/tests/system/small/ml/test_linear_model.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_llm.py` & `bigframes-1.7.0/tests/system/small/ml/test_llm.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_metrics.py` & `bigframes-1.7.0/tests/system/small/ml/test_metrics.py`

 * *Files 13% similar despite different names*

```diff
@@ -224,20 +224,22 @@
     np_thresholds = thresholds.to_pandas().astype("float64").array
 
     np.testing.assert_array_equal(
         # skip testing the first value, as it is redundant and inconsistent across sklearn versions
         np_thresholds[1:],
         expected_thresholds[1:],
     )
+    # TODO(b/340872435): fix type error
     np.testing.assert_array_equal(
-        np_fpr,
+        np_fpr,  # type: ignore
         expected_fpr,
     )
+    # TODO(b/340872435): fix type error
     np.testing.assert_array_equal(
-        np_tpr,
+        np_tpr,  # type: ignore
         expected_tpr,
     )
 
 
 def test_roc_curve_binary_classification_decision_returns_expected(session):
     # Instead of operating on probabilities, assume a 70% decision threshold
     # has been applied, and operate on the final output
@@ -319,20 +321,22 @@
     np_thresholds = thresholds.to_pandas().astype("float64").array
 
     np.testing.assert_array_equal(
         # skip testing the first value, as it is redundant and inconsistent across sklearn versions
         np_thresholds[1:],
         expected_thresholds[1:],
     )
+    # TODO(b/340872435): fix type error
     np.testing.assert_array_equal(
-        np_fpr,
+        np_fpr,  # type: ignore
         expected_fpr,
     )
+    # TODO(b/340872435): fix type error
     np.testing.assert_array_equal(
-        np_tpr,
+        np_tpr,  # type: ignore
         expected_tpr,
     )
 
 
 def test_roc_curve_binary_classification_prediction_series(session):
     pd_df = pd.DataFrame(
         {
@@ -511,16 +515,17 @@
         {
             "y_true": [2, 3, 3, 3, 4, 1],
             "y_pred": [4, 1, 2, 2, 4, 1],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
     confusion_matrix = metrics.confusion_matrix(df[["y_true"]], df[["y_pred"]])
+    # TODO(b/340872435): fix type error
     expected_pd_df = (
-        pd.DataFrame(
+        pd.DataFrame(  # type: ignore
             {1: [1, 0, 1, 0], 2: [0, 0, 2, 0], 3: [0, 0, 0, 0], 4: [0, 1, 0, 1]}
         )
         .astype("int64")
         .set_index([pd.Index([1, 2, 3, 4])])
     )
     pd.testing.assert_frame_equal(
         confusion_matrix, expected_pd_df, check_index_type=False
@@ -553,15 +558,16 @@
         }
     ).astype("str")
     df = session.read_pandas(pd_df)
     confusion_matrix = metrics.confusion_matrix(df[["y_true"]], df[["y_pred"]])
     expected_confusion_matrix = sklearn_metrics.confusion_matrix(
         pd_df[["y_true"]], pd_df[["y_pred"]]
     )
-    expected_pd_df = pd.DataFrame(expected_confusion_matrix).set_index(
+    # TODO(b/340872435): fix type error
+    expected_pd_df = pd.DataFrame(expected_confusion_matrix).set_index(  # type: ignore
         [pd.Index(["ant", "bird", "cat"])]
     )
     expected_pd_df.columns = pd.Index(["ant", "bird", "cat"])
     pd.testing.assert_frame_equal(
         confusion_matrix, expected_pd_df, check_index_type=False
     )
 
@@ -591,16 +597,17 @@
     pd_df = pd.DataFrame(
         {
             "y_true_arbitrary_name": [2, 0, 2, 2, 0, 1],
             "y_pred_arbitrary_name": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
+    # TODO(b/340872435): fix type error
     recall = metrics.recall_score(
-        df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]], average=None
+        df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]], average=None  # type: ignore
     )
     expected_values = [1.000000, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_recall = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(recall, expected_recall, check_index_type=False)
 
@@ -609,15 +616,16 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    recall = metrics.recall_score(df[["y_true"]], df[["y_pred"]], average=None)
+    # TODO(b/340872435): fix type error
+    recall = metrics.recall_score(df[["y_true"]], df[["y_pred"]], average=None)  # type: ignore
     expected_values = sklearn_metrics.recall_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = [0, 1, 2]
     expected_recall = pd.Series(expected_values, index=expected_index)
     pd.testing.assert_series_equal(recall, expected_recall, check_index_type=False)
 
@@ -626,15 +634,16 @@
     pd_df = pd.DataFrame(
         {
             "y_true": ["cat", "ant", "cat", "cat", "ant", "bird"],
             "y_pred": ["ant", "ant", "cat", "cat", "ant", "cat"],
         }
     ).astype("str")
     df = session.read_pandas(pd_df)
-    recall = metrics.recall_score(df[["y_true"]], df[["y_pred"]], average=None)
+    # TODO(b/340872435): fix type error
+    recall = metrics.recall_score(df[["y_true"]], df[["y_pred"]], average=None)  # type: ignore
     expected_values = sklearn_metrics.recall_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = ["ant", "bird", "cat"]
     expected_recall = pd.Series(expected_values, index=expected_index)
     pd.testing.assert_series_equal(recall, expected_recall, check_index_type=False)
 
@@ -643,15 +652,16 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    recall = metrics.recall_score(df["y_true"], df["y_pred"], average=None)
+    # TODO(b/340872435): fix type error
+    recall = metrics.recall_score(df["y_true"], df["y_pred"], average=None)  # type: ignore
     expected_values = [1.000000, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_recall = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(recall, expected_recall, check_index_type=False)
 
 
@@ -659,16 +669,17 @@
     pd_df = pd.DataFrame(
         {
             "y_true_arbitrary_name": [2, 0, 2, 2, 0, 1],
             "y_pred_arbitrary_name": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
+    # TODO(b/340872435): fix type error
     precision_score = metrics.precision_score(
-        df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]], average=None
+        df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]], average=None  # type: ignore
     )
     expected_values = [0.666667, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_precision = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(
         precision_score, expected_precision, check_index_type=False
@@ -679,16 +690,17 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
+    # TODO(b/340872435): fix type error
     precision_score = metrics.precision_score(
-        df[["y_true"]], df[["y_pred"]], average=None
+        df[["y_true"]], df[["y_pred"]], average=None  # type: ignore
     )
     expected_values = sklearn_metrics.precision_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = [0, 1, 2]
     expected_precision = pd.Series(expected_values, index=expected_index)
     pd.testing.assert_series_equal(
@@ -700,16 +712,17 @@
     pd_df = pd.DataFrame(
         {
             "y_true": ["cat", "ant", "cat", "cat", "ant", "bird"],
             "y_pred": ["ant", "ant", "cat", "cat", "ant", "cat"],
         }
     ).astype("str")
     df = session.read_pandas(pd_df)
+    # TODO(b/340872435): fix type error
     precision_score = metrics.precision_score(
-        df[["y_true"]], df[["y_pred"]], average=None
+        df[["y_true"]], df[["y_pred"]], average=None  # type: ignore
     )
     expected_values = sklearn_metrics.precision_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = ["ant", "bird", "cat"]
     expected_precision = pd.Series(expected_values, index=expected_index)
     pd.testing.assert_series_equal(
@@ -721,15 +734,16 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    precision_score = metrics.precision_score(df["y_true"], df["y_pred"], average=None)
+    # TODO(b/340872435): fix type error
+    precision_score = metrics.precision_score(df["y_true"], df["y_pred"], average=None)  # type: ignore
     expected_values = [0.666667, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_precision = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(
         precision_score, expected_precision, check_index_type=False
     )
@@ -739,16 +753,17 @@
     pd_df = pd.DataFrame(
         {
             "y_true_arbitrary_name": [2, 0, 2, 2, 0, 1],
             "y_pred_arbitrary_name": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
+    # TODO(b/340872435): fix type error
     f1_score = metrics.f1_score(
-        df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]], average=None
+        df[["y_true_arbitrary_name"]], df[["y_pred_arbitrary_name"]], average=None  # type: ignore
     )
     expected_values = [0.8, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_f1 = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(f1_score, expected_f1, check_index_type=False)
 
@@ -757,15 +772,16 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    f1_score = metrics.f1_score(df[["y_true"]], df[["y_pred"]], average=None)
+    # TODO(b/340872435): fix type error
+    f1_score = metrics.f1_score(df[["y_true"]], df[["y_pred"]], average=None)  # type: ignore
     expected_values = sklearn_metrics.f1_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = [0, 1, 2]
     expected_f1 = pd.Series(expected_values, index=expected_index)
     pd.testing.assert_series_equal(f1_score, expected_f1, check_index_type=False)
 
@@ -774,15 +790,16 @@
     pd_df = pd.DataFrame(
         {
             "y_true": ["cat", "ant", "cat", "cat", "ant", "bird"],
             "y_pred": ["ant", "ant", "cat", "cat", "ant", "cat"],
         }
     ).astype("str")
     df = session.read_pandas(pd_df)
-    f1_score = metrics.f1_score(df[["y_true"]], df[["y_pred"]], average=None)
+    # TODO(b/340872435): fix type error
+    f1_score = metrics.f1_score(df[["y_true"]], df[["y_pred"]], average=None)  # type: ignore
     expected_values = sklearn_metrics.f1_score(
         pd_df[["y_true"]], pd_df[["y_pred"]], average=None
     )
     expected_index = ["ant", "bird", "cat"]
     expected_f1 = pd.Series(expected_values, index=expected_index)
     pd.testing.assert_series_equal(f1_score, expected_f1, check_index_type=False)
 
@@ -791,15 +808,16 @@
     pd_df = pd.DataFrame(
         {
             "y_true": [2, 0, 2, 2, 0, 1],
             "y_pred": [0, 0, 2, 2, 0, 2],
         }
     ).astype("Int64")
     df = session.read_pandas(pd_df)
-    f1_score = metrics.f1_score(df["y_true"], df["y_pred"], average=None)
+    # TODO(b/340872435): fix type error
+    f1_score = metrics.f1_score(df["y_true"], df["y_pred"], average=None)  # type: ignore
     expected_values = [0.8, 0.000000, 0.666667]
     expected_index = [0, 1, 2]
     expected_f1 = pd.Series(expected_values, index=expected_index)
 
     pd.testing.assert_series_equal(f1_score, expected_f1, check_index_type=False)
```

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_metrics_pairwise.py` & `bigframes-1.7.0/tests/system/small/ml/test_metrics_pairwise.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_model_selection.py` & `bigframes-1.7.0/tests/system/small/ml/test_model_selection.py`

 * *Files 15% similar despite different names*

```diff
@@ -126,20 +126,25 @@
         ]
     ]
     y = df[["body_mass_g"]]
     X_train, X_test, y_train, y_test = model_selection.train_test_split(
         X, y, random_state=42
     )
 
-    X_train = X_train.to_pandas().sort_index()
-    X_test = X_test.to_pandas().sort_index()
-    y_train = y_train.to_pandas().sort_index()
-    y_test = y_test.to_pandas().sort_index()
+    # TODO(b/340876926): fix type error
+    X_train = X_train.to_pandas().sort_index()  # type: ignore
+    # TODO(b/340876926): fix type error
+    X_test = X_test.to_pandas().sort_index()  # type: ignore
+    # TODO(b/340876926): fix type error
+    y_train = y_train.to_pandas().sort_index()  # type: ignore
+    # TODO(b/340876926): fix type error
+    y_test = y_test.to_pandas().sort_index()  # type: ignore
 
-    train_index = pd.Index(
+    # TODO(b/340876926): fix type error
+    train_index = pd.Index(  # type: ignore
         [
             144,
             146,
             168,
             183,
             186,
             217,
@@ -158,49 +163,54 @@
             267,
             268,
             290,
         ],
         dtype="Int64",
         name="rowindex",
     )
-    test_index = pd.Index(
+    # TODO(b/340876926): fix type error
+    test_index = pd.Index(  # type: ignore
         [148, 161, 226, 269, 278, 289, 291], dtype="Int64", name="rowindex"
     )
 
     all_data.index.name = "_"
+    # TODO(b/340876926): fix type error
     pd.testing.assert_frame_equal(
-        X_train,
+        X_train,  # type: ignore
         all_data[
             [
                 "species",
                 "island",
                 "culmen_length_mm",
             ]
         ].loc[train_index],
     )
+    # TODO(b/340876926): fix type error
     pd.testing.assert_frame_equal(
-        X_test,
+        X_test,  # type: ignore
         all_data[
             [
                 "species",
                 "island",
                 "culmen_length_mm",
             ]
         ].loc[test_index],
     )
+    # TODO(b/340876926): fix type error
     pd.testing.assert_frame_equal(
-        y_train,
+        y_train,  # type: ignore
         all_data[
             [
                 "body_mass_g",
             ]
         ].loc[train_index],
     )
+    # TODO(b/340876926): fix type error
     pd.testing.assert_frame_equal(
-        y_test,
+        y_test,  # type: ignore
         all_data[
             [
                 "body_mass_g",
             ]
         ].loc[test_index],
     )
```

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_preprocessing.py` & `bigframes-1.7.0/tests/system/small/ml/test_preprocessing.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_register.py` & `bigframes-1.7.0/tests/system/small/ml/test_register.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/ml/test_remote.py` & `bigframes-1.7.0/tests/system/small/ml/test_remote.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/operations/__init__.py` & `bigframes-1.7.0/tests/system/small/operations/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/operations/test_datetimes.py` & `bigframes-1.7.0/tests/system/small/operations/test_datetimes.py`

 * *Files 1% similar despite different names*

```diff
@@ -306,15 +306,16 @@
         bf_result,
     )
 
 
 def test_dt_compare_coerce_str_datetime(scalars_dfs):
     scalars_df, scalars_pandas_df = scalars_dfs
     bf_series: bigframes.series.Series = scalars_df["datetime_col"]
-    bf_result = (bf_series >= "2024-01-01").to_pandas()
+    # TODO(b/340878286): fix type error
+    bf_result = (bf_series >= "2024-01-01").to_pandas()  # type: ignore
 
     pd_result = scalars_pandas_df["datetime_col"] >= pd.to_datetime("2024-01-01")
 
     # pandas produces pyarrow bool dtype
     assert_series_equal(pd_result, bf_result, check_dtype=False)
```

### Comparing `bigframes-1.6.0/tests/system/small/operations/test_plotting.py` & `bigframes-1.7.0/tests/system/small/operations/test_plotting.py`

 * *Files 1% similar despite different names*

```diff
@@ -254,16 +254,17 @@
     }
     data["s"] = s
     df = bpd.DataFrame(data)
     pd_df = pd.DataFrame(data)
 
     ax = df.plot.scatter(x="a", y="b", s="s")
     pd_ax = pd_df.plot.scatter(x="a", y="b", s="s")
+    # TODO(b/340891723): fix type error
     tm.assert_numpy_array_equal(
-        ax.collections[0].get_sizes(), pd_ax.collections[0].get_sizes()
+        ax.collections[0].get_sizes(), pd_ax.collections[0].get_sizes()  # type: ignore
     )
 
 
 @pytest.mark.parametrize(
     ("arg_name"),
     [
         pytest.param("c", marks=pytest.mark.xfail(raises=NotImplementedError)),
```

### Comparing `bigframes-1.6.0/tests/system/small/operations/test_strings.py` & `bigframes-1.7.0/tests/system/small/operations/test_strings.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/regression/test_issue355_merge_after_filter.py` & `bigframes-1.7.0/tests/system/small/regression/test_issue355_merge_after_filter.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/test_dataframe.py` & `bigframes-1.7.0/tests/system/small/test_dataframe.py`

 * *Files 2% similar despite different names*

```diff
@@ -143,15 +143,16 @@
     import bigframes.pandas as bpd
 
     # Note: This starts a thread-local session.
     with bpd.option_context("bigquery.location", "europe-west1"):
         df = bpd.DataFrame([[1, 2, 3], [4, 5, 6]])
         repr(df)
 
-        table = bpd.get_global_session().bqclient.get_table(df.query_job.destination)
+        # TODO(b/340876936): fix type error
+        table = bpd.get_global_session().bqclient.get_table(df.query_job.destination)  # type: ignore
         assert table.location == "europe-west1"
 
 
 def test_get_column(scalars_dfs):
     scalars_df, scalars_pandas_df = scalars_dfs
     col_name = "int64_col"
     series = scalars_df[col_name]
@@ -748,16 +749,18 @@
     pd_result.index = pd_result.index.astype("Int64")
     assert_pandas_df_equal(bf_result.to_pandas(), pd_result)
 
 
 def test_assign_to_empty_df_multiindex_error(session):
     empty_df = dataframe.DataFrame(session=session)
     empty_pandas_df = pd.DataFrame()
-    empty_df["empty_col_1"] = []
-    empty_df["empty_col_2"] = []
+    # TODO(b/340876936): fix type error
+    empty_df["empty_col_1"] = []  # type: ignore
+    # TODO(b/340876936): fix type error
+    empty_df["empty_col_2"] = []  # type: ignore
     empty_pandas_df["empty_col_1"] = []
     empty_pandas_df["empty_col_2"] = []
     empty_df = empty_df.set_index(["empty_col_1", "empty_col_2"])
     empty_pandas_df = empty_pandas_df.set_index(["empty_col_1", "empty_col_2"])
 
     with pytest.raises(ValueError):
         empty_df.assign(new_col=[1, 2, 3, 4, 5, 6, 7, 8, 9])
@@ -1337,28 +1340,42 @@
 
 def test_get_dtypes(scalars_df_default_index):
     dtypes = scalars_df_default_index.dtypes
     pd.testing.assert_series_equal(
         dtypes,
         pd.Series(
             {
-                "bool_col": pd.BooleanDtype(),
-                "bytes_col": pd.ArrowDtype(pa.binary()),
-                "date_col": pd.ArrowDtype(pa.date32()),
-                "datetime_col": pd.ArrowDtype(pa.timestamp("us")),
-                "geography_col": gpd.array.GeometryDtype(),
-                "int64_col": pd.Int64Dtype(),
-                "int64_too": pd.Int64Dtype(),
-                "numeric_col": pd.ArrowDtype(pa.decimal128(38, 9)),
-                "float64_col": pd.Float64Dtype(),
-                "rowindex": pd.Int64Dtype(),
-                "rowindex_2": pd.Int64Dtype(),
-                "string_col": pd.StringDtype(storage="pyarrow"),
-                "time_col": pd.ArrowDtype(pa.time64("us")),
-                "timestamp_col": pd.ArrowDtype(pa.timestamp("us", tz="UTC")),
+                # TODO(b/340876936): fix type error
+                "bool_col": pd.BooleanDtype(),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "bytes_col": pd.ArrowDtype(pa.binary()),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "date_col": pd.ArrowDtype(pa.date32()),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "datetime_col": pd.ArrowDtype(pa.timestamp("us")),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "geography_col": gpd.array.GeometryDtype(),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "int64_col": pd.Int64Dtype(),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "int64_too": pd.Int64Dtype(),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "numeric_col": pd.ArrowDtype(pa.decimal128(38, 9)),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "float64_col": pd.Float64Dtype(),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "rowindex": pd.Int64Dtype(),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "rowindex_2": pd.Int64Dtype(),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "string_col": pd.StringDtype(storage="pyarrow"),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "time_col": pd.ArrowDtype(pa.time64("us")),  # type: ignore
+                # TODO(b/340876936): fix type error
+                "timestamp_col": pd.ArrowDtype(pa.timestamp("us", tz="UTC")),  # type: ignore
             }
         ),
     )
 
 
 def test_get_dtypes_array_struct_query(session):
     df = session.read_gbq(
@@ -1780,16 +1797,19 @@
         "overwritefalse",
         "customfilter",
     ],
 )
 def test_df_update(overwrite, filter_func):
     if pd.__version__.startswith("1."):
         pytest.skip("dtype handled differently in pandas 1.x.")
-    index1 = pandas.Index([1, 2, 3, 4], dtype="Int64")
-    index2 = pandas.Index([1, 2, 4, 5], dtype="Int64")
+
+    # TODO(b/340876936): fix type error
+    index1 = pandas.Index([1, 2, 3, 4], dtype="Int64")  # type: ignore
+    # TODO(b/340876936): fix type error
+    index2 = pandas.Index([1, 2, 4, 5], dtype="Int64")  # type: ignore
     pd_df1 = pandas.DataFrame(
         {"a": [1, None, 3, 4], "b": [5, 6, None, 8]}, dtype="Int64", index=index1
     )
     pd_df2 = pandas.DataFrame(
         {"a": [None, 20, 30, 40], "c": [90, None, 110, 120]},
         dtype="Int64",
         index=index2,
@@ -1841,16 +1861,18 @@
         ("left", 0),
         ("right", 1),
         ("inner", None),
         ("inner", 1),
     ],
 )
 def test_df_align(join, axis):
-    index1 = pandas.Index([1, 2, 3, 4], dtype="Int64")
-    index2 = pandas.Index([1, 2, 4, 5], dtype="Int64")
+    # TODO(b/340876936): fix type error
+    index1 = pandas.Index([1, 2, 3, 4], dtype="Int64")  # type: ignore
+    # TODO(b/340876936): fix type error
+    index2 = pandas.Index([1, 2, 4, 5], dtype="Int64")  # type: ignore
     pd_df1 = pandas.DataFrame(
         {"a": [1, None, 3, 4], "b": [5, 6, None, 8]}, dtype="Int64", index=index1
     )
     pd_df2 = pandas.DataFrame(
         {"a": [None, 20, 30, 40], "c": [90, None, 110, 120]},
         dtype="Int64",
         index=index2,
@@ -1859,16 +1881,18 @@
     bf_df1 = dataframe.DataFrame(pd_df1)
     bf_df2 = dataframe.DataFrame(pd_df2)
 
     bf_result1, bf_result2 = bf_df1.align(bf_df2, join=join, axis=axis)
     pd_result1, pd_result2 = pd_df1.align(pd_df2, join=join, axis=axis)
 
     # Don't check dtype as pandas does unnecessary float conversion
-    pd.testing.assert_frame_equal(bf_result1.to_pandas(), pd_result1, check_dtype=False)
-    pd.testing.assert_frame_equal(bf_result2.to_pandas(), pd_result2, check_dtype=False)
+    # TODO(b/340876936): fix type error
+    pd.testing.assert_frame_equal(bf_result1.to_pandas(), pd_result1, check_dtype=False)  # type: ignore
+    # TODO(b/340876936): fix type error
+    pd.testing.assert_frame_equal(bf_result2.to_pandas(), pd_result2, check_dtype=False)  # type: ignore
 
 
 def test_combine_first(
     scalars_df_index,
     scalars_df_2_index,
     scalars_pandas_df_index,
 ):
@@ -2496,17 +2520,19 @@
     ).all()
 
 
 def test_df_transpose():
     # Include some floats to ensure type coercion
     values = [[0, 3.5, True], [1, 4.5, False], [2, 6.5, None]]
     # Test complex case of both axes being multi-indices with non-unique elements
-    columns = pd.Index(["A", "B", "A"], dtype=pd.StringDtype(storage="pyarrow"))
+    # TODO(b/340876936): fix type error
+    columns = pd.Index(["A", "B", "A"], dtype=pd.StringDtype(storage="pyarrow"))  # type: ignore
     columns_multi = pd.MultiIndex.from_arrays([columns, columns], names=["c1", "c2"])
-    index = pd.Index(["b", "a", "a"], dtype=pd.StringDtype(storage="pyarrow"))
+    # TODO(b/340876936): fix type error
+    index = pd.Index(["b", "a", "a"], dtype=pd.StringDtype(storage="pyarrow"))  # type: ignore
     rows_multi = pd.MultiIndex.from_arrays([index, index], names=["r1", "r2"])
 
     pd_df = pandas.DataFrame(values, index=rows_multi, columns=columns_multi)
     bf_df = dataframe.DataFrame(values, index=rows_multi, columns=columns_multi)
 
     pd_result = pd_df.T
     bf_result = bf_df.T.to_pandas()
@@ -3666,29 +3692,33 @@
 
 
 def test_df_setattr_index():
     pd_df = pandas.DataFrame(
         [[1, 1, 1], [1, 1, 1]], columns=["index", "columns", "my_column"]
     )
     bf_df = dataframe.DataFrame(pd_df)
-    pd_df.index = [4, 5]
-    bf_df.index = [4, 5]
+    # TODO(b/340876936): fix type error
+    pd_df.index = [4, 5]  # type: ignore
+    # TODO(b/340876936): fix type error
+    bf_df.index = [4, 5]  # type: ignore
 
     assert_pandas_df_equal(
         pd_df, bf_df.to_pandas(), check_index_type=False, check_dtype=False
     )
 
 
 def test_df_setattr_columns():
     pd_df = pandas.DataFrame(
         [[1, 1, 1], [1, 1, 1]], columns=["index", "columns", "my_column"]
     )
     bf_df = dataframe.DataFrame(pd_df)
-    pd_df.columns = [4, 5, 6]
-    bf_df.columns = [4, 5, 6]
+    # TODO(b/340876936): fix type error
+    pd_df.columns = [4, 5, 6]  # type: ignore
+    # TODO(b/340876936): fix type error
+    bf_df.columns = [4, 5, 6]  # type: ignore
 
     assert_pandas_df_equal(
         pd_df, bf_df.to_pandas(), check_index_type=False, check_dtype=False
     )
 
 
 def test_df_setattr_modify_column():
@@ -3774,15 +3804,16 @@
     pd.testing.assert_frame_equal(
         bf_result.to_pandas(),
         pd_result,
     )
 
 
 def test_iloc_empty_list(scalars_df_index, scalars_pandas_df_index):
-    index_list = []
+    # TODO(b/340876936): fix type error
+    index_list = []  # type: ignore
 
     bf_result = scalars_df_index.iloc[index_list]
     pd_result = scalars_pandas_df_index.iloc[index_list]
 
     bf_result = bf_result.to_pandas()
     assert bf_result.shape == pd_result.shape  # types are known to be different
```

### Comparing `bigframes-1.6.0/tests/system/small/test_dataframe_io.py` & `bigframes-1.7.0/tests/system/small/test_dataframe_io.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/test_encryption.py` & `bigframes-1.7.0/tests/system/small/test_encryption.py`

 * *Files 6% similar despite different names*

```diff
@@ -238,45 +238,52 @@
             "sex",
         ]
     ]
     y_train = df[["body_mass_g"]]
     model.fit(X_train, y_train)
 
     assert model is not None
-    assert model._bqml_model.model.encryption_configuration is not None
-    assert model._bqml_model.model.encryption_configuration.kms_key_name == bq_cmek
+    # TODO(b/340879287): fix type error
+    assert model._bqml_model.model.encryption_configuration is not None  # type: ignore
+    # TODO(b/340879287): fix type error
+    assert model._bqml_model.model.encryption_configuration.kms_key_name == bq_cmek  # type: ignore
 
     # Assert that model exists in BQ with intended encryption
-    model_bq = session_with_bq_cmek.bqclient.get_model(model._bqml_model.model_name)
+    # TODO(b/340879287): fix type error
+    model_bq = session_with_bq_cmek.bqclient.get_model(model._bqml_model.model_name)  # type: ignore
     assert model_bq.encryption_configuration.kms_key_name == bq_cmek
 
     # Explicitly save the model to a destination and assert that encryption holds
     model_ref = model._bqml_model_factory._create_model_ref(
         session_with_bq_cmek._anonymous_dataset
     )
     model_ref_full_name = (
         f"{model_ref.project}.{model_ref.dataset_id}.{model_ref.model_id}"
     )
     new_model = model.to_gbq(model_ref_full_name)
-    assert new_model._bqml_model.model.encryption_configuration.kms_key_name == bq_cmek
+    # TODO(b/340879287): fix type error
+    assert new_model._bqml_model.model.encryption_configuration.kms_key_name == bq_cmek  # type: ignore
 
     # Assert that model exists in BQ with intended encryption
-    model_bq = session_with_bq_cmek.bqclient.get_model(new_model._bqml_model.model_name)
+    # TODO(b/340879287): fix type error
+    model_bq = session_with_bq_cmek.bqclient.get_model(new_model._bqml_model.model_name)  # type: ignore
     assert model_bq.encryption_configuration.kms_key_name == bq_cmek
 
     # Assert that model registration keeps the encryption
     # Note that model registration only creates an entry (metadata) to be
     # included in the Vertex AI Model Registry. See for more details
     # https://cloud.google.com/bigquery/docs/update_vertex#add-existing.
     # When use deploys the model to an endpoint from the Model Registry then
     # they can specify an encryption key to further protect the artifacts at
     # rest on the Vertex AI side. See for more details:
     # https://cloud.google.com/vertex-ai/docs/general/deployment#deploy_a_model_to_an_endpoint,
     # https://cloud.google.com/vertex-ai/docs/general/cmek#create_resources_with_the_kms_key.
     # bigframes.ml does not provide any API for the model deployment.
     model_registered = new_model.register()
+    # TODO(b/340879287): fix type error
     assert (
-        model_registered._bqml_model.model.encryption_configuration.kms_key_name
+        model_registered._bqml_model.model.encryption_configuration.kms_key_name  # type: ignore
         == bq_cmek
     )
-    model_bq = session_with_bq_cmek.bqclient.get_model(new_model._bqml_model.model_name)
+    # TODO(b/340879287): fix type error
+    model_bq = session_with_bq_cmek.bqclient.get_model(new_model._bqml_model.model_name)  # type: ignore
     assert model_bq.encryption_configuration.kms_key_name == bq_cmek
```

### Comparing `bigframes-1.6.0/tests/system/small/test_groupby.py` & `bigframes-1.7.0/tests/system/small/test_groupby.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/test_ibis.py` & `bigframes-1.7.0/tests/system/small/test_ibis.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/test_index.py` & `bigframes-1.7.0/tests/system/small/test_index.py`

 * *Files 13% similar despite different names*

```diff
@@ -20,41 +20,47 @@
 from tests.system.utils import assert_pandas_index_equal_ignore_index_type
 
 
 def test_index_construct_from_list():
     bf_result = bpd.Index(
         [3, 14, 159], dtype=pd.Int64Dtype(), name="my_index"
     ).to_pandas()
-    pd_result = pd.Index([3, 14, 159], dtype=pd.Int64Dtype(), name="my_index")
+    # TODO(b/340878489): fix type error
+    pd_result = pd.Index([3, 14, 159], dtype=pd.Int64Dtype(), name="my_index")  # type: ignore
     pd.testing.assert_index_equal(bf_result, pd_result)
 
 
 def test_index_construct_from_series():
+    # TODO(b/340878489): fix type error
     bf_result = bpd.Index(
         bpd.Series([3, 14, 159], dtype=pd.Float64Dtype(), name="series_name"),
         name="index_name",
         dtype=pd.Int64Dtype(),
-    ).to_pandas()
-    pd_result = pd.Index(
+    ).to_pandas()  # type: ignore
+    # TODO(b/340878489): fix type error
+    pd_result = pd.Index(  # type: ignore
         pd.Series([3, 14, 159], dtype=pd.Float64Dtype(), name="series_name"),
         name="index_name",
         dtype=pd.Int64Dtype(),
     )
     pd.testing.assert_index_equal(bf_result, pd_result)
 
 
 def test_index_construct_from_index():
     bf_index_input = bpd.Index(
         [3, 14, 159], dtype=pd.Float64Dtype(), name="series_name"
     )
+    # TODO(b/340878489): fix type error
     bf_result = bpd.Index(
-        bf_index_input, dtype=pd.Int64Dtype(), name="index_name"
+        bf_index_input, dtype=pd.Int64Dtype(), name="index_name"  # type: ignore
     ).to_pandas()
-    pd_index_input = pd.Index([3, 14, 159], dtype=pd.Float64Dtype(), name="series_name")
-    pd_result = pd.Index(pd_index_input, dtype=pd.Int64Dtype(), name="index_name")
+    # TODO(b/340878489): fix type error
+    pd_index_input = pd.Index([3, 14, 159], dtype=pd.Float64Dtype(), name="series_name")  # type: ignore
+    # TODO(b/340878489): fix type error
+    pd_result = pd.Index(pd_index_input, dtype=pd.Int64Dtype(), name="index_name")  # type: ignore
     pd.testing.assert_index_equal(bf_result, pd_result)
 
 
 def test_get_index(scalars_df_index, scalars_pandas_df_index):
     index = scalars_df_index.index
     bf_result = index.to_pandas()
     pd_result = scalars_pandas_df_index.index
@@ -361,15 +367,16 @@
 def test_index_isin(scalars_df_index, scalars_pandas_df_index):
     bf_series = (
         scalars_df_index.set_index("int64_col").index.isin([2, 55555, 4]).to_pandas()
     )
     pd_result_array = scalars_pandas_df_index.set_index("int64_col").index.isin(
         [2, 55555, 4]
     )
-    pd.testing.assert_index_equal(
+    # TODO(b/340878489): fix type error
+    pd.testing.assert_index_equal(  # type: ignore
         pd.Index(pd_result_array),
         bf_series,
         check_names=False,
     )
 
 
 def test_multiindex_name_is_none(session):
```

### Comparing `bigframes-1.6.0/tests/system/small/test_ipython.py` & `bigframes-1.7.0/tests/system/small/test_ipython.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/test_multiindex.py` & `bigframes-1.7.0/tests/system/small/test_multiindex.py`

 * *Files 1% similar despite different names*

```diff
@@ -846,20 +846,22 @@
         columns=multi_columns,
         dtype="Int64",
     )
     bf_df = bpd.DataFrame(pd_df)
 
     bf_result = bf_df.stack(level=level).to_pandas()
     # BigFrames emulates future_stack impl
-    pd_result = pd_df.stack(level=level, future_stack=True)
+    # TODO(b/340884387): fix type error
+    pd_result = pd_df.stack(level=level, future_stack=True)  # type: ignore
 
     # Pandas produces NaN, where bq dataframes produces pd.NA
     # Column ordering seems to depend on pandas version
+    # TODO(b/340884387): fix type error
     pandas.testing.assert_frame_equal(
-        bf_result, pd_result, check_dtype=False, check_index_type=False
+        bf_result, pd_result, check_dtype=False, check_index_type=False  # type: ignore
     )
 
 
 def test_column_multi_index_melt():
     if pandas.__version__.startswith("1.") or pandas.__version__.startswith("2.0"):
         pytest.skip("pandas <2.1 uses different stack implementation")
 
@@ -885,17 +887,19 @@
     pandas.testing.assert_frame_equal(
         bf_result, pd_result, check_index_type=False, check_dtype=False
     )
 
 
 def test_column_multi_index_unstack(scalars_df_index, scalars_pandas_df_index):
     columns = ["int64_too", "int64_col", "rowindex_2"]
-    level1 = pandas.Index(["b", "a", "b"], dtype="string[pyarrow]")
+    # TODO(b/340884387): fix type error
+    level1 = pandas.Index(["b", "a", "b"], dtype="string[pyarrow]")  # type: ignore
     # Need resulting column to be pyarrow string rather than object dtype
-    level2 = pandas.Index(["a", "b", "b"], dtype="string[pyarrow]")
+    # TODO(b/340884387): fix type error
+    level2 = pandas.Index(["a", "b", "b"], dtype="string[pyarrow]")  # type: ignore
     multi_columns = pandas.MultiIndex.from_arrays([level1, level2])
     bf_df = scalars_df_index[columns].copy()
     bf_df.columns = multi_columns
     pd_df = scalars_pandas_df_index[columns].copy()
     pd_df.columns = multi_columns
 
     bf_result = bf_df.unstack().to_pandas()
@@ -1181,27 +1185,29 @@
     data = [[[1, 1], np.nan, [3, 3]], [[2], [5], []]]
     multi_level_columns = pandas.MultiIndex.from_arrays(
         [["col0", "col0", "col1"], ["col00", "col01", "col11"]]
     )
 
     df = bpd.DataFrame(data, columns=multi_level_columns)
     pd_df = df.to_pandas()
+    # TODO(b/340884387): fix type error
     pandas.testing.assert_frame_equal(
         df["col0"].explode("col00").to_pandas(),
-        pd_df["col0"].explode("col00"),
+        pd_df["col0"].explode("col00"),  # type: ignore
         check_dtype=False,
         check_index_type=False,
     )
 
 
 def test_column_multi_index_w_na_stack(scalars_df_index, scalars_pandas_df_index):
     columns = ["int64_too", "int64_col", "rowindex_2"]
     level1 = pandas.Index(["b", "c", "d"])
     # Need resulting column to be pyarrow string rather than object dtype
-    level2 = pandas.Index([None, "b", "b"], dtype="string[pyarrow]")
+    # TODO(b/340884387): fix type error
+    level2 = pandas.Index([None, "b", "b"], dtype="string[pyarrow]")  # type: ignore
     multi_columns = pandas.MultiIndex.from_arrays([level1, level2])
     bf_df = scalars_df_index[columns].copy()
     bf_df.columns = multi_columns
     pd_df = scalars_pandas_df_index[columns].copy()
     pd_df.columns = multi_columns
 
     pd_result = pd_df.stack()
```

### Comparing `bigframes-1.6.0/tests/system/small/test_numpy.py` & `bigframes-1.7.0/tests/system/small/test_numpy.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/test_pandas.py` & `bigframes-1.7.0/tests/system/small/test_pandas.py`

 * *Files 5% similar despite different names*

```diff
@@ -391,17 +391,19 @@
 
     pd_result = pd.cut(scalars_pandas_df["float64_col"], 5, labels=False)
     bf_result = bpd.cut(scalars_df["float64_col"], 5, labels=False)
 
     # make sure the result is a supported dtype
     assert bf_result.dtype == bpd.Int64Dtype()
 
-    bf_result = bf_result.to_pandas()
+    # TODO(b/340884971): fix type error
+    bf_result = bf_result.to_pandas()  # type: ignore
     pd_result = pd_result.astype("Int64")
-    pd.testing.assert_series_equal(bf_result, pd_result)
+    # TODO(b/340884971): fix type error
+    pd.testing.assert_series_equal(bf_result, pd_result)  # type: ignore
 
 
 def test_cut_default_labels(scalars_dfs):
     scalars_df, scalars_pandas_df = scalars_dfs
 
     pd_result = pd.cut(scalars_pandas_df["float64_col"], 5)
     bf_result = bpd.cut(scalars_df["float64_col"], 5).to_pandas()
@@ -524,18 +526,20 @@
     scalars_df, scalars_pandas_df = scalars_dfs
 
     pd_result = pd.qcut(
         scalars_pandas_df["float64_col"], q, labels=False, duplicates="drop"
     )
     bf_result = bpd.qcut(scalars_df["float64_col"], q, labels=False, duplicates="drop")
 
-    bf_result = bf_result.to_pandas()
+    # TODO(b/340884971): fix type error
+    bf_result = bf_result.to_pandas()  # type: ignore
     pd_result = pd_result.astype("Int64")
 
-    pd.testing.assert_series_equal(bf_result, pd_result)
+    # TODO(b/340884971): fix type error
+    pd.testing.assert_series_equal(bf_result, pd_result)  # type: ignore
 
 
 @pytest.mark.parametrize(
     ("arg", "utc", "unit", "format"),
     [
         (173872738, False, None, None),
         (32787983.23, True, "s", None),
@@ -564,32 +568,34 @@
         (["2023-01-01"], True, None, "%Y-%m-%d"),
         (["2023-02-01T15:00:00+07:22"], True, None, None),
         (["01-31-2023 14:30 -0800"], True, None, "%m-%d-%Y %H:%M %z"),
         (["01-31-2023 14:00", "02-01-2023 15:00"], True, None, "%m-%d-%Y %H:%M"),
     ],
 )
 def test_to_datetime_iterable(arg, utc, unit, format):
+    # TODO(b/340884971): fix type error
     bf_result = (
-        bpd.to_datetime(arg, utc=utc, unit=unit, format=format)
+        bpd.to_datetime(arg, utc=utc, unit=unit, format=format)  # type: ignore
         .to_pandas()
         .astype("datetime64[ns, UTC]" if utc else "datetime64[ns]")
     )
     pd_result = pd.Series(
         pd.to_datetime(arg, utc=utc, unit=unit, format=format)
     ).dt.floor("us")
     pd.testing.assert_series_equal(
         bf_result, pd_result, check_index_type=False, check_names=False
     )
 
 
 def test_to_datetime_series(scalars_dfs):
     scalars_df, scalars_pandas_df = scalars_dfs
     col = "int64_too"
+    # TODO(b/340884971): fix type error
     bf_result = (
-        bpd.to_datetime(scalars_df[col], unit="s").to_pandas().astype("datetime64[s]")
+        bpd.to_datetime(scalars_df[col], unit="s").to_pandas().astype("datetime64[s]")  # type: ignore
     )
     pd_result = pd.Series(pd.to_datetime(scalars_pandas_df[col], unit="s"))
     pd.testing.assert_series_equal(
         bf_result, pd_result, check_index_type=False, check_names=False
     )
 
 
@@ -604,15 +610,16 @@
         ([20242330, 25244685, 34324234], "s"),
         ([20242330000, 25244685000, 34324234000], "ms"),
         ([20242330000000, 25244685000000, 34324234000000], "us"),
         ([20242330000000000, 25244685000000000, 34324234000000000], "ns"),
     ],
 )
 def test_to_datetime_unit_param(arg, unit):
-    bf_result = bpd.to_datetime(arg, unit=unit).to_pandas().astype("datetime64[ns]")
+    # TODO(b/340884971): fix type error
+    bf_result = bpd.to_datetime(arg, unit=unit).to_pandas().astype("datetime64[ns]")  # type: ignore
     pd_result = pd.Series(pd.to_datetime(arg, unit=unit)).dt.floor("us")
     pd.testing.assert_series_equal(
         bf_result, pd_result, check_index_type=False, check_names=False
     )
 
 
 @pytest.mark.parametrize(
@@ -621,16 +628,115 @@
         ([20230110, 20230101, 20230101], False, "%Y%m%d"),
         ([201301.01], False, "%Y%m.%d"),
         (["2023-01-10", "2023-01-20", "2023-01-01"], True, "%Y-%m-%d"),
         (["2014-08-15 07:19"], True, "%Y-%m-%d %H:%M"),
     ],
 )
 def test_to_datetime_format_param(arg, utc, format):
+    # TODO(b/340884971): fix type error
     bf_result = (
-        bpd.to_datetime(arg, utc=utc, format=format)
+        bpd.to_datetime(arg, utc=utc, format=format)  # type: ignore
         .to_pandas()
         .astype("datetime64[ns, UTC]" if utc else "datetime64[ns]")
     )
     pd_result = pd.Series(pd.to_datetime(arg, utc=utc, format=format)).dt.floor("us")
     pd.testing.assert_series_equal(
         bf_result, pd_result, check_index_type=False, check_names=False
     )
+
+
+@pytest.mark.parametrize(
+    ("arg", "utc", "output_in_utc", "format"),
+    [
+        (
+            ["2014-08-15 08:15:12", "2011-08-15 08:15:12", "2015-08-15 08:15:12"],
+            False,
+            False,
+            None,
+        ),
+        (
+            [
+                "2008-12-25 05:30:00Z",
+                "2008-12-25 05:30:00-00:00",
+                "2008-12-25 05:30:00+00:00",
+                "2008-12-25 05:30:00-0000",
+                "2008-12-25 05:30:00+0000",
+                "2008-12-25 05:30:00-00",
+                "2008-12-25 05:30:00+00",
+            ],
+            False,
+            True,
+            None,
+        ),
+        (
+            ["2014-08-15 08:15:12", "2011-08-15 08:15:12", "2015-08-15 08:15:12"],
+            True,
+            True,
+            "%Y-%m-%d %H:%M:%S",
+        ),
+        (
+            [
+                "2014-08-15 08:15:12+05:00",
+                "2011-08-15 08:15:12+05:00",
+                "2015-08-15 08:15:12+05:00",
+            ],
+            True,
+            True,
+            None,
+        ),
+    ],
+)
+def test_to_datetime_string_inputs(arg, utc, output_in_utc, format):
+    # TODO(b/340884971): fix type error
+    bf_result = (
+        bpd.to_datetime(arg, utc=utc, format=format)  # type: ignore
+        .to_pandas()
+        .astype("datetime64[ns, UTC]" if output_in_utc else "datetime64[ns]")
+    )
+    pd_result = pd.Series(pd.to_datetime(arg, utc=utc, format=format)).dt.floor("us")
+    pd.testing.assert_series_equal(
+        bf_result, pd_result, check_index_type=False, check_names=False
+    )
+
+
+@pytest.mark.parametrize(
+    ("arg", "utc", "output_in_utc"),
+    [
+        (
+            [datetime(2023, 1, 1, 12, 0), datetime(2023, 2, 1, 12, 0)],
+            False,
+            False,
+        ),
+        (
+            [datetime(2023, 1, 1, 12, 0), datetime(2023, 2, 1, 12, 0)],
+            True,
+            True,
+        ),
+        (
+            [
+                datetime(2023, 1, 1, 12, 0, tzinfo=pytz.timezone("UTC")),
+                datetime(2023, 1, 1, 12, 0, tzinfo=pytz.timezone("UTC")),
+            ],
+            True,
+            True,
+        ),
+        (
+            [
+                datetime(2023, 1, 1, 12, 0, tzinfo=pytz.timezone("America/New_York")),
+                datetime(2023, 1, 1, 12, 0, tzinfo=pytz.timezone("UTC")),
+            ],
+            True,
+            True,
+        ),
+    ],
+)
+def test_to_datetime_timestamp_inputs(arg, utc, output_in_utc):
+    # TODO(b/340884971): fix type error
+    bf_result = (
+        bpd.to_datetime(arg, utc=utc)  # type: ignore
+        .to_pandas()
+        .astype("datetime64[ns, UTC]" if output_in_utc else "datetime64[ns]")
+    )
+    pd_result = pd.Series(pd.to_datetime(arg, utc=utc)).dt.floor("us")
+    pd.testing.assert_series_equal(
+        bf_result, pd_result, check_index_type=False, check_names=False
+    )
```

### Comparing `bigframes-1.6.0/tests/system/small/test_pandas_options.py` & `bigframes-1.7.0/tests/system/small/test_pandas_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/test_progress_bar.py` & `bigframes-1.7.0/tests/system/small/test_progress_bar.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/test_remote_function.py` & `bigframes-1.7.0/tests/system/small/test_remote_function.py`

 * *Files 0% similar despite different names*

```diff
@@ -619,15 +619,16 @@
         direct_sql = " UNION ALL ".join(
             [f"SELECT {x} AS x, {routine_ref_str}({x}) AS y" for x in src["x"]]
         )
         direct_df = bigquery_client.query(direct_sql).to_dataframe()
 
         indirect_df = bigframes.dataframe.DataFrame(src)
         indirect_df = indirect_df.assign(y=indirect_df.x.apply(square))
-        indirect_df = indirect_df.to_pandas()
+        # TODO(b/340875260): fix type error
+        indirect_df = indirect_df.to_pandas()  # type: ignore
 
         assert_pandas_df_equal(
             direct_df, indirect_df, ignore_order=True, check_index_type=False
         )
 
 
 @pytest.mark.flaky(retries=2, delay=120)
```

### Comparing `bigframes-1.6.0/tests/system/small/test_scalar.py` & `bigframes-1.7.0/tests/system/small/test_scalar.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/small/test_series.py` & `bigframes-1.7.0/tests/system/small/test_series.py`

 * *Files 1% similar despite different names*

```diff
@@ -45,15 +45,16 @@
 
 
 def test_series_construct_nullable_ints():
     bf_result = series.Series(
         [1, 3, bigframes.pandas.NA], index=[0, 4, bigframes.pandas.NA]
     ).to_pandas()
 
-    expected_index = pd.Index(
+    # TODO(b/340885567): fix type error
+    expected_index = pd.Index(  # type: ignore
         [0, 4, None],
         dtype=pd.Int64Dtype(),
     )
     expected = pd.Series([1, 3, pd.NA], dtype=pd.Int64Dtype(), index=expected_index)
 
     pd.testing.assert_series_equal(bf_result, expected)
 
@@ -1425,21 +1426,21 @@
     col_name = "numeric_col"
     assert scalars_df[col_name].dtype == pd.ArrowDtype(pa.decimal128(38, 9))
     bf_result = scalars_df[col_name] + 42
     assert bf_result.size == scalars_df[col_name].size
     assert bf_result.dtype == pd.ArrowDtype(pa.decimal128(38, 9))
 
 
-def test_repr(scalars_dfs):
+def test_series_small_repr(scalars_dfs):
     scalars_df, scalars_pandas_df = scalars_dfs
 
     col_name = "int64_col"
     bf_series = scalars_df[col_name]
     pd_series = scalars_pandas_df[col_name]
-    assert repr(bf_series) == repr(pd_series)
+    assert repr(bf_series) == pd_series.to_string(length=False, dtype=True, name=True)
 
 
 def test_sum(scalars_dfs):
     scalars_df, scalars_pandas_df = scalars_dfs
     col_name = "int64_col"
     bf_result = scalars_df[col_name].sum()
     pd_result = scalars_pandas_df[col_name].sum()
@@ -2953,15 +2954,16 @@
 
     pd_series = pd.Series(["2014-08-15", "2215-08-15", "2016-02-29"]).astype(
         pd.ArrowDtype(pa.string())
     )
 
     bf_series = series.Series(pd_series)
 
-    pd_result = pd_series.astype("date32[day][pyarrow]")
+    # TODO(b/340885567): fix type error
+    pd_result = pd_series.astype("date32[day][pyarrow]")  # type: ignore
     bf_result = bf_series.astype("date32[day][pyarrow]").to_pandas()
 
     pd.testing.assert_series_equal(bf_result, pd_result, check_index_type=False)
 
 
 def test_string_astype_datetime():
     pd_series = pd.Series(
@@ -3657,17 +3659,18 @@
         pytest.param(["z", "x", "a", "b"], False, id="ignore_str_index"),
     ],
 )
 def test_series_explode_w_index(index, ignore_index):
     data = [[], [200.0, 23.12], [4.5, -9.0], [1.0]]
     s = bigframes.pandas.Series(data, index=index)
     pd_s = pd.Series(data, index=index)
+    # TODO(b/340885567): fix type error
     pd.testing.assert_series_equal(
-        s.explode(ignore_index=ignore_index).to_pandas(),
-        pd_s.explode(ignore_index=ignore_index).astype(pd.Float64Dtype()),
+        s.explode(ignore_index=ignore_index).to_pandas(),  # type: ignore
+        pd_s.explode(ignore_index=ignore_index).astype(pd.Float64Dtype()),  # type: ignore
         check_index_type=False,
     )
 
 
 @pytest.mark.parametrize(
     ("ignore_index", "ordered"),
     [
@@ -3677,20 +3680,22 @@
     ],
 )
 def test_series_explode_reserve_order(ignore_index, ordered):
     data = [numpy.random.randint(0, 10, 10) for _ in range(10)]
     s = bigframes.pandas.Series(data)
     pd_s = pd.Series(data)
 
-    res = s.explode(ignore_index=ignore_index).to_pandas(ordered=ordered)
-    pd_res = pd_s.explode(ignore_index=ignore_index).astype(pd.Int64Dtype())
+    # TODO(b/340885567): fix type error
+    res = s.explode(ignore_index=ignore_index).to_pandas(ordered=ordered)  # type: ignore
+    # TODO(b/340885567): fix type error
+    pd_res = pd_s.explode(ignore_index=ignore_index).astype(pd.Int64Dtype())  # type: ignore
+    pd_res.index = pd_res.index.astype(pd.Int64Dtype())
     pd.testing.assert_series_equal(
         res if ordered else res.sort_index(),
         pd_res,
-        check_index_type=False,
     )
 
 
 def test_series_explode_w_aggregate():
     data = [[1, 2, 3], [], numpy.nan, [3, 4]]
     s = bigframes.pandas.Series(data)
     pd_s = pd.Series(data)
```

### Comparing `bigframes-1.6.0/tests/system/small/test_session.py` & `bigframes-1.7.0/tests/system/small/test_session.py`

 * *Files 1% similar despite different names*

```diff
@@ -10,19 +10,20 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import io
 import random
+import re
 import tempfile
 import textwrap
 import time
 import typing
-from typing import List, Sequence
+from typing import List, Optional, Sequence
 
 import google
 import google.cloud.bigquery as bigquery
 import numpy as np
 import pandas as pd
 import pyarrow as pa
 import pytest
@@ -64,37 +65,60 @@
                 CONCAT(t.string_col, "_2") AS my_strings,
                 t.int64_col > 0 AS my_bools,
             FROM `{scalars_table_id}` AS t
             """,
             ["my_strings"],
             id="one_cols_in_query",
         ),
-        pytest.param(
-            "{scalars_table_id}",
-            ["unknown"],
-            marks=pytest.mark.xfail(
-                raises=ValueError,
-                reason="Column `unknown` not found in this table.",
-            ),
-            id="unknown_col",
-        ),
     ],
 )
 def test_read_gbq_w_columns(
     session: bigframes.Session,
     scalars_table_id: str,
     query_or_table: str,
     columns: List[str],
 ):
     df = session.read_gbq(
         query_or_table.format(scalars_table_id=scalars_table_id), columns=columns
     )
     assert df.columns.tolist() == columns
 
 
+def test_read_gbq_w_unknown_column(
+    session: bigframes.Session,
+    scalars_table_id: str,
+):
+    with pytest.raises(
+        ValueError,
+        match=re.escape(
+            "Column 'int63_col' of `columns` not found in this table. Did you mean 'int64_col'?"
+        ),
+    ):
+        session.read_gbq(
+            scalars_table_id,
+            columns=["string_col", "int63_col", "bool_col"],
+        )
+
+
+def test_read_gbq_w_unknown_index_col(
+    session: bigframes.Session,
+    scalars_table_id: str,
+):
+    with pytest.raises(
+        ValueError,
+        match=re.escape(
+            "Column 'int64_two' of `index_col` not found in this table. Did you mean 'int64_too'?"
+        ),
+    ):
+        session.read_gbq(
+            scalars_table_id,
+            index_col=["int64_col", "int64_two"],
+        )
+
+
 @pytest.mark.parametrize(
     ("query_or_table", "index_col"),
     [
         pytest.param(
             "{scalars_table_id}",
             ["bool_col", "int64_col"],
             id="unique_multiindex_table",
@@ -244,22 +268,58 @@
     assert primary_key is not None
     primary_keys = primary_key.columns
     assert len(primary_keys) != 0
 
     df = session.read_gbq(f"{table.project}.{table.dataset_id}.{table.table_id}")
     result = df.head(100).to_pandas()
 
+    # Verify that primary keys are used as the index.
+    assert list(result.index.names) == list(primary_keys)
+
     # Verify that the DataFrame is already sorted by primary keys.
     sorted_result = result.sort_values(primary_keys)
     pd.testing.assert_frame_equal(result, sorted_result)
 
     # Verify that we're working from a snapshot rather than a copy of the table.
     assert "FOR SYSTEM_TIME AS OF TIMESTAMP" in df.sql
 
 
+def test_read_gbq_w_primary_keys_table_and_filters(
+    session: bigframes.Session, usa_names_grouped_table: bigquery.Table
+):
+    """
+    Verify fix for internal issue 338039517, where using filters didn't use the
+    primary keys for indexing / ordering.
+    """
+    # Validate that the table we're querying has a primary key.
+    table = usa_names_grouped_table
+    table_constraints = table.table_constraints
+    assert table_constraints is not None
+    primary_key = table_constraints.primary_key
+    assert primary_key is not None
+    primary_keys = primary_key.columns
+    assert len(primary_keys) != 0
+
+    df = session.read_gbq(
+        f"{table.project}.{table.dataset_id}.{table.table_id}",
+        filters=[
+            ("name", "LIKE", "W%"),
+            ("total_people", ">", 100),
+        ],  # type: ignore
+    )
+    result = df.to_pandas()
+
+    # Verify that primary keys are used as the index.
+    assert list(result.index.names) == list(primary_keys)
+
+    # Verify that the DataFrame is already sorted by primary keys.
+    sorted_result = result.sort_values(primary_keys)
+    pd.testing.assert_frame_equal(result, sorted_result)
+
+
 @pytest.mark.parametrize(
     ("query_or_table", "max_results"),
     [
         pytest.param("{scalars_table_id}", 2, id="two_rows_in_table"),
         pytest.param(
             """SELECT
                 t.float64_col * 2 AS my_floats,
@@ -346,57 +406,76 @@
     "api_method",
     # Test that both methods work as there's a risk that read_gbq /
     # read_gbq_table makes for an infinite loop. Table reads can convert to
     # queries and read_gbq reads from tables.
     ["read_gbq", "read_gbq_table"],
 )
 @pytest.mark.parametrize(
-    ("filters", "table_id", "index_col", "columns"),
+    ("filters", "table_id", "index_col", "columns", "max_results"),
     [
         pytest.param(
             [("_table_suffix", ">=", "1930"), ("_table_suffix", "<=", "1939")],
             _GSOD_ALL_TABLES,
             ["stn", "wban", "year", "mo", "da"],
             ["temp", "max", "min"],
+            100,
             id="all",
         ),
         pytest.param(
             (),  # filters
             _GSOD_1930S,
             (),  # index_col
             ["temp", "max", "min"],
+            None,  # max_results
             id="columns",
         ),
         pytest.param(
             [("_table_suffix", ">=", "1930"), ("_table_suffix", "<=", "1939")],
             _GSOD_ALL_TABLES,
             (),  # index_col,
             (),  # columns
+            None,  # max_results
             id="filters",
         ),
         pytest.param(
             (),  # filters
             _GSOD_1930S,
             ["stn", "wban", "year", "mo", "da"],
             (),  # columns
+            None,  # max_results
             id="index_col",
         ),
+        pytest.param(
+            (),  # filters
+            _GSOD_1930S,
+            (),  # index_col
+            (),  # columns
+            100,  # max_results
+            id="max_results",
+        ),
     ],
 )
 def test_read_gbq_wildcard(
     session: bigframes.Session,
     api_method: str,
     filters,
     table_id: str,
     index_col: Sequence[str],
     columns: Sequence[str],
+    max_results: Optional[int],
 ):
     table_metadata = session.bqclient.get_table(table_id)
     method = getattr(session, api_method)
-    df = method(table_id, filters=filters, index_col=index_col, columns=columns)
+    df = method(
+        table_id,
+        filters=filters,
+        index_col=index_col,
+        columns=columns,
+        max_results=max_results,
+    )
     num_rows, num_columns = df.shape
 
     if index_col:
         assert list(df.index.names) == list(index_col)
     else:
         assert df.index.name is None
 
@@ -486,23 +565,25 @@
     result = df.to_pandas()
     expected = scalars_pandas_df
 
     pd.testing.assert_frame_equal(result, expected)
 
 
 def test_read_pandas_series(session):
-    idx = pd.Index([2, 7, 1, 2, 8], dtype=pd.Int64Dtype())
+    # TODO(b/340887657): fix type error
+    idx = pd.Index([2, 7, 1, 2, 8], dtype=pd.Int64Dtype())  # type: ignore
     pd_series = pd.Series([3, 1, 4, 1, 5], dtype=pd.Int64Dtype(), index=idx)
     bf_series = session.read_pandas(pd_series)
 
     pd.testing.assert_series_equal(bf_series.to_pandas(), pd_series)
 
 
 def test_read_pandas_index(session):
-    pd_idx = pd.Index([2, 7, 1, 2, 8], dtype=pd.Int64Dtype())
+    # TODO(b/340887657): fix type error
+    pd_idx = pd.Index([2, 7, 1, 2, 8], dtype=pd.Int64Dtype())  # type: ignore
     bf_idx = session.read_pandas(pd_idx)
 
     pd.testing.assert_index_equal(bf_idx.to_pandas(), pd_idx)
 
 
 def test_read_pandas_w_unsupported_mixed_dtype(session):
     with pytest.raises(pa.ArrowInvalid, match="Could not convert"):
@@ -512,15 +593,16 @@
 def test_read_pandas_inline_respects_location():
     options = bigframes.BigQueryOptions(location="europe-west1")
     session = bigframes.Session(options)
 
     df = session.read_pandas(pd.DataFrame([[1, 2, 3], [4, 5, 6]]))
     repr(df)
 
-    table = session.bqclient.get_table(df.query_job.destination)
+    # TODO(b/340887657): fix type error
+    table = session.bqclient.get_table(df.query_job.destination)  # type: ignore
     assert table.location == "europe-west1"
 
 
 def test_read_pandas_col_label_w_space(session: bigframes.Session):
     expected = pd.DataFrame(
         {
             "Animal": ["Falcon", "Falcon", "Parrot", "Parrot"],
```

### Comparing `bigframes-1.6.0/tests/system/small/test_window.py` & `bigframes-1.7.0/tests/system/small/test_window.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/system/utils.py` & `bigframes-1.7.0/tests/system/utils.py`

 * *Files 4% similar despite different names*

```diff
@@ -11,27 +11,44 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import base64
 import decimal
 import functools
-from typing import Iterable, Optional, Set
+from typing import Iterable, Optional, Set, Union
 
 import geopandas as gpd  # type: ignore
 import google.api_core.operation
 from google.cloud import bigquery, functions_v2
 from google.cloud.functions_v2.types import functions
 import numpy as np
 import pandas as pd
 import pyarrow as pa  # type: ignore
 import pytest
 
 from bigframes.functions import remote_function
 
+ML_REGRESSION_METRICS = [
+    "mean_absolute_error",
+    "mean_squared_error",
+    "mean_squared_log_error",
+    "median_absolute_error",
+    "r2_score",
+    "explained_variance",
+]
+ML_CLASSFICATION_METRICS = [
+    "precision",
+    "recall",
+    "accuracy",
+    "f1_score",
+    "log_loss",
+    "roc_auc",
+]
+
 
 def skip_legacy_pandas(test):
     @functools.wraps(test)
     def wrapper(*args, **kwds):
         if pd.__version__.startswith("1."):
             pytest.skip("Skips pandas 1.x as not compatible with 2.x behavior.")
         return test(*args, **kwds)
@@ -245,14 +262,41 @@
         try:
             pd.testing.assert_series_equal(actual[column], expected[column], **kwargs)
         except AssertionError:
             # Allow for sign difference per column
             pd.testing.assert_series_equal(-actual[column], expected[column], **kwargs)
 
 
+def check_pandas_df_schema_and_index(
+    pd_df: pd.DataFrame,
+    columns: Iterable,
+    index: Union[int, Iterable],
+    col_exact: bool = True,
+):
+    """Check pandas df schema and index. But not the values.
+
+    Args:
+        pd_df: the input pandas df
+        columns: target columns to check with
+        index: int or Iterable. If int, only check the length (index size) of the df. If Iterable, check index values match
+        col_exact: If True, check the columns param are exact match. Otherwise only check the df contains all of those columns
+    """
+    if col_exact:
+        assert list(pd_df.columns) == list(columns)
+    else:
+        assert set(columns) <= set(pd_df.columns)
+
+    if isinstance(index, int):
+        assert len(pd_df) == index
+    elif isinstance(index, Iterable):
+        assert list(pd_df.index) == list(index)
+    else:
+        raise ValueError("Unsupported index type.")
+
+
 def get_remote_function_endpoints(
     bigquery_client: bigquery.Client, dataset_id: str
 ) -> Set[str]:
     """Get endpoints used by the remote functions in a datset"""
     endpoints = set()
     routines = bigquery_client.list_routines(dataset=dataset_id)
     for routine in routines:
```

### Comparing `bigframes-1.6.0/tests/unit/__init__.py` & `bigframes-1.7.0/tests/unit/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/_config/__init__.py` & `bigframes-1.7.0/tests/unit/_config/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/_config/test_bigquery_options.py` & `bigframes-1.7.0/tests/unit/_config/test_bigquery_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/core/__init__.py` & `bigframes-1.7.0/tests/unit/core/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/core/test_bf_utils.py` & `bigframes-1.7.0/tests/unit/core/test_bf_utils.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/core/test_blocks.py` & `bigframes-1.7.0/tests/unit/core/test_blocks.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/core/test_expression.py` & `bigframes-1.7.0/tests/unit/core/test_expression.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/core/test_log_adapter.py` & `bigframes-1.7.0/tests/unit/core/test_log_adapter.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/ml/__init__.py` & `bigframes-1.7.0/tests/unit/ml/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/ml/test_api_primitives.py` & `bigframes-1.7.0/tests/unit/ml/test_api_primitives.py`

 * *Files 10% similar despite different names*

```diff
@@ -26,16 +26,17 @@
 
     estimator = bigframes.ml.linear_model.LinearRegression(fit_intercept=False)
     assert estimator.__repr__() == "LinearRegression(fit_intercept=False)"
 
     estimator = bigframes.ml.linear_model.LinearRegression(fit_intercept=True)
     assert estimator.__repr__() == "LinearRegression()"
 
-    estimator = bigframes.ml.decomposition.PCA(n_components=7)
-    assert estimator.__repr__() == "PCA(n_components=7)"
+    # TODO(b/340891292): fix type error
+    pca_estimator = bigframes.ml.decomposition.PCA(n_components=7)
+    assert pca_estimator.__repr__() == "PCA(n_components=7)"
 
 
 @pytest.mark.skipif(sklearn_linear_model is None, reason="requires sklearn")
 def test_base_estimator_repr_matches_sklearn():
     estimator = bigframes.ml.linear_model.LinearRegression()
     sklearn_estimator = sklearn_linear_model.LinearRegression()
     assert estimator.__repr__() == sklearn_estimator.__repr__()
@@ -44,10 +45,11 @@
     sklearn_estimator = sklearn_linear_model.LinearRegression(fit_intercept=False)
     assert estimator.__repr__() == sklearn_estimator.__repr__()
 
     estimator = bigframes.ml.linear_model.LinearRegression(fit_intercept=True)
     sklearn_estimator = sklearn_linear_model.LinearRegression(fit_intercept=True)
     assert estimator.__repr__() == sklearn_estimator.__repr__()
 
-    estimator = bigframes.ml.decomposition.PCA(n_components=7)
+    # TODO(b/340891292): fix type error
+    pca_estimator = bigframes.ml.decomposition.PCA(n_components=7)
     sklearn_estimator = sklearn_decomposition.PCA(n_components=7)
-    assert estimator.__repr__() == sklearn_estimator.__repr__()
+    assert pca_estimator.__repr__() == sklearn_estimator.__repr__()
```

### Comparing `bigframes-1.6.0/tests/unit/ml/test_compose.py` & `bigframes-1.7.0/tests/unit/ml/test_compose.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/ml/test_golden_sql.py` & `bigframes-1.7.0/tests/unit/ml/test_golden_sql.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/ml/test_pipeline.py` & `bigframes-1.7.0/tests/unit/ml/test_pipeline.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/ml/test_sql.py` & `bigframes-1.7.0/tests/unit/ml/test_sql.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/resources.py` & `bigframes-1.7.0/tests/unit/resources.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/session/__init__.py` & `bigframes-1.7.0/tests/unit/session/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/session/test_clients.py` & `bigframes-1.7.0/tests/unit/session/test_clients.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/session/test_io_bigquery.py` & `bigframes-1.7.0/tests/unit/session/test_io_bigquery.py`

 * *Files 12% similar despite different names*

```diff
@@ -9,14 +9,15 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import datetime
+import re
 from typing import Iterable
 
 import google.cloud.bigquery as bigquery
 import pytest
 
 import bigframes
 from bigframes.core import log_adapter
@@ -201,110 +202,144 @@
 )
 def test_bq_schema_to_sql(schema: Iterable[bigquery.SchemaField], expected: str):
     sql = io_bq.bq_schema_to_sql(schema)
     assert sql == expected
 
 
 @pytest.mark.parametrize(
-    ("query_or_table", "index_cols", "columns", "filters", "expected_output"),
+    (
+        "query_or_table",
+        "index_cols",
+        "columns",
+        "filters",
+        "max_results",
+        "time_travel_timestamp",
+        "expected_output",
+    ),
     [
         pytest.param(
             "test_table",
-            [],
-            [],
-            ["date_col", ">", "2022-10-20"],
-            None,
-            marks=pytest.mark.xfail(
-                raises=ValueError,
-            ),
-            id="raise_error",
-        ),
-        pytest.param(
-            "test_table",
             ["row_index"],
             ["string_col"],
             [
                 (("rowindex", "not in", [0, 6]),),
                 (("string_col", "in", ["Hello, World!", ""]),),
             ],
+            123,  # max_results,
+            datetime.datetime(2024, 5, 14, 12, 42, 36, 125125),
             (
-                "SELECT `row_index`, `string_col` FROM `test_table` AS sub WHERE "
-                "`rowindex` NOT IN (0, 6) OR `string_col` IN ('Hello, World!', "
-                "'')"
+                "SELECT `row_index`, `string_col` FROM `test_table` "
+                "FOR SYSTEM_TIME AS OF TIMESTAMP('2024-05-14T12:42:36.125125') "
+                "WHERE `rowindex` NOT IN (0, 6) OR `string_col` IN ('Hello, World!', "
+                "'') LIMIT 123"
             ),
             id="table-all_params-filter_or_operation",
         ),
         pytest.param(
-            """SELECT
-                rowindex,
-                string_col,
-            FROM `test_table` AS t
-            """,
+            (
+                """SELECT
+                    rowindex,
+                    string_col,
+                FROM `test_table` AS t
+                """
+            ),
             ["rowindex"],
             ["string_col"],
             [
                 ("rowindex", "<", 4),
                 ("string_col", "==", "Hello, World!"),
             ],
-            """SELECT `rowindex`, `string_col` FROM (SELECT
-                rowindex,
-                string_col,
-            FROM `test_table` AS t
-            ) AS sub WHERE `rowindex` < 4 AND `string_col` = 'Hello, World!'""",
+            123,  # max_results,
+            datetime.datetime(2024, 5, 14, 12, 42, 36, 125125),
+            (
+                """SELECT `rowindex`, `string_col` FROM (SELECT
+                    rowindex,
+                    string_col,
+                FROM `test_table` AS t
+                ) """
+                "FOR SYSTEM_TIME AS OF TIMESTAMP('2024-05-14T12:42:36.125125') "
+                "WHERE `rowindex` < 4 AND `string_col` = 'Hello, World!' "
+                "LIMIT 123"
+            ),
             id="subquery-all_params-filter_and_operation",
         ),
         pytest.param(
             "test_table",
             [],
             ["col_a", "col_b"],
             [],
-            "SELECT `col_a`, `col_b` FROM `test_table` AS sub",
+            None,  # max_results
+            None,  # time_travel_timestampe
+            "SELECT `col_a`, `col_b` FROM `test_table`",
             id="table-columns",
         ),
         pytest.param(
             "test_table",
             [],
             [],
             [("date_col", ">", "2022-10-20")],
-            "SELECT * FROM `test_table` AS sub WHERE `date_col` > '2022-10-20'",
+            None,  # max_results
+            None,  # time_travel_timestampe
+            "SELECT * FROM `test_table` WHERE `date_col` > '2022-10-20'",
             id="table-filter",
         ),
         pytest.param(
             "test_table*",
             [],
             [],
             [],
-            "SELECT * FROM `test_table*` AS sub",
+            None,  # max_results
+            None,  # time_travel_timestampe
+            "SELECT * FROM `test_table*`",
             id="wildcard-no_params",
         ),
         pytest.param(
             "test_table*",
             [],
             [],
             [("_TABLE_SUFFIX", ">", "2022-10-20")],
-            "SELECT * FROM `test_table*` AS sub WHERE `_TABLE_SUFFIX` > '2022-10-20'",
+            None,  # max_results
+            None,  # time_travel_timestampe
+            "SELECT * FROM `test_table*` WHERE `_TABLE_SUFFIX` > '2022-10-20'",
             id="wildcard-filter",
         ),
     ],
 )
-def test_to_query(query_or_table, index_cols, columns, filters, expected_output):
+def test_to_query(
+    query_or_table,
+    index_cols,
+    columns,
+    filters,
+    max_results,
+    time_travel_timestamp,
+    expected_output,
+):
     query = io_bq.to_query(
         query_or_table,
-        index_cols,
-        columns,
-        filters,
+        index_cols=index_cols,
+        columns=columns,
+        filters=filters,
+        max_results=max_results,
+        time_travel_timestamp=time_travel_timestamp,
     )
     assert query == expected_output
 
 
 @pytest.mark.parametrize(
-    ("query_or_table", "filters", "expected_output"),
-    [],
+    ("filters", "expected_message"),
+    (
+        pytest.param(
+            ["date_col", ">", "2022-10-20"],
+            "Elements of filters must be tuples of length 3, but got 'd'",
+        ),
+    ),
 )
-def test_to_query_with_wildcard_table(query_or_table, filters, expected_output):
-    query = io_bq.to_query(
-        query_or_table,
-        (),  # index_cols
-        (),  # columns
-        filters,
-    )
-    assert query == expected_output
+def test_to_query_fails_with_bad_filters(filters, expected_message):
+    with pytest.raises(ValueError, match=re.escape(expected_message)):
+        io_bq.to_query(
+            "test_table",
+            index_cols=(),
+            columns=(),
+            filters=filters,
+            max_results=None,
+            time_travel_timestamp=None,
+        )
```

### Comparing `bigframes-1.6.0/tests/unit/session/test_io_pandas.py` & `bigframes-1.7.0/tests/unit/session/test_io_pandas.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/session/test_session.py` & `bigframes-1.7.0/tests/unit/session/test_session.py`

 * *Files 3% similar despite different names*

```diff
@@ -175,14 +175,17 @@
             table_ref, (google.cloud.bigquery.SchemaField("col", "INTEGER"),)
         )
         table._properties["numRows"] = "1000000000"
         table._properties["location"] = session._location
         return table
 
     session.bqclient.get_table = get_table_mock
+    session.bqclient.query_and_wait.return_value = (
+        {"total_count": 3, "distinct_count": 2},
+    )
 
     with pytest.warns(UserWarning, match=re.escape("use_cache=False")):
         df = session.read_gbq("my-project.my_dataset.my_table")
 
     assert "1999-01-02T03:04:05.678901" in df.sql
 
 
@@ -196,14 +199,15 @@
 
     See internal issue 335727141.
     """
     table = copy.deepcopy(table)
     bqclient = mock.create_autospec(google.cloud.bigquery.Client, instance=True)
     bqclient.project = "test-project"
     bqclient.get_table.return_value = table
+    bqclient.query_and_wait.return_value = ({"total_count": 3, "distinct_count": 2},)
     session = resources.create_bigquery_session(bqclient=bqclient)
     table._properties["location"] = session._location
 
     with pytest.warns(bigframes.exceptions.DefaultIndexWarning):
         session.read_gbq("my-project.my_dataset.my_table")
 
 
@@ -218,14 +222,15 @@
 
     See internal issue 335727141.
     """
     table = copy.deepcopy(table)
     bqclient = mock.create_autospec(google.cloud.bigquery.Client, instance=True)
     bqclient.project = "test-project"
     bqclient.get_table.return_value = table
+    bqclient.query_and_wait.return_value = ({"total_count": 4, "distinct_count": 3},)
     session = resources.create_bigquery_session(bqclient=bqclient)
     table._properties["location"] = session._location
 
     # No warnings raised because we set the option allowing the default indexes.
     with warnings.catch_warnings():
         warnings.simplefilter("error", bigframes.exceptions.DefaultIndexWarning)
         df = session.read_gbq(
```

### Comparing `bigframes-1.6.0/tests/unit/test_clients.py` & `bigframes-1.7.0/tests/unit/test_clients.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/test_compute_options.py` & `bigframes-1.7.0/tests/unit/test_compute_options.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/test_core.py` & `bigframes-1.7.0/tests/unit/test_core.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/test_dataframe.py` & `bigframes-1.7.0/tests/unit/test_dataframe.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/test_dtypes.py` & `bigframes-1.7.0/tests/unit/test_dtypes.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/test_features.py` & `bigframes-1.7.0/tests/unit/test_features.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/test_formatting_helper.py` & `bigframes-1.7.0/tests/unit/test_formatting_helper.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/test_formatting_helpers.py` & `bigframes-1.7.0/tests/unit/test_formatting_helpers.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/tests/unit/test_pandas.py` & `bigframes-1.7.0/tests/unit/test_pandas.py`

 * *Files 5% similar despite different names*

```diff
@@ -91,15 +91,16 @@
 
 def test_cut_raises_with_labels():
     with pytest.raises(
         NotImplementedError,
         match="The 'labels' parameter must be either False or None.",
     ):
         mock_series = mock.create_autospec(bigframes.pandas.Series, instance=True)
-        bigframes.pandas.cut(mock_series, 4, labels=["a", "b", "c", "d"])
+        # TODO(b/340893280): fix type error
+        bigframes.pandas.cut(mock_series, 4, labels=["a", "b", "c", "d"])  # type: ignore
 
 
 @pytest.mark.parametrize(
     ("bins",),
     (
         (0,),
         (-1,),
```

### Comparing `bigframes-1.6.0/tests/unit/test_remote_function.py` & `bigframes-1.7.0/tests/unit/test_remote_function.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/cpython/LICENSE` & `bigframes-1.7.0/third_party/bigframes_vendored/cpython/LICENSE`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/cpython/_pprint.py` & `bigframes-1.7.0/third_party/bigframes_vendored/cpython/_pprint.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/LICENSE` & `bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/LICENSE`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/__init__.py` & `bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/_pandas_helpers.py` & `bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/_pandas_helpers.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/__init__.py` & `bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/__init__.py` & `bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/test_pandas_helpers.py` & `bigframes-1.7.0/third_party/bigframes_vendored/google_cloud_bigquery/tests/unit/test_pandas_helpers.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/ibis/LICENSE.txt` & `bigframes-1.7.0/third_party/bigframes_vendored/ibis/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/ibis/README.md` & `bigframes-1.7.0/third_party/bigframes_vendored/ibis/README.md`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/ibis/backends/bigquery/compiler.py` & `bigframes-1.7.0/third_party/bigframes_vendored/ibis/backends/bigquery/compiler.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/ibis/backends/bigquery/datatypes.py` & `bigframes-1.7.0/third_party/bigframes_vendored/ibis/backends/bigquery/datatypes.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/ibis/backends/bigquery/registry.py` & `bigframes-1.7.0/third_party/bigframes_vendored/ibis/backends/bigquery/registry.py`

 * *Files 8% similar despite different names*

```diff
@@ -28,23 +28,45 @@
 
 
 def _generate_array(translator, op: vendored_ibis_ops.GenerateArray):
     arg = translator.translate(op.arg)
     return f"GENERATE_ARRAY(0, {arg})"
 
 
+def _safe_cast_to_datetime(translator, op: vendored_ibis_ops.SafeCastToDatetime):
+    arg = translator.translate(op.arg)
+    return f"SAFE_CAST({arg} AS DATETIME)"
+
+
 def _quantile(translator, op: ibis_reductions.Quantile):
     arg = translator.translate(op.arg)
     quantile = translator.translate(op.quantile)
     return f"PERCENTILE_CONT({arg}, {quantile})"
 
 
+def _array_aggregate(translator, op: vendored_ibis_ops.ArrayAggregate):
+    """This method provides the same functionality as the collect() method in Ibis, with
+    the added capability of ordering the results using order_by.
+    https://github.com/ibis-project/ibis/issues/9170
+    """
+    arg = translator.translate(op.arg)
+
+    order_by_sql = ""
+    if len(op.order_by) > 0:
+        order_by = ", ".join([translator.translate(column) for column in op.order_by])
+        order_by_sql = f"ORDER BY {order_by}"
+
+    return f"ARRAY_AGG({arg} IGNORE NULLS {order_by_sql})"
+
+
 patched_ops = {
     vendored_ibis_ops.ApproximateMultiQuantile: _approx_quantiles,  # type:ignore
     vendored_ibis_ops.FirstNonNullValue: _first_non_null_value,  # type:ignore
     vendored_ibis_ops.LastNonNullValue: _last_non_null_value,  # type:ignore
     vendored_ibis_ops.ToJsonString: _to_json_string,  # type:ignore
     vendored_ibis_ops.GenerateArray: _generate_array,  # type:ignore
+    vendored_ibis_ops.SafeCastToDatetime: _safe_cast_to_datetime,  # type:ignore
     ibis_reductions.Quantile: _quantile,  # type:ignore
+    vendored_ibis_ops.ArrayAggregate: _array_aggregate,  # type:ignore
 }
 
 OPERATION_REGISTRY.update(patched_ops)
```

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/ibis/expr/operations/analytic.py` & `bigframes-1.7.0/third_party/bigframes_vendored/ibis/expr/operations/analytic.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/ibis/expr/operations/reductions.py` & `bigframes-1.7.0/third_party/bigframes_vendored/ibis/expr/operations/reductions.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,11 +1,13 @@
 # Contains code from https://github.com/ibis-project/ibis/blob/master/ibis/expr/operations/reductions.py
 
 from __future__ import annotations
 
+import ibis.common.annotations as ibis_annotations
+from ibis.common.typing import VarTuple
 import ibis.expr.datatypes as dt
 import ibis.expr.operations.core as ibis_ops_core
 from ibis.expr.operations.reductions import Filterable, Reduction
 
 
 class ApproximateMultiQuantile(Filterable, Reduction):
     """Calculate (approximately) evenly-spaced quantiles.
@@ -14,10 +16,22 @@
     """
 
     arg: ibis_ops_core.Value
     num_bins: ibis_ops_core.Value[dt.Int64]
     dtype = dt.Array(dt.float64)
 
 
-__all__ = [
-    "ApproximateMultiQuantile",
-]
+class ArrayAggregate(Filterable, Reduction):
+    """
+    Collects the elements of this expression into an ordered array. Similar to
+    the ibis `ArrayCollect`, but adds `order_by_*` and `distinct_only` parameters.
+    """
+
+    arg: ibis_ops_core.Column
+    order_by: VarTuple[ibis_ops_core.Value] = ()
+
+    @ibis_annotations.attribute
+    def dtype(self):
+        return dt.Array(self.arg.dtype)
+
+
+__all__ = ["ApproximateMultiQuantile", "ArrayAggregate"]
```

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/AUTHORS.md` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/AUTHORS.md`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/LICENSE` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/LICENSE`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/README.md` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/README.md`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/_config/config.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/_config/config.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/accessors.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/arrays/arrow/accessors.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/arrays/datetimelike.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/arrays/datetimelike.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/common.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/common.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/align.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/align.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/common.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/common.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/engines.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/engines.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/eval.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/eval.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/expr.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/expr.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/ops.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/ops.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/parsing.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/parsing.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/computation/scope.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/computation/scope.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/config_init.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/config_init.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/dtypes/inference.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/dtypes/inference.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/frame.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/frame.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/generic.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/generic.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/groupby/__init__.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/groupby/__init__.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/indexes/accessor.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/indexes/accessor.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/indexes/base.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/indexes/base.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/indexes/multi.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/indexes/multi.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/indexing.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/indexing.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/reshape/concat.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/reshape/concat.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/reshape/encoding.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/reshape/encoding.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/reshape/merge.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/reshape/merge.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/reshape/tile.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/reshape/tile.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/series.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/series.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/strings/accessor.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/strings/accessor.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/tools/datetimes.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/tools/datetimes.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/core/window/rolling.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/core/window/rolling.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/common.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/common.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/gbq.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/gbq.py`

 * *Files 2% similar despite different names*

```diff
@@ -92,23 +92,23 @@
             2                 Zachary         Britton          94.591039
             <BLANKLINE>
             [2 rows x 3 columns]
 
         Reading data with `columns` and `filters` parameters:
 
             >>> columns = ['pitcherFirstName', 'pitcherLastName', 'year', 'pitchSpeed']
-            >>> filters = [('year', '==', 2016), ('pitcherFirstName', 'in', ['John', 'Doe']), ('pitcherLastName', 'in', ['Gant'])]
+            >>> filters = [('year', '==', 2016), ('pitcherFirstName', 'in', ['John', 'Doe']), ('pitcherLastName', 'in', ['Gant']), ('pitchSpeed', '>', 94)]
             >>> df = bpd.read_gbq(
             ...             "bigquery-public-data.baseball.games_wide",
             ...             columns=columns,
             ...             filters=filters,
             ...         )
             >>> df.head(1)
-                     pitcherFirstName	pitcherLastName     year	pitchSpeed
-            0	                 John	           Gant	    2016            82
+              pitcherFirstName pitcherLastName  year  pitchSpeed
+            0             John            Gant  2016          95
             <BLANKLINE>
             [1 rows x 4 columns]
 
         Args:
             query_or_table (str):
                 A SQL string to be executed or a BigQuery table to be read. The
                 table must be specified in the format of
```

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/parquet.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/parquet.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/parsers/readers.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/parsers/readers.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/io/pickle.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/io/pickle.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/pandas/_typing.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/pandas/_typing.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/plotting/_core.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/plotting/_core.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/util/_exceptions.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/util/_exceptions.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/pandas/util/_validators.py` & `bigframes-1.7.0/third_party/bigframes_vendored/pandas/util/_validators.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/COPYING` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/COPYING`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/base.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/base.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/cluster/_kmeans.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/cluster/_kmeans.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/compose/_column_transformer.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/compose/_column_transformer.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/decomposition/_pca.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/decomposition/_pca.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/ensemble/_forest.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/ensemble/_forest.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/linear_model/_base.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/linear_model/_base.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/linear_model/_logistic.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/linear_model/_logistic.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/metrics/_classification.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/metrics/_classification.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/metrics/_ranking.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/metrics/_ranking.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/metrics/_regression.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/metrics/_regression.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/metrics/pairwise.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/metrics/pairwise.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/pipeline.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/pipeline.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/preprocessing/_data.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/preprocessing/_data.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/preprocessing/_discretization.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/preprocessing/_discretization.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/preprocessing/_encoder.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/preprocessing/_encoder.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/sklearn/preprocessing/_label.py` & `bigframes-1.7.0/third_party/bigframes_vendored/sklearn/preprocessing/_label.py`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/xgboost/LICENSE` & `bigframes-1.7.0/third_party/bigframes_vendored/xgboost/LICENSE`

 * *Files identical despite different names*

### Comparing `bigframes-1.6.0/third_party/bigframes_vendored/xgboost/sklearn.py` & `bigframes-1.7.0/third_party/bigframes_vendored/xgboost/sklearn.py`

 * *Files identical despite different names*

